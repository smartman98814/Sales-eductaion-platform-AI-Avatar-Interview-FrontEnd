function D0(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function M0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Wp={exports:{}},ja={},qp={exports:{}},ie={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qs=Symbol.for("react.element"),A0=Symbol.for("react.portal"),L0=Symbol.for("react.fragment"),j0=Symbol.for("react.strict_mode"),U0=Symbol.for("react.profiler"),F0=Symbol.for("react.provider"),B0=Symbol.for("react.context"),V0=Symbol.for("react.forward_ref"),z0=Symbol.for("react.suspense"),W0=Symbol.for("react.memo"),q0=Symbol.for("react.lazy"),nh=Symbol.iterator;function $0(t){return t===null||typeof t!="object"?null:(t=nh&&t[nh]||t["@@iterator"],typeof t=="function"?t:null)}var $p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Hp=Object.assign,Kp={};function Dr(t,e,n){this.props=t,this.context=e,this.refs=Kp,this.updater=n||$p}Dr.prototype.isReactComponent={};Dr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Dr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Gp(){}Gp.prototype=Dr.prototype;function Iu(t,e,n){this.props=t,this.context=e,this.refs=Kp,this.updater=n||$p}var Ou=Iu.prototype=new Gp;Ou.constructor=Iu;Hp(Ou,Dr.prototype);Ou.isPureReactComponent=!0;var ih=Array.isArray,Jp=Object.prototype.hasOwnProperty,Nu={current:null},Qp={key:!0,ref:!0,__self:!0,__source:!0};function Yp(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Jp.call(e,i)&&!Qp.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:qs,type:t,key:s,ref:o,props:r,_owner:Nu.current}}function H0(t,e){return{$$typeof:qs,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Du(t){return typeof t=="object"&&t!==null&&t.$$typeof===qs}function K0(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var rh=/\/+/g;function dc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?K0(""+t.key):e.toString(36)}function wo(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case qs:case A0:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+dc(o,0):i,ih(r)?(n="",t!=null&&(n=t.replace(rh,"$&/")+"/"),wo(r,e,n,"",function(l){return l})):r!=null&&(Du(r)&&(r=H0(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(rh,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",ih(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+dc(s,a);o+=wo(s,e,n,c,r)}else if(c=$0(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+dc(s,a++),o+=wo(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function no(t,e,n){if(t==null)return t;var i=[],r=0;return wo(t,i,"","",function(s){return e.call(n,s,r++)}),i}function G0(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var lt={current:null},Eo={transition:null},J0={ReactCurrentDispatcher:lt,ReactCurrentBatchConfig:Eo,ReactCurrentOwner:Nu};function Xp(){throw Error("act(...) is not supported in production builds of React.")}ie.Children={map:no,forEach:function(t,e,n){no(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return no(t,function(){e++}),e},toArray:function(t){return no(t,function(e){return e})||[]},only:function(t){if(!Du(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ie.Component=Dr;ie.Fragment=L0;ie.Profiler=U0;ie.PureComponent=Iu;ie.StrictMode=j0;ie.Suspense=z0;ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J0;ie.act=Xp;ie.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Hp({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Nu.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Jp.call(e,c)&&!Qp.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:qs,type:t.type,key:r,ref:s,props:i,_owner:o}};ie.createContext=function(t){return t={$$typeof:B0,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:F0,_context:t},t.Consumer=t};ie.createElement=Yp;ie.createFactory=function(t){var e=Yp.bind(null,t);return e.type=t,e};ie.createRef=function(){return{current:null}};ie.forwardRef=function(t){return{$$typeof:V0,render:t}};ie.isValidElement=Du;ie.lazy=function(t){return{$$typeof:q0,_payload:{_status:-1,_result:t},_init:G0}};ie.memo=function(t,e){return{$$typeof:W0,type:t,compare:e===void 0?null:e}};ie.startTransition=function(t){var e=Eo.transition;Eo.transition={};try{t()}finally{Eo.transition=e}};ie.unstable_act=Xp;ie.useCallback=function(t,e){return lt.current.useCallback(t,e)};ie.useContext=function(t){return lt.current.useContext(t)};ie.useDebugValue=function(){};ie.useDeferredValue=function(t){return lt.current.useDeferredValue(t)};ie.useEffect=function(t,e){return lt.current.useEffect(t,e)};ie.useId=function(){return lt.current.useId()};ie.useImperativeHandle=function(t,e,n){return lt.current.useImperativeHandle(t,e,n)};ie.useInsertionEffect=function(t,e){return lt.current.useInsertionEffect(t,e)};ie.useLayoutEffect=function(t,e){return lt.current.useLayoutEffect(t,e)};ie.useMemo=function(t,e){return lt.current.useMemo(t,e)};ie.useReducer=function(t,e,n){return lt.current.useReducer(t,e,n)};ie.useRef=function(t){return lt.current.useRef(t)};ie.useState=function(t){return lt.current.useState(t)};ie.useSyncExternalStore=function(t,e,n){return lt.current.useSyncExternalStore(t,e,n)};ie.useTransition=function(){return lt.current.useTransition()};ie.version="18.3.1";qp.exports=ie;var E=qp.exports;const Zp=M0(E),Q0=D0({__proto__:null,default:Zp},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y0=E,X0=Symbol.for("react.element"),Z0=Symbol.for("react.fragment"),ek=Object.prototype.hasOwnProperty,tk=Y0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nk={key:!0,ref:!0,__self:!0,__source:!0};function em(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)ek.call(e,i)&&!nk.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:X0,type:t,key:s,ref:o,props:r,_owner:tk.current}}ja.Fragment=Z0;ja.jsx=em;ja.jsxs=em;Wp.exports=ja;var f=Wp.exports,ol={},tm={exports:{}},_t={},nm={exports:{}},im={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,G){var j=z.length;z.push(G);e:for(;0<j;){var ce=j-1>>>1,fe=z[ce];if(0<r(fe,G))z[ce]=G,z[j]=fe,j=ce;else break e}}function n(z){return z.length===0?null:z[0]}function i(z){if(z.length===0)return null;var G=z[0],j=z.pop();if(j!==G){z[0]=j;e:for(var ce=0,fe=z.length,It=fe>>>1;ce<It;){var Ct=2*(ce+1)-1,nn=z[Ct],ft=Ct+1,mi=z[ft];if(0>r(nn,j))ft<fe&&0>r(mi,nn)?(z[ce]=mi,z[ft]=j,ce=ft):(z[ce]=nn,z[Ct]=j,ce=Ct);else if(ft<fe&&0>r(mi,j))z[ce]=mi,z[ft]=j,ce=ft;else break e}}return G}function r(z,G){var j=z.sortIndex-G.sortIndex;return j!==0?j:z.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,m=!1,b=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(z){for(var G=n(l);G!==null;){if(G.callback===null)i(l);else if(G.startTime<=z)i(l),G.sortIndex=G.expirationTime,e(c,G);else break;G=n(l)}}function p(z){if(v=!1,S(z),!b)if(n(c)!==null)b=!0,ht(k);else{var G=n(l);G!==null&&Ke(p,G.startTime-z)}}function k(z,G){b=!1,v&&(v=!1,g(P),P=-1),m=!0;var j=h;try{for(S(G),d=n(c);d!==null&&(!(d.expirationTime>G)||z&&!N());){var ce=d.callback;if(typeof ce=="function"){d.callback=null,h=d.priorityLevel;var fe=ce(d.expirationTime<=G);G=t.unstable_now(),typeof fe=="function"?d.callback=fe:d===n(c)&&i(c),S(G)}else i(c);d=n(c)}if(d!==null)var It=!0;else{var Ct=n(l);Ct!==null&&Ke(p,Ct.startTime-G),It=!1}return It}finally{d=null,h=j,m=!1}}var T=!1,x=null,P=-1,I=5,R=-1;function N(){return!(t.unstable_now()-R<I)}function $(){if(x!==null){var z=t.unstable_now();R=z;var G=!0;try{G=x(!0,z)}finally{G?L():(T=!1,x=null)}}else T=!1}var L;if(typeof y=="function")L=function(){y($)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,ve=Y.port2;Y.port1.onmessage=$,L=function(){ve.postMessage(null)}}else L=function(){w($,0)};function ht(z){x=z,T||(T=!0,L())}function Ke(z,G){P=w(function(){z(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){b||m||(b=!0,ht(k))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(z){switch(h){case 1:case 2:case 3:var G=3;break;default:G=h}var j=h;h=G;try{return z()}finally{h=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,G){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var j=h;h=z;try{return G()}finally{h=j}},t.unstable_scheduleCallback=function(z,G,j){var ce=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?ce+j:ce):j=ce,z){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=j+fe,z={id:u++,callback:G,priorityLevel:z,startTime:j,expirationTime:fe,sortIndex:-1},j>ce?(z.sortIndex=j,e(l,z),n(c)===null&&z===n(l)&&(v?(g(P),P=-1):v=!0,Ke(p,j-ce))):(z.sortIndex=fe,e(c,z),b||m||(b=!0,ht(k))),z},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(z){var G=h;return function(){var j=h;h=G;try{return z.apply(this,arguments)}finally{h=j}}}})(im);nm.exports=im;var ik=nm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rk=E,Pt=ik;function F(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rm=new Set,bs={};function Ui(t,e){Cr(t,e),Cr(t+"Capture",e)}function Cr(t,e){for(bs[t]=e,t=0;t<e.length;t++)rm.add(e[t])}var Rn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),al=Object.prototype.hasOwnProperty,sk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sh={},oh={};function ok(t){return al.call(oh,t)?!0:al.call(sh,t)?!1:sk.test(t)?oh[t]=!0:(sh[t]=!0,!1)}function ak(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ck(t,e,n,i){if(e===null||typeof e>"u"||ak(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ut(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ze[t]=new ut(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ze[e]=new ut(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ze[t]=new ut(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ze[t]=new ut(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ze[t]=new ut(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ze[t]=new ut(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ze[t]=new ut(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ze[t]=new ut(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ze[t]=new ut(t,5,!1,t.toLowerCase(),null,!1,!1)});var Mu=/[\-:]([a-z])/g;function Au(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Mu,Au);Ze[e]=new ut(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Mu,Au);Ze[e]=new ut(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Mu,Au);Ze[e]=new ut(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ze[t]=new ut(t,1,!1,t.toLowerCase(),null,!1,!1)});Ze.xlinkHref=new ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ze[t]=new ut(t,1,!1,t.toLowerCase(),null,!0,!0)});function Lu(t,e,n,i){var r=Ze.hasOwnProperty(e)?Ze[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ck(e,n,r,i)&&(n=null),i||r===null?ok(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Mn=rk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,io=Symbol.for("react.element"),Ki=Symbol.for("react.portal"),Gi=Symbol.for("react.fragment"),ju=Symbol.for("react.strict_mode"),cl=Symbol.for("react.profiler"),sm=Symbol.for("react.provider"),om=Symbol.for("react.context"),Uu=Symbol.for("react.forward_ref"),ll=Symbol.for("react.suspense"),ul=Symbol.for("react.suspense_list"),Fu=Symbol.for("react.memo"),Bn=Symbol.for("react.lazy"),am=Symbol.for("react.offscreen"),ah=Symbol.iterator;function Fr(t){return t===null||typeof t!="object"?null:(t=ah&&t[ah]||t["@@iterator"],typeof t=="function"?t:null)}var Ce=Object.assign,hc;function es(t){if(hc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);hc=e&&e[1]||""}return`
`+hc+t}var fc=!1;function pc(t,e){if(!t||fc)return"";fc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{fc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?es(t):""}function lk(t){switch(t.tag){case 5:return es(t.type);case 16:return es("Lazy");case 13:return es("Suspense");case 19:return es("SuspenseList");case 0:case 2:case 15:return t=pc(t.type,!1),t;case 11:return t=pc(t.type.render,!1),t;case 1:return t=pc(t.type,!0),t;default:return""}}function dl(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Gi:return"Fragment";case Ki:return"Portal";case cl:return"Profiler";case ju:return"StrictMode";case ll:return"Suspense";case ul:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case om:return(t.displayName||"Context")+".Consumer";case sm:return(t._context.displayName||"Context")+".Provider";case Uu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Fu:return e=t.displayName||null,e!==null?e:dl(t.type)||"Memo";case Bn:e=t._payload,t=t._init;try{return dl(t(e))}catch{}}return null}function uk(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dl(e);case 8:return e===ju?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function oi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function cm(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dk(t){var e=cm(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ro(t){t._valueTracker||(t._valueTracker=dk(t))}function lm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=cm(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Yo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hl(t,e){var n=e.checked;return Ce({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ch(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=oi(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function um(t,e){e=e.checked,e!=null&&Lu(t,"checked",e,!1)}function fl(t,e){um(t,e);var n=oi(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?pl(t,e.type,n):e.hasOwnProperty("defaultValue")&&pl(t,e.type,oi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function lh(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function pl(t,e,n){(e!=="number"||Yo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ts=Array.isArray;function cr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+oi(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function ml(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return Ce({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function uh(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(F(92));if(ts(n)){if(1<n.length)throw Error(F(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:oi(n)}}function dm(t,e){var n=oi(e.value),i=oi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function dh(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hm(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gl(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hm(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var so,fm=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(so=so||document.createElement("div"),so.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=so.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ss(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var as={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hk=["Webkit","ms","Moz","O"];Object.keys(as).forEach(function(t){hk.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),as[e]=as[t]})});function pm(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||as.hasOwnProperty(t)&&as[t]?(""+e).trim():e+"px"}function mm(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=pm(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var fk=Ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vl(t,e){if(e){if(fk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function yl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kl=null;function Bu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var bl=null,lr=null,ur=null;function hh(t){if(t=Ks(t)){if(typeof bl!="function")throw Error(F(280));var e=t.stateNode;e&&(e=za(e),bl(t.stateNode,t.type,e))}}function gm(t){lr?ur?ur.push(t):ur=[t]:lr=t}function vm(){if(lr){var t=lr,e=ur;if(ur=lr=null,hh(t),e)for(t=0;t<e.length;t++)hh(e[t])}}function ym(t,e){return t(e)}function km(){}var mc=!1;function bm(t,e,n){if(mc)return t(e,n);mc=!0;try{return ym(t,e,n)}finally{mc=!1,(lr!==null||ur!==null)&&(km(),vm())}}function Cs(t,e){var n=t.stateNode;if(n===null)return null;var i=za(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(F(231,e,typeof n));return n}var Sl=!1;if(Rn)try{var Br={};Object.defineProperty(Br,"passive",{get:function(){Sl=!0}}),window.addEventListener("test",Br,Br),window.removeEventListener("test",Br,Br)}catch{Sl=!1}function pk(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var cs=!1,Xo=null,Zo=!1,Cl=null,mk={onError:function(t){cs=!0,Xo=t}};function gk(t,e,n,i,r,s,o,a,c){cs=!1,Xo=null,pk.apply(mk,arguments)}function vk(t,e,n,i,r,s,o,a,c){if(gk.apply(this,arguments),cs){if(cs){var l=Xo;cs=!1,Xo=null}else throw Error(F(198));Zo||(Zo=!0,Cl=l)}}function Fi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Sm(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function fh(t){if(Fi(t)!==t)throw Error(F(188))}function yk(t){var e=t.alternate;if(!e){if(e=Fi(t),e===null)throw Error(F(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return fh(r),t;if(s===i)return fh(r),e;s=s.sibling}throw Error(F(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(F(189))}}if(n.alternate!==i)throw Error(F(190))}if(n.tag!==3)throw Error(F(188));return n.stateNode.current===n?t:e}function Cm(t){return t=yk(t),t!==null?Tm(t):null}function Tm(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Tm(t);if(e!==null)return e;t=t.sibling}return null}var wm=Pt.unstable_scheduleCallback,ph=Pt.unstable_cancelCallback,kk=Pt.unstable_shouldYield,bk=Pt.unstable_requestPaint,Ie=Pt.unstable_now,Sk=Pt.unstable_getCurrentPriorityLevel,Vu=Pt.unstable_ImmediatePriority,Em=Pt.unstable_UserBlockingPriority,ea=Pt.unstable_NormalPriority,Ck=Pt.unstable_LowPriority,xm=Pt.unstable_IdlePriority,Ua=null,dn=null;function Tk(t){if(dn&&typeof dn.onCommitFiberRoot=="function")try{dn.onCommitFiberRoot(Ua,t,void 0,(t.current.flags&128)===128)}catch{}}var Xt=Math.clz32?Math.clz32:xk,wk=Math.log,Ek=Math.LN2;function xk(t){return t>>>=0,t===0?32:31-(wk(t)/Ek|0)|0}var oo=64,ao=4194304;function ns(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ta(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=ns(a):(s&=o,s!==0&&(i=ns(s)))}else o=n&~r,o!==0?i=ns(o):s!==0&&(i=ns(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Xt(e),r=1<<n,i|=t[n],e&=~r;return i}function Pk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _k(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Xt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=Pk(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Tl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Pm(){var t=oo;return oo<<=1,!(oo&4194240)&&(oo=64),t}function gc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function $s(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Xt(e),t[e]=n}function Rk(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Xt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function zu(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Xt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var le=0;function _m(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Rm,Wu,Im,Om,Nm,wl=!1,co=[],Jn=null,Qn=null,Yn=null,Ts=new Map,ws=new Map,zn=[],Ik="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mh(t,e){switch(t){case"focusin":case"focusout":Jn=null;break;case"dragenter":case"dragleave":Qn=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Ts.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ws.delete(e.pointerId)}}function Vr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Ks(e),e!==null&&Wu(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Ok(t,e,n,i,r){switch(e){case"focusin":return Jn=Vr(Jn,t,e,n,i,r),!0;case"dragenter":return Qn=Vr(Qn,t,e,n,i,r),!0;case"mouseover":return Yn=Vr(Yn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Ts.set(s,Vr(Ts.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ws.set(s,Vr(ws.get(s)||null,t,e,n,i,r)),!0}return!1}function Dm(t){var e=Si(t.target);if(e!==null){var n=Fi(e);if(n!==null){if(e=n.tag,e===13){if(e=Sm(n),e!==null){t.blockedOn=e,Nm(t.priority,function(){Im(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function xo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=El(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);kl=i,n.target.dispatchEvent(i),kl=null}else return e=Ks(n),e!==null&&Wu(e),t.blockedOn=n,!1;e.shift()}return!0}function gh(t,e,n){xo(t)&&n.delete(e)}function Nk(){wl=!1,Jn!==null&&xo(Jn)&&(Jn=null),Qn!==null&&xo(Qn)&&(Qn=null),Yn!==null&&xo(Yn)&&(Yn=null),Ts.forEach(gh),ws.forEach(gh)}function zr(t,e){t.blockedOn===e&&(t.blockedOn=null,wl||(wl=!0,Pt.unstable_scheduleCallback(Pt.unstable_NormalPriority,Nk)))}function Es(t){function e(r){return zr(r,t)}if(0<co.length){zr(co[0],t);for(var n=1;n<co.length;n++){var i=co[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Jn!==null&&zr(Jn,t),Qn!==null&&zr(Qn,t),Yn!==null&&zr(Yn,t),Ts.forEach(e),ws.forEach(e),n=0;n<zn.length;n++)i=zn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<zn.length&&(n=zn[0],n.blockedOn===null);)Dm(n),n.blockedOn===null&&zn.shift()}var dr=Mn.ReactCurrentBatchConfig,na=!0;function Dk(t,e,n,i){var r=le,s=dr.transition;dr.transition=null;try{le=1,qu(t,e,n,i)}finally{le=r,dr.transition=s}}function Mk(t,e,n,i){var r=le,s=dr.transition;dr.transition=null;try{le=4,qu(t,e,n,i)}finally{le=r,dr.transition=s}}function qu(t,e,n,i){if(na){var r=El(t,e,n,i);if(r===null)xc(t,e,i,ia,n),mh(t,i);else if(Ok(r,t,e,n,i))i.stopPropagation();else if(mh(t,i),e&4&&-1<Ik.indexOf(t)){for(;r!==null;){var s=Ks(r);if(s!==null&&Rm(s),s=El(t,e,n,i),s===null&&xc(t,e,i,ia,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else xc(t,e,i,null,n)}}var ia=null;function El(t,e,n,i){if(ia=null,t=Bu(i),t=Si(t),t!==null)if(e=Fi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Sm(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ia=t,null}function Mm(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Sk()){case Vu:return 1;case Em:return 4;case ea:case Ck:return 16;case xm:return 536870912;default:return 16}default:return 16}}var $n=null,$u=null,Po=null;function Am(){if(Po)return Po;var t,e=$u,n=e.length,i,r="value"in $n?$n.value:$n.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Po=r.slice(t,1<i?1-i:void 0)}function _o(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function lo(){return!0}function vh(){return!1}function Rt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?lo:vh,this.isPropagationStopped=vh,this}return Ce(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=lo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=lo)},persist:function(){},isPersistent:lo}),e}var Mr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hu=Rt(Mr),Hs=Ce({},Mr,{view:0,detail:0}),Ak=Rt(Hs),vc,yc,Wr,Fa=Ce({},Hs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ku,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Wr&&(Wr&&t.type==="mousemove"?(vc=t.screenX-Wr.screenX,yc=t.screenY-Wr.screenY):yc=vc=0,Wr=t),vc)},movementY:function(t){return"movementY"in t?t.movementY:yc}}),yh=Rt(Fa),Lk=Ce({},Fa,{dataTransfer:0}),jk=Rt(Lk),Uk=Ce({},Hs,{relatedTarget:0}),kc=Rt(Uk),Fk=Ce({},Mr,{animationName:0,elapsedTime:0,pseudoElement:0}),Bk=Rt(Fk),Vk=Ce({},Mr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zk=Rt(Vk),Wk=Ce({},Mr,{data:0}),kh=Rt(Wk),qk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$k={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kk(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Hk[t])?!!e[t]:!1}function Ku(){return Kk}var Gk=Ce({},Hs,{key:function(t){if(t.key){var e=qk[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_o(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?$k[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ku,charCode:function(t){return t.type==="keypress"?_o(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_o(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Jk=Rt(Gk),Qk=Ce({},Fa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bh=Rt(Qk),Yk=Ce({},Hs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ku}),Xk=Rt(Yk),Zk=Ce({},Mr,{propertyName:0,elapsedTime:0,pseudoElement:0}),eb=Rt(Zk),tb=Ce({},Fa,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),nb=Rt(tb),ib=[9,13,27,32],Gu=Rn&&"CompositionEvent"in window,ls=null;Rn&&"documentMode"in document&&(ls=document.documentMode);var rb=Rn&&"TextEvent"in window&&!ls,Lm=Rn&&(!Gu||ls&&8<ls&&11>=ls),Sh=" ",Ch=!1;function jm(t,e){switch(t){case"keyup":return ib.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Um(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ji=!1;function sb(t,e){switch(t){case"compositionend":return Um(e);case"keypress":return e.which!==32?null:(Ch=!0,Sh);case"textInput":return t=e.data,t===Sh&&Ch?null:t;default:return null}}function ob(t,e){if(Ji)return t==="compositionend"||!Gu&&jm(t,e)?(t=Am(),Po=$u=$n=null,Ji=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Lm&&e.locale!=="ko"?null:e.data;default:return null}}var ab={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Th(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ab[t.type]:e==="textarea"}function Fm(t,e,n,i){gm(i),e=ra(e,"onChange"),0<e.length&&(n=new Hu("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var us=null,xs=null;function cb(t){Qm(t,0)}function Ba(t){var e=Xi(t);if(lm(e))return t}function lb(t,e){if(t==="change")return e}var Bm=!1;if(Rn){var bc;if(Rn){var Sc="oninput"in document;if(!Sc){var wh=document.createElement("div");wh.setAttribute("oninput","return;"),Sc=typeof wh.oninput=="function"}bc=Sc}else bc=!1;Bm=bc&&(!document.documentMode||9<document.documentMode)}function Eh(){us&&(us.detachEvent("onpropertychange",Vm),xs=us=null)}function Vm(t){if(t.propertyName==="value"&&Ba(xs)){var e=[];Fm(e,xs,t,Bu(t)),bm(cb,e)}}function ub(t,e,n){t==="focusin"?(Eh(),us=e,xs=n,us.attachEvent("onpropertychange",Vm)):t==="focusout"&&Eh()}function db(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ba(xs)}function hb(t,e){if(t==="click")return Ba(e)}function fb(t,e){if(t==="input"||t==="change")return Ba(e)}function pb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var en=typeof Object.is=="function"?Object.is:pb;function Ps(t,e){if(en(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!al.call(e,r)||!en(t[r],e[r]))return!1}return!0}function xh(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ph(t,e){var n=xh(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=xh(n)}}function zm(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?zm(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Wm(){for(var t=window,e=Yo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Yo(t.document)}return e}function Ju(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function mb(t){var e=Wm(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&zm(n.ownerDocument.documentElement,n)){if(i!==null&&Ju(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Ph(n,s);var o=Ph(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gb=Rn&&"documentMode"in document&&11>=document.documentMode,Qi=null,xl=null,ds=null,Pl=!1;function _h(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Pl||Qi==null||Qi!==Yo(i)||(i=Qi,"selectionStart"in i&&Ju(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ds&&Ps(ds,i)||(ds=i,i=ra(xl,"onSelect"),0<i.length&&(e=new Hu("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Qi)))}function uo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Yi={animationend:uo("Animation","AnimationEnd"),animationiteration:uo("Animation","AnimationIteration"),animationstart:uo("Animation","AnimationStart"),transitionend:uo("Transition","TransitionEnd")},Cc={},qm={};Rn&&(qm=document.createElement("div").style,"AnimationEvent"in window||(delete Yi.animationend.animation,delete Yi.animationiteration.animation,delete Yi.animationstart.animation),"TransitionEvent"in window||delete Yi.transitionend.transition);function Va(t){if(Cc[t])return Cc[t];if(!Yi[t])return t;var e=Yi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in qm)return Cc[t]=e[n];return t}var $m=Va("animationend"),Hm=Va("animationiteration"),Km=Va("animationstart"),Gm=Va("transitionend"),Jm=new Map,Rh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ui(t,e){Jm.set(t,e),Ui(e,[t])}for(var Tc=0;Tc<Rh.length;Tc++){var wc=Rh[Tc],vb=wc.toLowerCase(),yb=wc[0].toUpperCase()+wc.slice(1);ui(vb,"on"+yb)}ui($m,"onAnimationEnd");ui(Hm,"onAnimationIteration");ui(Km,"onAnimationStart");ui("dblclick","onDoubleClick");ui("focusin","onFocus");ui("focusout","onBlur");ui(Gm,"onTransitionEnd");Cr("onMouseEnter",["mouseout","mouseover"]);Cr("onMouseLeave",["mouseout","mouseover"]);Cr("onPointerEnter",["pointerout","pointerover"]);Cr("onPointerLeave",["pointerout","pointerover"]);Ui("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ui("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ui("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ui("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ui("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ui("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var is="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kb=new Set("cancel close invalid load scroll toggle".split(" ").concat(is));function Ih(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,vk(i,e,void 0,t),t.currentTarget=null}function Qm(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Ih(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Ih(r,a,l),s=c}}}if(Zo)throw t=Cl,Zo=!1,Cl=null,t}function pe(t,e){var n=e[Nl];n===void 0&&(n=e[Nl]=new Set);var i=t+"__bubble";n.has(i)||(Ym(e,t,2,!1),n.add(i))}function Ec(t,e,n){var i=0;e&&(i|=4),Ym(n,t,i,e)}var ho="_reactListening"+Math.random().toString(36).slice(2);function _s(t){if(!t[ho]){t[ho]=!0,rm.forEach(function(n){n!=="selectionchange"&&(kb.has(n)||Ec(n,!1,t),Ec(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ho]||(e[ho]=!0,Ec("selectionchange",!1,e))}}function Ym(t,e,n,i){switch(Mm(e)){case 1:var r=Dk;break;case 4:r=Mk;break;default:r=qu}n=r.bind(null,e,n,t),r=void 0,!Sl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function xc(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Si(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}bm(function(){var l=s,u=Bu(n),d=[];e:{var h=Jm.get(t);if(h!==void 0){var m=Hu,b=t;switch(t){case"keypress":if(_o(n)===0)break e;case"keydown":case"keyup":m=Jk;break;case"focusin":b="focus",m=kc;break;case"focusout":b="blur",m=kc;break;case"beforeblur":case"afterblur":m=kc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=yh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=jk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Xk;break;case $m:case Hm:case Km:m=Bk;break;case Gm:m=eb;break;case"scroll":m=Ak;break;case"wheel":m=nb;break;case"copy":case"cut":case"paste":m=zk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=bh}var v=(e&4)!==0,w=!v&&t==="scroll",g=v?h!==null?h+"Capture":null:h;v=[];for(var y=l,S;y!==null;){S=y;var p=S.stateNode;if(S.tag===5&&p!==null&&(S=p,g!==null&&(p=Cs(y,g),p!=null&&v.push(Rs(y,p,S)))),w)break;y=y.return}0<v.length&&(h=new m(h,b,null,n,u),d.push({event:h,listeners:v}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",h&&n!==kl&&(b=n.relatedTarget||n.fromElement)&&(Si(b)||b[In]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(b=n.relatedTarget||n.toElement,m=l,b=b?Si(b):null,b!==null&&(w=Fi(b),b!==w||b.tag!==5&&b.tag!==6)&&(b=null)):(m=null,b=l),m!==b)){if(v=yh,p="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(v=bh,p="onPointerLeave",g="onPointerEnter",y="pointer"),w=m==null?h:Xi(m),S=b==null?h:Xi(b),h=new v(p,y+"leave",m,n,u),h.target=w,h.relatedTarget=S,p=null,Si(u)===l&&(v=new v(g,y+"enter",b,n,u),v.target=S,v.relatedTarget=w,p=v),w=p,m&&b)t:{for(v=m,g=b,y=0,S=v;S;S=qi(S))y++;for(S=0,p=g;p;p=qi(p))S++;for(;0<y-S;)v=qi(v),y--;for(;0<S-y;)g=qi(g),S--;for(;y--;){if(v===g||g!==null&&v===g.alternate)break t;v=qi(v),g=qi(g)}v=null}else v=null;m!==null&&Oh(d,h,m,v,!1),b!==null&&w!==null&&Oh(d,w,b,v,!0)}}e:{if(h=l?Xi(l):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var k=lb;else if(Th(h))if(Bm)k=fb;else{k=db;var T=ub}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=hb);if(k&&(k=k(t,l))){Fm(d,k,n,u);break e}T&&T(t,h,l),t==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&pl(h,"number",h.value)}switch(T=l?Xi(l):window,t){case"focusin":(Th(T)||T.contentEditable==="true")&&(Qi=T,xl=l,ds=null);break;case"focusout":ds=xl=Qi=null;break;case"mousedown":Pl=!0;break;case"contextmenu":case"mouseup":case"dragend":Pl=!1,_h(d,n,u);break;case"selectionchange":if(gb)break;case"keydown":case"keyup":_h(d,n,u)}var x;if(Gu)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Ji?jm(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(Lm&&n.locale!=="ko"&&(Ji||P!=="onCompositionStart"?P==="onCompositionEnd"&&Ji&&(x=Am()):($n=u,$u="value"in $n?$n.value:$n.textContent,Ji=!0)),T=ra(l,P),0<T.length&&(P=new kh(P,t,null,n,u),d.push({event:P,listeners:T}),x?P.data=x:(x=Um(n),x!==null&&(P.data=x)))),(x=rb?sb(t,n):ob(t,n))&&(l=ra(l,"onBeforeInput"),0<l.length&&(u=new kh("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=x))}Qm(d,e)})}function Rs(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ra(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Cs(t,n),s!=null&&i.unshift(Rs(t,s,r)),s=Cs(t,e),s!=null&&i.push(Rs(t,s,r))),t=t.return}return i}function qi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Oh(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Cs(n,s),c!=null&&o.unshift(Rs(n,c,a))):r||(c=Cs(n,s),c!=null&&o.push(Rs(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var bb=/\r\n?/g,Sb=/\u0000|\uFFFD/g;function Nh(t){return(typeof t=="string"?t:""+t).replace(bb,`
`).replace(Sb,"")}function fo(t,e,n){if(e=Nh(e),Nh(t)!==e&&n)throw Error(F(425))}function sa(){}var _l=null,Rl=null;function Il(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ol=typeof setTimeout=="function"?setTimeout:void 0,Cb=typeof clearTimeout=="function"?clearTimeout:void 0,Dh=typeof Promise=="function"?Promise:void 0,Tb=typeof queueMicrotask=="function"?queueMicrotask:typeof Dh<"u"?function(t){return Dh.resolve(null).then(t).catch(wb)}:Ol;function wb(t){setTimeout(function(){throw t})}function Pc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Es(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Es(e)}function Xn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Mh(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ar=Math.random().toString(36).slice(2),un="__reactFiber$"+Ar,Is="__reactProps$"+Ar,In="__reactContainer$"+Ar,Nl="__reactEvents$"+Ar,Eb="__reactListeners$"+Ar,xb="__reactHandles$"+Ar;function Si(t){var e=t[un];if(e)return e;for(var n=t.parentNode;n;){if(e=n[In]||n[un]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Mh(t);t!==null;){if(n=t[un])return n;t=Mh(t)}return e}t=n,n=t.parentNode}return null}function Ks(t){return t=t[un]||t[In],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Xi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(F(33))}function za(t){return t[Is]||null}var Dl=[],Zi=-1;function di(t){return{current:t}}function ge(t){0>Zi||(t.current=Dl[Zi],Dl[Zi]=null,Zi--)}function he(t,e){Zi++,Dl[Zi]=t.current,t.current=e}var ai={},it=di(ai),yt=di(!1),Ri=ai;function Tr(t,e){var n=t.type.contextTypes;if(!n)return ai;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function kt(t){return t=t.childContextTypes,t!=null}function oa(){ge(yt),ge(it)}function Ah(t,e,n){if(it.current!==ai)throw Error(F(168));he(it,e),he(yt,n)}function Xm(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(F(108,uk(t)||"Unknown",r));return Ce({},n,i)}function aa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ai,Ri=it.current,he(it,t),he(yt,yt.current),!0}function Lh(t,e,n){var i=t.stateNode;if(!i)throw Error(F(169));n?(t=Xm(t,e,Ri),i.__reactInternalMemoizedMergedChildContext=t,ge(yt),ge(it),he(it,t)):ge(yt),he(yt,n)}var bn=null,Wa=!1,_c=!1;function Zm(t){bn===null?bn=[t]:bn.push(t)}function Pb(t){Wa=!0,Zm(t)}function hi(){if(!_c&&bn!==null){_c=!0;var t=0,e=le;try{var n=bn;for(le=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}bn=null,Wa=!1}catch(r){throw bn!==null&&(bn=bn.slice(t+1)),wm(Vu,hi),r}finally{le=e,_c=!1}}return null}var er=[],tr=0,ca=null,la=0,Dt=[],Mt=0,Ii=null,xn=1,Pn="";function gi(t,e){er[tr++]=la,er[tr++]=ca,ca=t,la=e}function eg(t,e,n){Dt[Mt++]=xn,Dt[Mt++]=Pn,Dt[Mt++]=Ii,Ii=t;var i=xn;t=Pn;var r=32-Xt(i)-1;i&=~(1<<r),n+=1;var s=32-Xt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,xn=1<<32-Xt(e)+r|n<<r|i,Pn=s+t}else xn=1<<s|n<<r|i,Pn=t}function Qu(t){t.return!==null&&(gi(t,1),eg(t,1,0))}function Yu(t){for(;t===ca;)ca=er[--tr],er[tr]=null,la=er[--tr],er[tr]=null;for(;t===Ii;)Ii=Dt[--Mt],Dt[Mt]=null,Pn=Dt[--Mt],Dt[Mt]=null,xn=Dt[--Mt],Dt[Mt]=null}var xt=null,wt=null,ye=!1,Kt=null;function tg(t,e){var n=At(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function jh(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,xt=t,wt=Xn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,xt=t,wt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ii!==null?{id:xn,overflow:Pn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=At(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,xt=t,wt=null,!0):!1;default:return!1}}function Ml(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Al(t){if(ye){var e=wt;if(e){var n=e;if(!jh(t,e)){if(Ml(t))throw Error(F(418));e=Xn(n.nextSibling);var i=xt;e&&jh(t,e)?tg(i,n):(t.flags=t.flags&-4097|2,ye=!1,xt=t)}}else{if(Ml(t))throw Error(F(418));t.flags=t.flags&-4097|2,ye=!1,xt=t}}}function Uh(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;xt=t}function po(t){if(t!==xt)return!1;if(!ye)return Uh(t),ye=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Il(t.type,t.memoizedProps)),e&&(e=wt)){if(Ml(t))throw ng(),Error(F(418));for(;e;)tg(t,e),e=Xn(e.nextSibling)}if(Uh(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(F(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){wt=Xn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}wt=null}}else wt=xt?Xn(t.stateNode.nextSibling):null;return!0}function ng(){for(var t=wt;t;)t=Xn(t.nextSibling)}function wr(){wt=xt=null,ye=!1}function Xu(t){Kt===null?Kt=[t]:Kt.push(t)}var _b=Mn.ReactCurrentBatchConfig;function qr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(F(309));var i=n.stateNode}if(!i)throw Error(F(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(F(284));if(!n._owner)throw Error(F(290,t))}return t}function mo(t,e){throw t=Object.prototype.toString.call(e),Error(F(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Fh(t){var e=t._init;return e(t._payload)}function ig(t){function e(g,y){if(t){var S=g.deletions;S===null?(g.deletions=[y],g.flags|=16):S.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function i(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function r(g,y){return g=ni(g,y),g.index=0,g.sibling=null,g}function s(g,y,S){return g.index=S,t?(S=g.alternate,S!==null?(S=S.index,S<y?(g.flags|=2,y):S):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,S,p){return y===null||y.tag!==6?(y=Ac(S,g.mode,p),y.return=g,y):(y=r(y,S),y.return=g,y)}function c(g,y,S,p){var k=S.type;return k===Gi?u(g,y,S.props.children,p,S.key):y!==null&&(y.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Bn&&Fh(k)===y.type)?(p=r(y,S.props),p.ref=qr(g,y,S),p.return=g,p):(p=Ao(S.type,S.key,S.props,null,g.mode,p),p.ref=qr(g,y,S),p.return=g,p)}function l(g,y,S,p){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=Lc(S,g.mode,p),y.return=g,y):(y=r(y,S.children||[]),y.return=g,y)}function u(g,y,S,p,k){return y===null||y.tag!==7?(y=xi(S,g.mode,p,k),y.return=g,y):(y=r(y,S),y.return=g,y)}function d(g,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Ac(""+y,g.mode,S),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case io:return S=Ao(y.type,y.key,y.props,null,g.mode,S),S.ref=qr(g,null,y),S.return=g,S;case Ki:return y=Lc(y,g.mode,S),y.return=g,y;case Bn:var p=y._init;return d(g,p(y._payload),S)}if(ts(y)||Fr(y))return y=xi(y,g.mode,S,null),y.return=g,y;mo(g,y)}return null}function h(g,y,S,p){var k=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return k!==null?null:a(g,y,""+S,p);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case io:return S.key===k?c(g,y,S,p):null;case Ki:return S.key===k?l(g,y,S,p):null;case Bn:return k=S._init,h(g,y,k(S._payload),p)}if(ts(S)||Fr(S))return k!==null?null:u(g,y,S,p,null);mo(g,S)}return null}function m(g,y,S,p,k){if(typeof p=="string"&&p!==""||typeof p=="number")return g=g.get(S)||null,a(y,g,""+p,k);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case io:return g=g.get(p.key===null?S:p.key)||null,c(y,g,p,k);case Ki:return g=g.get(p.key===null?S:p.key)||null,l(y,g,p,k);case Bn:var T=p._init;return m(g,y,S,T(p._payload),k)}if(ts(p)||Fr(p))return g=g.get(S)||null,u(y,g,p,k,null);mo(y,p)}return null}function b(g,y,S,p){for(var k=null,T=null,x=y,P=y=0,I=null;x!==null&&P<S.length;P++){x.index>P?(I=x,x=null):I=x.sibling;var R=h(g,x,S[P],p);if(R===null){x===null&&(x=I);break}t&&x&&R.alternate===null&&e(g,x),y=s(R,y,P),T===null?k=R:T.sibling=R,T=R,x=I}if(P===S.length)return n(g,x),ye&&gi(g,P),k;if(x===null){for(;P<S.length;P++)x=d(g,S[P],p),x!==null&&(y=s(x,y,P),T===null?k=x:T.sibling=x,T=x);return ye&&gi(g,P),k}for(x=i(g,x);P<S.length;P++)I=m(x,g,P,S[P],p),I!==null&&(t&&I.alternate!==null&&x.delete(I.key===null?P:I.key),y=s(I,y,P),T===null?k=I:T.sibling=I,T=I);return t&&x.forEach(function(N){return e(g,N)}),ye&&gi(g,P),k}function v(g,y,S,p){var k=Fr(S);if(typeof k!="function")throw Error(F(150));if(S=k.call(S),S==null)throw Error(F(151));for(var T=k=null,x=y,P=y=0,I=null,R=S.next();x!==null&&!R.done;P++,R=S.next()){x.index>P?(I=x,x=null):I=x.sibling;var N=h(g,x,R.value,p);if(N===null){x===null&&(x=I);break}t&&x&&N.alternate===null&&e(g,x),y=s(N,y,P),T===null?k=N:T.sibling=N,T=N,x=I}if(R.done)return n(g,x),ye&&gi(g,P),k;if(x===null){for(;!R.done;P++,R=S.next())R=d(g,R.value,p),R!==null&&(y=s(R,y,P),T===null?k=R:T.sibling=R,T=R);return ye&&gi(g,P),k}for(x=i(g,x);!R.done;P++,R=S.next())R=m(x,g,P,R.value,p),R!==null&&(t&&R.alternate!==null&&x.delete(R.key===null?P:R.key),y=s(R,y,P),T===null?k=R:T.sibling=R,T=R);return t&&x.forEach(function($){return e(g,$)}),ye&&gi(g,P),k}function w(g,y,S,p){if(typeof S=="object"&&S!==null&&S.type===Gi&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case io:e:{for(var k=S.key,T=y;T!==null;){if(T.key===k){if(k=S.type,k===Gi){if(T.tag===7){n(g,T.sibling),y=r(T,S.props.children),y.return=g,g=y;break e}}else if(T.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Bn&&Fh(k)===T.type){n(g,T.sibling),y=r(T,S.props),y.ref=qr(g,T,S),y.return=g,g=y;break e}n(g,T);break}else e(g,T);T=T.sibling}S.type===Gi?(y=xi(S.props.children,g.mode,p,S.key),y.return=g,g=y):(p=Ao(S.type,S.key,S.props,null,g.mode,p),p.ref=qr(g,y,S),p.return=g,g=p)}return o(g);case Ki:e:{for(T=S.key;y!==null;){if(y.key===T)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){n(g,y.sibling),y=r(y,S.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=Lc(S,g.mode,p),y.return=g,g=y}return o(g);case Bn:return T=S._init,w(g,y,T(S._payload),p)}if(ts(S))return b(g,y,S,p);if(Fr(S))return v(g,y,S,p);mo(g,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(n(g,y.sibling),y=r(y,S),y.return=g,g=y):(n(g,y),y=Ac(S,g.mode,p),y.return=g,g=y),o(g)):n(g,y)}return w}var Er=ig(!0),rg=ig(!1),ua=di(null),da=null,nr=null,Zu=null;function ed(){Zu=nr=da=null}function td(t){var e=ua.current;ge(ua),t._currentValue=e}function Ll(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function hr(t,e){da=t,Zu=nr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(gt=!0),t.firstContext=null)}function Ut(t){var e=t._currentValue;if(Zu!==t)if(t={context:t,memoizedValue:e,next:null},nr===null){if(da===null)throw Error(F(308));nr=t,da.dependencies={lanes:0,firstContext:t}}else nr=nr.next=t;return e}var Ci=null;function nd(t){Ci===null?Ci=[t]:Ci.push(t)}function sg(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,nd(e)):(n.next=r.next,r.next=n),e.interleaved=n,On(t,i)}function On(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Vn=!1;function id(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function og(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Zn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,oe&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,On(t,n)}return r=i.interleaved,r===null?(e.next=e,nd(i)):(e.next=r.next,r.next=e),i.interleaved=e,On(t,n)}function Ro(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,zu(t,n)}}function Bh(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ha(t,e,n,i){var r=t.updateQueue;Vn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,m=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var b=t,v=a;switch(h=e,m=n,v.tag){case 1:if(b=v.payload,typeof b=="function"){d=b.call(m,d,h);break e}d=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=v.payload,h=typeof b=="function"?b.call(m,d,h):b,h==null)break e;d=Ce({},d,h);break e;case 2:Vn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else m={eventTime:m,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=m,c=d):u=u.next=m,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Ni|=o,t.lanes=o,t.memoizedState=d}}function Vh(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(F(191,r));r.call(i)}}}var Gs={},hn=di(Gs),Os=di(Gs),Ns=di(Gs);function Ti(t){if(t===Gs)throw Error(F(174));return t}function rd(t,e){switch(he(Ns,e),he(Os,t),he(hn,Gs),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:gl(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=gl(e,t)}ge(hn),he(hn,e)}function xr(){ge(hn),ge(Os),ge(Ns)}function ag(t){Ti(Ns.current);var e=Ti(hn.current),n=gl(e,t.type);e!==n&&(he(Os,t),he(hn,n))}function sd(t){Os.current===t&&(ge(hn),ge(Os))}var be=di(0);function fa(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Rc=[];function od(){for(var t=0;t<Rc.length;t++)Rc[t]._workInProgressVersionPrimary=null;Rc.length=0}var Io=Mn.ReactCurrentDispatcher,Ic=Mn.ReactCurrentBatchConfig,Oi=0,Se=null,Le=null,ze=null,pa=!1,hs=!1,Ds=0,Rb=0;function et(){throw Error(F(321))}function ad(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!en(t[n],e[n]))return!1;return!0}function cd(t,e,n,i,r,s){if(Oi=s,Se=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Io.current=t===null||t.memoizedState===null?Db:Mb,t=n(i,r),hs){s=0;do{if(hs=!1,Ds=0,25<=s)throw Error(F(301));s+=1,ze=Le=null,e.updateQueue=null,Io.current=Ab,t=n(i,r)}while(hs)}if(Io.current=ma,e=Le!==null&&Le.next!==null,Oi=0,ze=Le=Se=null,pa=!1,e)throw Error(F(300));return t}function ld(){var t=Ds!==0;return Ds=0,t}function cn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ze===null?Se.memoizedState=ze=t:ze=ze.next=t,ze}function Ft(){if(Le===null){var t=Se.alternate;t=t!==null?t.memoizedState:null}else t=Le.next;var e=ze===null?Se.memoizedState:ze.next;if(e!==null)ze=e,Le=t;else{if(t===null)throw Error(F(310));Le=t,t={memoizedState:Le.memoizedState,baseState:Le.baseState,baseQueue:Le.baseQueue,queue:Le.queue,next:null},ze===null?Se.memoizedState=ze=t:ze=ze.next=t}return ze}function Ms(t,e){return typeof e=="function"?e(t):e}function Oc(t){var e=Ft(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=Le,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Oi&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,Se.lanes|=u,Ni|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,en(i,e.memoizedState)||(gt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Se.lanes|=s,Ni|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Nc(t){var e=Ft(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);en(s,e.memoizedState)||(gt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function cg(){}function lg(t,e){var n=Se,i=Ft(),r=e(),s=!en(i.memoizedState,r);if(s&&(i.memoizedState=r,gt=!0),i=i.queue,ud(hg.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||ze!==null&&ze.memoizedState.tag&1){if(n.flags|=2048,As(9,dg.bind(null,n,i,r,e),void 0,null),$e===null)throw Error(F(349));Oi&30||ug(n,e,r)}return r}function ug(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Se.updateQueue,e===null?(e={lastEffect:null,stores:null},Se.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function dg(t,e,n,i){e.value=n,e.getSnapshot=i,fg(e)&&pg(t)}function hg(t,e,n){return n(function(){fg(e)&&pg(t)})}function fg(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!en(t,n)}catch{return!0}}function pg(t){var e=On(t,1);e!==null&&Zt(e,t,1,-1)}function zh(t){var e=cn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:t},e.queue=t,t=t.dispatch=Nb.bind(null,Se,t),[e.memoizedState,t]}function As(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Se.updateQueue,e===null?(e={lastEffect:null,stores:null},Se.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function mg(){return Ft().memoizedState}function Oo(t,e,n,i){var r=cn();Se.flags|=t,r.memoizedState=As(1|e,n,void 0,i===void 0?null:i)}function qa(t,e,n,i){var r=Ft();i=i===void 0?null:i;var s=void 0;if(Le!==null){var o=Le.memoizedState;if(s=o.destroy,i!==null&&ad(i,o.deps)){r.memoizedState=As(e,n,s,i);return}}Se.flags|=t,r.memoizedState=As(1|e,n,s,i)}function Wh(t,e){return Oo(8390656,8,t,e)}function ud(t,e){return qa(2048,8,t,e)}function gg(t,e){return qa(4,2,t,e)}function vg(t,e){return qa(4,4,t,e)}function yg(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function kg(t,e,n){return n=n!=null?n.concat([t]):null,qa(4,4,yg.bind(null,e,t),n)}function dd(){}function bg(t,e){var n=Ft();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ad(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Sg(t,e){var n=Ft();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ad(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Cg(t,e,n){return Oi&21?(en(n,e)||(n=Pm(),Se.lanes|=n,Ni|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,gt=!0),t.memoizedState=n)}function Ib(t,e){var n=le;le=n!==0&&4>n?n:4,t(!0);var i=Ic.transition;Ic.transition={};try{t(!1),e()}finally{le=n,Ic.transition=i}}function Tg(){return Ft().memoizedState}function Ob(t,e,n){var i=ti(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},wg(t))Eg(e,n);else if(n=sg(t,e,n,i),n!==null){var r=at();Zt(n,t,i,r),xg(n,e,i)}}function Nb(t,e,n){var i=ti(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(wg(t))Eg(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,en(a,o)){var c=e.interleaved;c===null?(r.next=r,nd(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=sg(t,e,r,i),n!==null&&(r=at(),Zt(n,t,i,r),xg(n,e,i))}}function wg(t){var e=t.alternate;return t===Se||e!==null&&e===Se}function Eg(t,e){hs=pa=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function xg(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,zu(t,n)}}var ma={readContext:Ut,useCallback:et,useContext:et,useEffect:et,useImperativeHandle:et,useInsertionEffect:et,useLayoutEffect:et,useMemo:et,useReducer:et,useRef:et,useState:et,useDebugValue:et,useDeferredValue:et,useTransition:et,useMutableSource:et,useSyncExternalStore:et,useId:et,unstable_isNewReconciler:!1},Db={readContext:Ut,useCallback:function(t,e){return cn().memoizedState=[t,e===void 0?null:e],t},useContext:Ut,useEffect:Wh,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Oo(4194308,4,yg.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Oo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Oo(4,2,t,e)},useMemo:function(t,e){var n=cn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=cn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Ob.bind(null,Se,t),[i.memoizedState,t]},useRef:function(t){var e=cn();return t={current:t},e.memoizedState=t},useState:zh,useDebugValue:dd,useDeferredValue:function(t){return cn().memoizedState=t},useTransition:function(){var t=zh(!1),e=t[0];return t=Ib.bind(null,t[1]),cn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Se,r=cn();if(ye){if(n===void 0)throw Error(F(407));n=n()}else{if(n=e(),$e===null)throw Error(F(349));Oi&30||ug(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Wh(hg.bind(null,i,s,t),[t]),i.flags|=2048,As(9,dg.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=cn(),e=$e.identifierPrefix;if(ye){var n=Pn,i=xn;n=(i&~(1<<32-Xt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ds++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Rb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Mb={readContext:Ut,useCallback:bg,useContext:Ut,useEffect:ud,useImperativeHandle:kg,useInsertionEffect:gg,useLayoutEffect:vg,useMemo:Sg,useReducer:Oc,useRef:mg,useState:function(){return Oc(Ms)},useDebugValue:dd,useDeferredValue:function(t){var e=Ft();return Cg(e,Le.memoizedState,t)},useTransition:function(){var t=Oc(Ms)[0],e=Ft().memoizedState;return[t,e]},useMutableSource:cg,useSyncExternalStore:lg,useId:Tg,unstable_isNewReconciler:!1},Ab={readContext:Ut,useCallback:bg,useContext:Ut,useEffect:ud,useImperativeHandle:kg,useInsertionEffect:gg,useLayoutEffect:vg,useMemo:Sg,useReducer:Nc,useRef:mg,useState:function(){return Nc(Ms)},useDebugValue:dd,useDeferredValue:function(t){var e=Ft();return Le===null?e.memoizedState=t:Cg(e,Le.memoizedState,t)},useTransition:function(){var t=Nc(Ms)[0],e=Ft().memoizedState;return[t,e]},useMutableSource:cg,useSyncExternalStore:lg,useId:Tg,unstable_isNewReconciler:!1};function qt(t,e){if(t&&t.defaultProps){e=Ce({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function jl(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ce({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $a={isMounted:function(t){return(t=t._reactInternals)?Fi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=at(),r=ti(t),s=_n(i,r);s.payload=e,n!=null&&(s.callback=n),e=Zn(t,s,r),e!==null&&(Zt(e,t,r,i),Ro(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=at(),r=ti(t),s=_n(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Zn(t,s,r),e!==null&&(Zt(e,t,r,i),Ro(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=at(),i=ti(t),r=_n(n,i);r.tag=2,e!=null&&(r.callback=e),e=Zn(t,r,i),e!==null&&(Zt(e,t,i,n),Ro(e,t,i))}};function qh(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ps(n,i)||!Ps(r,s):!0}function Pg(t,e,n){var i=!1,r=ai,s=e.contextType;return typeof s=="object"&&s!==null?s=Ut(s):(r=kt(e)?Ri:it.current,i=e.contextTypes,s=(i=i!=null)?Tr(t,r):ai),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$a,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function $h(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&$a.enqueueReplaceState(e,e.state,null)}function Ul(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},id(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ut(s):(s=kt(e)?Ri:it.current,r.context=Tr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(jl(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&$a.enqueueReplaceState(r,r.state,null),ha(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Pr(t,e){try{var n="",i=e;do n+=lk(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Dc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Fl(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Lb=typeof WeakMap=="function"?WeakMap:Map;function _g(t,e,n){n=_n(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){va||(va=!0,Jl=i),Fl(t,e)},n}function Rg(t,e,n){n=_n(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Fl(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Fl(t,e),typeof i!="function"&&(ei===null?ei=new Set([this]):ei.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Hh(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Lb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Qb.bind(null,t,e,n),e.then(t,t))}function Kh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Gh(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_n(-1,1),e.tag=2,Zn(n,e,1))),n.lanes|=1),t)}var jb=Mn.ReactCurrentOwner,gt=!1;function rt(t,e,n,i){e.child=t===null?rg(e,null,n,i):Er(e,t.child,n,i)}function Jh(t,e,n,i,r){n=n.render;var s=e.ref;return hr(e,r),i=cd(t,e,n,i,s,r),n=ld(),t!==null&&!gt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Nn(t,e,r)):(ye&&n&&Qu(e),e.flags|=1,rt(t,e,i,r),e.child)}function Qh(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!kd(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Ig(t,e,s,i,r)):(t=Ao(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ps,n(o,i)&&t.ref===e.ref)return Nn(t,e,r)}return e.flags|=1,t=ni(s,i),t.ref=e.ref,t.return=e,e.child=t}function Ig(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ps(s,i)&&t.ref===e.ref)if(gt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(gt=!0);else return e.lanes=t.lanes,Nn(t,e,r)}return Bl(t,e,n,i,r)}function Og(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},he(rr,Tt),Tt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,he(rr,Tt),Tt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,he(rr,Tt),Tt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,he(rr,Tt),Tt|=i;return rt(t,e,r,n),e.child}function Ng(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Bl(t,e,n,i,r){var s=kt(n)?Ri:it.current;return s=Tr(e,s),hr(e,r),n=cd(t,e,n,i,s,r),i=ld(),t!==null&&!gt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Nn(t,e,r)):(ye&&i&&Qu(e),e.flags|=1,rt(t,e,n,r),e.child)}function Yh(t,e,n,i,r){if(kt(n)){var s=!0;aa(e)}else s=!1;if(hr(e,r),e.stateNode===null)No(t,e),Pg(e,n,i),Ul(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Ut(l):(l=kt(n)?Ri:it.current,l=Tr(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&$h(e,o,i,l),Vn=!1;var h=e.memoizedState;o.state=h,ha(e,i,o,r),c=e.memoizedState,a!==i||h!==c||yt.current||Vn?(typeof u=="function"&&(jl(e,n,u,i),c=e.memoizedState),(a=Vn||qh(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,og(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:qt(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ut(c):(c=kt(n)?Ri:it.current,c=Tr(e,c));var m=n.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&$h(e,o,i,c),Vn=!1,h=e.memoizedState,o.state=h,ha(e,i,o,r);var b=e.memoizedState;a!==d||h!==b||yt.current||Vn?(typeof m=="function"&&(jl(e,n,m,i),b=e.memoizedState),(l=Vn||qh(e,n,l,i,h,b,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,b,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,b,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=b),o.props=i,o.state=b,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Vl(t,e,n,i,s,r)}function Vl(t,e,n,i,r,s){Ng(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Lh(e,n,!1),Nn(t,e,s);i=e.stateNode,jb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Er(e,t.child,null,s),e.child=Er(e,null,a,s)):rt(t,e,a,s),e.memoizedState=i.state,r&&Lh(e,n,!0),e.child}function Dg(t){var e=t.stateNode;e.pendingContext?Ah(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ah(t,e.context,!1),rd(t,e.containerInfo)}function Xh(t,e,n,i,r){return wr(),Xu(r),e.flags|=256,rt(t,e,n,i),e.child}var zl={dehydrated:null,treeContext:null,retryLane:0};function Wl(t){return{baseLanes:t,cachePool:null,transitions:null}}function Mg(t,e,n){var i=e.pendingProps,r=be.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),he(be,r&1),t===null)return Al(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ga(o,i,0,null),t=xi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Wl(n),e.memoizedState=zl,t):hd(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Ub(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=ni(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ni(a,s):(s=xi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Wl(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=zl,i}return s=t.child,t=s.sibling,i=ni(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function hd(t,e){return e=Ga({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function go(t,e,n,i){return i!==null&&Xu(i),Er(e,t.child,null,n),t=hd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ub(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Dc(Error(F(422))),go(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Ga({mode:"visible",children:i.children},r,0,null),s=xi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Er(e,t.child,null,o),e.child.memoizedState=Wl(o),e.memoizedState=zl,s);if(!(e.mode&1))return go(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(F(419)),i=Dc(s,i,void 0),go(t,e,o,i)}if(a=(o&t.childLanes)!==0,gt||a){if(i=$e,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,On(t,r),Zt(i,t,r,-1))}return yd(),i=Dc(Error(F(421))),go(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Yb.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,wt=Xn(r.nextSibling),xt=e,ye=!0,Kt=null,t!==null&&(Dt[Mt++]=xn,Dt[Mt++]=Pn,Dt[Mt++]=Ii,xn=t.id,Pn=t.overflow,Ii=e),e=hd(e,i.children),e.flags|=4096,e)}function Zh(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ll(t.return,e,n)}function Mc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Ag(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(rt(t,e,i.children,n),i=be.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zh(t,n,e);else if(t.tag===19)Zh(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(he(be,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&fa(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Mc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&fa(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Mc(e,!0,n,null,s);break;case"together":Mc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function No(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Nn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ni|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(F(153));if(e.child!==null){for(t=e.child,n=ni(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ni(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Fb(t,e,n){switch(e.tag){case 3:Dg(e),wr();break;case 5:ag(e);break;case 1:kt(e.type)&&aa(e);break;case 4:rd(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;he(ua,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(he(be,be.current&1),e.flags|=128,null):n&e.child.childLanes?Mg(t,e,n):(he(be,be.current&1),t=Nn(t,e,n),t!==null?t.sibling:null);he(be,be.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Ag(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),he(be,be.current),i)break;return null;case 22:case 23:return e.lanes=0,Og(t,e,n)}return Nn(t,e,n)}var Lg,ql,jg,Ug;Lg=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ql=function(){};jg=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ti(hn.current);var s=null;switch(n){case"input":r=hl(t,r),i=hl(t,i),s=[];break;case"select":r=Ce({},r,{value:void 0}),i=Ce({},i,{value:void 0}),s=[];break;case"textarea":r=ml(t,r),i=ml(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=sa)}vl(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(bs.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(bs.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&pe("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Ug=function(t,e,n,i){n!==i&&(e.flags|=4)};function $r(t,e){if(!ye)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function tt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Bb(t,e,n){var i=e.pendingProps;switch(Yu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(e),null;case 1:return kt(e.type)&&oa(),tt(e),null;case 3:return i=e.stateNode,xr(),ge(yt),ge(it),od(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(po(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Kt!==null&&(Xl(Kt),Kt=null))),ql(t,e),tt(e),null;case 5:sd(e);var r=Ti(Ns.current);if(n=e.type,t!==null&&e.stateNode!=null)jg(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(F(166));return tt(e),null}if(t=Ti(hn.current),po(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[un]=e,i[Is]=s,t=(e.mode&1)!==0,n){case"dialog":pe("cancel",i),pe("close",i);break;case"iframe":case"object":case"embed":pe("load",i);break;case"video":case"audio":for(r=0;r<is.length;r++)pe(is[r],i);break;case"source":pe("error",i);break;case"img":case"image":case"link":pe("error",i),pe("load",i);break;case"details":pe("toggle",i);break;case"input":ch(i,s),pe("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},pe("invalid",i);break;case"textarea":uh(i,s),pe("invalid",i)}vl(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&fo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&fo(i.textContent,a,t),r=["children",""+a]):bs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&pe("scroll",i)}switch(n){case"input":ro(i),lh(i,s,!0);break;case"textarea":ro(i),dh(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=sa)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hm(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[un]=e,t[Is]=i,Lg(t,e,!1,!1),e.stateNode=t;e:{switch(o=yl(n,i),n){case"dialog":pe("cancel",t),pe("close",t),r=i;break;case"iframe":case"object":case"embed":pe("load",t),r=i;break;case"video":case"audio":for(r=0;r<is.length;r++)pe(is[r],t);r=i;break;case"source":pe("error",t),r=i;break;case"img":case"image":case"link":pe("error",t),pe("load",t),r=i;break;case"details":pe("toggle",t),r=i;break;case"input":ch(t,i),r=hl(t,i),pe("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Ce({},i,{value:void 0}),pe("invalid",t);break;case"textarea":uh(t,i),r=ml(t,i),pe("invalid",t);break;default:r=i}vl(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?mm(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&fm(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ss(t,c):typeof c=="number"&&Ss(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(bs.hasOwnProperty(s)?c!=null&&s==="onScroll"&&pe("scroll",t):c!=null&&Lu(t,s,c,o))}switch(n){case"input":ro(t),lh(t,i,!1);break;case"textarea":ro(t),dh(t);break;case"option":i.value!=null&&t.setAttribute("value",""+oi(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?cr(t,!!i.multiple,s,!1):i.defaultValue!=null&&cr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=sa)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return tt(e),null;case 6:if(t&&e.stateNode!=null)Ug(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(F(166));if(n=Ti(Ns.current),Ti(hn.current),po(e)){if(i=e.stateNode,n=e.memoizedProps,i[un]=e,(s=i.nodeValue!==n)&&(t=xt,t!==null))switch(t.tag){case 3:fo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&fo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[un]=e,e.stateNode=i}return tt(e),null;case 13:if(ge(be),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ye&&wt!==null&&e.mode&1&&!(e.flags&128))ng(),wr(),e.flags|=98560,s=!1;else if(s=po(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(F(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(F(317));s[un]=e}else wr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;tt(e),s=!1}else Kt!==null&&(Xl(Kt),Kt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||be.current&1?Fe===0&&(Fe=3):yd())),e.updateQueue!==null&&(e.flags|=4),tt(e),null);case 4:return xr(),ql(t,e),t===null&&_s(e.stateNode.containerInfo),tt(e),null;case 10:return td(e.type._context),tt(e),null;case 17:return kt(e.type)&&oa(),tt(e),null;case 19:if(ge(be),s=e.memoizedState,s===null)return tt(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)$r(s,!1);else{if(Fe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=fa(t),o!==null){for(e.flags|=128,$r(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return he(be,be.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ie()>_r&&(e.flags|=128,i=!0,$r(s,!1),e.lanes=4194304)}else{if(!i)if(t=fa(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),$r(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ye)return tt(e),null}else 2*Ie()-s.renderingStartTime>_r&&n!==1073741824&&(e.flags|=128,i=!0,$r(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ie(),e.sibling=null,n=be.current,he(be,i?n&1|2:n&1),e):(tt(e),null);case 22:case 23:return vd(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Tt&1073741824&&(tt(e),e.subtreeFlags&6&&(e.flags|=8192)):tt(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function Vb(t,e){switch(Yu(e),e.tag){case 1:return kt(e.type)&&oa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xr(),ge(yt),ge(it),od(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return sd(e),null;case 13:if(ge(be),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(F(340));wr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ge(be),null;case 4:return xr(),null;case 10:return td(e.type._context),null;case 22:case 23:return vd(),null;case 24:return null;default:return null}}var vo=!1,nt=!1,zb=typeof WeakSet=="function"?WeakSet:Set,H=null;function ir(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){xe(t,e,i)}else n.current=null}function $l(t,e,n){try{n()}catch(i){xe(t,e,i)}}var ef=!1;function Wb(t,e){if(_l=na,t=Wm(),Ju(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var m;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)h=d,d=m;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(m=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=m}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Rl={focusedElem:t,selectionRange:n},na=!1,H=e;H!==null;)if(e=H,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,H=t;else for(;H!==null;){e=H;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var v=b.memoizedProps,w=b.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?v:qt(e.type,v),w);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(p){xe(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,H=t;break}H=e.return}return b=ef,ef=!1,b}function fs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&$l(e,n,s)}r=r.next}while(r!==i)}}function Ha(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Hl(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Fg(t){var e=t.alternate;e!==null&&(t.alternate=null,Fg(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[un],delete e[Is],delete e[Nl],delete e[Eb],delete e[xb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Bg(t){return t.tag===5||t.tag===3||t.tag===4}function tf(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Bg(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Kl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=sa));else if(i!==4&&(t=t.child,t!==null))for(Kl(t,e,n),t=t.sibling;t!==null;)Kl(t,e,n),t=t.sibling}function Gl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Gl(t,e,n),t=t.sibling;t!==null;)Gl(t,e,n),t=t.sibling}var Je=null,$t=!1;function Ln(t,e,n){for(n=n.child;n!==null;)Vg(t,e,n),n=n.sibling}function Vg(t,e,n){if(dn&&typeof dn.onCommitFiberUnmount=="function")try{dn.onCommitFiberUnmount(Ua,n)}catch{}switch(n.tag){case 5:nt||ir(n,e);case 6:var i=Je,r=$t;Je=null,Ln(t,e,n),Je=i,$t=r,Je!==null&&($t?(t=Je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Je.removeChild(n.stateNode));break;case 18:Je!==null&&($t?(t=Je,n=n.stateNode,t.nodeType===8?Pc(t.parentNode,n):t.nodeType===1&&Pc(t,n),Es(t)):Pc(Je,n.stateNode));break;case 4:i=Je,r=$t,Je=n.stateNode.containerInfo,$t=!0,Ln(t,e,n),Je=i,$t=r;break;case 0:case 11:case 14:case 15:if(!nt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&$l(n,e,o),r=r.next}while(r!==i)}Ln(t,e,n);break;case 1:if(!nt&&(ir(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){xe(n,e,a)}Ln(t,e,n);break;case 21:Ln(t,e,n);break;case 22:n.mode&1?(nt=(i=nt)||n.memoizedState!==null,Ln(t,e,n),nt=i):Ln(t,e,n);break;default:Ln(t,e,n)}}function nf(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zb),e.forEach(function(i){var r=Xb.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function zt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Je=a.stateNode,$t=!1;break e;case 3:Je=a.stateNode.containerInfo,$t=!0;break e;case 4:Je=a.stateNode.containerInfo,$t=!0;break e}a=a.return}if(Je===null)throw Error(F(160));Vg(s,o,r),Je=null,$t=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){xe(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zg(e,t),e=e.sibling}function zg(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(zt(e,t),sn(t),i&4){try{fs(3,t,t.return),Ha(3,t)}catch(v){xe(t,t.return,v)}try{fs(5,t,t.return)}catch(v){xe(t,t.return,v)}}break;case 1:zt(e,t),sn(t),i&512&&n!==null&&ir(n,n.return);break;case 5:if(zt(e,t),sn(t),i&512&&n!==null&&ir(n,n.return),t.flags&32){var r=t.stateNode;try{Ss(r,"")}catch(v){xe(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&um(r,s),yl(a,o);var l=yl(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?mm(r,d):u==="dangerouslySetInnerHTML"?fm(r,d):u==="children"?Ss(r,d):Lu(r,u,d,l)}switch(a){case"input":fl(r,s);break;case"textarea":dm(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?cr(r,!!s.multiple,m,!1):h!==!!s.multiple&&(s.defaultValue!=null?cr(r,!!s.multiple,s.defaultValue,!0):cr(r,!!s.multiple,s.multiple?[]:"",!1))}r[Is]=s}catch(v){xe(t,t.return,v)}}break;case 6:if(zt(e,t),sn(t),i&4){if(t.stateNode===null)throw Error(F(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){xe(t,t.return,v)}}break;case 3:if(zt(e,t),sn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Es(e.containerInfo)}catch(v){xe(t,t.return,v)}break;case 4:zt(e,t),sn(t);break;case 13:zt(e,t),sn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(md=Ie())),i&4&&nf(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(nt=(l=nt)||u,zt(e,t),nt=l):zt(e,t),sn(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(H=t,u=t.child;u!==null;){for(d=H=u;H!==null;){switch(h=H,m=h.child,h.tag){case 0:case 11:case 14:case 15:fs(4,h,h.return);break;case 1:ir(h,h.return);var b=h.stateNode;if(typeof b.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(v){xe(i,n,v)}}break;case 5:ir(h,h.return);break;case 22:if(h.memoizedState!==null){sf(d);continue}}m!==null?(m.return=h,H=m):sf(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=pm("display",o))}catch(v){xe(t,t.return,v)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){xe(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:zt(e,t),sn(t),i&4&&nf(t);break;case 21:break;default:zt(e,t),sn(t)}}function sn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Bg(n)){var i=n;break e}n=n.return}throw Error(F(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Ss(r,""),i.flags&=-33);var s=tf(t);Gl(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=tf(t);Kl(t,a,o);break;default:throw Error(F(161))}}catch(c){xe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function qb(t,e,n){H=t,Wg(t)}function Wg(t,e,n){for(var i=(t.mode&1)!==0;H!==null;){var r=H,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||vo;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||nt;a=vo;var l=nt;if(vo=o,(nt=c)&&!l)for(H=r;H!==null;)o=H,c=o.child,o.tag===22&&o.memoizedState!==null?of(r):c!==null?(c.return=o,H=c):of(r);for(;s!==null;)H=s,Wg(s),s=s.sibling;H=r,vo=a,nt=l}rf(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,H=s):rf(t)}}function rf(t){for(;H!==null;){var e=H;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:nt||Ha(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!nt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:qt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Vh(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Vh(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Es(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}nt||e.flags&512&&Hl(e)}catch(h){xe(e,e.return,h)}}if(e===t){H=null;break}if(n=e.sibling,n!==null){n.return=e.return,H=n;break}H=e.return}}function sf(t){for(;H!==null;){var e=H;if(e===t){H=null;break}var n=e.sibling;if(n!==null){n.return=e.return,H=n;break}H=e.return}}function of(t){for(;H!==null;){var e=H;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ha(4,e)}catch(c){xe(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){xe(e,r,c)}}var s=e.return;try{Hl(e)}catch(c){xe(e,s,c)}break;case 5:var o=e.return;try{Hl(e)}catch(c){xe(e,o,c)}}}catch(c){xe(e,e.return,c)}if(e===t){H=null;break}var a=e.sibling;if(a!==null){a.return=e.return,H=a;break}H=e.return}}var $b=Math.ceil,ga=Mn.ReactCurrentDispatcher,fd=Mn.ReactCurrentOwner,jt=Mn.ReactCurrentBatchConfig,oe=0,$e=null,De=null,Xe=0,Tt=0,rr=di(0),Fe=0,Ls=null,Ni=0,Ka=0,pd=0,ps=null,pt=null,md=0,_r=1/0,kn=null,va=!1,Jl=null,ei=null,yo=!1,Hn=null,ya=0,ms=0,Ql=null,Do=-1,Mo=0;function at(){return oe&6?Ie():Do!==-1?Do:Do=Ie()}function ti(t){return t.mode&1?oe&2&&Xe!==0?Xe&-Xe:_b.transition!==null?(Mo===0&&(Mo=Pm()),Mo):(t=le,t!==0||(t=window.event,t=t===void 0?16:Mm(t.type)),t):1}function Zt(t,e,n,i){if(50<ms)throw ms=0,Ql=null,Error(F(185));$s(t,n,i),(!(oe&2)||t!==$e)&&(t===$e&&(!(oe&2)&&(Ka|=n),Fe===4&&Wn(t,Xe)),bt(t,i),n===1&&oe===0&&!(e.mode&1)&&(_r=Ie()+500,Wa&&hi()))}function bt(t,e){var n=t.callbackNode;_k(t,e);var i=ta(t,t===$e?Xe:0);if(i===0)n!==null&&ph(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&ph(n),e===1)t.tag===0?Pb(af.bind(null,t)):Zm(af.bind(null,t)),Tb(function(){!(oe&6)&&hi()}),n=null;else{switch(_m(i)){case 1:n=Vu;break;case 4:n=Em;break;case 16:n=ea;break;case 536870912:n=xm;break;default:n=ea}n=Yg(n,qg.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function qg(t,e){if(Do=-1,Mo=0,oe&6)throw Error(F(327));var n=t.callbackNode;if(fr()&&t.callbackNode!==n)return null;var i=ta(t,t===$e?Xe:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=ka(t,i);else{e=i;var r=oe;oe|=2;var s=Hg();($e!==t||Xe!==e)&&(kn=null,_r=Ie()+500,Ei(t,e));do try{Gb();break}catch(a){$g(t,a)}while(!0);ed(),ga.current=s,oe=r,De!==null?e=0:($e=null,Xe=0,e=Fe)}if(e!==0){if(e===2&&(r=Tl(t),r!==0&&(i=r,e=Yl(t,r))),e===1)throw n=Ls,Ei(t,0),Wn(t,i),bt(t,Ie()),n;if(e===6)Wn(t,i);else{if(r=t.current.alternate,!(i&30)&&!Hb(r)&&(e=ka(t,i),e===2&&(s=Tl(t),s!==0&&(i=s,e=Yl(t,s))),e===1))throw n=Ls,Ei(t,0),Wn(t,i),bt(t,Ie()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(F(345));case 2:vi(t,pt,kn);break;case 3:if(Wn(t,i),(i&130023424)===i&&(e=md+500-Ie(),10<e)){if(ta(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){at(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Ol(vi.bind(null,t,pt,kn),e);break}vi(t,pt,kn);break;case 4:if(Wn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Xt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Ie()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*$b(i/1960))-i,10<i){t.timeoutHandle=Ol(vi.bind(null,t,pt,kn),i);break}vi(t,pt,kn);break;case 5:vi(t,pt,kn);break;default:throw Error(F(329))}}}return bt(t,Ie()),t.callbackNode===n?qg.bind(null,t):null}function Yl(t,e){var n=ps;return t.current.memoizedState.isDehydrated&&(Ei(t,e).flags|=256),t=ka(t,e),t!==2&&(e=pt,pt=n,e!==null&&Xl(e)),t}function Xl(t){pt===null?pt=t:pt.push.apply(pt,t)}function Hb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!en(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wn(t,e){for(e&=~pd,e&=~Ka,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Xt(e),i=1<<n;t[n]=-1,e&=~i}}function af(t){if(oe&6)throw Error(F(327));fr();var e=ta(t,0);if(!(e&1))return bt(t,Ie()),null;var n=ka(t,e);if(t.tag!==0&&n===2){var i=Tl(t);i!==0&&(e=i,n=Yl(t,i))}if(n===1)throw n=Ls,Ei(t,0),Wn(t,e),bt(t,Ie()),n;if(n===6)throw Error(F(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,vi(t,pt,kn),bt(t,Ie()),null}function gd(t,e){var n=oe;oe|=1;try{return t(e)}finally{oe=n,oe===0&&(_r=Ie()+500,Wa&&hi())}}function Di(t){Hn!==null&&Hn.tag===0&&!(oe&6)&&fr();var e=oe;oe|=1;var n=jt.transition,i=le;try{if(jt.transition=null,le=1,t)return t()}finally{le=i,jt.transition=n,oe=e,!(oe&6)&&hi()}}function vd(){Tt=rr.current,ge(rr)}function Ei(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Cb(n)),De!==null)for(n=De.return;n!==null;){var i=n;switch(Yu(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&oa();break;case 3:xr(),ge(yt),ge(it),od();break;case 5:sd(i);break;case 4:xr();break;case 13:ge(be);break;case 19:ge(be);break;case 10:td(i.type._context);break;case 22:case 23:vd()}n=n.return}if($e=t,De=t=ni(t.current,null),Xe=Tt=e,Fe=0,Ls=null,pd=Ka=Ni=0,pt=ps=null,Ci!==null){for(e=0;e<Ci.length;e++)if(n=Ci[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ci=null}return t}function $g(t,e){do{var n=De;try{if(ed(),Io.current=ma,pa){for(var i=Se.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}pa=!1}if(Oi=0,ze=Le=Se=null,hs=!1,Ds=0,fd.current=null,n===null||n.return===null){Fe=1,Ls=e,De=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=Xe,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Kh(o);if(m!==null){m.flags&=-257,Gh(m,o,a,s,e),m.mode&1&&Hh(s,l,e),e=m,c=l;var b=e.updateQueue;if(b===null){var v=new Set;v.add(c),e.updateQueue=v}else b.add(c);break e}else{if(!(e&1)){Hh(s,l,e),yd();break e}c=Error(F(426))}}else if(ye&&a.mode&1){var w=Kh(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Gh(w,o,a,s,e),Xu(Pr(c,a));break e}}s=c=Pr(c,a),Fe!==4&&(Fe=2),ps===null?ps=[s]:ps.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=_g(s,c,e);Bh(s,g);break e;case 1:a=c;var y=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(ei===null||!ei.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var p=Rg(s,a,e);Bh(s,p);break e}}s=s.return}while(s!==null)}Gg(n)}catch(k){e=k,De===n&&n!==null&&(De=n=n.return);continue}break}while(!0)}function Hg(){var t=ga.current;return ga.current=ma,t===null?ma:t}function yd(){(Fe===0||Fe===3||Fe===2)&&(Fe=4),$e===null||!(Ni&268435455)&&!(Ka&268435455)||Wn($e,Xe)}function ka(t,e){var n=oe;oe|=2;var i=Hg();($e!==t||Xe!==e)&&(kn=null,Ei(t,e));do try{Kb();break}catch(r){$g(t,r)}while(!0);if(ed(),oe=n,ga.current=i,De!==null)throw Error(F(261));return $e=null,Xe=0,Fe}function Kb(){for(;De!==null;)Kg(De)}function Gb(){for(;De!==null&&!kk();)Kg(De)}function Kg(t){var e=Qg(t.alternate,t,Tt);t.memoizedProps=t.pendingProps,e===null?Gg(t):De=e,fd.current=null}function Gg(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Vb(n,e),n!==null){n.flags&=32767,De=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Fe=6,De=null;return}}else if(n=Bb(n,e,Tt),n!==null){De=n;return}if(e=e.sibling,e!==null){De=e;return}De=e=t}while(e!==null);Fe===0&&(Fe=5)}function vi(t,e,n){var i=le,r=jt.transition;try{jt.transition=null,le=1,Jb(t,e,n,i)}finally{jt.transition=r,le=i}return null}function Jb(t,e,n,i){do fr();while(Hn!==null);if(oe&6)throw Error(F(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(F(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Rk(t,s),t===$e&&(De=$e=null,Xe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||yo||(yo=!0,Yg(ea,function(){return fr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=jt.transition,jt.transition=null;var o=le;le=1;var a=oe;oe|=4,fd.current=null,Wb(t,n),zg(n,t),mb(Rl),na=!!_l,Rl=_l=null,t.current=n,qb(n),bk(),oe=a,le=o,jt.transition=s}else t.current=n;if(yo&&(yo=!1,Hn=t,ya=r),s=t.pendingLanes,s===0&&(ei=null),Tk(n.stateNode),bt(t,Ie()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(va)throw va=!1,t=Jl,Jl=null,t;return ya&1&&t.tag!==0&&fr(),s=t.pendingLanes,s&1?t===Ql?ms++:(ms=0,Ql=t):ms=0,hi(),null}function fr(){if(Hn!==null){var t=_m(ya),e=jt.transition,n=le;try{if(jt.transition=null,le=16>t?16:t,Hn===null)var i=!1;else{if(t=Hn,Hn=null,ya=0,oe&6)throw Error(F(331));var r=oe;for(oe|=4,H=t.current;H!==null;){var s=H,o=s.child;if(H.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(H=l;H!==null;){var u=H;switch(u.tag){case 0:case 11:case 15:fs(8,u,s)}var d=u.child;if(d!==null)d.return=u,H=d;else for(;H!==null;){u=H;var h=u.sibling,m=u.return;if(Fg(u),u===l){H=null;break}if(h!==null){h.return=m,H=h;break}H=m}}}var b=s.alternate;if(b!==null){var v=b.child;if(v!==null){b.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}H=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,H=o;else e:for(;H!==null;){if(s=H,s.flags&2048)switch(s.tag){case 0:case 11:case 15:fs(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,H=g;break e}H=s.return}}var y=t.current;for(H=y;H!==null;){o=H;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,H=S;else e:for(o=y;H!==null;){if(a=H,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ha(9,a)}}catch(k){xe(a,a.return,k)}if(a===o){H=null;break e}var p=a.sibling;if(p!==null){p.return=a.return,H=p;break e}H=a.return}}if(oe=r,hi(),dn&&typeof dn.onPostCommitFiberRoot=="function")try{dn.onPostCommitFiberRoot(Ua,t)}catch{}i=!0}return i}finally{le=n,jt.transition=e}}return!1}function cf(t,e,n){e=Pr(n,e),e=_g(t,e,1),t=Zn(t,e,1),e=at(),t!==null&&($s(t,1,e),bt(t,e))}function xe(t,e,n){if(t.tag===3)cf(t,t,n);else for(;e!==null;){if(e.tag===3){cf(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ei===null||!ei.has(i))){t=Pr(n,t),t=Rg(e,t,1),e=Zn(e,t,1),t=at(),e!==null&&($s(e,1,t),bt(e,t));break}}e=e.return}}function Qb(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=at(),t.pingedLanes|=t.suspendedLanes&n,$e===t&&(Xe&n)===n&&(Fe===4||Fe===3&&(Xe&130023424)===Xe&&500>Ie()-md?Ei(t,0):pd|=n),bt(t,e)}function Jg(t,e){e===0&&(t.mode&1?(e=ao,ao<<=1,!(ao&130023424)&&(ao=4194304)):e=1);var n=at();t=On(t,e),t!==null&&($s(t,e,n),bt(t,n))}function Yb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Jg(t,n)}function Xb(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(F(314))}i!==null&&i.delete(e),Jg(t,n)}var Qg;Qg=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||yt.current)gt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return gt=!1,Fb(t,e,n);gt=!!(t.flags&131072)}else gt=!1,ye&&e.flags&1048576&&eg(e,la,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;No(t,e),t=e.pendingProps;var r=Tr(e,it.current);hr(e,n),r=cd(null,e,i,t,r,n);var s=ld();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kt(i)?(s=!0,aa(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,id(e),r.updater=$a,e.stateNode=r,r._reactInternals=e,Ul(e,i,t,n),e=Vl(null,e,i,!0,s,n)):(e.tag=0,ye&&s&&Qu(e),rt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(No(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=eS(i),t=qt(i,t),r){case 0:e=Bl(null,e,i,t,n);break e;case 1:e=Yh(null,e,i,t,n);break e;case 11:e=Jh(null,e,i,t,n);break e;case 14:e=Qh(null,e,i,qt(i.type,t),n);break e}throw Error(F(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:qt(i,r),Bl(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:qt(i,r),Yh(t,e,i,r,n);case 3:e:{if(Dg(e),t===null)throw Error(F(387));i=e.pendingProps,s=e.memoizedState,r=s.element,og(t,e),ha(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Pr(Error(F(423)),e),e=Xh(t,e,i,n,r);break e}else if(i!==r){r=Pr(Error(F(424)),e),e=Xh(t,e,i,n,r);break e}else for(wt=Xn(e.stateNode.containerInfo.firstChild),xt=e,ye=!0,Kt=null,n=rg(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wr(),i===r){e=Nn(t,e,n);break e}rt(t,e,i,n)}e=e.child}return e;case 5:return ag(e),t===null&&Al(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Il(i,r)?o=null:s!==null&&Il(i,s)&&(e.flags|=32),Ng(t,e),rt(t,e,o,n),e.child;case 6:return t===null&&Al(e),null;case 13:return Mg(t,e,n);case 4:return rd(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Er(e,null,i,n):rt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:qt(i,r),Jh(t,e,i,r,n);case 7:return rt(t,e,e.pendingProps,n),e.child;case 8:return rt(t,e,e.pendingProps.children,n),e.child;case 12:return rt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,he(ua,i._currentValue),i._currentValue=o,s!==null)if(en(s.value,o)){if(s.children===r.children&&!yt.current){e=Nn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=_n(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Ll(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(F(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ll(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}rt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,hr(e,n),r=Ut(r),i=i(r),e.flags|=1,rt(t,e,i,n),e.child;case 14:return i=e.type,r=qt(i,e.pendingProps),r=qt(i.type,r),Qh(t,e,i,r,n);case 15:return Ig(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:qt(i,r),No(t,e),e.tag=1,kt(i)?(t=!0,aa(e)):t=!1,hr(e,n),Pg(e,i,r),Ul(e,i,r,n),Vl(null,e,i,!0,t,n);case 19:return Ag(t,e,n);case 22:return Og(t,e,n)}throw Error(F(156,e.tag))};function Yg(t,e){return wm(t,e)}function Zb(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function At(t,e,n,i){return new Zb(t,e,n,i)}function kd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function eS(t){if(typeof t=="function")return kd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Uu)return 11;if(t===Fu)return 14}return 2}function ni(t,e){var n=t.alternate;return n===null?(n=At(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ao(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")kd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Gi:return xi(n.children,r,s,e);case ju:o=8,r|=8;break;case cl:return t=At(12,n,e,r|2),t.elementType=cl,t.lanes=s,t;case ll:return t=At(13,n,e,r),t.elementType=ll,t.lanes=s,t;case ul:return t=At(19,n,e,r),t.elementType=ul,t.lanes=s,t;case am:return Ga(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case sm:o=10;break e;case om:o=9;break e;case Uu:o=11;break e;case Fu:o=14;break e;case Bn:o=16,i=null;break e}throw Error(F(130,t==null?t:typeof t,""))}return e=At(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function xi(t,e,n,i){return t=At(7,t,i,e),t.lanes=n,t}function Ga(t,e,n,i){return t=At(22,t,i,e),t.elementType=am,t.lanes=n,t.stateNode={isHidden:!1},t}function Ac(t,e,n){return t=At(6,t,null,e),t.lanes=n,t}function Lc(t,e,n){return e=At(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tS(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gc(0),this.expirationTimes=gc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gc(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function bd(t,e,n,i,r,s,o,a,c){return t=new tS(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=At(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},id(s),t}function nS(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ki,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Xg(t){if(!t)return ai;t=t._reactInternals;e:{if(Fi(t)!==t||t.tag!==1)throw Error(F(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(kt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(t.tag===1){var n=t.type;if(kt(n))return Xm(t,n,e)}return e}function Zg(t,e,n,i,r,s,o,a,c){return t=bd(n,i,!0,t,r,s,o,a,c),t.context=Xg(null),n=t.current,i=at(),r=ti(n),s=_n(i,r),s.callback=e??null,Zn(n,s,r),t.current.lanes=r,$s(t,r,i),bt(t,i),t}function Ja(t,e,n,i){var r=e.current,s=at(),o=ti(r);return n=Xg(n),e.context===null?e.context=n:e.pendingContext=n,e=_n(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Zn(r,e,o),t!==null&&(Zt(t,r,o,s),Ro(t,r,o)),o}function ba(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function lf(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Sd(t,e){lf(t,e),(t=t.alternate)&&lf(t,e)}function iS(){return null}var ev=typeof reportError=="function"?reportError:function(t){console.error(t)};function Cd(t){this._internalRoot=t}Qa.prototype.render=Cd.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(F(409));Ja(t,e,null,null)};Qa.prototype.unmount=Cd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Di(function(){Ja(null,t,null,null)}),e[In]=null}};function Qa(t){this._internalRoot=t}Qa.prototype.unstable_scheduleHydration=function(t){if(t){var e=Om();t={blockedOn:null,target:t,priority:e};for(var n=0;n<zn.length&&e!==0&&e<zn[n].priority;n++);zn.splice(n,0,t),n===0&&Dm(t)}};function Td(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ya(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function uf(){}function rS(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=ba(o);s.call(l)}}var o=Zg(e,i,t,0,null,!1,!1,"",uf);return t._reactRootContainer=o,t[In]=o.current,_s(t.nodeType===8?t.parentNode:t),Di(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=ba(c);a.call(l)}}var c=bd(t,0,!1,null,null,!1,!1,"",uf);return t._reactRootContainer=c,t[In]=c.current,_s(t.nodeType===8?t.parentNode:t),Di(function(){Ja(e,c,n,i)}),c}function Xa(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=ba(o);a.call(c)}}Ja(e,o,t,r)}else o=rS(n,e,t,r,i);return ba(o)}Rm=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ns(e.pendingLanes);n!==0&&(zu(e,n|1),bt(e,Ie()),!(oe&6)&&(_r=Ie()+500,hi()))}break;case 13:Di(function(){var i=On(t,1);if(i!==null){var r=at();Zt(i,t,1,r)}}),Sd(t,1)}};Wu=function(t){if(t.tag===13){var e=On(t,134217728);if(e!==null){var n=at();Zt(e,t,134217728,n)}Sd(t,134217728)}};Im=function(t){if(t.tag===13){var e=ti(t),n=On(t,e);if(n!==null){var i=at();Zt(n,t,e,i)}Sd(t,e)}};Om=function(){return le};Nm=function(t,e){var n=le;try{return le=t,e()}finally{le=n}};bl=function(t,e,n){switch(e){case"input":if(fl(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=za(i);if(!r)throw Error(F(90));lm(i),fl(i,r)}}}break;case"textarea":dm(t,n);break;case"select":e=n.value,e!=null&&cr(t,!!n.multiple,e,!1)}};ym=gd;km=Di;var sS={usingClientEntryPoint:!1,Events:[Ks,Xi,za,gm,vm,gd]},Hr={findFiberByHostInstance:Si,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},oS={bundleType:Hr.bundleType,version:Hr.version,rendererPackageName:Hr.rendererPackageName,rendererConfig:Hr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Cm(t),t===null?null:t.stateNode},findFiberByHostInstance:Hr.findFiberByHostInstance||iS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ko=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ko.isDisabled&&ko.supportsFiber)try{Ua=ko.inject(oS),dn=ko}catch{}}_t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sS;_t.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Td(e))throw Error(F(200));return nS(t,e,null,n)};_t.createRoot=function(t,e){if(!Td(t))throw Error(F(299));var n=!1,i="",r=ev;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=bd(t,1,!1,null,null,n,!1,i,r),t[In]=e.current,_s(t.nodeType===8?t.parentNode:t),new Cd(e)};_t.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(F(188)):(t=Object.keys(t).join(","),Error(F(268,t)));return t=Cm(e),t=t===null?null:t.stateNode,t};_t.flushSync=function(t){return Di(t)};_t.hydrate=function(t,e,n){if(!Ya(e))throw Error(F(200));return Xa(null,t,e,!0,n)};_t.hydrateRoot=function(t,e,n){if(!Td(t))throw Error(F(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=ev;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Zg(e,null,t,1,n??null,r,!1,s,o),t[In]=e.current,_s(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Qa(e)};_t.render=function(t,e,n){if(!Ya(e))throw Error(F(200));return Xa(null,t,e,!1,n)};_t.unmountComponentAtNode=function(t){if(!Ya(t))throw Error(F(40));return t._reactRootContainer?(Di(function(){Xa(null,null,t,!1,function(){t._reactRootContainer=null,t[In]=null})}),!0):!1};_t.unstable_batchedUpdates=gd;_t.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Ya(n))throw Error(F(200));if(t==null||t._reactInternals===void 0)throw Error(F(38));return Xa(t,e,n,!1,i)};_t.version="18.3.1-next-f1338f8080-20240426";function tv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tv)}catch(t){console.error(t)}}tv(),tm.exports=_t;var aS=tm.exports,df=aS;ol.createRoot=df.createRoot,ol.hydrateRoot=df.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function js(){return js=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},js.apply(this,arguments)}var Kn;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Kn||(Kn={}));const hf="popstate";function cS(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return Zl("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:nv(r)}return uS(e,n,null,t)}function Me(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function wd(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function lS(){return Math.random().toString(36).substr(2,8)}function ff(t,e){return{usr:t.state,key:t.key,idx:e}}function Zl(t,e,n,i){return n===void 0&&(n=null),js({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Lr(e):e,{state:n,key:e&&e.key||i||lS()})}function nv(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Lr(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function uS(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Kn.Pop,c=null,l=u();l==null&&(l=0,o.replaceState(js({},o.state,{idx:l}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Kn.Pop;let w=u(),g=w==null?null:w-l;l=w,c&&c({action:a,location:v.location,delta:g})}function h(w,g){a=Kn.Push;let y=Zl(v.location,w,g);l=u()+1;let S=ff(y,l),p=v.createHref(y);try{o.pushState(S,"",p)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(p)}s&&c&&c({action:a,location:v.location,delta:1})}function m(w,g){a=Kn.Replace;let y=Zl(v.location,w,g);l=u();let S=ff(y,l),p=v.createHref(y);o.replaceState(S,"",p),s&&c&&c({action:a,location:v.location,delta:0})}function b(w){let g=r.location.origin!=="null"?r.location.origin:r.location.href,y=typeof w=="string"?w:nv(w);return y=y.replace(/ $/,"%20"),Me(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let v={get action(){return a},get location(){return t(r,o)},listen(w){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(hf,d),c=w,()=>{r.removeEventListener(hf,d),c=null}},createHref(w){return e(r,w)},createURL:b,encodeLocation(w){let g=b(w);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:m,go(w){return o.go(w)}};return v}var pf;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(pf||(pf={}));function dS(t,e,n){return n===void 0&&(n="/"),hS(t,e,n)}function hS(t,e,n,i){let r=typeof e=="string"?Lr(e):e,s=sv(r.pathname||"/",n);if(s==null)return null;let o=iv(t);fS(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=ES(s);a=CS(o[c],l)}return a}function iv(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(Me(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let l=Pi([i,c.relativePath]),u=n.concat(c);s.children&&s.children.length>0&&(Me(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),iv(s.children,e,u,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:bS(l,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let c of rv(s.path))r(s,o,c)}),e}function rv(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=rv(i.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),r&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function fS(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:SS(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const pS=/^:[\w-]+$/,mS=3,gS=2,vS=1,yS=10,kS=-2,mf=t=>t==="*";function bS(t,e){let n=t.split("/"),i=n.length;return n.some(mf)&&(i+=kS),e&&(i+=gS),n.filter(r=>!mf(r)).reduce((r,s)=>r+(pS.test(s)?mS:s===""?vS:yS),i)}function SS(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function CS(t,e,n){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let c=i[a],l=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=TS({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),h=c.route;if(!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:Pi([s,d.pathname]),pathnameBase:IS(Pi([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=Pi([s,d.pathnameBase]))}return o}function TS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=wS(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((l,u,d)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let v=a[d]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const b=a[d];return m&&!b?l[h]=void 0:l[h]=(b||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function wS(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),wd(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(i.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function ES(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wd(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function sv(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const xS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,PS=t=>xS.test(t);function _S(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Lr(t):t,s;if(n)if(PS(n))s=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),wd(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+n))}n.startsWith("/")?s=gf(n.substring(1),"/"):s=gf(n,e)}else s=e;return{pathname:s,search:OS(i),hash:NS(r)}}function gf(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function jc(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function RS(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function ov(t,e){let n=RS(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function av(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=Lr(t):(r=js({},t),Me(!r.pathname||!r.pathname.includes("?"),jc("?","pathname","search",r)),Me(!r.pathname||!r.pathname.includes("#"),jc("#","pathname","hash",r)),Me(!r.search||!r.search.includes("#"),jc("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!i&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}a=d>=0?e[d]:"/"}let c=_S(r,a),l=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}const Pi=t=>t.join("/").replace(/\/\/+/g,"/"),IS=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),OS=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NS=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function DS(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const cv=["post","put","patch","delete"];new Set(cv);const MS=["get",...cv];new Set(MS);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Us(){return Us=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Us.apply(this,arguments)}const Ed=E.createContext(null),AS=E.createContext(null),Js=E.createContext(null),Za=E.createContext(null),Bi=E.createContext({outlet:null,matches:[],isDataRoute:!1}),lv=E.createContext(null);function Qs(){return E.useContext(Za)!=null}function xd(){return Qs()||Me(!1),E.useContext(Za).location}function uv(t){E.useContext(Js).static||E.useLayoutEffect(t)}function Ys(){let{isDataRoute:t}=E.useContext(Bi);return t?GS():LS()}function LS(){Qs()||Me(!1);let t=E.useContext(Ed),{basename:e,future:n,navigator:i}=E.useContext(Js),{matches:r}=E.useContext(Bi),{pathname:s}=xd(),o=JSON.stringify(ov(r,n.v7_relativeSplatPath)),a=E.useRef(!1);return uv(()=>{a.current=!0}),E.useCallback(function(l,u){if(u===void 0&&(u={}),!a.current)return;if(typeof l=="number"){i.go(l);return}let d=av(l,JSON.parse(o),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Pi([e,d.pathname])),(u.replace?i.replace:i.push)(d,u.state,u)},[e,i,o,s,t])}function jS(t,e){return US(t,e)}function US(t,e,n,i){Qs()||Me(!1);let{navigator:r}=E.useContext(Js),{matches:s}=E.useContext(Bi),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let l=xd(),u;if(e){var d;let w=typeof e=="string"?Lr(e):e;c==="/"||(d=w.pathname)!=null&&d.startsWith(c)||Me(!1),u=w}else u=l;let h=u.pathname||"/",m=h;if(c!=="/"){let w=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(w.length).join("/")}let b=dS(t,{pathname:m}),v=WS(b&&b.map(w=>Object.assign({},w,{params:Object.assign({},a,w.params),pathname:Pi([c,r.encodeLocation?r.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?c:Pi([c,r.encodeLocation?r.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),s,n,i);return e&&v?E.createElement(Za.Provider,{value:{location:Us({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Kn.Pop}},v):v}function FS(){let t=KS(),e=DS(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),n?E.createElement("pre",{style:r},n):null,null)}const BS=E.createElement(FS,null);class VS extends E.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?E.createElement(Bi.Provider,{value:this.props.routeContext},E.createElement(lv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zS(t){let{routeContext:e,match:n,children:i}=t,r=E.useContext(Ed);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),E.createElement(Bi.Provider,{value:e},i)}function WS(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||Me(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,l=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:h,errors:m}=n,b=d.route.loader&&h[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||b){c=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let m,b=!1,v=null,w=null;n&&(m=a&&d.route.id?a[d.route.id]:void 0,v=d.route.errorElement||BS,c&&(l<0&&h===0?(JS("route-fallback"),b=!0,w=null):l===h&&(b=!0,w=d.route.hydrateFallbackElement||null)));let g=e.concat(o.slice(0,h+1)),y=()=>{let S;return m?S=v:b?S=w:d.route.Component?S=E.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,E.createElement(zS,{match:d,routeContext:{outlet:u,matches:g,isDataRoute:n!=null},children:S})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?E.createElement(VS,{location:n.location,revalidation:n.revalidation,component:v,error:m,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}var dv=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(dv||{}),hv=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(hv||{});function qS(t){let e=E.useContext(Ed);return e||Me(!1),e}function $S(t){let e=E.useContext(AS);return e||Me(!1),e}function HS(t){let e=E.useContext(Bi);return e||Me(!1),e}function fv(t){let e=HS(),n=e.matches[e.matches.length-1];return n.route.id||Me(!1),n.route.id}function KS(){var t;let e=E.useContext(lv),n=$S(),i=fv();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function GS(){let{router:t}=qS(dv.UseNavigateStable),e=fv(hv.UseNavigateStable),n=E.useRef(!1);return uv(()=>{n.current=!0}),E.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,Us({fromRouteId:e},s)))},[t,e])}const vf={};function JS(t,e,n){vf[t]||(vf[t]=!0)}function QS(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Kr(t){let{to:e,replace:n,state:i,relative:r}=t;Qs()||Me(!1);let{future:s,static:o}=E.useContext(Js),{matches:a}=E.useContext(Bi),{pathname:c}=xd(),l=Ys(),u=av(e,ov(a,s.v7_relativeSplatPath),c,r==="path"),d=JSON.stringify(u);return E.useEffect(()=>l(JSON.parse(d),{replace:n,state:i,relative:r}),[l,d,r,n,i]),null}function yi(t){Me(!1)}function YS(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Kn.Pop,navigator:s,static:o=!1,future:a}=t;Qs()&&Me(!1);let c=e.replace(/^\/*/,"/"),l=E.useMemo(()=>({basename:c,navigator:s,static:o,future:Us({v7_relativeSplatPath:!1},a)}),[c,a,s,o]);typeof i=="string"&&(i=Lr(i));let{pathname:u="/",search:d="",hash:h="",state:m=null,key:b="default"}=i,v=E.useMemo(()=>{let w=sv(u,c);return w==null?null:{location:{pathname:w,search:d,hash:h,state:m,key:b},navigationType:r}},[c,u,d,h,m,b,r]);return v==null?null:E.createElement(Js.Provider,{value:l},E.createElement(Za.Provider,{children:n,value:v}))}function XS(t){let{children:e,location:n}=t;return jS(eu(e),n)}new Promise(()=>{});function eu(t,e){e===void 0&&(e=[]);let n=[];return E.Children.forEach(t,(i,r)=>{if(!E.isValidElement(i))return;let s=[...e,r];if(i.type===E.Fragment){n.push.apply(n,eu(i.props.children,s));return}i.type!==yi&&Me(!1),!i.props.index||!i.props.children||Me(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=eu(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const ZS="6";try{window.__reactRouterVersion=ZS}catch{}const eC="startTransition",yf=Q0[eC];function tC(t){let{basename:e,children:n,future:i,window:r}=t,s=E.useRef();s.current==null&&(s.current=cS({window:r,v5Compat:!0}));let o=s.current,[a,c]=E.useState({action:o.action,location:o.location}),{v7_startTransition:l}=i||{},u=E.useCallback(d=>{l&&yf?yf(()=>c(d)):c(d)},[c,l]);return E.useLayoutEffect(()=>o.listen(u),[o,u]),E.useEffect(()=>QS(i),[i]),E.createElement(YS,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:i})}var kf;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(kf||(kf={}));var bf;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(bf||(bf={}));const je={heygen:{apiKey:"sk_V2_hgu_kANdMI493FF_OL6Q6C8xToxmlx0rJyKceAZ7nxGuB68C",serverUrl:"https://api.heygen.com"},backend:{baseUrl:"http://localhost:8000"}},Uc="auth_token",Fc="auth_user";class nC{async parseError(e){try{const n=await e.json();return n!=null&&n.detail?Array.isArray(n.detail)?n.detail.map(i=>{const r=i.loc?i.loc.slice(1).join("."):"unknown";let s=i.msg||i.message||"validation error";if(s.includes("pattern")||s.includes("match pattern"))r==="username"?s="Username can only contain letters, numbers, spaces, hyphens, and underscores":r==="email"?s="Please enter a valid email address":s=`Invalid ${r} format`;else if(s.includes("String should have at least")){const o=s.match(/at least (\d+)/),a=o?o[1]:"minimum";r==="username"?s=`Username must be at least ${a} characters long`:r==="password"&&(s=`Password must be at least ${a} characters long`)}else if(s.includes("String should have at most")){const o=s.match(/at most (\d+)/),a=o?o[1]:"maximum";r==="username"&&(s=`Username must be at most ${a} characters long`)}return`${r==="body"?"":r.charAt(0).toUpperCase()+r.slice(1)+": "}${s}`}).join("; "):typeof n.detail=="string"?n.detail:JSON.stringify(n.detail):n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):`HTTP ${e.status}: ${e.statusText||"Error"}`}catch{return`HTTP ${e.status}: ${e.statusText||"Error"}`}}async signUp(e,n,i){try{const r=await fetch(`${je.backend.baseUrl}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:n,password:i})});if(!r.ok){const o=await this.parseError(r);throw new Error(o||"Sign up failed")}const s=await r.json();return this.setToken(s.access_token),this.setUser(s.user),s}catch(r){throw console.error("Sign up error:",r),r}}async signIn(e,n){try{const i=await fetch(`${je.backend.baseUrl}/api/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:n})});if(!i.ok){const s=await this.parseError(i),o=i.status===401?"Incorrect email or password (or account not found).":s||"Sign in failed";throw new Error(o)}const r=await i.json();return this.setToken(r.access_token),this.setUser(r.user),r}catch(i){throw console.error("Sign in error:",i),i}}signOut(){this.removeToken(),this.removeUser()}getUser(){const e=localStorage.getItem(Fc);return e?JSON.parse(e):null}getToken(){return localStorage.getItem(Uc)}isAuthenticated(){return!!this.getToken()}setToken(e){localStorage.setItem(Uc,e)}setUser(e){localStorage.setItem(Fc,JSON.stringify(e))}removeToken(){localStorage.removeItem(Uc)}removeUser(){localStorage.removeItem(Fc)}getAuthHeader(){const e=this.getToken();return e?{Authorization:`Bearer ${e}`}:{}}async updateProfile({username:e,currentPassword:n,newPassword:i}){const r={username:e||void 0,current_password:n||void 0,new_password:i||void 0},s=await fetch(`${je.backend.baseUrl}/api/auth/profile`,{method:"PATCH",headers:{"Content-Type":"application/json",...this.getAuthHeader()},body:JSON.stringify(r)}),o=await s.json().catch(()=>null);if(!s.ok){const a=(o==null?void 0:o.detail)||await this.parseError(s);throw new Error(a||"Failed to update profile")}return o!=null&&o.access_token&&this.setToken(o.access_token),o!=null&&o.user&&this.setUser(o.user),o}async deleteAccount(e){const n=await fetch(`${je.backend.baseUrl}/api/auth/profile`,{method:"DELETE",headers:{"Content-Type":"application/json",...this.getAuthHeader()},body:JSON.stringify({current_password:e})}),i=await n.json().catch(()=>null);if(!n.ok){const r=(i==null?void 0:i.detail)||await this.parseError(n);throw new Error(r||"Failed to delete account")}return this.signOut(),i}async verifyToken(){if(!this.getToken())return!1;try{const n=await fetch(`${je.backend.baseUrl}/api/auth/me`,{headers:{...this.getAuthHeader()}});if(n.ok){const i=await n.json();return this.setUser(i),!0}else return this.signOut(),!1}catch{return this.signOut(),!1}}}const Re=new nC;function iC({isAuthenticated:t,onLogout:e}){var u,d,h,m;const n=Ys(),i=t?Re.getUser():null,[r,s]=E.useState(!1),o=E.useRef(null);E.useEffect(()=>{t&&i&&console.log("Navbar - User:",{email:i.email,role:i.role,isAdmin:(i==null?void 0:i.role)==="admin"})},[t,i]);const a=()=>{e(),s(!1)},c=()=>{s(b=>!b)};E.useEffect(()=>{const b=v=>{o.current&&!o.current.contains(v.target)&&s(!1)};return r&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[r]);const l=((d=(u=i==null?void 0:i.username)==null?void 0:u[0])==null?void 0:d.toUpperCase())||((m=(h=i==null?void 0:i.email)==null?void 0:h[0])==null?void 0:m.toUpperCase())||"U";return f.jsx(f.Fragment,{children:f.jsx("nav",{className:"navbar",children:f.jsxs("div",{className:"navbar-container",children:[f.jsxs("div",{className:"navbar-left",children:[f.jsx("div",{className:"navbar-brand",onClick:()=>n("/"),style:{cursor:"pointer"},children:f.jsx("h1",{children:"Home"})}),t&&f.jsxs(f.Fragment,{children:[f.jsx("button",{className:"navbar-button navbar-button-dashboard",onClick:()=>n("/dashboard"),children:"Dashboard"}),(i==null?void 0:i.role)==="admin"&&f.jsx("button",{className:"navbar-button navbar-button-admin",onClick:()=>n("/admin"),children:"Admin Panel"})]})]}),f.jsx("div",{className:"navbar-menu",children:t?f.jsxs("div",{className:"navbar-user",ref:o,children:[f.jsx("button",{className:"profile-button",onClick:c,"aria-haspopup":"true","aria-expanded":r,type:"button",children:f.jsx("div",{className:"profile-avatar",children:l})}),r&&f.jsxs("div",{className:"profile-dropdown",children:[f.jsxs("div",{className:"profile-dropdown-header",children:[f.jsx("div",{className:"profile-avatar small",children:l}),f.jsxs("div",{className:"profile-info",children:[f.jsx("span",{className:"profile-name",children:(i==null?void 0:i.username)||(i==null?void 0:i.email)||"User"}),f.jsx("span",{className:"profile-email",children:i==null?void 0:i.email})]})]}),f.jsx("button",{className:"dropdown-item",type:"button",onClick:()=>{n("/settings"),s(!1)},children:"Settings"}),f.jsx("button",{className:"dropdown-item dropdown-logout",type:"button",onClick:a,children:"Logout"})]})]}):f.jsxs("div",{className:"navbar-auth",children:[f.jsx("button",{className:"navbar-button navbar-button-signin",onClick:()=>n("/signin"),children:"Sign In"}),f.jsx("button",{className:"navbar-button navbar-button-signup",onClick:()=>n("/signup"),children:"Sign Up"})]})})]})})})}function rC({avatar:t,status:e,onCancel:n}){return f.jsx("div",{className:"loading-screen",children:f.jsxs("div",{className:"loading-content",children:[f.jsx("div",{className:"loading-avatar-circle",style:{backgroundColor:t.backgroundColor},children:f.jsx("span",{className:"loading-avatar-initials",children:t.initials})}),f.jsxs("h2",{className:"loading-title",children:["Preparing Interview with ",t.name]}),f.jsx("div",{className:"loading-spinner",children:f.jsx("div",{className:"spinner-ring"})}),f.jsx("p",{className:"loading-status",children:e}),f.jsx("button",{className:"btn-cancel",onClick:n,children:"Cancel"})]})})}const Lo=[{id:1,name:"Maya",fullName:"Maya - Rushed Salon Owner",role:"Owner of a busy hair and nail salon",description:"Friendly but hurried salon owner focused on Instagram-worthy aesthetics",personality:"Busy, Instagram-obsessed, cost-skeptical at first",backgroundColor:"#FF6B9D",initials:"M",imageUrl:"https://files2.heygen.ai/avatar/v3/d3370d0f86784bde8e2144d16d573dcc_55280/preview_target.webp",heygenAvatarId:"Anastasia_Chair_Sitting_public",heygenVoiceId:"e0cc82c22f414c95b1f25696c732f058"},{id:2,name:"Patricia",fullName:"Patricia - Medical Office Manager",role:"Office manager at a dental practice",description:"Detail-oriented healthcare office manager focused on patient comfort and compliance",personality:"Detail-oriented, cautious, asks about sanitation/allergies/maintenance",backgroundColor:"#4ECDC4",initials:"P",imageUrl:"https://files2.heygen.ai/avatar/v3/699a4c2995914d39b2cb311a930d7720_45570/preview_talk_3.webp",heygenAvatarId:"Ann_Doctor_Standing2_public",heygenVoiceId:"f8c69e517f424cafaecde32dde57096b"},{id:3,name:"Jennifer",fullName:"Jennifer - Corporate Receptionist",role:"Receptionist and gatekeeper at a professional office",description:"Polite but protective gatekeeper who controls access to decision makers",personality:"Tired of salespeople, initially deflects, warms up if treated respectfully",backgroundColor:"#95E1D3",initials:"J",imageUrl:"https://files2.heygen.ai/avatar/v3/89e07b826f1c4cb1a5549201cdd8f4d6_55300/preview_target.webp",heygenAvatarId:"Alessandra_Chair_Sitting_public",heygenVoiceId:"fb8c5c3f02854c57a4da182d4ed59467"},{id:4,name:"Marcus",fullName:"Marcus - Cost-Conscious Caf Owner",role:"Owner of a small caf with tight margins",description:"Pragmatic, budget-focused caf owner who compares all costs carefully",personality:'Pragmatic, immediately asks "How much?", compares everything to Costco',backgroundColor:"#F38181",initials:"M",imageUrl:"https://files2.heygen.ai/avatar/v3/7fbef4dd1d6641bc8777b26a6aaac85e_45580/preview_talk_1.webp",heygenAvatarId:"Bryan_FitnessCoach_public",heygenVoiceId:"3b4aec73277b4a3f8afd462f76da2778"},{id:5,name:"Diane",fullName:"Diane - Corporate Marketing Manager",role:"Marketing manager at a law firm",description:"Strategic, brand-focused manager who needs ROI justification",personality:"Strategic, measured, thinks ROI/client perception, needs data",backgroundColor:"#AA96DA",initials:"D",imageUrl:"https://files2.heygen.ai/avatar/v3/4e5afdfe8bdb44f3ae18b90281ab034c_45610/preview_talk_1.webp",heygenAvatarId:"Elenora_FitnessCoach2_public",heygenVoiceId:"cef3bc4e0a84424cafcde6f2cf466c97"},{id:6,name:"Rick",fullName:"Rick - Auto Dealership GM",role:"General manager of a car dealership",description:"Sales-driven, enthusiastic GM who loves customer wow-factor",personality:"Energetic, obsessed with customer wow-factor and showroom appeal",backgroundColor:"#FCBAD3",initials:"R",imageUrl:"https://files2.heygen.ai/avatar/v3/f83fffc45faa4368b6db9597e6b323ca_45590/preview_talk_3.webp",heygenAvatarId:"Dexter_Doctor_Sitting2_public",heygenVoiceId:"e0cc82c22f414c95b1f25696c732f058"},{id:7,name:"Sofia",fullName:"Sofia - Boutique Retail Owner",role:"Owner of a boutique retail store",description:"Design-focused owner who makes emotional decisions based on aesthetics",personality:"Design-focused, emotional, highly visual decisions, brand-conscious",backgroundColor:"#FFFFD2",initials:"S",imageUrl:"https://files2.heygen.ai/avatar/v3/b1ff5edbf96242e6ac9469227df40924_55360/preview_target.webp",heygenAvatarId:"Katya_Chair_Sitting_public",heygenVoiceId:"0c418eab508d4030879c0c3381433806"},{id:8,name:"Robert",fullName:"Robert - Skeptical CFO",role:"CFO focused on financial justification",description:"Analytical, numbers-focused CFO who demands clear financial value",personality:"Analytical, data-focused, questions financial value, demands ROI",backgroundColor:"#A8DADC",initials:"R",imageUrl:"https://files2.heygen.ai/avatar/v3/db2fb7fd0d044b908395a011166ab22d_45680/preview_target.webp",heygenAvatarId:"Shawn_Therapist_public",heygenVoiceId:"c4a8ceb7a2954500bc047fb092bcff3f"},{id:9,name:"Amanda",fullName:"Amanda - Hotel Manager",role:"Manager of a boutique hotel focused on guest experience",description:"Guest-obsessed hotel manager who thinks at scale and values reviews",personality:"Guest-focused, obsessed with reviews, thinks at scale",backgroundColor:"#FFB4A2",initials:"A",imageUrl:"https://files2.heygen.ai/avatar/v3/2b901b6b72c4444d81a93a2eb8fe1070_55420/preview_target.webp",heygenAvatarId:"Rika_Chair_Sitting_public",heygenVoiceId:"16a09e4706f74997ba4ed05ea11470f6"},{id:10,name:"James",fullName:"James - Multi-Location Franchise Owner",role:"Owner of 8-12 franchise locations seeking turnkey solutions",description:"Strategic multi-location owner who values consistency and hates complexity",personality:"Strategic, thinks scale, hates complexity, wants turnkey solutions",backgroundColor:"#B5EAD7",initials:"J",imageUrl:"https://files2.heygen.ai/avatar/v3/a1ed8c71e4bf4e6cb9071d2b7cd71e4e_45660/preview_talk_1.webp",heygenAvatarId:"Silas_CustomerSupport_public",heygenVoiceId:"d2f4f24783d04e22ab49ee8fdc3715e0"}];function sC(){const t=Lo.find(i=>i.name==="Patricia"),e=Lo.find(i=>i.name==="Rick"),n=Lo.find(i=>i.name==="Sofia");return f.jsxs("div",{className:"landing-page",children:[f.jsx("div",{className:"landing-hero",children:f.jsx("div",{className:"landing-container",children:f.jsxs("div",{className:"landing-content",children:[f.jsx("h1",{className:"landing-title",children:"Floral Image"}),f.jsx("h2",{className:"landing-subtitle",children:"Sustainable, Lifelike Floral Arrangements for Your Business"}),f.jsx("p",{className:"landing-description",children:"Transform your space with our handmade, sustainable flower arrangements. Experience the beauty of fresh flowers without the mess, allergies, or high costs. Join over 45,000 businesses worldwide who trust Floral Image."}),f.jsxs("div",{className:"landing-features",children:[f.jsxs("div",{className:"feature-card",children:[f.jsx("div",{className:"feature-icon",children:t&&f.jsx("img",{src:t.imageUrl,alt:t.fullName,className:"feature-avatar-image"})}),f.jsx("h3",{children:"Sustainable"}),f.jsx("p",{children:"80 times more sustainable than fresh cut flowers over a 5-year period"})]}),f.jsxs("div",{className:"feature-card",children:[f.jsx("div",{className:"feature-icon",children:e&&f.jsx("img",{src:e.imageUrl,alt:e.fullName,className:"feature-avatar-image"})}),f.jsx("h3",{children:"Monthly Refresh"}),f.jsx("p",{children:"New arrangements delivered monthly - always fresh, always beautiful"})]}),f.jsxs("div",{className:"feature-card",children:[f.jsx("div",{className:"feature-icon",children:n&&f.jsx("img",{src:n.imageUrl,alt:n.fullName,className:"feature-avatar-image"})}),f.jsx("h3",{children:"No Contracts"}),f.jsx("p",{children:"Flexible month-to-month service - cancel anytime, no commitments"})]})]}),f.jsxs("div",{className:"landing-benefits",children:[f.jsxs("div",{className:"benefit-item",children:[f.jsx("span",{className:"benefit-icon",children:""}),f.jsx("span",{className:"benefit-text",children:"No allergies, no mess, no water"})]}),f.jsxs("div",{className:"benefit-item",children:[f.jsx("span",{className:"benefit-icon",children:""}),f.jsx("span",{className:"benefit-text",children:"Significant cost savings vs. fresh flowers"})]}),f.jsxs("div",{className:"benefit-item",children:[f.jsx("span",{className:"benefit-icon",children:""}),f.jsx("span",{className:"benefit-text",children:"Creates positive conversations with clients"})]}),f.jsxs("div",{className:"benefit-item",children:[f.jsx("span",{className:"benefit-icon",children:""}),f.jsx("span",{className:"benefit-text",children:"Monthly refresh service included"})]})]})]})})}),f.jsx("div",{className:"landing-footer",children:f.jsxs("div",{className:"landing-container",children:[f.jsx("p",{children:" 2024 Floral Image. All rights reserved."}),f.jsx("p",{className:"footer-tagline",children:"Handmade  Sustainable  Lifelike"})]})})]})}function oC({onAvatarSelect:t,backendReady:e}){const[n,i]=E.useState(null),[r,s]=E.useState({x:0,y:0,showBelow:!1}),o=(c,l)=>{const u=l.currentTarget.getBoundingClientRect(),d=c.id<=5,h=u.top,b=d||h<350;s({x:u.left+u.width/2,y:b?u.bottom:u.top,showBelow:b}),i(c)},a=()=>{i(null)};return f.jsxs("div",{className:"avatar-grid-container",children:[f.jsx("h1",{className:"grid-title",children:"Select Your Interview Customer"}),f.jsx("p",{className:"grid-subtitle",children:"Choose one of 10 AI customer personas to practice your sales pitch"}),!e&&f.jsxs("div",{className:"backend-notice",children:[f.jsx("div",{className:"notice-icon",children:""}),f.jsx("p",{children:"Initializing backend AI agents... Please wait"})]}),f.jsx("div",{className:"avatar-grid",children:Lo.map(c=>f.jsxs("div",{className:"avatar-card",onMouseEnter:l=>o(c,l),onMouseLeave:a,onClick:()=>t(c),children:[f.jsx("div",{className:"avatar-image-container",children:f.jsx("img",{src:c.imageUrl,alt:c.name,className:"avatar-image",loading:"lazy"})}),f.jsx("div",{className:"avatar-name",children:c.name}),f.jsx("div",{className:"avatar-role-short",children:c.role.split(" ").slice(0,3).join(" ")})]},c.id))}),n&&f.jsxs("div",{className:`avatar-modal ${r.showBelow?"modal-below":"modal-above"}`,style:{left:`${r.x}px`,top:`${r.y}px`},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("div",{className:"modal-avatar-image-container",children:f.jsx("img",{src:n.imageUrl,alt:n.name,className:"modal-avatar-image"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"modal-name",children:n.fullName}),f.jsx("p",{className:"modal-role",children:n.role})]})]}),f.jsxs("div",{className:"modal-content",children:[f.jsxs("div",{className:"modal-section",children:[f.jsx("strong",{children:"Description:"}),f.jsx("p",{children:n.description})]}),f.jsxs("div",{className:"modal-section",children:[f.jsx("strong",{children:"Personality:"}),f.jsx("p",{children:n.personality})]})]}),f.jsx("div",{className:"modal-footer",children:f.jsx("p",{children:"Click to start interview"})})]})]})}function aC({onAvatarSelect:t,backendReady:e}){return f.jsx("div",{className:"dashboard",children:f.jsx("div",{className:"dashboard-container",children:f.jsx("div",{className:"dashboard-content",children:f.jsx(oC,{onAvatarSelect:t,backendReady:e})})})})}function cC({onSuccess:t,onSwitchToSignup:e}){const n=Ys(),[i,r]=E.useState(""),[s,o]=E.useState(""),[a,c]=E.useState(""),[l,u]=E.useState(!1),d=async m=>{m.preventDefault(),c(""),u(!0);try{await Re.signIn(i,s),t?t():n("/dashboard")}catch(b){let v="Failed to sign in. Please check your credentials (account may not exist).";b instanceof Error?v=b.message||v:typeof b=="string"?v=b:b&&typeof b=="object"&&(v=b.message||b.detail||JSON.stringify(b)),c(v)}finally{u(!1)}},h=()=>{e?e():n("/signup")};return f.jsx("div",{className:"auth-page",children:f.jsx("div",{className:"auth-container",children:f.jsxs("div",{className:"auth-card",children:[f.jsx("h2",{children:"Sign In"}),f.jsx("p",{className:"auth-subtitle",children:"Welcome back! Please sign in to continue."}),a&&f.jsx("div",{className:"auth-error",children:a}),f.jsxs("form",{onSubmit:d,className:"auth-form",children:[f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"email",children:"Email"}),f.jsx("input",{type:"email",id:"email",value:i,onChange:m=>r(m.target.value),required:!0,placeholder:"your.email@example.com",disabled:l})]}),f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"password",children:"Password"}),f.jsx("input",{type:"password",id:"password",value:s,onChange:m=>o(m.target.value),required:!0,placeholder:"Enter your password",disabled:l})]}),f.jsx("button",{type:"submit",className:"auth-button",disabled:l,children:l?"Signing in...":"Sign In"})]}),f.jsx("div",{className:"auth-switch",children:f.jsxs("p",{children:[" Don't have an account?"," ",f.jsx("button",{type:"button",onClick:h,className:"auth-link-button",children:"Sign Up"})]})})]})})})}function lC({onSuccess:t,onSwitchToLogin:e}){const n=Ys(),[i,r]=E.useState(""),[s,o]=E.useState(""),[a,c]=E.useState(""),[l,u]=E.useState(""),[d,h]=E.useState(""),[m,b]=E.useState(!1),v=async g=>{if(g.preventDefault(),h(""),s.trim().length<3){h("Username must be at least 3 characters long");return}if(s.trim().length>50){h("Username must be at most 50 characters long");return}if(a!==l){h("Passwords do not match");return}if(a.length<8){h("Password must be at least 8 characters long");return}b(!0);try{await Re.signUp(i,s,a),t?t():n("/dashboard")}catch(y){let S="Failed to sign up. Please try again.";y instanceof Error?S=y.message||S:typeof y=="string"?S=y:y&&typeof y=="object"&&(S=y.message||y.detail||JSON.stringify(y)),h(S)}finally{b(!1)}},w=()=>{e?e():n("/signin")};return f.jsx("div",{className:"auth-page",children:f.jsx("div",{className:"auth-container",children:f.jsxs("div",{className:"auth-card",children:[f.jsx("h2",{children:"Sign Up"}),f.jsx("p",{className:"auth-subtitle",children:"Create an account to get started."}),d&&f.jsx("div",{className:"auth-error",children:d}),f.jsxs("form",{onSubmit:v,className:"auth-form",children:[f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"email",children:"Email"}),f.jsx("input",{type:"email",id:"email",value:i,onChange:g=>r(g.target.value),required:!0,placeholder:"your.email@example.com",disabled:m})]}),f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"username",children:"Username"}),f.jsx("input",{type:"text",id:"username",value:s,onChange:g=>o(g.target.value),required:!0,placeholder:"Choose a username",disabled:m})]}),f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"password",children:"Password"}),f.jsx("input",{type:"password",id:"password",value:a,onChange:g=>c(g.target.value),required:!0,placeholder:"At least 8 characters",disabled:m})]}),f.jsxs("div",{className:"auth-field",children:[f.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),f.jsx("input",{type:"password",id:"confirmPassword",value:l,onChange:g=>u(g.target.value),required:!0,placeholder:"Confirm your password",disabled:m})]}),f.jsx("button",{type:"submit",className:"auth-button",disabled:m,children:m?"Creating account...":"Sign Up"})]}),f.jsx("div",{className:"auth-switch",children:f.jsxs("p",{children:["Already have an account?"," ",f.jsx("button",{type:"button",onClick:w,className:"auth-link-button",children:"Sign In"})]})})]})})})}function uC({onLogout:t}){const e=Re.getUser(),[n,i]=E.useState((e==null?void 0:e.username)||""),[r,s]=E.useState(""),[o,a]=E.useState(""),[c,l]=E.useState(""),[u,d]=E.useState(null),[h,m]=E.useState(null),[b,v]=E.useState(!1),[w,g]=E.useState(!1),y=async p=>{if(p.preventDefault(),d(null),m(null),v(!0),o&&o.length<6){m("Password length must be at least 6 letters."),v(!1);return}try{await Re.updateProfile({username:n.trim(),currentPassword:r||void 0,newPassword:o||void 0}),d("Profile updated successfully."),s(""),a("")}catch(k){m(k.message||"Failed to update profile.")}finally{v(!1)}},S=async p=>{p.preventDefault(),d(null),m(null),g(!0);try{await Re.deleteAccount(c),d("Account deleted. You will be signed out."),t&&t()}catch(k){m(k.message||"Failed to delete account.")}finally{l(""),g(!1)}};return f.jsx("div",{className:"profile-settings",children:f.jsxs("div",{className:"profile-card",children:[f.jsx("h1",{children:"Account Settings"}),f.jsx("p",{className:"profile-subtitle",children:"Update your name or password, or delete your account."}),f.jsxs("form",{className:"profile-form",onSubmit:y,children:[f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"username",children:"Name"}),f.jsx("input",{id:"username",type:"text",value:n,onChange:p=>i(p.target.value),placeholder:"Your display name",required:!0})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"currentPassword",children:"Current Password (required to change password)"}),f.jsx("input",{id:"currentPassword",type:"password",value:r,onChange:p=>s(p.target.value),placeholder:"Enter current password"})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"newPassword",children:"New Password (optional)"}),f.jsx("input",{id:"newPassword",type:"password",value:o,onChange:p=>a(p.target.value),placeholder:"Enter new password"})]}),f.jsx("button",{type:"submit",className:"btn-primary",disabled:b,children:b?"Saving...":"Save Changes"})]}),f.jsxs("div",{className:"danger-zone",children:[f.jsx("h2",{children:"Danger Zone"}),f.jsx("p",{children:"Delete your account permanently. This cannot be undone."}),f.jsxs("form",{className:"profile-form",onSubmit:S,children:[f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"deletePassword",children:"Confirm with current password"}),f.jsx("input",{id:"deletePassword",type:"password",value:c,onChange:p=>l(p.target.value),placeholder:"Enter current password",required:!0})]}),f.jsx("button",{type:"submit",className:"btn-danger",disabled:w,children:w?"Deleting...":"Delete Account"})]})]}),u&&f.jsx("div",{className:"status success",children:u}),h&&f.jsx("div",{className:"status error",children:h})]})})}function dC(){const[t,e]=E.useState(null),[n,i]=E.useState(null),[r,s]=E.useState(!1),o=E.useRef(null),a=E.useCallback(async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!1});e(l),s(!0),i(null),o.current&&(o.current.srcObject=l)}catch(l){i(l.message||"Failed to access webcam"),s(!1)}},[]),c=E.useCallback(()=>{t&&(t.getTracks().forEach(l=>l.stop()),e(null),s(!1),o.current&&(o.current.srcObject=null))},[t]);return E.useEffect(()=>{o.current&&t&&(o.current.srcObject=t)},[t]),E.useEffect(()=>()=>{t&&t.getTracks().forEach(l=>l.stop())},[t]),{stream:t,error:n,isActive:r,videoRef:o,startWebcam:a,stopWebcam:c}}var Sf={};function hC(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var fC=Object.defineProperty,pC=(t,e,n)=>e in t?fC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cf=(t,e,n)=>pC(t,typeof e!="symbol"?e+"":e,n);class ct{constructor(){Cf(this,"_locking"),Cf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function Pe(t,e){if(!t)throw new Error(e)}const mC=34028234663852886e22,gC=-34028234663852886e22,vC=4294967295,yC=2147483647,kC=-2147483648;function jo(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>yC||t<kC)throw new Error("invalid int 32: "+t)}function tu(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>vC||t<0)throw new Error("invalid uint 32: "+t)}function pv(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>mC||t<gC))throw new Error("invalid float 32: "+t)}const mv=Symbol("@bufbuild/protobuf/enum-type");function bC(t){const e=t[mv];return Pe(e,"missing enum type on enum object"),e}function gv(t,e,n,i){t[mv]=vv(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function vv(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=yv(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function SC(t,e,n){const i={};for(const r of e){const s=yv(r);i[s.localName]=s.no,i[s.no]=s.localName}return gv(i,t,e),i}function yv(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Pd{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function CC(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Pd),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function TC(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Bc(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Uo=4294967296;function Tf(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Uo&&(r=r+(i/Uo|0),i=i%Uo)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?bv(i,r):_d(i,r)}function wC(t,e){let n=_d(t,e);const i=n.hi&2147483648;i&&(n=bv(n.lo,n.hi));const r=kv(n.lo,n.hi);return i?"-"+r:r}function kv(t,e){if({lo:t,hi:e}=EC(t,e),e<=2097151)return String(Uo*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+wf(o)+wf(s)}function EC(t,e){return{lo:t>>>0,hi:e>>>0}}function _d(t,e){return{lo:t|0,hi:e|0}}function bv(t,e){return e=~e,t?t=~t+1:e+=1,_d(t,e)}const wf=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Ef(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function xC(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function PC(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Sf!="object"||Sf.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Pe(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Pe(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Tf(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Tf(r)},dec(r,s){return wC(r,s)},uDec(r,s){return kv(r,s)}}}const ke=PC();var A;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(A||(A={}));var ci;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(ci||(ci={}));function jn(t,e,n){if(e===n)return!0;if(t==A.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case A.UINT64:case A.FIXED64:case A.INT64:case A.SFIXED64:case A.SINT64:return e==n}return!1}function Rr(t,e){switch(t){case A.BOOL:return!1;case A.UINT64:case A.FIXED64:case A.INT64:case A.SFIXED64:case A.SINT64:return e==0?ke.zero:"0";case A.DOUBLE:case A.FLOAT:return 0;case A.BYTES:return new Uint8Array(0);case A.STRING:return"";default:return 0}}function Sv(t,e){switch(t){case A.BOOL:return e===!1;case A.STRING:return e==="";case A.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Oe;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Oe||(Oe={}));class _C{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(tu(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return jo(e),Ef(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){pv(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){tu(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){jo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return jo(e),e=(e<<1^e>>31)>>>0,Ef(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ke.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ke.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=ke.enc(e);return Bc(n.lo,n.hi,this.buf),this}sint64(e){let n=ke.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Bc(r,s,this.buf),this}uint64(e){let n=ke.uEnc(e);return Bc(n.lo,n.hi,this.buf),this}}class RC{constructor(e,n){this.varint64=TC,this.uint32=xC,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Oe.Varint:for(;this.buf[this.pos++]&128;);break;case Oe.Bit64:this.pos+=4;case Oe.Bit32:this.pos+=4;break;case Oe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Oe.StartGroup:for(;;){const[s,o]=this.tag();if(o===Oe.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ke.dec(...this.varint64())}uint64(){return ke.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,ke.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ke.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ke.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function IC(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Cv(t){const e=t.field.localName,n=Object.create(null);return n[e]=OC(t),[n,()=>n[e]]}function OC(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Rr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function NC(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ec=[];for(let t=0;t<Cn.length;t++)ec[Cn[t].charCodeAt(0)]=t;ec[45]=Cn.indexOf("+");ec[95]=Cn.indexOf("/");const Tv={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=ec[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Cn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Cn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Cn[r|i>>6],e+=Cn[i&63],n=0;break}return n&&(e+=Cn[r],e+="=",n==1&&(e+="=")),e}};function DC(t,e,n){Ev(e,t);const i=e.runtime.bin.makeReadOptions(n),r=NC(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Cv(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function MC(t,e,n,i){Ev(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(wv(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function wv(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Ev(t,e){Pe(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function xv(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Sv(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function xf(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Rr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Tn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Pd.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Pv(t,e){return Tn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}A.DOUBLE,A.FLOAT,A.INT64,A.UINT64,A.INT32,A.UINT32,A.BOOL,A.STRING,A.BYTES;const Pf={ignoreUnknownFields:!1},_f={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function AC(t){return t?Object.assign(Object.assign({},Pf),t):Pf}function LC(t){return t?Object.assign(Object.assign({},_f),t):_f}const Sa=Symbol(),Fo=Symbol();function jC(){return{makeReadOptions:AC,makeWriteOptions:LC,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(ln(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}Rf(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=Cv(u);Rf(d,a,u.field,n,u),MC(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!xv(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!FC(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=If(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&wv(t,a)){const c=DC(t,a,e),l=If(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return gs(t,e,n??ci.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Sv(t,e)))return Bo(t,e)},debug:ln}}function ln(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Rf(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Pe(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Vc(n.T,a,i.ignoreUnknownFields,!0);c!==Fo&&o.push(c);break;case"scalar":try{o.push(gs(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=UC(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Vc(n.V.T,c,i.ignoreUnknownFields,!0);u!==Fo&&(o[l]=u);break;case"scalar":try{o[l]=gs(n.V.T,c,ci.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];Tn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Vc(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Sa:xf(n,t);break;case Fo:break;default:t[s]=c;break}break;case"scalar":try{const l=gs(n.T,e,n.L,!1);switch(l){case Sa:xf(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ln(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function UC(t,e){if(t===A.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return gs(t,e,ci.BIGINT,!0).toString()}function gs(t,e,n,i){if(e===null)return i?Rr(t,n):Sa;switch(t){case A.DOUBLE:case A.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==A.FLOAT&&pv(r),r;case A.INT32:case A.FIXED32:case A.SFIXED32:case A.SINT32:case A.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==A.UINT32||t==A.FIXED32?tu(s):jo(s),s;case A.INT64:case A.SFIXED64:case A.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=ke.parse(e);return n?o.toString():o;case A.FIXED64:case A.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=ke.uParse(e);return n?a.toString():a;case A.BOOL:if(typeof e!="boolean")break;return e;case A.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case A.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Tv.dec(e)}throw new Error}function Vc(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Sa;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Fo;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(ln(e)))}function FC(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function If(t,e,n){if(t.kind=="map"){Pe(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Bo(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=zc(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Pe(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Bo(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(zc(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Bo(t.T,e);case"enum":return zc(t.T,e,n.enumAsInteger);case"message":return Pv(t.T,e).toJson(n)}}function zc(t,e,n){var i;if(Pe(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Bo(t,e){switch(t){case A.INT32:case A.SFIXED32:case A.SINT32:case A.FIXED32:case A.UINT32:return Pe(typeof e=="number"),e;case A.FLOAT:case A.DOUBLE:return Pe(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case A.STRING:return Pe(typeof e=="string"),e;case A.BOOL:return Pe(typeof e=="boolean"),e;case A.UINT64:case A.FIXED64:case A.INT64:case A.SFIXED64:case A.SINT64:return Pe(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case A.BYTES:return Pe(e instanceof Uint8Array),Tv.enc(e)}}const $i=Symbol("@bufbuild/protobuf/unknown-fields"),Of={readUnknownFields:!0,readerFactory:t=>new RC(t)},Nf={writeUnknownFields:!0,writerFactory:()=>new _C};function BC(t){return t?Object.assign(Object.assign({},Of),t):Of}function VC(t){return t?Object.assign(Object.assign({},Nf),t):Nf}function zC(){return{makeReadOptions:BC,makeWriteOptions:VC,listUnknownFields(t){var e;return(e=t[$i])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[$i]},writeUnknownFields(t,e){const i=t[$i];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[$i])||(r[$i]=[]),r[$i].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==Oe.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Df(t,e,l,c,i)}if(r&&(c!=Oe.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Df,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!xv(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Mf(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Mf(t,e,n,i)}}}function Df(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?A.INT32:n.T;let c=Ca;if(n.kind=="scalar"&&n.L>0&&(c=qC),s){let h=t[o];if(i==Oe.LengthDelimited&&a!=A.STRING&&a!=A.BYTES){let b=e.uint32()+e.pos;for(;e.pos<b;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(Vo(e,new l,r,n)):Tn(t[o])?Vo(e,t[o],r,n):(t[o]=Vo(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=WC(n,e,r);t[o][u]=d;break}}function Vo(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function WC(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=Ca(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=Ca(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Vo(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Rr(t.K,ci.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Rr(t.V.T,ci.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function qC(t,e){const n=Ca(t,e);return typeof n=="bigint"?n.toString():n}function Ca(t,e){switch(e){case A.STRING:return t.string();case A.BOOL:return t.bool();case A.DOUBLE:return t.double();case A.FLOAT:return t.float();case A.INT32:return t.int32();case A.INT64:return t.int64();case A.UINT64:return t.uint64();case A.FIXED64:return t.fixed64();case A.BYTES:return t.bytes();case A.FIXED32:return t.fixed32();case A.SFIXED32:return t.sfixed32();case A.SFIXED64:return t.sfixed64();case A.SINT64:return t.sint64();case A.UINT32:return t.uint32();case A.SINT32:return t.sint32()}}function Mf(t,e,n,i){Pe(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?A.INT32:t.T;if(r)if(Pe(Array.isArray(e)),t.packed)HC(n,s,t.no,e);else for(const o of e)vs(n,s,t.no,o);else vs(n,s,t.no,e);break;case"message":if(r){Pe(Array.isArray(e));for(const o of e)Af(n,i,t,o)}else Af(n,i,t,e);break;case"map":Pe(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))$C(n,i,t,o,a);break}}function $C(t,e,n,i,r){t.tag(n.no,Oe.LengthDelimited),t.fork();let s=i;switch(n.K){case A.INT32:case A.FIXED32:case A.UINT32:case A.SFIXED32:case A.SINT32:s=Number.parseInt(i);break;case A.BOOL:Pe(i=="true"||i=="false"),s=i=="true";break}switch(vs(t,n.K,1,s),n.V.kind){case"scalar":vs(t,n.V.T,2,r);break;case"enum":vs(t,A.INT32,2,r);break;case"message":Pe(r!==void 0),t.tag(2,Oe.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Af(t,e,n,i){const r=Pv(n.T,i);n.delimited?t.tag(n.no,Oe.StartGroup).raw(r.toBinary(e)).tag(n.no,Oe.EndGroup):t.tag(n.no,Oe.LengthDelimited).bytes(r.toBinary(e))}function vs(t,e,n,i){Pe(i!==void 0);let[r,s]=_v(e);t.tag(n,r)[s](i)}function HC(t,e,n,i){if(!i.length)return;t.tag(n,Oe.LengthDelimited).fork();let[,r]=_v(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function _v(t){let e=Oe.Varint;switch(t){case A.BYTES:case A.STRING:e=Oe.LengthDelimited;break;case A.DOUBLE:case A.FIXED64:case A.SFIXED64:e=Oe.Bit64;break;case A.FIXED32:case A.SFIXED32:case A.FLOAT:e=Oe.Bit32;break}const n=A[t].toLowerCase();return[e,n]}function KC(){return{setEnumType:gv,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!Tn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===A.BYTES&&(l=Gr(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===A.BYTES&&(u=i.repeated?u.map(Gr):Gr(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===A.BYTES)for(const[m,b]of Object.entries(o[r]))s[r][m]=Gr(b);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const m of Object.keys(o[r])){let b=o[r][m];h.fieldWrapper||(b=new h(b)),s[r][m]=b}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>Tn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=Gr(h):s[r]=h:s[r]=Tn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>jn(i.T,o,s[a]));case"enum":return r.every((o,a)=>jn(A.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!Tn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!Tn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return jn(A.INT32,r,s);case"scalar":return jn(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return jn(A.INT32,r.value,s.value);case"scalar":return jn(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>jn(A.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>jn(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(bo);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=bo(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:bo(s.value)}:{case:void 0}:o=bo(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function bo(t){if(t===void 0)return t;if(Tn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Gr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function GC(t,e,n){return{syntax:t,json:jC(),bin:zC(),util:Object.assign(Object.assign({},KC()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return CC(this,i,r,s)},makeEnum:SC,makeEnumType:vv,getEnumType:bC,makeExtension(i,r,s){return IC(this,i,r,s)}}}class JC{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Rv(t,e){const n=Iv(t);return e?n:tT(eT(n))}function QC(t){return Rv(t,!1)}const YC=Iv;function Iv(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const XC=new Set(["constructor","toString","toJSON","valueOf"]),ZC=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Ov=t=>"".concat(t,"$"),eT=t=>ZC.has(t)?Ov(t):t,tT=t=>XC.has(t)?Ov(t):t;class nT{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=QC(e)}addField(e){Pe(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function iT(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=Rv(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:YC(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:ci.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=A.BYTES&&u.T!=A.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new nT(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const _=GC("proto3",t=>new JC(t,e=>iT(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Rr(e.T,e.L);break}}});class mt extends Pd{constructor(e){super(),this.seconds=ke.zero,this.nanos=0,_.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(_.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ke.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return mt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new mt({seconds:ke.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new mt().fromBinary(e,n)}static fromJson(e,n){return new mt().fromJson(e,n)}static fromJsonString(e,n){return new mt().fromJsonString(e,n)}static equals(e,n){return _.util.equals(mt,e,n)}}mt.runtime=_;mt.typeName="google.protobuf.Timestamp";mt.fields=_.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const rT=_.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:mt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:sT,repeated:!0},{no:5,name:"events",kind:"message",T:aT,repeated:!0}]),sT=_.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:oT,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),oT=_.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:mt},{no:3,name:"value",kind:"scalar",T:2}]),aT=_.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:mt},{no:7,name:"normalized_end_timestamp",kind:"message",T:mt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Nv=_.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Gt=_.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ne=_.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Rd=_.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),rs=_.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Fs=_.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Yt=_.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ki=_.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),cT=_.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),We=_.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),tc=_.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ta,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:$v}]),Ta=_.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),lT=_.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:_.getEnumType(Ne),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Mi=_.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(pr)},{no:4,name:"tracks",kind:"message",T:sr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:lT},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:_.getEnumType(Ai)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:_.getEnumType(Yt)},{no:18,name:"kind_details",kind:"enum",T:_.getEnumType(uT),repeated:!0}]),pr=_.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ai=_.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),uT=_.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Ue=_.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),dT=_.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ii,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(Dv)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),sr=_.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:_.getEnumType(Gt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:_.getEnumType(Ne)},{no:10,name:"layers",kind:"message",T:ii,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:dT,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:_.getEnumType(Ue)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:$v},{no:19,name:"audio_features",kind:"enum",T:_.getEnumType(We),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(Nv)}]),ii=_.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(Rd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Dv=_.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),ot=_.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:_.getEnumType(ee)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Id,oneof:"value"},{no:3,name:"speaker",kind:"message",T:hT,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:jv,oneof:"value"},{no:7,name:"transcription",kind:"message",T:fT,oneof:"value"},{no:8,name:"metrics",kind:"message",T:rT,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:wa,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Od,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Nd,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Dd,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ea,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:xa,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Pa,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Mv,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ee=_.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Mv=_.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:_.getEnumType(Ue)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Av=_.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Id,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:wa,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Od,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Nd,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Dd,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Ea,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:xa,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Pa,oneof:"value"}]),hT=_.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Lv,repeated:!0}]),Lv=_.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Id=_.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),jv=_.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),fT=_.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:pT,repeated:!0}]),pT=_.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),wa=_.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Od=_.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Nd=_.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Dd=_.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Uv,oneof:"value"}]),Uv=_.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Fv=_.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Bv=_.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:_.getEnumType(Vv)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Vv=_.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),zv=_.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:_.getEnumType(Wv)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Wv=_.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),qv=_.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Lf},{no:2,name:"screen",kind:"message",T:Lf},{no:3,name:"resume_connection",kind:"enum",T:_.getEnumType(Fs)},{no:4,name:"disabled_codecs",kind:"message",T:mT},{no:5,name:"force_relay",kind:"enum",T:_.getEnumType(Fs)}]),Lf=_.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:_.getEnumType(Fs)}]),mT=_.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ta,repeated:!0},{no:2,name:"publish",kind:"message",T:Ta,repeated:!0}]),$v=_.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),nu=_.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Hv=_.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:_.getEnumType(nu)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Kv=_.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ea=_.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:_.getEnumType(Ue)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Hv,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Kv,oneof:"content_header"}],{localName:"DataStream_Header"}),xa=_.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Pa=_.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),gT=_.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Jt=_.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),iu=_.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),vT=_.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),yT=_.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:li,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"trickle",kind:"message",T:nc,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Bs,oneof:"message"},{no:5,name:"mute",kind:"message",T:ic,oneof:"message"},{no:6,name:"subscription",kind:"message",T:rc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Gv,oneof:"message"},{no:8,name:"leave",kind:"message",T:sc,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Qv,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Zv,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Ud,oneof:"message"},{no:13,name:"simulate",kind:"message",T:on,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ld,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:ny,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Ad,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Jv,oneof:"message"}]),jf=_.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:kT,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"offer",kind:"message",T:li,oneof:"message"},{no:4,name:"trickle",kind:"message",T:nc,oneof:"message"},{no:5,name:"update",kind:"message",T:CT,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Md,oneof:"message"},{no:8,name:"leave",kind:"message",T:sc,oneof:"message"},{no:9,name:"mute",kind:"message",T:ic,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:TT,oneof:"message"},{no:11,name:"room_update",kind:"message",T:wT,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:xT,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:_T,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:IT,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:NT,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:ST,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:bT,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:MT,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:jT,oneof:"message"},{no:22,name:"request_response",kind:"message",T:UT,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:FT,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:DT,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:WT,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:OT,oneof:"message"}]),ru=_.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ii,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(Dv)}]),Bs=_.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:_.getEnumType(Gt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:_.getEnumType(Ne)},{no:9,name:"layers",kind:"message",T:ii,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:ru,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:_.getEnumType(Ue)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(Nv)},{no:17,name:"audio_features",kind:"enum",T:_.getEnumType(We),repeated:!0}]),nc=_.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:_.getEnumType(Jt)},{no:3,name:"final",kind:"scalar",T:8}]),ic=_.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),kT=_.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:tc},{no:2,name:"participant",kind:"message",T:Mi},{no:3,name:"other_participants",kind:"message",T:Mi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Yv,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:qv},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Bv},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ta,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),bT=_.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Yv,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:qv},{no:3,name:"server_info",kind:"message",T:Bv},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Md=_.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:sr}]),ST=_.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),li=_.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),CT=_.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Mi,repeated:!0}]),rc=_.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Fv,repeated:!0}]),Gv=_.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:_.getEnumType(Rd)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Ad=_.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:_.getEnumType(We),repeated:!0}]),Jv=_.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),sc=_.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:_.getEnumType(Yt)},{no:3,name:"action",kind:"enum",T:_.getEnumType(mr)},{no:4,name:"regions",kind:"message",T:AT}]),mr=_.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Qv=_.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ii,repeated:!0}]),Ld=_.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Yv=_.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),TT=_.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Lv,repeated:!0}]),wT=_.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:tc}]),ET=_.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:_.getEnumType(rs)},{no:3,name:"score",kind:"scalar",T:2}]),xT=_.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ET,repeated:!0}]),PT=_.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(iu)}]),_T=_.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:PT,repeated:!0}]),jd=_.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(Rd)},{no:2,name:"enabled",kind:"scalar",T:8}]),RT=_.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:jd,repeated:!0}]),IT=_.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:jd,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:RT,repeated:!0}]),OT=_.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:gT,repeated:!0}]),Xv=_.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Zv=_.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Xv,repeated:!0}]),NT=_.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),DT=_.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:tc},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Mi},{no:4,name:"other_participants",kind:"message",T:Mi,repeated:!0}]),Ud=_.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:li},{no:2,name:"subscription",kind:"message",T:rc},{no:3,name:"publish_tracks",kind:"message",T:Md,repeated:!0},{no:4,name:"data_channels",kind:"message",T:ty,repeated:!0},{no:5,name:"offer",kind:"message",T:li},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:ey,repeated:!0}]),ey=_.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),ty=_.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:_.getEnumType(Jt)}]),on=_.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:_.getEnumType(vT),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),ny=_.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),MT=_.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),AT=_.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:LT,repeated:!0}]),LT=_.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),jT=_.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:_.getEnumType(cT)}]),UT=_.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:_.getEnumType(Fd)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:nc,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Bs,oneof:"request"},{no:6,name:"mute",kind:"message",T:ic,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Ld,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Ad,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Jv,oneof:"request"}]),Fd=_.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),FT=_.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),iy=_.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),BT=_.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:zv},{no:2,name:"connection_settings",kind:"message",T:iy},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Bs,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:li},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:_.getEnumType(ki)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Ud}]),VT=_.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:_.getEnumType(zT)},{no:2,name:"join_request",kind:"scalar",T:12}]),zT=_.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),WT=_.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function qT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var zo={exports:{}},$T=zo.exports,Uf;function HT(){return Uf||(Uf=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})($T,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var g=v[w];if(typeof g.bind=="function")return g.bind(v);try{return Function.prototype.bind.call(g,v)}catch{return function(){return Function.prototype.apply.apply(g,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),w=0;w<r.length;w++){var g=r[w];this[g]=w<v?e:this.methodFactory(g,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function h(v,w,g){return l(v)||d.apply(this,arguments)}function m(v,w){var g=this,y,S,p,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(N){var $=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=$;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+$+";"}catch{}}}function x(){var N;if(!(typeof window===n||!k)){try{N=window.localStorage[k]}catch{}if(typeof N===n)try{var $=window.document.cookie,L=encodeURIComponent(k),Y=$.indexOf(L+"=");Y!==-1&&(N=/^([^;]+)/.exec($.slice(Y+L.length+1))[1])}catch{}return g.levels[N]===void 0&&(N=void 0),N}}function P(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(N){var $=N;if(typeof $=="string"&&g.levels[$.toUpperCase()]!==void 0&&($=g.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=g.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+N)}g.name=v,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=w||h,g.getLevel=function(){return p??S??y},g.setLevel=function(N,$){return p=I(N),$!==!1&&T(p),u.call(g)},g.setDefaultLevel=function(N){S=I(N),x()||g.setLevel(N,!1)},g.resetLevel=function(){p=null,P(),u.call(g)},g.enableAll=function(N){g.setLevel(g.levels.TRACE,N)},g.disableAll=function(N){g.setLevel(g.levels.SILENT,N)},g.rebuild=function(){if(o!==g&&(y=I(o.getLevel())),u.call(g),o===g)for(var N in s)s[N].rebuild()},y=I(o?o.getLevel():"WARN");var R=x();R!=null&&(p=I(R)),u.call(g)}o=new m,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var g=s[w];return g||(g=s[w]=new m(w,o.methodFactory)),g};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return s},o.default=o,o})}(zo)),zo.exports}var oc=HT(),su;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(su||(su={}));var tn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(tn||(tn={}));let Z=oc.getLogger("livekit");Object.values(tn).map(t=>oc.getLogger(t));Z.setDefaultLevel(su.info);function Dn(t){const e=oc.getLogger(t);return e.setDefaultLevel(Z.getLevel()),e}const KT=oc.getLogger("lk-e2ee"),Jr=7e3,GT=[0,300,2*2*300,3*3*300,4*4*300,Jr,Jr,Jr,Jr,Jr];class JT{constructor(e){this._retryDelays=e!==void 0?[...e]:GT}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function QT(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function C(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Ff(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ff=="function"?Ff(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var So={exports:{}},Bf;function YT(){if(Bf)return So.exports;Bf=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,T,x){return Function.prototype.apply.call(k,T,x)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(p){console&&console.warn&&console.warn(p)}var r=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}So.exports=s,So.exports.once=g,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(p){if(typeof p!="number"||p<0||r(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");o=p}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(p){return p._maxListeners===void 0?s.defaultMaxListeners:p._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var T=[],x=1;x<arguments.length;x++)T.push(arguments[x]);var P=k==="error",I=this._events;if(I!==void 0)P=P&&I.error===void 0;else if(!P)return!1;if(P){var R;if(T.length>0&&(R=T[0]),R instanceof Error)throw R;var N=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw N.context=R,N}var $=I[k];if($===void 0)return!1;if(typeof $=="function")e($,this,T);else for(var L=$.length,Y=b($,L),x=0;x<L;++x)e(Y[x],this,T);return!0};function l(p,k,T,x){var P,I,R;if(a(T),I=p._events,I===void 0?(I=p._events=Object.create(null),p._eventsCount=0):(I.newListener!==void 0&&(p.emit("newListener",k,T.listener?T.listener:T),I=p._events),R=I[k]),R===void 0)R=I[k]=T,++p._eventsCount;else if(typeof R=="function"?R=I[k]=x?[T,R]:[R,T]:x?R.unshift(T):R.push(T),P=c(p),P>0&&R.length>P&&!R.warned){R.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=p,N.type=k,N.count=R.length,i(N)}return p}s.prototype.addListener=function(k,T){return l(this,k,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,T){return l(this,k,T,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,k,T){var x={fired:!1,wrapFn:void 0,target:p,type:k,listener:T},P=u.bind(x);return P.listener=T,x.wrapFn=P,P}s.prototype.once=function(k,T){return a(T),this.on(k,d(this,k,T)),this},s.prototype.prependOnceListener=function(k,T){return a(T),this.prependListener(k,d(this,k,T)),this},s.prototype.removeListener=function(k,T){var x,P,I,R,N;if(a(T),P=this._events,P===void 0)return this;if(x=P[k],x===void 0)return this;if(x===T||x.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete P[k],P.removeListener&&this.emit("removeListener",k,x.listener||T));else if(typeof x!="function"){for(I=-1,R=x.length-1;R>=0;R--)if(x[R]===T||x[R].listener===T){N=x[R].listener,I=R;break}if(I<0)return this;I===0?x.shift():v(x,I),x.length===1&&(P[k]=x[0]),P.removeListener!==void 0&&this.emit("removeListener",k,N||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var T,x,P;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[k]),this;if(arguments.length===0){var I=Object.keys(x),R;for(P=0;P<I.length;++P)R=I[P],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=x[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(P=T.length-1;P>=0;P--)this.removeListener(k,T[P]);return this};function h(p,k,T){var x=p._events;if(x===void 0)return[];var P=x[k];return P===void 0?[]:typeof P=="function"?T?[P.listener||P]:[P]:T?w(P):b(P,P.length)}s.prototype.listeners=function(k){return h(this,k,!0)},s.prototype.rawListeners=function(k){return h(this,k,!1)},s.listenerCount=function(p,k){return typeof p.listenerCount=="function"?p.listenerCount(k):m.call(p,k)},s.prototype.listenerCount=m;function m(p){var k=this._events;if(k!==void 0){var T=k[p];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(p,k){for(var T=new Array(k),x=0;x<k;++x)T[x]=p[x];return T}function v(p,k){for(;k+1<p.length;k++)p[k]=p[k+1];p.pop()}function w(p){for(var k=new Array(p.length),T=0;T<k.length;++T)k[T]=p[T].listener||p[T];return k}function g(p,k){return new Promise(function(T,x){function P(R){p.removeListener(k,I),x(R)}function I(){typeof p.removeListener=="function"&&p.removeListener("error",P),T([].slice.call(arguments))}S(p,k,I,{once:!0}),k!=="error"&&y(p,P,{once:!0})})}function y(p,k,T){typeof p.on=="function"&&S(p,"error",k,T)}function S(p,k,T,x){if(typeof p.on=="function")x.once?p.once(k,T):p.on(k,T);else if(typeof p.addEventListener=="function")p.addEventListener(k,function P(I){x.once&&p.removeEventListener(k,P),T(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return So.exports}var gn=YT();let ry=!0,sy=!0;function ss(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Vi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function XT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ry=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function ZT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(sy=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function oy(){if(typeof window=="object"){if(ry)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Bd(t,e){sy&&console.warn(t+" is deprecated, please use "+e+" instead.")}function ew(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ss(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ss(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ss(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ss(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Vf(t){return Object.prototype.toString.call(t)==="[object Object]"}function ay(t){return Vf(t)?Object.keys(t).reduce(function(e,n){const i=Vf(t[n]),r=i?ay(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function ou(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?ou(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{ou(t,t.get(r),n)})}))}function zf(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&ou(t,a,r)})}),r}const Wf=oy;function cy(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,m){return h?h+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(b=>b.kind==="videoinput");let m=h.find(b=>d.some(v=>b.label.toLowerCase().includes(v)));return!m&&h.length&&d.includes("back")&&(m=h[h.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=i(a.video),Wf("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Wf("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function ly(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function uy(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Vi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function dy(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hy(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>zf(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Vi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>zf(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function fy(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function py(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return fy(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(m=>m.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[d.id];if(b)b.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const m=l._reverseStreams[h],b=l._streams[m.id];d=d.replace(new RegExp(b.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const m=l._reverseStreams[h],b=l._streams[m.id];d=d.replace(new RegExp(m.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[b=>{const v=s(this,b);h[0].apply(null,[v])},b=>{h[1]&&h[1].apply(null,b)},arguments[2]]):u.apply(this,arguments).then(b=>s(this,b))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(v=>u.track===v)&&(h=this._streams[m])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function au(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function my(t,e){Vi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var qf=Object.freeze({__proto__:null,fixNegotiationNeeded:my,shimAddTrackRemoveTrack:py,shimAddTrackRemoveTrackWithNative:fy,shimGetSendersWithDtmf:dy,shimGetUserMedia:cy,shimMediaStream:ly,shimOnTrack:uy,shimPeerConnection:au,shimSenderReceiverGetStats:hy});function gy(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Bd("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function tw(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function vy(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cu(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function yy(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ky(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Vi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function by(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Bd("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Sy(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Cy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Ty(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function wy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Ey(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var $f=Object.freeze({__proto__:null,shimAddTransceiver:Cy,shimCreateAnswer:Ey,shimCreateOffer:wy,shimGetDisplayMedia:tw,shimGetParameters:Ty,shimGetUserMedia:gy,shimOnTrack:vy,shimPeerConnection:cu,shimRTCDataChannel:Sy,shimReceiverGetStats:ky,shimRemoveStream:by,shimSenderGetStats:yy});function xy(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function Py(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function _y(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function Ry(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Iy(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function Iy(t){return t&&t.video!==void 0?Object.assign({},t,{video:ay(t.video)}):t}function Oy(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Bd("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Ny(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Dy(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function My(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Hf=Object.freeze({__proto__:null,shimAudioContext:My,shimCallbacksAPI:_y,shimConstraints:Iy,shimCreateOfferLegacy:Dy,shimGetUserMedia:Ry,shimLocalStreamsAPI:xy,shimRTCIceServerUrls:Oy,shimRemoteStreamsAPI:Py,shimTrackEventTransceiver:Ny}),Wc={exports:{}},Kf;function nw(){return Kf||(Kf=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(b=>parseInt(b,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(m.rtx={ssrc:l}),i.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(m))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Wc)),Wc.exports}var Ay=nw(),gr=qT(Ay),iw=hC({__proto__:null,default:gr},[Ay]);function Wo(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=gr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Vi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function lu(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Vi(t,"icecandidate",e=>{if(e.candidate){const n=gr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function qo(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=gr.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=gr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=gr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function $o(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Vi(t,"datachannel",i=>(e(i.channel,i.target),i))}function uu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function du(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Ho(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ko(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var rw=Object.freeze({__proto__:null,removeExtmapAllowMixed:du,shimAddIceCandidateNullOrEmpty:Ho,shimConnectionState:uu,shimMaxMessageSize:qo,shimParameterlessSetLocalDescription:Ko,shimRTCIceCandidate:Wo,shimRTCIceCandidateRelayProtocol:lu,shimSendThrowTypeError:$o});function sw(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=oy,i=ew(t),r={browserDetails:i,commonShim:rw,extractVersion:ss,disableLog:XT,disableWarnings:ZT,sdp:iw};switch(i.browser){case"chrome":if(!qf||!au||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=qf,Ho(t,i),Ko(t),cy(t,i),ly(t),au(t,i),uy(t),py(t,i),dy(t),hy(t),my(t,i),Wo(t),lu(t),uu(t),qo(t,i),$o(t),du(t,i);break;case"firefox":if(!$f||!cu||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=$f,Ho(t,i),Ko(t),gy(t,i),cu(t,i),vy(t),by(t),yy(t),ky(t),Sy(t),Cy(t),Ty(t),wy(t),Ey(t),Wo(t),uu(t),qo(t,i),$o(t);break;case"safari":if(!Hf||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Hf,Ho(t,i),Ko(t),Oy(t),Dy(t),_y(t),xy(t),Py(t),Ny(t),Ry(t),My(t),Wo(t),lu(t),qo(t,i),$o(t),du(t,i);break;default:n("Unsupported browser!");break}return r}sw({window:typeof window>"u"?void 0:window});const ow=/version\/(\d+(\.?_?\d+)+)/i;let qc;function St(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(qc===void 0||e){const i=aw.find(r=>{let{test:s}=r;return s.test(n)});qc=i==null?void 0:i.describe(n)}return qc}const aw=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Go(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:$c(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Go(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:$c(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Go(ow,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:$c(t)}}}];function Go(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function $c(t){return t.includes("mac os")?Go(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var cw="2.16.1";const lw=cw,uw=16;class vn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var me;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(me||(me={}));class X extends vn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=me[n]}static notAllowed(e,n,i){return new X(e,me.NotAllowed,n,i)}static timeout(e){return new X(e,me.Timeout)}static leaveRequest(e,n){return new X(e,me.LeaveRequest,void 0,n)}static internal(e,n){return new X(e,me.InternalError,void 0,n)}static cancelled(e){return new X(e,me.Cancelled)}static serverUnreachable(e,n){return new X(e,me.ServerUnreachable,n)}static websocket(e,n,i){return new X(e,me.WebSocket,n,i)}}class Vd extends vn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class En extends vn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class dw extends vn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ae extends vn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class hu extends vn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Gf extends vn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Jf extends vn{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Fd[n]}}var st;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(st||(st={}));class Nt extends vn{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=st[n]}}class Hi extends vn{constructor(e){super(18,e),this.name="SignalReconnectError"}}var _a;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(_a||(_a={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(_a||(_a={}));class Qe{}Qe.setTimeout=function(){return setTimeout(...arguments)};Qe.setInterval=function(){return setInterval(...arguments)};Qe.clearTimeout=function(){return clearTimeout(...arguments)};Qe.clearInterval=function(){return clearInterval(...arguments)};var O;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(O||(O={}));var M;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(M||(M={}));var W;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(W||(W={}));var B;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(B||(B={}));function hw(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class ue{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const fw=["vp8","h264"],pw=["vp8","h264","vp9","av1","h265"];function mw(t){return!!fw.find(e=>e===t)}const gw=mw;var Qf;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Qf||(Qf={}));var fu;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(fu||(fu={}));const Vs={h90:new ue(160,90,9e4,20),h180:new ue(320,180,16e4,20),h216:new ue(384,216,18e4,20),h360:new ue(640,360,45e4,20),h540:new ue(960,540,8e5,25),h720:new ue(1280,720,17e5,30),h1080:new ue(1920,1080,3e6,30),h1440:new ue(2560,1440,5e6,30),h2160:new ue(3840,2160,8e6,30)},pu={h120:new ue(160,120,7e4,20),h180:new ue(240,180,125e3,20),h240:new ue(320,240,14e4,20),h360:new ue(480,360,33e4,20),h480:new ue(640,480,5e5,20),h540:new ue(720,540,6e5,25),h720:new ue(960,720,13e5,30),h1080:new ue(1440,1080,23e5,30),h1440:new ue(1920,1440,38e5,30)},zd={h360fps3:new ue(640,360,2e5,3,"medium"),h360fps15:new ue(640,360,4e5,15,"medium"),h720fps5:new ue(1280,720,8e5,5,"medium"),h720fps15:new ue(1280,720,15e5,15,"medium"),h720fps30:new ue(1280,720,2e6,30,"medium"),h1080fps15:new ue(1920,1080,25e5,15,"medium"),h1080fps30:new ue(1920,1080,5e6,30,"medium"),original:new ue(0,0,7e6,30,"medium")};function Ly(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=Fy(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(mu(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(mu(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function mu(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Wd(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":mu(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function jy(t){return C(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Uy();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ye(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function Uy(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>C(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function vw(t){return t==="audioinput"?D.Source.Microphone:t==="videoinput"?D.Source.Camera:D.Source.Unknown}function gu(t){return t===D.Source.Microphone?"audioinput":t===D.Source.Camera?"videoinput":void 0}function yw(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,ji()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function ys(t){return t.split("/")[1].toLowerCase()}function kw(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Md({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function te(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?te(t.track):{})}}function bw(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Sw(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function Fy(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:hw(e)}}function Cw(t){switch(t){case Ne.CAMERA:return D.Source.Camera;case Ne.MICROPHONE:return D.Source.Microphone;case Ne.SCREEN_SHARE:return D.Source.ScreenShare;case Ne.SCREEN_SHARE_AUDIO:return D.Source.ScreenShareAudio;default:return D.Source.Unknown}}function Yf(t,e){return t.width*t.height<e.width*e.height}function Tw(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const ww=5e3,Qr=[];var Et;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Et||(Et={}));class D extends gn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=D.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Z,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),ww):this.handleAppVisibilityChanged()},this.log=Dn((r=i.loggerName)!==null&&r!==void 0?r:tn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=D.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),te(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===D.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===D.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Qr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Qr.splice(Qr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),or(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?B.AudioPlaybackStarted:B.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?B.AudioPlaybackFailed:B.VideoPlaybackFailed,s):s.name==="AbortError"?Z.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Z.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(B.ElementAttached,e),e}detach(e){try{if(e){vr(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(B.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{vr(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(B.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Dn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Qr.forEach(i=>{i.parentElement||(n=!1)}),n&&Qr.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===D.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){vt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){vt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function or(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!ji()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(ji()||Li())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function vr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Gt.AUDIO;case e.Video:return Gt.VIDEO;default:return Gt.DATA}}t.kindToProto=r;function s(l){switch(l){case Gt.AUDIO:return e.Audio;case Gt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return Ne.CAMERA;case n.Microphone:return Ne.MICROPHONE;case n.ScreenShare:return Ne.SCREEN_SHARE;case n.ScreenShareAudio:return Ne.SCREEN_SHARE_AUDIO;default:return Ne.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case Ne.CAMERA:return n.Camera;case Ne.MICROPHONE:return n.Microphone;case Ne.SCREEN_SHARE:return n.ScreenShare;case Ne.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case iu.ACTIVE:return i.Active;case iu.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(D||(D={}));const Ew="|",Xf="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function xw(t){const e=t.split(Ew);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ye(t){return C(this,void 0,void 0,function*(){return new Promise(e=>Qe.setTimeout(e,t))})}function vu(){return"addTransceiver"in RTCPeerConnection.prototype}function yu(){return"addTrack"in RTCPeerConnection.prototype}function Pw(){if(!("getCapabilities"in RTCRtpSender)||ji()||Li())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function _w(){if(!("getCapabilities"in RTCRtpSender)||Li())return!1;if(ji()){const n=St();if(n!=null&&n.version&&mn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&mn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Qt(t){return t==="av1"||t==="vp9"}function ku(t){return!document||zs()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function Rw(){return typeof RTCPeerConnection>"u"?!1:vu()||yu()}function Li(){var t;return((t=St())===null||t===void 0?void 0:t.name)==="Firefox"}function Zf(){const t=St();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function ji(){var t;return((t=St())===null||t===void 0?void 0:t.name)==="Safari"}function zs(){const t=St();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function Iw(){const t=St();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&mn(t.osVersion,"17")>=0}function Ow(t){return t||(t=St()),(t==null?void 0:t.name)==="Safari"&&mn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&mn(t.osVersion,"18.3")>0}function By(){var t,e;return vt()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Nw(){const t=St(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&mn(t.osVersion,e)>=0?!0:t.name==="Safari"&&mn(t.version,e)>=0}function vt(){return typeof document<"u"}function pn(){return navigator.product=="ReactNative"}function Ir(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Hc(t){return Ir(t)?t.hostname.split(".")[0]:null}function Vy(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function zy(){if(!pn())return;let t=Vy();if(t)return t.platform}function ep(){if(vt())return window.devicePixelRatio;if(pn()){let t=Vy();if(t)return t.devicePixelRatio}return 1}function mn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function Dw(t){for(const e of t)e.target.handleResize(e)}function Mw(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Kc=null;const tp=()=>(Kc||(Kc=new ResizeObserver(Dw)),Kc);let Gc=null;const np=()=>(Gc||(Gc=new IntersectionObserver(Mw,{root:null,rootMargin:"0px"})),Gc);function Aw(){var t;const e=new zv({sdk:Wv.JS,protocol:uw,version:lw});return pn()&&(e.os=(t=zy())!==null&&t!==void 0?t:""),e}function ip(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Yr;function Jc(){if(!Yr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Yr]=i.stream.getAudioTracks(),!Yr)throw Error("Could not get empty media stream audio track");Yr.enabled=!1}return Yr.clone()}class Lt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>C(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Lw(t){return pw.includes(t)}function ri(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function jw(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Ws(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function Uw(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function Fw(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function rp(t){switch(t.reason){case me.LeaveRequest:return t.context;case me.Cancelled:return Yt.CLIENT_INITIATED;case me.NotAllowed:return Yt.USER_REJECTED;case me.ServerUnreachable:return Yt.JOIN_FAILURE;default:return Yt.UNKNOWN_REASON}}function Jo(t){return t!==void 0?Number(t):void 0}function bi(t){return t!==void 0?BigInt(t):void 0}function yr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function fn(t){return!!t&&t.kind==D.Kind.Audio}function fi(t){return!!t&&t.kind==D.Kind.Video}function Un(t){return yr(t)&&fi(t)}function yn(t){return yr(t)&&fn(t)}function bu(t){return!!t&&!t.isLocal}function Bw(t){return!!t&&!t.isLocal}function Qc(t){return bu(t)&&fi(t)}function Vw(t){return t.isLocal}function zw(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function Ww(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function qw(t,e){const n=new URL(jw(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),qy(n,"rtc")}function $w(t){const e=new URL(Ws(t));return qy(e,"validate")}function Wy(t){return t.endsWith("/")?t:"".concat(t,"/")}function qy(t,e){return t.pathname="".concat(Wy(t.pathname)).concat(e),t.toString()}function sp(t){if(typeof t=="string")return jf.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return jf.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function Hw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const Kw=10,Xr="lk_e2ee",Gw="LKFrameEncryptionKey",Jw={sharedKey:!1,ratchetSalt:Gw,ratchetWindowSize:8,failureTolerance:Kw,keyringSize:16};var si;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(si||(si={}));var op;(function(t){t.KeyRatcheted="keyRatcheted"})(op||(op={}));var Gn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Gn||(Gn={}));var ap;(function(t){t.Error="cryptorError"})(ap||(ap={}));function Qw(){return Yw()||Su()}function Su(){return typeof window.RTCRtpScriptTransform<"u"}function Yw(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function Xw(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new Av({value:t.value})}class m_ extends gn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Z.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Jw),e),this.on(si.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(si.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(si.RatchetRequest,e,n)}}var cp;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(cp||(cp={}));class Zw extends gn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(Z.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(Gn.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Gn.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Gn.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(si.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break}},this.onWorkerError=i=>{Z.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Gn.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!Qw())throw new Vd("tried to setup end-to-end encryption on an unsupported browser");if(Z.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:KT.getLevel()}};this.worker&&(Z.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Z.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Z.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(W.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(O.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ue.NONE,r.identity)),e.on(O.ConnectionStateChanged,i=>{i===re.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ue.NONE,r.identity)})})}).on(O.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(O.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(O.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(M.LocalSenderCreated,(i,r)=>C(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(M.LocalTrackPublished,i=>{if(!fi(i.track)||!zs())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:ys(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(si.SetKey,i=>this.postKey(i)).on(si.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return C(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Lt;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Lt;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?ys(i.mimeType):void 0)}}setupE2EESender(e,n){if(!yr(e)||!n){n||Z.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return C(this,void 0,void 0,function*(){if(this.worker){if(Su()&&!Zf()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Xr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Xr in e}};this.worker.postMessage(a,[o,s])}e[Xr]=!0}})}handleSender(e,n,i){var r;if(!(Xr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Su()&&!Zf()){Z.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Z.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Xr]=!0}}}const eE=500,tE=15e3;class kr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new kr),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Hc(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,Ye(Math.min(eE*Math.pow(2,s),tE)))}getBackOffPromise(e){const n=new URL(e),i=n&&Hc(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Hc(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}kr._instance=null;const Yc="default";class qe{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new qe),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=qe.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Z.debug("awaiting getUserMedia promise");try{n?yield qe.userMediaPromiseMap.get(n):yield Promise.all(qe.userMediaPromiseMap.values())}catch{Z.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(ji()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return C(this,void 0,void 0,function*(){if(n!==Yc)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Yc);if(!s){Z.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Yc&&a.groupId===(i??s.groupId));if(!o){Z.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?qe.userMediaPromiseMap.has(e):qe.userMediaPromiseMap.size>0}}qe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];qe.userMediaPromiseMap=new Map;var ks;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(ks||(ks={}));class nE{constructor(){this.pendingTasks=new Map,this.taskMutex=new ct,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ks.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ks.RUNNING,yield e()}finally{n.status=ks.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class iE{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(l){s.onmessage=u=>{let{data:d}=u;return l.enqueue(d)},s.onerror=u=>l.error(u)},cancel:o}),writable:new WritableStream({write(l){s.send(l)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const l=()=>C(this,void 0,void 0,function*(){const u=new Promise(h=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",m=>{h(m)},{once:!0})}),d=yield Promise.race([Ye(250),u]);d?a(d):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:h}=u;a({closeCode:d,reason:h}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const rE=["syncState","trickle","offer","answer","simulate","leave"];function sE(t){const e=rE.indexOf(t.case)>=0;return Z.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var de;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(de||(de={}));const oE=250;class qd{get currentState(){return this.state}get isDisconnected(){return this.state===de.DISCONNECTING||this.state===de.DISCONNECTED}get isEstablishingConnection(){return this.state===de.CONNECTING||this.state===de.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=de.DISCONNECTED,this.log=Z,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Dn((i=n.loggerName)!==null&&i!==void 0?i:tn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new nE,this.queuedRequests=[],this.closingLock=new ct,this.connectionLock=new ct,this.state=de.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return C(this,void 0,void 0,function*(){return this.state=de.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=de.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return C(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=i;const o=Aw(),a=i.singlePeerConnection?cE(n,o,i):aE(n,o,i),c=qw(e,a),l=$w(c);return new Promise((u,d)=>C(this,void 0,void 0,function*(){var h,m;try{let b=!1;const v=p=>C(this,void 0,void 0,function*(){if(b)return;b=!0;const k=p instanceof Event?p.currentTarget:p,T=Hw(k,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(T)).catch(x=>{this.log.error(x),this.close()}):this.close(),w(),d(X.cancelled(T))});r==null||r.addEventListener("abort",v);const w=()=>{clearTimeout(g),r==null||r.removeEventListener("abort",v)},g=setTimeout(()=>{v(X.timeout("room connection has timed out (signal)"))},i.websocketTimeout),y=(p,k)=>{this.handleSignalConnected(p,g,k)},S=new URL(c);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new iE(c);try{this.ws.closed.then(R=>{var N;this.isEstablishingConnection&&d(X.internal("Websocket got closed during a (re)connection attempt: ".concat(R.reason))),R.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:R.reason,code:R.closeCode,wasClean:R.closeCode===1e3,state:this.state})),this.state===de.CONNECTED&&this.handleOnClose((N=R.reason)!==null&&N!==void 0?N:"Unexpected WS error"))}).catch(R=>{this.isEstablishingConnection&&d(X.internal("Websocket error during a (re)connection attempt: ".concat(R)))});const p=yield this.ws.opened.catch(R=>C(this,void 0,void 0,function*(){if(this.state!==de.CONNECTED){this.state=de.DISCONNECTED,clearTimeout(g);const N=yield this.handleConnectionError(R,l);d(N);return}this.handleWSError(R),d(R)}));if(clearTimeout(g),!p)return;const k=p.readable.getReader();this.streamWriter=p.writable.getWriter();const T=yield k.read();if(k.releaseLock(),!T.value)throw X.internal("no message received as first message");const x=sp(T.value),P=this.validateFirstMessage(x,(h=i.reconnect)!==null&&h!==void 0?h:!1);if(!P.isValid){d(P.error);return}((m=x.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=x.message.value.pingTimeout,this.pingIntervalDuration=x.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const I=P.shouldProcessFirstMessage?x:void 0;y(p,I),u(P.response)}catch(p){d(p)}finally{w()}}finally{s()}}))})}startReadingLoop(e,n){return C(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Ye(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=sp(r);this.handleSignalResponse(s)}})}close(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([de.DISCONNECTING||de.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=de.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Ye(oE)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=de.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ar(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ar(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new nc({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ic({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new Ld({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Qv({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Zv({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ke.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new ny({timestamp:ke.parse(Date.now()),rtt:ke.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Ad({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new sc({reason:Yt.CLIENT_INITIATED,action:mr.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!sE(n)&&i.state===de.RECONNECTING){i.queuedRequests.push(()=>C(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ye(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new yT({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=lp(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=lp(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===de.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Qe.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Qe.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Qe.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Qe.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=de.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===de.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:X.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:X.internal("Unexpected first message")}:{isValid:!1,error:X.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return C(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return X.notAllowed(r,i.status)}else return e instanceof X?e:X.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof X?i:X.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function lp(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function ar(t,e){return new li({sdp:t.sdp,type:t.type,id:e})}function aE(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",pn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function cE(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new BT({clientInfo:e,connectionSettings:new iy({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new VT({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class up{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class lE{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Wt={},Xc={},Zc={exports:{}},dp;function $d(){if(dp)return Zc.exports;dp=1;var t=Zc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Zc.exports}var hp;function uE(){return hp||(hp=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=$d(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],m=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var b=0;b<(r[h]||[]).length;b+=1){var v=r[h][b];if(v.reg.test(m))return i(v,u,m)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(Xc)),Xc}var el,fp;function dE(){if(fp)return el;fp=1;var t=$d(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return el=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(m){u.push(i(d,h,m))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(m){m.name in d&&d[m.name]!=null?u.push(i(h,m,d)):m.push in d&&d[m.push]!=null&&d[m.push].forEach(function(b){u.push(i(h,m,b))})})})}),u.join(`\r
`)+`\r
`},el}var pp;function hE(){if(pp)return Wt;pp=1;var t=uE(),e=dE(),n=$d();return Wt.grammar=n,Wt.write=e,Wt.parse=t.parse,Wt.parseParams=t.parseParams,Wt.parseFmtpConfig=t.parseFmtpConfig,Wt.parsePayloads=t.parsePayloads,Wt.parseRemoteCandidates=t.parseRemoteCandidates,Wt.parseImageAttributes=t.parseImageAttributes,Wt.parseSimulcastStreamList=t.parseSimulcastStreamList,Wt}var Fn=hE();function Hd(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var m=Date.now()-l;if(m+e>=c)return c-m}return e}var h=function(){var m=[].slice.call(arguments),b=this;return new Promise(function(v,w){var g=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var S=t.apply(b,m);a&&a(S),u.forEach(function(p){return(0,p.resolve)(S)}),u=[]}},d()),g){var y=t.apply(b,m);return a&&a(y),v(y)}u.push({resolve:v,reject:w})})};return h.cancel=function(m){s!==void 0&&clearTimeout(s),u.forEach(function(b){return(0,b.reject)(m)}),u=[]},h}const fE=.7,pE=20,br={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class mp extends gn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Z,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Hd(r=>C(this,void 0,void 0,function*(){this.emit(br.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),pE),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Dn((i=n.loggerName)!==null&&i!==void 0?i:tn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new ct}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return C(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=mE(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Fn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Kd(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===l){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Fn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(br.NegotiationComplete),e.sdp&&Fn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(br.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Fn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{vp(a),a.type==="audio"?gp(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(Qt(c.codec)&&!ji()&&this.ensureVideoDDExtensionForSVC(a,o),!Qt(c.codec)))return!0;const u=Math.round(c.maxbr*fE);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Fn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Fn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{vp(r),r.type==="audio"&&gp(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Fn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ae("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ae("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return C(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new hu(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===Xf))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Xf})}}}function gp(t,e,n){const i=Kd(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function mE(t){var e;const n=[],i=[],r=Fn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const c=Kd(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&i.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function vp(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Kd(t){return typeof t=="number"?t.toFixed(0):t}const Cu="vp8",gE={audioPreset:fu.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:zd.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Cu,backupCodec:!0,preConnectBuffer:!1},$y={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Hy={deviceId:{ideal:"default"},resolution:Vs.h720.resolution},vE={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new JT,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Gd={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ee;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Ee||(Ee={}));class yE{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Gd.peerConnectionTimeout,this.log=Z,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=Ee.CONNECTED:c.some(l=>l==="failed")?this.state=Ee.FAILED:c.some(l=>l==="connecting")?this.state=Ee.CONNECTING:c.every(l=>l==="closed")?this.state=Ee.CLOSED:c.some(l=>l==="closed")?this.state=Ee.CLOSING:c.every(l=>l==="new")&&(this.state=Ee.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(Ee[a]," to ").concat(Ee[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=Dn((r=i.loggerName)!==null&&r!==void 0?r:tn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new mp(e,i),n!=="publisher-only"&&(this.subscriber=new mp(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Jt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Jt.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=Ee.NEW,this.connectionLock=new ct,this.remoteOfferLock=new ct}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return C(this,void 0,void 0,function*(){var i;n===Jt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return C(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return C(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new Promise((n,i)=>C(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(br.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(br.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Jt.PUBLISHER?this.publisher.getConnectedAddress():e===Jt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>C(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Qe.clearTimeout(d),l(X.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Qe.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(X.internal("could not establish pc connection"))},o);for(;this.state!==Ee.CONNECTED;)if(yield Ye(50),r!=null&&r.signal.aborted){l(X.cancelled("room connection has been cancelled"));return}Qe.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}const Ky=5e3,kE=3e4;class se{static fetchRegionSettings(e,n,i){return C(this,void 0,void 0,function*(){const r=yield se.fetchLock.lock();try{const s=yield fetch("".concat(bE(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=Ww(s.headers),a=o?o*1e3:Ky;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?X.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):X.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof X?s:i!=null&&i.aborted?X.cancelled("Region fetching was aborted"):X.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return C(this,void 0,void 0,function*(){const r=se.settingsTimeouts.get(e.hostname);clearTimeout(r),se.settingsTimeouts.set(e.hostname,setTimeout(()=>C(this,void 0,void 0,function*(){try{const s=yield se.fetchRegionSettings(e,n);se.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof X&&s.reason===me.NotAllowed){Z.debug("token is not valid, cancelling auto region refresh");return}Z.debug("auto refetching of region settings failed",{error:s}),se.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){se.cache.set(e.hostname,i),se.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=se.settingsTimeouts.get(e);n&&(clearTimeout(n),se.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=se.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=se.connectionTrackers.get(e);i&&i.connectionCount===0&&(Z.debug("stopping region refetch after disconnect delay",{hostname:e}),se.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},kE))}static cancelCleanup(e){const n=se.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=se.connectionTrackers.get(e);n||(n={connectionCount:0},se.connectionTrackers.set(e,n)),n.connectionCount++,se.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=se.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&se.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Ir(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){return se.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=se.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),se.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Z.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){se.updateCachedRegionSettings(this.serverUrl,this.token,e)}}se.cache=new Map;se.settingsTimeouts=new Map;se.connectionTrackers=new Map;se.fetchLock=new ct;function bE(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class _e extends Error{constructor(e,n,i){super(n),this.code=e,this.message=yp(n,_e.MAX_MESSAGE_BYTES),this.data=i?yp(i,_e.MAX_DATA_BYTES):void 0}static fromProto(e){return new _e(e.code,e.message,e.data)}toProto(){return new Uv({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new _e(_e.ErrorCode[e],_e.ErrorMessage[e],n)}}_e.MAX_MESSAGE_BYTES=256;_e.MAX_DATA_BYTES=15360;_e.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};_e.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Gy=15360;function Jd(t){return new TextEncoder().encode(t).length}function yp(t,e){if(Jd(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Qd=2e3;function ac(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Yd=typeof MediaRecorder<"u";class SE{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const CE=Yd?MediaRecorder:SE;class TE extends CE{constructor(e,n){if(!Yd)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>C(this,void 0,void 0,function*(){let u;if(l.data.arrayBuffer){const d=yield l.data.arrayBuffer();u=new Uint8Array(d)}else if(l.data.byteArray)u=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function wE(){return Yd}const EE=1e3,xE=1e4;class Jy extends D{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Hd(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(B.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new ct,this.pauseUpstreamLock=new ct,this.trackChangeLock=new ct,this.trackChangeLock.lock().then(o=>C(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==D.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return C(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{vr(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(or(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{or(r??e,s)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:EE;return function*(){var i;if(e.kind===D.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=St())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ye(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Ye(50)}throw new En("unable to get track dimensions after timeout")}()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ri(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ri(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===D.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===D.Kind.Audio?"audioinput":"videoinput";return n?qe.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return C(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new En("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=QT(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===D.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(l=>{vr(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===D.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(B.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),By()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(B.UpstreamPaused,this);const i=St();if((i==null?void 0:i.name)==="Safari"&&mn(i.version,"12.0")<0)throw new Vd("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(B.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(or(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(vr(i._mediaStreamTrack,l),or(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(B.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(B.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!wE()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new TE(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},xE)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Ra extends Jy{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,D.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=ac(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,We.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,We.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ri(this._constraints.deviceId);return this.source===D.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let n;if(e){const i=Wd({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){vt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Qd)))}setProcessor(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!pn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(B.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield jy(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(B.AudioSilenceDetected)),e})}}function PE(t,e,n){switch(t.kind){case"audio":return new Ra(t,e,!1,void 0,n);case"video":return new Ia(t,e,!1,n);default:throw new En("unsupported track type: ".concat(t.kind))}}const _E=Object.values(Vs),RE=Object.values(pu),IE=Object.values(zd),OE=[Vs.h180,Vs.h360],NE=[pu.h180,pu.h360],DE=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ue(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Tu=["q","h","f"];function wu(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=AE(t,e,n,l),Z.debug("using video encoding",o));const u=o.maxFramerate,d=new ue(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Qt(l)){const b=new Qy(c),v=[];if(b.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const w=St();if(zs()||pn()||(w==null?void 0:w.name)==="Chrome"&&mn(w==null?void 0:w.version,"113")<0){const g=b.suffix=="h"?2:3,y=Ow(w);for(let S=0;S<b.spatial;S+=1)v.push({rid:Tu[2-S],maxBitrate:o.maxBitrate/Math.pow(g,S),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:y?Math.pow(2,S):void 0});v[0].scalabilityMode=c}else v.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(v[0].priority=d.encoding.priority,v[0].networkPriority=d.encoding.priority),Z.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let h=[];t?h=(r=bp(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:kp(t,d):h=(s=bp(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:kp(t,d);let m;if(h.length>0){const b=h[0];h.length>1&&([,m]=h);const v=Math.max(e,n);if(v>=960&&m)return tl(e,n,[b,m,d],u);if(v>=480)return tl(e,n,[b,d],u)}return tl(e,n,[d])}function ME(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Z.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===D.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),wu(t.source===D.Source.ScreenShare,c,l,n)}function AE(t,e,n,i){const r=LE(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function LE(t,e,n){if(t)return IE;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?_E:RE}function kp(t,e){if(t)return DE(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?OE:NE}function tl(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Tu.length)return;const a=Math.min(t,e),l={rid:Tu[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=Li()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),pn()&&zy()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Z.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Z.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function bp(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Qy{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function jE(t){return t.source===D.Source.ScreenShare||t.constraints.height&&ri(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const UE=5e3;class Ia extends Jy{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,D.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(B.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=ac(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new ct}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!vt())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Qd))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=wn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=wn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=Et.LOW;i<=Et.HIGH;i+=1)n.push(new jd({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Qt(this.codec),n)}restartTrack(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Wd({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=wn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,m=wn(r.simulcastCodecs.values()),b;b=yield m.next(),o=b.done,!o;h=!0)l=b.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(v){a={error:v}}finally{try{!h&&!o&&(c=m.return)&&(yield c.call(m))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},UE))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Qt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=wn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Qt(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Sp(d.sender,d.encodings,u.qualities,this.senderLock,Qt(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Sp(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Qt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),By()&&this.isInBackground&&this.source===D.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Sp(t,e,n,i,r,s,o){return C(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),l.forEach((h,m)=>{var b;let v=(b=h.rid)!==null&&b!==void 0?b:"";v===""&&(v="q");const w=Yy(v),g=n.find(y=>y.quality===w);g&&h.active!==g.enabled&&(u=!0,h.active=g.enabled,s.debug("setting layer ".concat(g.quality," to ").concat(h.active?"enabled":"disabled"),o),Li()&&(g.enabled?(h.scaleResolutionDownBy=e[m].scaleResolutionDownBy,h.maxBitrate=e[m].maxBitrate,h.maxFrameRate=e[m].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Yy(t){switch(t){case"f":return Et.HIGH;case"h":return Et.MEDIUM;case"q":return Et.LOW;default:return Et.HIGH}}function Cp(t,e,n,i){if(!n)return[new ii({quality:Et.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new Qy(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new ii({quality:Math.min(Et.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Yy((o=r.rid)!==null&&o!==void 0?o:"");return new ii({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Tp="_lossy",wp="_reliable",FE=2*1e3,nl="leave-reconnect",BE=3e4,VE=8*1024,zE=256*1024;var Ot;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ot||(Ot={}));class WE extends gn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Gd.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ot.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Z,this.reliableDataSequence=1,this.reliableMessageBuffer=new up,this.reliableReceivedState=new lE(BE),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>C(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===wp)s.reliableDCSub=o;else if(o.label===Tp)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>C(this,void 0,void 0,function*(){var r,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=ot.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(W.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),m=Av.fromBinary(h.payload),b=new ot({value:m.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=b.value)===null||a===void 0?void 0:a.case)==="user"&&Ep(b,b.value.value),this.emit(W.DataPacketReceived,b,d.value.value.encryptionType)}else((c=d.value)===null||c===void 0?void 0:c.case)==="user"&&Ep(d,d.value.value),this.emit(W.DataPacketReceived,d,Ue.NONE)}finally{l()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?ee.LOSSY:ee.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(W.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===nl&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Qe.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Ot.Connected&&i();const s=()=>{this.off(W.Disconnected,o),i()},o=()=>{this.off(W.Restarted,s),r()};this.once(W.Restarted,s),this.once(W.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===ee.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(W.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>C(this,void 0,void 0,function*(){!this.url||!(yield fetch(Ws(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===de.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===de.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ki.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>C(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Ws(this.url),{method:"HEAD"}),Ye(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Dn((n=e.loggerName)!==null&&n!==void 0?n:tn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new qd(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new ct,this.dataProcessLock=new ct,this.dcBufferStatus=new Map([[ee.LOSSY,!0],[ee.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(W.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(W.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(W.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(W.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(W.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(W.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(W.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(W.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return C(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{Z.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(W.SignalConnected,s),s}catch(s){if(s instanceof X&&s.reason===me.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(W.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new up,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new En("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(X.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return C(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Ee.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new yE(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(W.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Ee.CONNECTED){const u=this.pcState===Ot.New;this.pcState=Ot.Connected,u&&this.emit(W.Connected,e)}else s===Ee.FAILED&&(this.pcState===Ot.Connected||this.pcState===Ot.Reconnecting)&&(this.pcState=Ot.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?ki.RR_SUBSCRIBER_FAILED:ki.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===de.RECONNECTING,l=[Ee.FAILED,Ee.CLOSING,Ee.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(W.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(W.MediaTrackAdded,s.track,s.streams[0],s.receiver)},qE((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(W.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(W.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(W.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(W.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(W.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ki.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Ky,regionSettings:e.regions})),e.action){case mr.DISCONNECT:this.emit(W.Disconnected,e==null?void 0:e.reason),this.close();break;case mr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(nl);break;case mr.RESUME:this.handleDisconnect(nl)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Fs.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Tp,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(wp,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(ee.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,VE),zE)}},1e3))}createSender(e,n,i){return C(this,void 0,void 0,function*(){if(vu())return yield this.createTransceiverRTCRtpSender(e,n,i);if(yu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ae("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(vu())return this.createSimulcastTransceiverSender(e,n,i,r);if(yu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ae("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),fi(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Z.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Fs.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Ee.NEW)===Ee.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Ae?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Hi||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ki.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(W.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Ae("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(W.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Hi;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof X&&o.reason===me.NotAllowed?new Ae("could not reconnect, token might be expired"):new Hi}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(W.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==de.CONNECTED)throw new Hi("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(W.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ae("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ae("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(W.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof X&&r.reason===me.NotAllowed?new Ae("could not reconnect, token might be expired"):r instanceof X&&r.reason===me.LeaveRequest?r:new Hi(s)}if(this.emit(W.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==de.CONNECTED)throw new Hi("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(W.Resumed)})}waitForPCInitialConnection(e,n){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=Ot.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ye(FE),!this.pcManager)throw new Ae("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ot.Connected}catch(e){throw this.pcState=Ot.Disconnected,X.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return C(this,void 0,void 0,function*(){const s=new ot({destinationIdentities:[e],kind:ee.RELIABLE,value:{case:"rpcResponse",value:new Dd({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,ee.RELIABLE)})}publishRpcAck(e,n){return C(this,void 0,void 0,function*(){const i=new ot({destinationIdentities:[e],kind:ee.RELIABLE,value:{case:"rpcAck",value:new Nd({requestId:n})}});yield this.sendDataPacket(i,ee.RELIABLE)})}sendDataPacket(e,n){return C(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=Xw(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new Mv({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===ee.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===ee.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ee.RELIABLE);const n=this.dataChannelForKind(ee.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(ee.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(W.Closing,r);!this.dcBufferStatus.get(e);)yield Ye(10);this.off(W.Closing,r),n()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Ae("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw X.internal("".concat(a," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(d=>{Z.error(d,i.logContext)});const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Ye(50)}throw X.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Ee.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new Promise((e,n)=>C(this,void 0,void 0,function*(){if(!this.pcManager){n(new hu("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(W.Closing,r),this.pcManager.publisher.once(br.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();Lw(c)&&o.set(a.payload,c)}),this.emit(W.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof hu&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ki.RR_UNKNOWN),n(s)}finally{this.off(W.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===ee.LOSSY)return this.lossyDCSub;if(e===ee.RELIABLE)return this.reliableDCSub}else{if(e===ee.LOSSY)return this.lossyDC;if(e===ee.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,m=new Array;e.forEach(b=>{b.isDesired!==d&&h.push(b.trackSid),b.isEnabled||m.push(b.trackSid)}),this.client.sendSyncState(new Ud({answer:this.options.singlePeerConnection?c?ar({sdp:c.sdp,type:c.type}):void 0:u?ar({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?a?ar({sdp:a.sdp,type:a.type}):void 0:l?ar({sdp:l.sdp,type:l.type}):void 0,subscription:new rc({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:kw(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((b,v)=>new ey({publisherSid:v,lastSeq:b}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new ty({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(ee.LOSSY),Jt.PUBLISHER),n(this.dataChannelForKind(ee.RELIABLE),Jt.PUBLISHER),n(this.dataChannelForKind(ee.LOSSY,!0),Jt.SUBSCRIBER),n(this.dataChannelForKind(ee.RELIABLE,!0),Jt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Qe.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){vt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){vt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function qE(t){return t!==void 0&&t>13}function Ep(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Xy{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Nt("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),st.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Nt("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),st.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class $E extends Xy{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Lt,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return C(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=wn(c),d;d=yield u.next(),i=d.done,!i;l=!0){o=d.value,l=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class HE extends Xy{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Jo(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Lt,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:u}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new Nt("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),st.DecodeFailed)}return{done:!1,value:d}}}catch(l){throw o(),l}}),return(){return C(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=wn(c),d;d=yield u.next(),i=d.done,!i;l=!0)o=d.value,l=!1,a+=o}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class KE{constructor(){this.log=Z,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Nt('A text stream handler for topic "'.concat(e,'" has already been set.'),st.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Nt('A byte stream handler for topic "'.concat(e,'" has already been set.'),st.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new Nt("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),st.AbnormalEnd);for(const[l,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return C(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return C(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Lt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Jo(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Nt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),st.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new $E(c,l,Jo(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Lt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Nt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),st.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new HE(c,l,Jo(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Nt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),st.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Nt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),st.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Nt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),st.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Nt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),st.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Zy{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class GE extends Zy{}class JE extends Zy{}const xp=15e3;class QE{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return C(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var m;c[h]=d;const b=c.reduce((v,w)=>v+w,0);(m=n==null?void 0:n.onProgress)===null||m===void 0||m.call(n,b)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>C(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:m=>{l(m,h+1)}})})))),u.info})}streamText(e){return C(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Ue.GCM:Ue.NONE},a=new Ea({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:bi(o.timestamp),totalLength:bi(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new Hv({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?nu.UPDATE:nu.CREATE})}}),c=e==null?void 0:e.destinationIdentities,l=new ot({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,ee.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(v){return C(this,void 0,void 0,function*(){for(const w of zw(v,xp)){const g=new xa({content:w,streamId:s,chunkIndex:bi(u)}),y=new ot({destinationIdentities:c,value:{case:"streamChunk",value:g}});yield d.sendDataPacket(y,ee.RELIABLE),u+=1}})},close(){return C(this,void 0,void 0,function*(){const v=new Pa({streamId:s}),w=new ot({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield d.sendDataPacket(w,ee.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let m=()=>C(this,void 0,void 0,function*(){yield b.close()});d.once(W.Closing,m);const b=new GE(h,o,()=>this.engine.off(W.Closing,m));return b})}sendFile(e,n){return C(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return C(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e==null?void 0:e.destinationIdentities,u={id:c,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Ue.GCM:Ue.NONE},d=new Ea({totalLength:bi((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:bi(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new Kv({name:u.name})}}),h=new ot({destinationIdentities:l,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,ee.RELIABLE);let m=0;const b=new ct,v=this.engine,w=this.log,g=new WritableStream({write(S){return C(this,void 0,void 0,function*(){const p=yield b.lock();let k=0;try{for(;k<S.byteLength;){const T=S.slice(k,k+xp),x=new ot({destinationIdentities:l,value:{case:"streamChunk",value:new xa({content:T,streamId:c,chunkIndex:bi(m)})}});yield v.sendDataPacket(x,ee.RELIABLE),m+=1,k+=T.byteLength}}finally{p()}})},close(){return C(this,void 0,void 0,function*(){const S=new Pa({streamId:c}),p=new ot({destinationIdentities:l,value:{case:"streamTrailer",value:S}});yield v.sendDataPacket(p,ee.RELIABLE)})},abort(S){w.error("Sink error:",S)}});return new JE(g,u)})}}class e0 extends D{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(B.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Qd)),bw()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(B.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class YE extends e0{constructor(e,n,i,r,s,o){super(e,n,D.Kind.Audio,i,o),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=ac(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;pn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(pn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(ku(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&ku(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(B.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(B.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const il=100;class XE extends e0{constructor(e,n,i,r,s){super(e,n,D.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=ac(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Hd(()=>{this.updateDimensions()},il),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===D.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?vr(this._mediaStreamTrack,n):or(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new ZE(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<il){Qe.setTimeout(()=>{this.updateVisibility()},il);return}this.lastVisible=a,this.emit(B.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(B.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?ep():n||(ep()>2?2:1)}}class ZE{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Zr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Zr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Zr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Eu(e),this.isPiP=vt()&&Zr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Eu(this.element),this.isPiP=Zr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,np().observe(this.element),tp().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=np())===null||e===void 0||e.unobserve(this.element),(n=tp())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Zr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Eu(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Eu(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class Sn extends gn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Ue.NONE,this.log=Z,this.handleMuted=()=>{this.emit(B.Muted)},this.handleUnmuted=()=>{this.emit(B.Unmuted)},this.log=Dn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:tn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=D.Source.Unknown}setTrack(e){this.track&&(this.track.off(B.Muted,this.handleMuted),this.track.off(B.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(B.Muted,this.handleMuted),e.on(B.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),te(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ue.NONE}get audioTrack(){if(fn(this.track))return this.track}get videoTrack(){if(fi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=D.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===D.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Sn||(Sn={}));class xu extends Sn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(B.Ended)},this.handleCpuConstrained=()=>{this.track&&fi(this.track)&&this.emit(B.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(B.Ended,this.handleTrackEnded),this.track.off(B.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(B.Ended,this.handleTrackEnded),e.on(B.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(fn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(We.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(We.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(We.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(We.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(We.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(We.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function cc(t,e){return C(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=Fy(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=Ly(s,$y,Hy),l=Wd(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(qe.userMediaPromiseMap.set("audioinput",u),u.catch(()=>qe.userMediaPromiseMap.delete("audioinput"))),s.video&&(qe.userMediaPromiseMap.set("videoinput",u),u.catch(()=>qe.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>C(this,void 0,void 0,function*(){const m=h.kind==="audio";let b=m?c.audio:c.video;(typeof b=="boolean"||!b)&&(b={});let v;const w=m?l.audio:l.video;typeof w!="boolean"&&(v=w);const g=h.getSettings().deviceId;v!=null&&v.deviceId&&ri(v.deviceId)!==g?v.deviceId=g:v||(v={deviceId:g});const y=PE(h,v,e);return y.kind===D.Kind.Video?y.source=D.Source.Camera:y.kind===D.Kind.Audio&&(y.source=D.Source.Microphone),y.mediaStream=d,fn(y)&&i?yield y.setProcessor(i):fi(y)&&r&&(yield y.setProcessor(r)),y})))}catch(d){if(!n)throw d;return cc(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function ex(t){return C(this,void 0,void 0,function*(){return(yield cc({audio:!1,video:!0}))[0]})}function tx(t){return C(this,void 0,void 0,function*(){return(yield cc({audio:!0,video:!1}))[0]})}var qn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(qn||(qn={}));function nx(t){switch(t){case rs.EXCELLENT:return qn.Excellent;case rs.GOOD:return qn.Good;case rs.POOR:return qn.Poor;case rs.LOST:return qn.Lost;default:return qn.Unknown}}class t0 extends gn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ai.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===pr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ai.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=qn.Unknown,this.log=Z,this.log=Dn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:tn.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Lt,this.once(M.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(D.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(D.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(D.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===pr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==pr.ACTIVE&&this.emit(M.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(M.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(M.ParticipantNameChanged,e)}_setAttributes(e){const n=Sw(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(M.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(M.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(M.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=nx(e),n!==this._connectionQuality&&this.emit(M.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>fn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(B.Muted,()=>{this.emit(M.TrackMuted,e)}),e.on(B.Unmuted,()=>{this.emit(M.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case D.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case D.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function ix(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Xv({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class rx extends t0{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ue.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Lt)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(l=this.signalConnectedFuture).reject)===null||u===void 0||u.call(l,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Lt),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:u}=a,d=this.pendingSignalRequests.get(c);d&&(l!==Fd.OK&&d.reject(new Jf(u,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,u=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(u=_e.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>ix(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),te(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),te(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),te(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),te(c))),this.emit(M.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>C(this,void 0,void 0,function*(){var c,l,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const m=this.videoTrackPublications.get(a.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!m.videoTrack)return;const b=yield m.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,w=wn(b),g;g=yield w.next(),c=g.done,!c;v=!0){d=g.value,v=!1;const y=d;gw(y)&&(this.log.debug("publish ".concat(y," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),te(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,y,m.options))}}catch(y){l={error:y}}finally{try{!v&&!c&&(u=w.return)&&(yield u.call(w))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>C(this,void 0,void 0,function*(){if(a.source===D.Source.ScreenShare||a.source===D.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),te(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(yn(a)||Un(a))try{if(vt())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===D.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),te(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),te(a))),yn(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),te(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ue.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(W.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(W.Connected,this.handleReconnected).on(W.SignalConnected,this.handleSignalConnected).on(W.SignalRestarted,this.handleReconnected).on(W.SignalResumed,this.handleReconnected).on(W.Restarting,this.handleReconnecting).on(W.Resuming,this.handleReconnecting).on(W.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(W.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(W.Closing,this.handleClosing).on(W.SignalRequestResponse,this.handleSignalRequestResponse).on(W.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>C(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),m=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:b=>{c(b),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-m<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(b=>{let[v,w]=b;return this.attributes[v]===w||w===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(h),a();return}yield Ye(50)}c(new Jf("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(D.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(D.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(D.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?Ue.GCM:Ue.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return C(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case D.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case D.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case D.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new En(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(M.MediaDevicesError,l,gu(e)),this.pendingPublishing.delete(e),l}for(const l of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===D.Source.Microphone&&fn(l)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),te(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===D.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(D.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(D.Source.Camera)||this.pendingPublishing.has(D.Source.Microphone))){this.pendingPublishing.add(D.Source.Camera),this.pendingPublishing.add(D.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(D.Source.Camera),this.pendingPublishing.delete(D.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var n,i;e??(e={});const r=Ly(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield cc(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(fn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=D.Source.Microphone,this.emit(M.AudioStreamAcquired)),fi(a)&&(this.cameraError=void 0,a.source=D.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Vd("getDisplayMedia not supported");e.resolution===void 0&&!Iw()&&(e.resolution=zd.h1080fps30.resolution);const n=yw(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new En("no video track found");const s=new Ia(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=D.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(M.AudioStreamAcquired);const a=new Ra(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=D.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;yn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),yr(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let g;switch(i.source){case D.Source.Microphone:g="audioinput";break;case D.Source.Camera:g="videoinput"}g&&s.activeDeviceMap.has(g)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(g)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Ra(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Ia(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new En("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(g=>{g.track&&g.track===i&&(h=g)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),te(h))),h;const m=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),b="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,v=(c=m.forceStereo)!==null&&c!==void 0?c:b;v&&(m.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),te(i))),m.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=m.dtx)!==null&&l!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!Nw()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const w=new Promise((g,y)=>C(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==de.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:te(i)}));let S=!1;const p=setTimeout(()=>{S=!0,i.stop(),y(new Gf("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(p),S)return;const k=yield this.publish(i,m,v);g(k)}else try{const S=yield this.publish(i,m,v);g(S)}catch(S){y(S)}}catch(S){y(S)}}));s.pendingPublishPromises.set(i,w);try{return yield w}catch(g){throw g}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Lt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),te(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>Cw(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),te(e))),!1)}publish(e,n,i){return C(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,m;if(!this.hasPermissionsToPublish(e))throw new Gf("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(I=>yr(e)&&I.source===e.source)&&e.source!==D.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),te(e))),n.stopMicTrackOnMute&&fn(e)&&(e.stopOnMute=!0),e.source===D.Source.ScreenShare&&Li()&&(n.simulcast=!1),n.videoCodec==="av1"&&!Pw()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!_w()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Cu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===ys(I.mime))||(n.videoCodec=ys(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(B.Muted,this.onTrackMuted),e.on(B.Unmuted,this.onTrackUnmuted),e.on(B.Ended,this.handleTrackEnded),e.on(B.UpstreamPaused,this.onTrackUpstreamPaused),e.on(B.UpstreamResumed,this.onTrackUpstreamResumed),e.on(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const w=[],g=!(!((r=n.dtx)!==null&&r!==void 0)||r),y=e.getSourceTrackSettings();y.autoGainControl&&w.push(We.TF_AUTO_GAIN_CONTROL),y.echoCancellation&&w.push(We.TF_ECHO_CANCELLATION),y.noiseSuppression&&w.push(We.TF_NOISE_SUPPRESSION),y.channelCount&&y.channelCount>1&&w.push(We.TF_STEREO),g&&w.push(We.TF_NO_DTX),yn(e)&&e.hasPreConnectBuffer&&w.push(We.TF_PRECONNECT_BUFFER);const S=new Bs({cid:e.mediaStreamTrack.id,name:n.name,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),disableDtx:g,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:w});let p;if(e.kind===D.Kind.Video){let I={width:0,height:0};try{I=yield e.waitForDimensions()}catch{const N=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Vs.h720.resolution;I={width:N.width,height:N.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{dims:I}))}S.width=I.width,S.height=I.height,Un(e)&&(Qt(v)&&(e.source===D.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),te(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new ru({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Cu}),n.backupCodec&&v!==n.backupCodec.codec&&S.encryption===Ue.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new ru({codec:n.backupCodec.codec,cid:""})))),p=wu(e.source===D.Source.ScreenShare,S.width,S.height,n),S.layers=Cp(S.width,S.height,p,Qt(n.videoCodec))}else e.kind===D.Kind.Audio&&(p=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(m=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ae("cannot publish track when not connected");const k=()=>C(this,void 0,void 0,function*(){var I,R,N;if(!this.engine.pcManager)throw new Ae("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,p),this.emit(M.LocalSenderCreated,e.sender,e),Un(e)&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=jE(e)),e.setDegradationPreference(n.degradationPreference)),p)if(Li()&&e.kind===D.Kind.Audio){let $;for(const L of this.engine.pcManager.publisher.getTransceivers())if(L.sender===e.sender){$=L;break}$&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:$,codec:"opus",maxbr:!((R=p[0])===null||R===void 0)&&R.maxBitrate?p[0].maxBitrate/1e3:0})}else e.codec&&Qt(e.codec)&&(!((N=p[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:p[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const x=new Promise((I,R)=>C(this,void 0,void 0,function*(){var N;try{T=yield this.engine.addTrack(S),I(T)}catch($){e.sender&&(!((N=this.engine.pcManager)===null||N===void 0)&&N.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(L=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{error:L}))})),R($)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([x,k()]))[0];else{T=yield x;let I;if(T.codecs.forEach(R=>{I===void 0&&(I=R.mimeType)}),I&&e.kind===D.Kind.Video){const R=ys(I);R!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{codec:R})),n.videoCodec=R,p=wu(e.source===D.Source.ScreenShare,S.width,S.height,n))}yield k()}const P=new xu(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(P.on(B.CpuConstrained,I=>this.onTrackCpuConstrained(I,P)),P.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:p,trackInfo:T})),Un(e)?e.startMonitor(this.engine.client):yn(e)&&e.startMonitor(),this.addTrackPublication(P),this.emit(M.LocalTrackPublished,P),yn(e)&&T.audioFeatures.includes(We.TF_PRECONNECT_BUFFER)){const I=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(M.LocalTrackSubscribed,N=>{if(N.trackSid===T.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),te(e))),e.stopPreConnectBuffer()}}),I&&new Promise(($,L)=>C(this,void 0,void 0,function*(){var Y,ve,ht,Ke,z,G;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),te(e)));const It=setTimeout(()=>{L(new Error("agent not active within 10 seconds"))},1e4),Ct=yield this.waitUntilActiveAgentPresent();clearTimeout(It),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),te(e)));const nn=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Ct.identity],attributes:{trackId:P.trackSid,sampleRate:String((z=y.sampleRate)!==null&&z!==void 0?z:"48000"),channels:String((G=y.channelCount)!==null&&G!==void 0?G:"1")}});try{for(var j=!0,ce=wn(I),fe;fe=yield ce.next(),Y=fe.done,!Y;j=!0){Ke=fe.value,j=!1;const ft=Ke;yield nn.write(ft)}}catch(ft){ve={error:ft}}finally{try{!j&&!Y&&(ht=ce.return)&&(yield ht.call(ce))}finally{if(ve)throw ve.error}}yield nn.close(),$()}catch(It){L(It)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),te(e)))}).catch($=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{error:$}))})}return P})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return C(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Ue.NONE)return;let s;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(s=m)}),!s)throw new En("track is not published");if(!Un(e))throw new En("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=ME(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),te(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new Bs({cid:c.mediaStreamTrack.id,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Cp(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Ae("cannot publish track when not connected");const u=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return C(this,void 0,void 0,function*(){var i,r;if(yr(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),te(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?te(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(B.Muted,this.onTrackMuted),e.off(B.Unmuted,this.onTrackUnmuted),e.off(B.Ended,this.handleTrackEnded),e.off(B.UpstreamPaused,this.onTrackUpstreamPaused),e.off(B.UpstreamResumed,this.onTrackUpstreamResumed),e.off(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ee.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Un(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case D.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case D.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(M.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>C(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>C(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==D.Source.ScreenShare&&l.source!==D.Source.ScreenShareAudio&&(yn(l)||Un(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?ee.RELIABLE:ee.LOSSY,o=r.destinationIdentities,a=r.topic;let c=new Id({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const l=new ot({kind:s,value:{case:"user",value:c}});yield i.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return C(this,void 0,void 0,function*(){const i=new ot({kind:ee.RELIABLE,value:{case:"sipDtmf",value:new jv({code:e,digit:n})}});yield this.engine.sendDataPacket(i,ee.RELIABLE)})}sendChatMessage(e,n){return C(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new ot({value:{case:"chatMessage",value:new wa(Object.assign(Object.assign({},i),{timestamp:ke.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,ee.RELIABLE),this.emit(M.ChatMessage,i),i})}editChatMessage(e,n){return C(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new ot({value:{case:"chatMessage",value:new wa(Object.assign(Object.assign({},i),{timestamp:ke.parse(i.timestamp),editTimestamp:ke.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,ee.RELIABLE),this.emit(M.ChatMessage,i),i})}sendText(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return C(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((u,d)=>C(i,void 0,void 0,function*(){var h,m,b,v;if(Jd(o)>Gy){d(_e.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||m===void 0)&&m.version&&mn((v=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){d(_e.builtIn("UNSUPPORTED_SERVER"));return}const w=Math.max(a,8e3),g=crypto.randomUUID();yield this.publishRpcRequest(r,g,s,o,w);const y=setTimeout(()=>{this.pendingAcks.delete(g),d(_e.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(S)},7e3);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(y)},participantIdentity:r});const S=setTimeout(()=>{this.pendingResponses.delete(g),d(_e.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(g,{resolve:(p,k)=>{clearTimeout(S),this.pendingAcks.has(g)&&(this.log.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(y)),k?d(k):u(p??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return C(this,void 0,void 0,function*(){const o=new ot({destinationIdentities:[e],kind:ee.RELIABLE,value:{case:"rpcRequest",value:new Od({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,ee.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,_e.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),te(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Lt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(yn(r)||Un(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Ye(20)}})}}class sx extends Sn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(B.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new rc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Fv({participantSid:"",trackSids:[this.trackSid]})]});this.emit(B.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Sn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Sn.SubscriptionStatus.Subscribed:Sn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Sn.PermissionStatus.Allowed:Sn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Qc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Qc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Et.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(B.VisibilityChanged,this.handleVisibilityChange),r.off(B.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(B.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(B.VisibilityChanged,this.handleVisibilityChange),e.on(B.Ended,this.handleEnded),this.emit(B.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(B.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?B.Muted:B.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(B.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(B.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Qc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Gv({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===D.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Yf(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=Tw(this.trackInfo,this.requestedMaxQuality);i&&Yf(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Et.HIGH})),e.quality=Et.HIGH)}this.emit(B.UpdateSettings,e)}}class Oa extends t0{static fromParticipantInfo(e,n,i){return new Oa(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ai.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(B.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),te(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(B.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(B.SubscriptionPermissionChanged,n=>{this.emit(M.TrackSubscriptionPermissionChanged,e,n)}),e.on(B.SubscriptionStatusChanged,n=>{this.emit(M.TrackSubscriptionStatusChanged,e,n)}),e.on(B.Subscribed,n=>{this.emit(M.TrackSubscribed,n,e)}),e.on(B.Unsubscribed,n=>{this.emit(M.TrackUnsubscribed,n,e)}),e.on(B.SubscriptionFailed,n=>{this.emit(M.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(M.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),te(a))),this.emit(M.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new XE(e,n,r,s):l=new YE(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&bu(l)&&fn(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=D.kindFromProto(r.type);if(!c)return;a=new sx(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==D.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:te(l),newTrack:te(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),te(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(M.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case D.Kind.Audio:this.audioTrackPublications.delete(e);break;case D.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(M.TrackUnpublished,i)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;fn(i.track)&&bu(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var re;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(re||(re={}));const ox=4*1e3;class Or extends gn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=re.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Z,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>C(this,void 0,void 0,function*(){var l;if(!Rw())throw pn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===re.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(re.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==Wy(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ir(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new se(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(m=>{var b;(b=this.regionUrlProvider)===null||b===void 0||b.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const d=(m,b,v)=>C(this,void 0,void 0,function*(){var w,g;this.abortController&&this.abortController.abort();const y=new AbortController;this.abortController=y,u==null||u();try{if(yield kr.getInstance().getBackOffPromise(o),y.signal.aborted)throw X.cancelled("Connection attempt aborted");yield this.attemptConnection(v??o,a,c,y),this.abortController=void 0,m()}catch(S){if(this.regionUrlProvider&&S instanceof X&&S.reason!==me.Cancelled&&S.reason!==me.NotAllowed){let p=null;try{this.log.debug("Fetching next region"),p=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(k){if(k instanceof X&&(k.status===401||k.reason===me.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),b(k);return}}[me.InternalError,me.ServerUnreachable,me.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),kr.getInstance().addFailedConnectionAttempt(o)),p&&!(!((g=this.abortController)===null||g===void 0)&&g.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(p),this.logContext),this.recreateEngine(),yield d(m,b,p)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,rp(S)),b(S))}else{let p=Yt.UNKNOWN_REASON;S instanceof X&&(p=rp(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,p),b(S)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Lt((m,b)=>{d(m,b,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>C(this,void 0,void 0,function*(){var h,m,b;const v=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout,singlePeerConnection:u.singlePeerConnection},d.signal);let w=v.serverInfo;if(w||(w={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(g=>{let[y,S]=g;return"".concat(y,": ").concat(S)}).join(", ")),{room:(h=v.room)===null||h===void 0?void 0:h.name,roomSid:(m=v.room)===null||m===void 0?void 0:m.sid,identity:(b=v.participant)===null||b===void 0?void 0:b.identity}),!w.version)throw new dw("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),v}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>C(this,void 0,void 0,function*(){var u,d;this.state===re.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Gd),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const m=l.signal.aborted?X.cancelled("Signal connection aborted"):X.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(m.message="".concat(m.message,": ").concat(h.message)),h instanceof X&&(m.reason=h.reason,m.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),m}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),X.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}vt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),vt()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(re.Connected),this.emit(O.Connected),kr.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return C(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,m;const b=yield l.disconnectLock.lock();try{if(l.state===re.Disconnected){l.log.debug("already disconnected",l.logContext);return}if(l.log.info("disconnect from room",Object.assign({},l.logContext)),l.state===re.Connecting||l.state===re.Reconnecting||l.isResuming){const v="Abort connection attempt due to user initiated disconnect";l.log.warn(v,l.logContext),(d=l.abortController)===null||d===void 0||d.abort(v),(m=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||m===void 0||m.call(h,X.cancelled("Client initiated disconnect")),l.connectFuture=void 0}l.engine&&(l.engine.client.isDisconnected||(yield l.engine.client.sendLeave()),yield l.engine.close()),l.handleDisconnect(u,Yt.CLIENT_INITIATED),l.engine=void 0}finally{b()}}()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const o=[],a=St();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=Jc();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(O.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(re.Reconnecting)&&this.emit(O.Reconnecting)},this.handleSignalRestarted=o=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(re.Connected),this.emit(O.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===pr.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(O.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(O.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=D.streamStateFromProto(a.state);l.track.setStreamState(u),u!==l.track.streamState&&(c.emit(M.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(O.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,c,l)=>{this.emit(O.DataReceived,a.payload,o,c,a.topic,l),o==null||o.emit(M.DataReceived,a.payload,c,l)},this.handleSipDtmf=(o,a)=>{this.emit(O.SipDTMFReceived,a,o),o==null||o.emit(M.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=Uw(a,this.transcriptionReceivedTimes);l==null||l.emit(B.TranscriptionReceived,u),c==null||c.emit(M.TranscriptionReceived,u,l),this.emit(O.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=Fw(a);this.emit(O.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(O.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(O.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(O.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(O.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(O.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var o;((o=St())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(O.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(O.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(O.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(O.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(O.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(O.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(O.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(O.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(B.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(O.LocalTrackPublished,o,this.localParticipant),yn(o.track)&&(yield o.track.checkForSilence())&&this.emit(O.LocalAudioSilenceDetected,o);const m=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),b=gu(o.source);b&&m&&m!==this.localParticipant.activeDeviceMap.get(b)&&(this.localParticipant.activeDeviceMap.set(b,m),this.emit(O.ActiveDeviceChanged,b,m))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(B.Restarted,this.onLocalTrackRestarted),this.emit(O.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>C(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=gu(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(O.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(O.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(O.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(O.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(O.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},vE),e),this.log=Dn((i=this.options.loggerName)!==null&&i!==void 0?i:tn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},$y),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Hy),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},gE),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new KE,this.outgoingDataStreamManager=new QE(this.engine,this.log),this.disconnectLock=new ct,this.localParticipant=new rx("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ri(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ri(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ri(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),vt()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Or.cleanupRegistry&&Or.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new Zw(i,n),this.e2eeManager.on(Gn.ParticipantEncryptionStatusChanged,(r,s)=>{Vw(s)&&(this.isE2EEEnabled=r),this.emit(O.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(Gn.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(O.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return C(this,void 0,void 0,function*(){return this.state===re.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(W.RoomUpdate,i),e(r.sid))};this.engine.on(W.RoomUpdate,i),this.once(O.Disconnected,()=>{this.engine.off(W.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new WE(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(W.ParticipantUpdate,this.handleParticipantUpdates).on(W.RoomUpdate,this.handleRoomUpdate).on(W.SpeakersChanged,this.handleSpeakersChanged).on(W.StreamStateChanged,this.handleStreamStateUpdate).on(W.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(W.SubscriptionError,this.handleSubscriptionError).on(W.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(W.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(W.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(W.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(W.DataPacketReceived,this.handleDataPacket).on(W.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(re.SignalReconnecting)&&this.emit(O.SignalReconnecting)}).on(W.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(re.Connected)&&this.emit(O.Reconnected)}).on(W.SignalResumed,()=>{this.bufferedEvents=[],(this.state===re.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(W.Restarting,this.handleRestarting).on(W.SignalRestarted,this.handleSignalRestarted).on(W.Offline,()=>{this.setAndEmitConnectionState(re.Reconnecting)&&this.emit(O.Reconnecting)}).on(W.DCBufferStatusChanged,(e,n)=>{this.emit(O.DCBufferStatusChanged,e,n)}).on(W.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(M.LocalTrackSubscribed,n),this.emitWhenConnected(O.LocalTrackSubscribed,n,this.localParticipant)}).on(W.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(O.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return qe.getInstance().getDevices(e,n)}prepareConnection(e,n){return C(this,void 0,void 0,function*(){if(this.state===re.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ir(new URL(e))&&n){this.regionUrlProvider=new se(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===re.Disconnected&&(this.regionUrl=i,yield fetch(Ws(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Ws(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return C(this,void 0,void 0,function*(){let i=()=>C(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new on({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new on({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new on({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new on({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new on({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new on({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new on({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>C(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new sc({reason:Yt.CLIENT_INITIATED,action:mr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new on({scenario:{case:"subscriberBandwidth",value:bi(n)}});break;case"leave-full-reconnect":r=new on({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,m;let b=!0,v=!1;const w=o?{exact:r}:r;if(i==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const g=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=w;const y=Array.from(s.localParticipant.audioTrackPublications.values()).filter(p=>p.source===D.Source.Microphone);try{b=(yield Promise.all(y.map(p=>{var k;return(k=p.audioTrack)===null||k===void 0?void 0:k.setDeviceId(w)}))).every(p=>p===!0)}catch(p){throw s.options.audioCaptureDefaults.deviceId=g,p}const S=y.some(p=>{var k,T;return(T=(k=p.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});b&&S&&(v=!0)}else if(i==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const g=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=w;const y=Array.from(s.localParticipant.videoTrackPublications.values()).filter(p=>p.source===D.Source.Camera);try{b=(yield Promise.all(y.map(p=>{var k;return(k=p.videoTrack)===null||k===void 0?void 0:k.setDeviceId(w)}))).every(p=>p===!0)}catch(p){throw s.options.videoCaptureDefaults.deviceId=g,p}const S=y.some(p=>{var k,T;return(T=(k=p.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});b&&S&&(v=!0)}else if(i==="audiooutput"){if(v=!0,!ku()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield qe.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(m=s.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const g=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(y=>y.setAudioOutput({deviceId:r})))}catch(y){throw s.options.audioOutput.deviceId=g,y}}return v&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(O.ActiveDeviceChanged,i,r)),b}()})}setupLocalParticipantEvents(){this.localParticipant.on(M.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(M.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(M.AttributesChanged,this.onLocalAttributesChanged).on(M.TrackMuted,this.onLocalTrackMuted).on(M.TrackUnmuted,this.onLocalTrackUnmuted).on(M.LocalTrackPublished,this.onLocalTrackPublished).on(M.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(M.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(M.MediaDevicesError,this.onMediaDevicesError).on(M.AudioStreamAcquired,this.startAudio).on(M.ChatMessage,this.onLocalChatMessageSent).on(M.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===re.Connecting||this.state===re.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(O.Reconnected,d),this.off(O.Connected,d),this.off(O.Disconnected,h)};this.once(O.Reconnected,d),this.once(O.Connected,d),this.once(O.Disconnected,h);return}if(this.state===re.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=xw(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const u=c.addSubscribedMediaTrack(e,a,n,i,l);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(O.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==re.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(M.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(M.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(M.AttributesChanged,this.onLocalAttributesChanged).off(M.TrackMuted,this.onLocalTrackMuted).off(M.TrackUnmuted,this.onLocalTrackUnmuted).off(M.LocalTrackPublished,this.onLocalTrackPublished).off(M.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(M.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(M.MediaDevicesError,this.onMediaDevicesError).off(M.AudioStreamAcquired,this.startAudio).off(M.ChatMessage,this.onLocalChatMessageSent).off(M.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),vt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(re.Disconnected),this.emit(O.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(O.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,_e.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,_e.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Jd(u)>Gy?(c=_e.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof _e?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=_e.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,n,i;const r=qe.getInstance().previousDevices,s=yield qe.getInstance().getDevices(void 0,!1),o=St();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(O.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=vw(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(m=>m.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!zs()||c==="videoinput"||d.length>0&&!d.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!zs())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Uy())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ye(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(O.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Oa.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Oa(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(O.ParticipantConnected,i),i.on(M.TrackPublished,r=>{this.emitWhenConnected(O.TrackPublished,r,i)}).on(M.TrackSubscribed,(r,s)=>{r.kind===D.Kind.Audio?(r.on(B.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(B.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===D.Kind.Video&&(r.on(B.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(B.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(O.TrackSubscribed,r,s,i)}).on(M.TrackUnpublished,r=>{this.emit(O.TrackUnpublished,r,i)}).on(M.TrackUnsubscribed,(r,s)=>{this.emit(O.TrackUnsubscribed,r,s,i)}).on(M.TrackMuted,r=>{this.emitWhenConnected(O.TrackMuted,r,i)}).on(M.TrackUnmuted,r=>{this.emitWhenConnected(O.TrackUnmuted,r,i)}).on(M.ParticipantMetadataChanged,r=>{this.emitWhenConnected(O.ParticipantMetadataChanged,r,i)}).on(M.ParticipantNameChanged,r=>{this.emitWhenConnected(O.ParticipantNameChanged,r,i)}).on(M.AttributesChanged,r=>{this.emitWhenConnected(O.ParticipantAttributesChanged,r,i)}).on(M.ConnectionQualityChanged,r=>{this.emitWhenConnected(O.ConnectionQualityChanged,r,i)}).on(M.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(O.ParticipantPermissionsChanged,r,i)}).on(M.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(O.TrackSubscriptionStatusChanged,r,s,i)}).on(M.TrackSubscriptionFailed,(r,s)=>{this.emit(O.TrackSubscriptionFailed,r,i,s)}).on(M.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(O.TrackSubscriptionPermissionChanged,r,s,i)}).on(M.Active,()=>{this.emitWhenConnected(O.ParticipantActive,i),i.kind===Ai.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Bw(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Qe.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Yt.STATE_MISMATCH))):e=0},ox)}clearConnectionReconcile(){this.connectionReconcileInterval&&Qe.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(O.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===re.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===re.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new tc({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ke.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Mi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected),this.emit(O.Connected),this.setAndEmitConnectionState(re.Connected),r.video){const o=new xu(D.Kind.Video,new sr({source:Ne.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Gt.AUDIO,name:"video-dummy"}),new Ia(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ip(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(M.LocalTrackPublished,o)}if(r.audio){const o=new xu(D.Kind.Audio,new sr({source:Ne.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Gt.AUDIO}),new Ra(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Jc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(M.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Mi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:pr.ACTIVE,tracks:[],joinedAt:ke.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=ip(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new sr({source:Ne.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Gt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=Jc(),u=new sr({source:Ne.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Gt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==O.ActiveSpeakersChanged&&e!==O.TranscriptionReceived){const s=n0(i).filter(o=>o!==void 0);(e===O.TrackSubscribed||e===O.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Or.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function n0(t){return t.map(e=>{if(e)return Array.isArray(e)?n0(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ht;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ht||(Ht={}));class pi extends gn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ht.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Or(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return C(this,void 0,void 0,function*(){if(this.status!==Ht.IDLE)throw Error("check is running already");this.setStatus(Ht.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ht.SKIPPED&&this.setStatus(this.isSuccess()?Ht.SUCCESS:Ht.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===re.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==re.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ht.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(O.Reconnecting,()=>{n=!0}),this.room.once(O.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ye(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class ax extends pi{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new se(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let b=0;b<c;b++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),m={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(b=>{b.type==="candidate-pair"&&b.nominated&&(m.rtt=b.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const rl=1e4;class cx extends pi{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(rl/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(rl/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>C(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,rl)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class lx extends pi{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield tx();if(yield jy(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class ux extends pi{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield ex();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const m=l.getContext("2d");m.drawImage(i,0,0);const v=m.getImageData(0,0,l.width,l.height).data;let w=!0;for(let g=0;g<v.length;g+=4)if(v[g]!==0||v[g+1]!==0||v[g+2]!==0){w=!1;break}w?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class dx extends pi{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(O.SignalReconnecting,a).on(O.Reconnecting,a).on(O.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==re.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class hx extends pi{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;Ir(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new se(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new qd,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let o=!1,a=!1,c=!1;for(let l of s.iceServers)for(let u of l.urls)u.startsWith("turn:")?(a=!0,c=!0):u.startsWith("turns:")&&(a=!0,c=!0,o=!0),u.startsWith("stun:")&&(c=!0);c?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class fx extends pi{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(O.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(px(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Z.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function px(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class mx extends pi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new qd,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(o){if(Ir(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const c=yield new se(this.url,this.token).getNextBestRegionUrl();c&&(s=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===Vv.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class g_ extends gn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ht.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ht.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(mx)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(fx)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(hx)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(dx)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(lx)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(ux)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(cx);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(ax)})}}function ne(t,e,n){return(e=vx(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gx(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vx(t){var e=gx(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class dt extends Error{constructor(e,n){var i;super(e,n),ne(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ne(dt,"code","ERR_JOSE_GENERIC");class yx extends dt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ne(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ne(this,"claim",void 0),ne(this,"reason",void 0),ne(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ne(yx,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class kx extends dt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ne(this,"code","ERR_JWT_EXPIRED"),ne(this,"claim",void 0),ne(this,"reason",void 0),ne(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ne(kx,"code","ERR_JWT_EXPIRED");class bx extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ne(bx,"code","ERR_JOSE_ALG_NOT_ALLOWED");class Sx extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ne(Sx,"code","ERR_JOSE_NOT_SUPPORTED");class Cx extends dt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ne(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ne(Cx,"code","ERR_JWE_DECRYPTION_FAILED");class Tx extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JWE_INVALID")}}ne(Tx,"code","ERR_JWE_INVALID");class wx extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JWS_INVALID")}}ne(wx,"code","ERR_JWS_INVALID");class Ex extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JWT_INVALID")}}ne(Ex,"code","ERR_JWT_INVALID");class xx extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JWK_INVALID")}}ne(xx,"code","ERR_JWK_INVALID");class Px extends dt{constructor(){super(...arguments),ne(this,"code","ERR_JWKS_INVALID")}}ne(Px,"code","ERR_JWKS_INVALID");class _x extends dt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ne(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ne(_x,"code","ERR_JWKS_NO_MATCHING_KEY");class Rx extends dt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ne(this,Symbol.asyncIterator,void 0),ne(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ne(Rx,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Ix extends dt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ne(this,"code","ERR_JWKS_TIMEOUT")}}ne(Ix,"code","ERR_JWKS_TIMEOUT");class Ox extends dt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ne(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ne(Ox,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");class Nx{constructor(){this.baseUrl=je.backend.baseUrl,this.currentRoom=null}getHeaders(){return{"Content-Type":"application/json",...Re.getAuthHeader()}}async createRoomToken(e,n,i,r=null){const s={room_name:e,participant_name:n};i!=null&&i!==void 0&&(s.agent_id=i),r!=null&&r!==void 0&&r!==""&&(s.heygen_session_id=r);const o=await fetch(`${this.baseUrl}/api/livekit/token`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(s)});if(!o.ok){let a=`HTTP ${o.status}`;try{const c=await o.json();c.detail?Array.isArray(c.detail)?a=c.detail.map(l=>`${l.loc?l.loc.slice(1).join("."):"unknown"}: ${l.msg||l.message||"validation error"}`).join("; "):typeof c.detail=="string"?a=c.detail:a=JSON.stringify(c.detail):c.message?a=typeof c.message=="string"?c.message:JSON.stringify(c.message):c.error?a=typeof c.error=="string"?c.error:JSON.stringify(c.error):a=JSON.stringify(c)}catch{try{a=await o.text()||`HTTP ${o.status}: ${o.statusText}`}catch{a=`HTTP ${o.status}: ${o.statusText}`}}throw new Error(`Failed to create room token: ${a}`)}return await o.json()}async connectToRoom(e,n,i,r=null,s,o,a){const c=await this.createRoomToken(e,n,i,r),l=new Or({adaptiveStream:!0,dynacast:!0});l.on(O.TrackSubscribed,(u,d,h)=>{s&&s(u,d,h)}),l.on(O.ParticipantConnected,u=>{o&&o(u)}),l.on(O.Disconnected,()=>{a&&a()}),await l.connect(c.url,c.token);try{await l.localParticipant.setMicrophoneEnabled(!0)}catch{}return this.currentRoom=l,l}async disconnect(){this.currentRoom&&(await this.currentRoom.disconnect(),this.currentRoom=null)}getCurrentRoom(){return this.currentRoom}async publishTracks(e){if(!this.currentRoom)throw new Error("Not connected to a room");const n=e.getVideoTracks()[0];n&&await this.currentRoom.localParticipant.publishTrack(n,{source:D.Source.Camera});const i=e.getAudioTracks()[0];i&&await this.currentRoom.localParticipant.publishTrack(i,{source:D.Source.Microphone})}}const os=new Nx;async function an(t,e={},n=3,i=3e4){const r=new AbortController,s=setTimeout(()=>r.abort(),i);try{const o=await fetch(t,{...e,signal:r.signal});return clearTimeout(s),o}catch(o){if(clearTimeout(s),n>0&&(o.name==="AbortError"||o.name==="TypeError"||o.message.includes("network")))return await new Promise(a=>setTimeout(a,1e3)),an(t,e,n-1,i);throw o}}class Dx{constructor(){this.apiKey=je.heygen.apiKey,this.serverUrl=je.heygen.serverUrl}async fetchVoices(){let e=await an(`${this.serverUrl}/v2/voices`,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4);if(e.ok||(e=await an(`${this.serverUrl}/v1/voices.list`,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4)),e.ok){const n=await e.json();return this._parseVoicesResponse(n)}return[]}async fetchAvatars(){const e=`${this.serverUrl}/v1/streaming/avatar.list`,n=await an(e,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4);if(n.ok){const i=await n.json();return this._parseAvatarsResponse(i)}return[]}async createSession(e,n,i){const r={quality:e,avatar_name:n,voice:{voice_id:i}},s=await an(`${this.serverUrl}/v1/streaming.new`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify(r)},3,6e4),o=await s.json();if(!s.ok){const a=o.message||o.error||`Server error (${s.status})`;throw new Error(a)}if(s.status===500)throw new Error("Server error");return o.data}async startSession(e,n){const i=await an(`${this.serverUrl}/v1/streaming.start`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,sdp:n})},3,6e4);if(i.status===500)throw new Error("Server error");return(await i.json()).data}async submitIceCandidate(e,n){fetch(`${this.serverUrl}/v1/streaming.ice`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,candidate:n})}).catch(()=>{})}async sendTask(e,n){const i=await an(`${this.serverUrl}/v1/streaming.task`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,text:n})},3,3e4);if(i.status===500)throw new Error("Server error");return(await i.json()).data}async stopSession(e){const n=await an(`${this.serverUrl}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e})},2,2e4);if(n.status===500)throw new Error("Server error");return(await n.json()).data}stopSessionSync(e){if(e)try{const n=`${this.serverUrl}/v1/streaming.stop`,i=JSON.stringify({session_id:e}),r=new Blob([i],{type:"application/json"}),s=`${n}?x-api-key=${encodeURIComponent(this.apiKey)}`;navigator.sendBeacon(s,r)||fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:i,keepalive:!0}).catch(()=>{})}catch{}}async listSessions(){const e=[`${this.serverUrl}/v1/sessions.list`,`${this.serverUrl}/v1/streaming.list`,`${this.serverUrl}/v1/sessions`];for(const n of e)try{const i=await an(n,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},2,2e4);if(i.ok){const r=await i.json();return this._parseSessionsResponse(r)}}catch{}return[]}async closeSessionById(e){try{const n=await an(`${this.serverUrl}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e})},2,2e4);return n.ok?{success:!0,data:await n.json()}:{success:!1,error:(await n.json()).message||"Failed to close session"}}catch(n){return{success:!1,error:n.message}}}_parseVoicesResponse(e){let n=[];return e.data&&Array.isArray(e.data)?n=e.data:e.data&&e.data.voices&&Array.isArray(e.data.voices)?n=e.data.voices:e.voices&&Array.isArray(e.voices)?n=e.voices:Array.isArray(e)&&(n=e),n.length>0?n.map(i=>({id:i.voice_id||i.id||i.voiceId,name:i.name||i.display_name||i.displayName||`${i.voice_id||i.id||i.voiceId} (${i.language||i.lang||"Unknown"})`})):[]}_parseAvatarsResponse(e){let n=[];if(e.data&&Array.isArray(e.data)?n=e.data:e.data&&e.data.avatars&&Array.isArray(e.data.avatars)?n=e.data.avatars:e.avatars&&Array.isArray(e.avatars)?n=e.avatars:Array.isArray(e)&&(n=e),n.length>0){const i=n.filter(s=>{var a,c;return s.is_streaming===!0||s.is_streaming_avatar===!0||s.streaming_enabled===!0||s.type==="streaming"||s.type==="interactive"||s.avatar_type==="streaming"||s.avatar_type==="interactive"||((a=s.capabilities)==null?void 0:a.includes("streaming"))||((c=s.capabilities)==null?void 0:c.includes("interactive"))||s.is_streaming===void 0&&s.is_streaming_avatar===void 0&&s.streaming_enabled===void 0&&s.type===void 0&&s.avatar_type===void 0});return(i.length>0?i:n).map(s=>({id:s.avatar_id||s.id||s.avatarId,name:s.name||s.display_name||s.displayName||s.avatar_name||`${s.avatar_id||s.id||s.avatarId}`,isStreaming:s.is_streaming||s.is_streaming_avatar||s.streaming_enabled||!0}))}return[]}_parseSessionsResponse(e){return e.data&&Array.isArray(e.data)?e.data:e.sessions&&Array.isArray(e.sessions)?e.sessions:Array.isArray(e)?e:[]}}const wi=new Dx;function Mx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pu={exports:{}},Ax=Pu.exports,Pp;function Lx(){return Pp||(Pp=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Ax,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var g=v[w];if(typeof g.bind=="function")return g.bind(v);try{return Function.prototype.bind.call(g,v)}catch{return function(){return Function.prototype.apply.apply(g,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),w=0;w<r.length;w++){var g=r[w];this[g]=w<v?e:this.methodFactory(g,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function h(v,w,g){return l(v)||d.apply(this,arguments)}function m(v,w){var g=this,y,S,p,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(N){var $=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=$;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+$+";"}catch{}}}function x(){var N;if(!(typeof window===n||!k)){try{N=window.localStorage[k]}catch{}if(typeof N===n)try{var $=window.document.cookie,L=encodeURIComponent(k),Y=$.indexOf(L+"=");Y!==-1&&(N=/^([^;]+)/.exec($.slice(Y+L.length+1))[1])}catch{}return g.levels[N]===void 0&&(N=void 0),N}}function P(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(N){var $=N;if(typeof $=="string"&&g.levels[$.toUpperCase()]!==void 0&&($=g.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=g.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+N)}g.name=v,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=w||h,g.getLevel=function(){return p??S??y},g.setLevel=function(N,$){return p=I(N),$!==!1&&T(p),u.call(g)},g.setDefaultLevel=function(N){S=I(N),x()||g.setLevel(N,!1)},g.resetLevel=function(){p=null,P(),u.call(g)},g.enableAll=function(N){g.setLevel(g.levels.TRACE,N)},g.disableAll=function(N){g.setLevel(g.levels.SILENT,N)},g.rebuild=function(){if(o!==g&&(y=I(o.getLevel())),u.call(g),o===g)for(var N in s)s[N].rebuild()},y=I(o?o.getLevel():"WARN");var R=x();R!=null&&(p=I(R)),u.call(g)}o=new m,o.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[v];return w||(w=s[v]=new m(v,o.methodFactory)),w};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return s},o.default=o,o})}(Pu)),Pu.exports}var jx=Lx();const Ux=Mx(jx);var _u=function(t,e){return _u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},_u(t,e)};function An(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");_u(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Fx(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,[])).next())})}function i0(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Nr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Na(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Da(t,e,n){if(arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function Sr(t){return this instanceof Sr?(this.v=t,this):new Sr(t)}function Bx(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(m){return function(b){return Promise.resolve(b).then(m,d)}}function a(m,b){i[m]&&(r[m]=function(v){return new Promise(function(w,g){s.push([m,v,w,g])>1||c(m,v)})},b&&(r[m]=b(r[m])))}function c(m,b){try{l(i[m](b))}catch(v){h(s[0][3],v)}}function l(m){m.value instanceof Sr?Promise.resolve(m.value.v).then(u,d):h(s[0][2],m)}function u(m){c("next",m)}function d(m){c("throw",m)}function h(m,b){m(b),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Vx(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Nr=="function"?Nr(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Be(t){return typeof t=="function"}function Xd(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var sl=Xd(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Ma(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Xs=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Nr(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Be(u))try{u()}catch(v){s=v instanceof sl?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Nr(d),m=h.next();!m.done;m=h.next()){var b=m.value;try{_p(b)}catch(v){s=s??[],v instanceof sl?s=Da(Da([],Na(s)),Na(v.errors)):s.push(v)}}}catch(v){i={error:v}}finally{try{m&&!m.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(s)throw new sl(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)_p(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Ma(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Ma(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),r0=Xs.EMPTY;function s0(t){return t instanceof Xs||t&&"closed"in t&&Be(t.remove)&&Be(t.add)&&Be(t.unsubscribe)}function _p(t){Be(t)?t():t.unsubscribe()}var zx={Promise:void 0},Wx={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Da([t,e],Na(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function o0(t){Wx.setTimeout(function(){throw t})}function Rp(){}function Qo(t){t()}var Zd=function(t){An(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,s0(n)&&n.add(i)):i.destination=Hx,i}return e.create=function(n,i,r){return new Ru(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Xs),qx=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){Co(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){Co(i)}else Co(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Co(n)}},t}(),Ru=function(t){An(e,t);function e(n,i,r){var s=t.call(this)||this,o;return Be(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new qx(o),s}return e}(Zd);function Co(t){o0(t)}function $x(t){throw t}var Hx={closed:!0,next:Rp,error:$x,complete:Rp},eh=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function a0(t){return t}function Kx(t){return t.length===0?a0:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var He=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=Jx(e)?e:new Ru(e,n,i);return Qo(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=Ip(n),new n(function(r,s){var o=new Ru({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[eh]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Kx(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Ip(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function Ip(t){var e;return(e=t??zx.Promise)!==null&&e!==void 0?e:Promise}function Gx(t){return t&&Be(t.next)&&Be(t.error)&&Be(t.complete)}function Jx(t){return t&&t instanceof Zd||Gx(t)&&s0(t)}function Qx(t){return Be(t==null?void 0:t.lift)}function Zs(t){return function(e){if(Qx(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Aa(t,e,n,i,r){return new Yx(t,e,n,i,r)}var Yx=function(t){An(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Zd),Xx=Xd(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),c0=function(t){An(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new Op(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new Xx},e.prototype.next=function(n){var i=this;Qo(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Nr(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;Qo(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;Qo(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?r0:(this.currentObservers=null,a.push(n),new Xs(function(){i.currentObservers=null,Ma(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new He;return n.source=this,n},e.create=function(n,i){return new Op(n,i)},e}(He),Op=function(t){An(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:r0},e}(c0);(function(t){An(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(c0);var Zx={now:function(){return Date.now()}},eP=function(t){An(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Xs),Np={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Da([t,e],Na(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},tP=function(t){An(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),Np.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&Np.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ma(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(eP),Dp=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=Zx.now,t}(),nP=function(t){An(e,t);function e(n,i){i===void 0&&(i=Dp.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(Dp);new nP(tP);function iP(t){return t&&Be(t.schedule)}function rP(t){return t[t.length-1]}function l0(t){return iP(rP(t))?t.pop():void 0}var u0=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function d0(t){return Be(t==null?void 0:t.then)}function h0(t){return Be(t[eh])}function f0(t){return Symbol.asyncIterator&&Be(t==null?void 0:t[Symbol.asyncIterator])}function p0(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function sP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var m0=sP();function g0(t){return Be(t==null?void 0:t[m0])}function v0(t){return Bx(this,arguments,function(){var e,n,i,r;return i0(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Sr(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,Sr(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Sr(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function y0(t){return Be(t==null?void 0:t.getReader)}function eo(t){if(t instanceof He)return t;if(t!=null){if(h0(t))return oP(t);if(u0(t))return aP(t);if(d0(t))return cP(t);if(f0(t))return k0(t);if(g0(t))return lP(t);if(y0(t))return uP(t)}throw p0(t)}function oP(t){return new He(function(e){var n=t[eh]();if(Be(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function aP(t){return new He(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function cP(t){return new He(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,o0)})}function lP(t){return new He(function(e){var n,i;try{for(var r=Nr(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function k0(t){return new He(function(e){dP(t,e).catch(function(n){return e.error(n)})})}function uP(t){return k0(v0(t))}function dP(t,e){var n,i,r,s;return Fx(this,void 0,void 0,function(){var o,a;return i0(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Vx(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function _i(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function b0(t,e){return e===void 0&&(e=0),Zs(function(n,i){n.subscribe(Aa(i,function(r){return _i(i,t,function(){return i.next(r)},e)},function(){return _i(i,t,function(){return i.complete()},e)},function(r){return _i(i,t,function(){return i.error(r)},e)}))})}function S0(t,e){return e===void 0&&(e=0),Zs(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function hP(t,e){return eo(t).pipe(S0(e),b0(e))}function fP(t,e){return eo(t).pipe(S0(e),b0(e))}function pP(t,e){return new He(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function mP(t,e){return new He(function(n){var i;return _i(n,e,function(){i=t[m0](),_i(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Be(i==null?void 0:i.return)&&i.return()}})}function C0(t,e){if(!t)throw new Error("Iterable cannot be null");return new He(function(n){_i(n,e,function(){var i=t[Symbol.asyncIterator]();_i(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function gP(t,e){return C0(v0(t),e)}function vP(t,e){if(t!=null){if(h0(t))return hP(t,e);if(u0(t))return pP(t,e);if(d0(t))return fP(t,e);if(f0(t))return C0(t,e);if(g0(t))return mP(t,e);if(y0(t))return gP(t,e)}throw p0(t)}function yP(t,e){return e?vP(t,e):eo(t)}Xd(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function jr(t,e){return Zs(function(n,i){var r=0;n.subscribe(Aa(i,function(s){i.next(t.call(e,s,r++))}))})}function kP(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){d&&!c.length&&!l&&e.complete()},m=function(v){return l<i?b(v):c.push(v)},b=function(v){l++;var w=!1;eo(n(v,u++)).subscribe(Aa(e,function(g){e.next(g)},function(){w=!0},void 0,function(){if(w)try{l--;for(var g=function(){var y=c.shift();o||b(y)};c.length&&l<i;)g();h()}catch(y){e.error(y)}}))};return t.subscribe(Aa(e,m,function(){d=!0,h()})),function(){}}function T0(t,e,n){return n===void 0&&(n=1/0),Be(e)?T0(function(i,r){return jr(function(s,o){return e(i,s,r,o)})(eo(t(i,r)))},n):(typeof e=="number"&&(n=e),Zs(function(i,r){return kP(i,r,t,n)}))}function bP(t){return T0(a0,t)}function SP(){return bP(1)}function Mp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return SP()(yP(t,l0(t)))}function Ur(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=l0(t);return Zs(function(i,r){(n?Mp(t,i,n):Mp(t,i)).subscribe(r)})}var CP=Object.defineProperty,TP=Object.defineProperties,wP=Object.getOwnPropertyDescriptors,Ap=Object.getOwnPropertySymbols,EP=Object.prototype.hasOwnProperty,xP=Object.prototype.propertyIsEnumerable,Lp=(t,e,n)=>e in t?CP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,PP=(t,e)=>{for(var n in e||(e={}))EP.call(e,n)&&Lp(t,n,e[n]);if(Ap)for(var n of Ap(e))xP.call(e,n)&&Lp(t,n,e[n]);return t},_P=(t,e)=>TP(t,wP(e));function RP(t){return typeof t>"u"?!1:IP(t)||OP(t)}function IP(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function OP(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function NP(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function DP(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(NP(t))return`${t.participant.identity}_${t.source}_placeholder`;if(RP(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var MP=[O.ConnectionStateChanged,O.RoomMetadataChanged,O.ActiveSpeakersChanged,O.ConnectionQualityChanged,O.ParticipantConnected,O.ParticipantDisconnected,O.ParticipantPermissionsChanged,O.ParticipantMetadataChanged,O.ParticipantNameChanged,O.ParticipantAttributesChanged,O.TrackMuted,O.TrackUnmuted,O.TrackPublished,O.TrackUnpublished,O.TrackStreamStateChanged,O.TrackSubscriptionFailed,O.TrackSubscriptionPermissionChanged,O.TrackSubscriptionStatusChanged],AP=[...MP,O.LocalTrackPublished,O.LocalTrackUnpublished],LP=[M.TrackPublished,M.TrackUnpublished,M.TrackMuted,M.TrackUnmuted,M.TrackStreamStateChanged,M.TrackSubscribed,M.TrackUnsubscribed,M.TrackSubscriptionPermissionChanged,M.TrackSubscriptionFailed,M.LocalTrackPublished,M.LocalTrackUnpublished],jP=[M.ConnectionQualityChanged,M.IsSpeakingChanged,M.ParticipantMetadataChanged,M.ParticipantPermissionsChanged,M.TrackMuted,M.TrackUnmuted,M.TrackPublished,M.TrackUnpublished,M.TrackStreamStateChanged,M.TrackSubscriptionFailed,M.TrackSubscriptionPermissionChanged,M.TrackSubscriptionStatusChanged];[...jP,M.LocalTrackPublished,M.LocalTrackUnpublished];var w0=Ux.getLogger("lk-components-js");w0.setDefaultLevel("WARN");function UP(t,e){var n;return _P(PP({},t),{receivedAtMediaTimestamp:(n=e.rtpTimestamp)!=null?n:0,receivedAt:e.timestamp})}function FP(t,e,n){return[...t,...e].reduceRight((i,r)=>(i.find(s=>s.id===r.id)||i.unshift(r),i),[]).slice(0-n)}var La=(t=>(t.AgentState="lk.agent.state",t.PublishOnBehalf="lk.publish_on_behalf",t.TranscriptionFinal="lk.transcription_final",t.TranscriptionSegmentId="lk.segment_id",t.TranscribedTrackId="lk.transcribed_track_id",t))(La||{});function BP(t,...e){return new He(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(Ur(t))}function VP(t,e){return new He(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function zP(t){return VP(t,O.ConnectionStateChanged).pipe(jr(([e])=>e),Ur(t.state))}function E0(t,...e){return new He(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(Ur(t))}function WP(t){return E0(t,M.TrackMuted,M.TrackUnmuted,M.ParticipantPermissionsChanged,M.TrackPublished,M.TrackUnpublished,M.LocalTrackPublished,M.LocalTrackUnpublished,M.MediaDevicesError,M.TrackSubscriptionStatusChanged).pipe(jr(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(D.Source.Microphone),o=e.getTrackPublication(D.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function qP(t,e){return new He(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function $P(t,e={}){var n;let i;const r=new He(c=>(i=c,()=>a.unsubscribe())).pipe(Ur(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:AP,o=Array.from(new Set([O.ParticipantConnected,O.ParticipantDisconnected,O.ConnectionStateChanged,...s])),a=BP(t,...o).subscribe(c=>i==null?void 0:i.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&(i==null||i.next(Array.from(t.remoteParticipants.values()))),r}function jp(t){return typeof t>"u"?new He:qP(t,M.AttributesChanged).pipe(jr(([e])=>({changed:e,attributes:t.attributes})),Ur({changed:t.attributes,attributes:t.attributes}))}function Up(t,e,n=!1){const{sources:i,kind:r,name:s}=e;return Array.from(t.trackPublications.values()).filter(o=>(!i||i.includes(o.source))&&(!r||o.kind===r)&&(!s||o.trackName===s)&&(!n||o.track)).map(o=>({participant:t,publication:o,source:o.source}))}function HP(t,e){return E0(t,...LP).pipe(jr(n=>{const i=Up(n,e);return w0.debug(`TrackReference[] was updated. (length ${i.length})`,i),i}),Ur(Up(t,e)))}function x0(t,e){return new He(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function KP(t){return x0(t,B.TranscriptionReceived)}function GP(t){return x0(t,B.TimeSyncUpdate).pipe(jr(([e])=>e))}E.createContext(void 0);E.createContext(void 0);const JP=E.createContext(void 0);function P0(){return E.useContext(JP)}const _0=E.createContext(void 0);function QP(){return E.useContext(_0)}function th(t){const e=QP(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}E.createContext(void 0);E.createContext(void 0);function lc(t,e,n=!0){const[i,r]=E.useState(e);return E.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function YP(t){const e=th(t),n=E.useMemo(()=>zP(e),[e]);return lc(n,e.state)}function XP(t={}){const e=th(t.room),[n,i]=E.useState(e.localParticipant),[r,s]=E.useState(n.isMicrophoneEnabled),[o,a]=E.useState(n.isCameraEnabled),[c,l]=E.useState(n.isScreenShareEnabled),[u,d]=E.useState(n.lastMicrophoneError),[h,m]=E.useState(n.lastCameraError),[b,v]=E.useState(void 0),[w,g]=E.useState(void 0),y=S=>{a(S.isCameraEnabled),s(S.isMicrophoneEnabled),l(S.isScreenShareEnabled),g(S.cameraTrack),v(S.microphoneTrack),d(S.participant.lastMicrophoneError),m(S.participant.lastCameraError),i(S.participant)};return E.useEffect(()=>{const S=WP(e.localParticipant).subscribe(y);return()=>S.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:c,isCameraEnabled:o,microphoneTrack:b,cameraTrack:w,lastMicrophoneError:u,lastCameraError:h,localParticipant:n}}function R0(t={}){const e=th(t.room),[n,i]=E.useState([]);return E.useEffect(()=>{const r=$P(e,{additionalRoomEvents:t.updateOnlyOn}).subscribe(i);return()=>r.unsubscribe()},[e,JSON.stringify(t.updateOnlyOn)]),n}function ZP(t={}){const e=R0(t),{localParticipant:n}=XP(t);return E.useMemo(()=>[n,...e],[n,e])}function Fp(t,e={}){let n,i;typeof e=="string"?n=e:(n=e==null?void 0:e.participantIdentity,i=e==null?void 0:e.room);const r=P0(),s=ZP({room:i,updateOnlyOn:[]}),o=E.useMemo(()=>n?s.find(c=>c.identity===n):r,[n,s,r]),a=E.useMemo(()=>{if(o)return HP(o,{sources:t})},[o,JSON.stringify(t)]);return lc(a,[])}function e_(t){var e,n,i;const r=E.useMemo(()=>{var s;return(s=t==null?void 0:t.publication)!=null&&s.track?GP(t==null?void 0:t.publication.track):void 0},[(e=t==null?void 0:t.publication)==null?void 0:e.track]);return lc(r,{timestamp:Date.now(),rtpTimestamp:(i=(n=t==null?void 0:t.publication)==null?void 0:n.track)==null?void 0:i.rtpTimestamp})}const t_={bufferSize:100};function n_(t,e){const n={...t_,...e},[i,r]=E.useState([]),s=e_(t),o=a=>{var c;(c=n.onTranscription)==null||c.call(n,a),r(l=>FP(l,a.map(u=>UP(u,s)),n.bufferSize))};return E.useEffect(()=>{if(!(t!=null&&t.publication))return;const a=KP(t.publication).subscribe(c=>{o(...c)});return()=>{a.unsubscribe()}},[t&&DP(t),o]),{segments:i}}function i_(t={}){const e=P0(),n=t.participant??e,i=E.useMemo(()=>jp(n),[n]);return lc(i,{attributes:n==null?void 0:n.attributes})}const Bp=La.AgentState;function r_(){const t=R0(),e=t.find(d=>d.kind===Ai.AGENT&&!(La.PublishOnBehalf in d.attributes)),n=t.find(d=>d.kind===Ai.AGENT&&d.attributes[La.PublishOnBehalf]===(e==null?void 0:e.identity)),i=Fp([D.Source.Microphone,D.Source.Camera],e==null?void 0:e.identity),r=Fp([D.Source.Microphone,D.Source.Camera],n==null?void 0:n.identity),s=i.find(d=>d.source===D.Source.Microphone)??r.find(d=>d.source===D.Source.Microphone),o=i.find(d=>d.source===D.Source.Camera)??r.find(d=>d.source===D.Source.Camera),{segments:a}=n_(s),c=YP(),{attributes:l}=i_({participant:e}),u=E.useMemo(()=>c===re.Disconnected?"disconnected":c===re.Connecting||!e||!(l!=null&&l[Bp])?"connecting":l[Bp],[l,e,c]);return{agent:e,state:u,audioTrack:s,videoTrack:o,agentTranscriptions:a,agentAttributes:l}}var To={exports:{}},Vp;function s_(){if(Vp)return To.exports;Vp=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(p,k,T){return Function.prototype.apply.call(p,k,T)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:n=function(p){return Object.getOwnPropertyNames(p)};function i(p){console&&console.warn&&console.warn(p)}var r=Number.isNaN||function(p){return p!==p};function s(){s.init.call(this)}To.exports=s,To.exports.once=g,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(p){if(typeof p!="number"||p<0||r(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");o=p}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||r(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this};function c(p){return p._maxListeners===void 0?s.defaultMaxListeners:p._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(p){for(var k=[],T=1;T<arguments.length;T++)k.push(arguments[T]);var x=p==="error",P=this._events;if(P!==void 0)x=x&&P.error===void 0;else if(!x)return!1;if(x){var I;if(k.length>0&&(I=k[0]),I instanceof Error)throw I;var R=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw R.context=I,R}var N=P[p];if(N===void 0)return!1;if(typeof N=="function")e(N,this,k);else for(var $=N.length,L=b(N,$),T=0;T<$;++T)e(L[T],this,k);return!0};function l(p,k,T,x){var P,I,R;if(a(T),I=p._events,I===void 0?(I=p._events=Object.create(null),p._eventsCount=0):(I.newListener!==void 0&&(p.emit("newListener",k,T.listener?T.listener:T),I=p._events),R=I[k]),R===void 0)R=I[k]=T,++p._eventsCount;else if(typeof R=="function"?R=I[k]=x?[T,R]:[R,T]:x?R.unshift(T):R.push(T),P=c(p),P>0&&R.length>P&&!R.warned){R.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=p,N.type=k,N.count=R.length,i(N)}return p}s.prototype.addListener=function(p,k){return l(this,p,k,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(p,k){return l(this,p,k,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,k,T){var x={fired:!1,wrapFn:void 0,target:p,type:k,listener:T},P=u.bind(x);return P.listener=T,x.wrapFn=P,P}s.prototype.once=function(p,k){return a(k),this.on(p,d(this,p,k)),this},s.prototype.prependOnceListener=function(p,k){return a(k),this.prependListener(p,d(this,p,k)),this},s.prototype.removeListener=function(p,k){var T,x,P,I,R;if(a(k),x=this._events,x===void 0)return this;if(T=x[p],T===void 0)return this;if(T===k||T.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete x[p],x.removeListener&&this.emit("removeListener",p,T.listener||k));else if(typeof T!="function"){for(P=-1,I=T.length-1;I>=0;I--)if(T[I]===k||T[I].listener===k){R=T[I].listener,P=I;break}if(P<0)return this;P===0?T.shift():v(T,P),T.length===1&&(x[p]=T[0]),x.removeListener!==void 0&&this.emit("removeListener",p,R||k)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(p){var k,T,x;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[p]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[p]),this;if(arguments.length===0){var P=Object.keys(T),I;for(x=0;x<P.length;++x)I=P[x],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=T[p],typeof k=="function")this.removeListener(p,k);else if(k!==void 0)for(x=k.length-1;x>=0;x--)this.removeListener(p,k[x]);return this};function h(p,k,T){var x=p._events;if(x===void 0)return[];var P=x[k];return P===void 0?[]:typeof P=="function"?T?[P.listener||P]:[P]:T?w(P):b(P,P.length)}s.prototype.listeners=function(p){return h(this,p,!0)},s.prototype.rawListeners=function(p){return h(this,p,!1)},s.listenerCount=function(p,k){return typeof p.listenerCount=="function"?p.listenerCount(k):m.call(p,k)},s.prototype.listenerCount=m;function m(p){var k=this._events;if(k!==void 0){var T=k[p];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(p,k){for(var T=new Array(k),x=0;x<k;++x)T[x]=p[x];return T}function v(p,k){for(;k+1<p.length;k++)p[k]=p[k+1];p.pop()}function w(p){for(var k=new Array(p.length),T=0;T<k.length;++T)k[T]=p[T].listener||p[T];return k}function g(p,k){return new Promise(function(T,x){function P(R){p.removeListener(k,I),x(R)}function I(){typeof p.removeListener=="function"&&p.removeListener("error",P),T([].slice.call(arguments))}S(p,k,I,{once:!0}),k!=="error"&&y(p,P,{once:!0})})}function y(p,k,T){typeof p.on=="function"&&S(p,"error",k,T)}function S(p,k,T,x){if(typeof p.on=="function")x.once?p.once(k,T):p.on(k,T);else if(typeof p.addEventListener=="function")p.addEventListener(k,function P(I){x.once&&p.removeEventListener(k,P),T(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return To.exports}s_();function o_({addAgentMessageToChat:t}){const{agentTranscriptions:e}=r_(),n=E.useRef(-1);return E.useEffect(()=>{if(e&&e.length>0&&e.slice(n.current+1).length>0){const r=e[e.length-1];if(r&&r.text&&r.text.trim()){const s=r.text.trim();t(s,{identity:"agent"},!0)}n.current=e.length-1}},[e,t]),null}function a_({avatar:t,peerConnection:e,livekitRoom:n,heygenSessionId:i,onExit:r}){const[s,o]=E.useState([]),[a,c]=E.useState(!1),[l,u]=E.useState(!1),[d,h]=E.useState([]),[m,b]=E.useState(""),[v,w]=E.useState(!1),[g,y]=E.useState(!1),[S,p]=E.useState(null),[k,T]=E.useState(!1),[x]=E.useState(new Date),P=E.useRef(""),I=E.useRef(!1),R=E.useCallback(U=>{try{return btoa(encodeURIComponent(U).replace(/%([0-9A-F]{2})/g,(Q,V)=>String.fromCharCode(parseInt(V,16))))}catch{let V=0;for(let K=0;K<U.length;K++){const q=U.charCodeAt(K);V=(V<<5)-V+q,V=V&V}return Math.abs(V).toString(36)}},[]),N=E.useCallback((U,Q,V)=>{const K=`${U||"user"}-${Q.substring(0,50)}-${V}-${Math.random().toString(36).substring(2,9)}`;return R(K).substring(0,16).replace(/[^a-zA-Z0-9]/g,"")},[R]),{videoRef:$,isActive:L,startWebcam:Y,stopWebcam:ve}=dC(),ht=E.useRef(null),Ke=E.useRef(null),z=E.useRef(null),G=E.useCallback(U=>{const Q=(U||"").toLowerCase();return["agent","bot","dakota","sage-1986"].some(V=>Q.includes(V))},[]),j=E.useCallback(U=>{o(Q=>[...Q,U])},[]);E.useEffect(()=>{n&&(Ke.current=n)},[n]),E.useEffect(()=>{if(!z.current){const U=document.createElement("audio");U.autoplay=!0,U.playsInline=!0,U.id="livekit-audio",document.body.appendChild(U),z.current=U,console.log(" LiveKit audio element created")}return()=>{z.current&&z.current.parentNode&&(document.body.removeChild(z.current),z.current=null)}},[]),E.useEffect(()=>{if(!n)return;const U=(V,K,q)=>{const J=G(q==null?void 0:q.identity);if(V.kind==="audio"&&J&&z.current){const Te=z.current;Te.muted=!0,Te.volume=0,I.current=!0,console.log(" LiveKit audio detected (muted) - enabling HeyGen sends");const Ge=()=>{I.current=!1,console.log(" LiveKit audio track ended - stopping HeyGen sends"),j(" Audio ended")};V.on("ended",Ge),j("LiveKit audio detected (using HeyGen audio) "),console.log(" LiveKit audio track detected (muted) from",q==null?void 0:q.identity)}},Q=(V,K,q)=>{const J=G(q==null?void 0:q.identity);V.kind==="audio"&&J&&(I.current=!1,console.log(" LiveKit audio track unsubscribed - stopping HeyGen sends"),j(" Audio track unsubscribed"))};return n.on(O.TrackSubscribed,U),n.on(O.TrackUnsubscribed,Q),n.remoteParticipants.forEach(V=>{G(V==null?void 0:V.identity)&&V.audioTrackPublications.forEach(q=>{if(q.track&&q.isSubscribed&&z.current){const J=z.current;J.muted=!0,J.volume=0,I.current=!0;const Te=()=>{I.current=!1,console.log(" LiveKit audio track ended - stopping HeyGen sends"),j(" Audio ended")};q.track.on("ended",Te),j("LiveKit audio detected (using HeyGen audio) "),console.log(" Existing LiveKit audio track detected (muted) from",V==null?void 0:V.identity)}})}),()=>{n.off(O.TrackSubscribed,U),n.off(O.TrackUnsubscribed,Q)}},[n,j,G]),E.useEffect(()=>((async()=>{try{j("Starting your camera..."),await Y(),j("Camera ready ")}catch(Q){j(`Camera not available (${Q.message}) - continuing without webcam`)}})(),()=>{ve()}),[]),E.useEffect(()=>{if(!e){j("Waiting for HeyGen peer connection...");return}if(!ht.current)return;const U=ht.current;U.muted=!1,U.volume=1;const V=(()=>{try{const K=e.getReceivers(),q=[],J=[];for(const Te of K)Te.track&&Te.track.kind==="video"&&q.push(Te.track),Te.track&&Te.track.kind==="audio"&&J.push(Te.track);if(q.length>0){const Te=new MediaStream([...q,...J]);return U.srcObject=Te,J.length>0?j("HeyGen video + audio connected "):j("HeyGen video connected "),U.play().catch(()=>{}),!0}}catch(K){j(`Error checking existing tracks: ${(K==null?void 0:K.message)||K||"unknown error"}`)}return!1})();e.ontrack=K=>{if(K.track){let q=U.srcObject;q||(q=new MediaStream,U.srcObject=q),K.track.kind==="video"&&(q.getVideoTracks().forEach(J=>q.removeTrack(J)),q.addTrack(K.track),j("HeyGen video track connected ")),K.track.kind==="audio"&&(q.getAudioTracks().forEach(J=>q.removeTrack(J)),q.addTrack(K.track),j("HeyGen audio track connected ")),U.play().catch(()=>{})}},V||j("Waiting for HeyGen video stream...")},[e,j]);const ce=E.useCallback(U=>{var K;if(!U||!U.trim())return;const Q=Date.now(),V=((K=n==null?void 0:n.localParticipant)==null?void 0:K.identity)||"user";h(q=>{const J=U.trim();if(q.some(Ve=>Ve.text===J&&Ve.sender==="user"&&Ve.participantId===V&&Math.abs(Q-(Ve.timestampMs||0))<2e3))return q;let Ge=N(V,J,Q),Bt=0;for(;q.some(Ve=>Ve.id===Ge);)Ge=`${Ge}-${Bt}`,Bt++;const rn={id:Ge,text:J,sender:"user",timestamp:new Date(Q).toLocaleTimeString(),timestampMs:Q,participantId:V};return[...q,rn]}),j(`You: ${U.substring(0,50)}${U.length>50?"...":""}`)},[n,j,N]),fe=E.useCallback(async U=>{if(!(!U.trim()||!n))try{if(ce(U),b(""),n.localParticipant)try{await n.localParticipant.sendText(U,{topic:"lk.chat"}),j(`Sent: ${U}`),n.remoteParticipants.size===0?j(" Message sent, but no agent connected to room"):j("Message sent to agent")}catch{try{const K=new TextEncoder().encode(JSON.stringify({type:"text_message",text:U,timestamp:Date.now()}));await n.localParticipant.publishData(K,{reliable:!0}),j(`Sent: ${U}`)}catch(V){j(`Error sending message: ${V.message}`)}}else j("Error: Not connected to LiveKit room")}catch(Q){j(`Error sending message: ${Q.message}`)}},[n,ce,j]),It=E.useCallback(async()=>{if(!a)try{if(c(!0),j("Starting conversation with LiveKit agent..."),Ke.current)try{await Ke.current.localParticipant.setMicrophoneEnabled(!0),j("Microphone connected - speak naturally!")}catch{j("Microphone not available - agent can still hear you if enabled")}j("Conversation started! Speak naturally to the agent.")}catch(U){j(`Error: ${U.message}`)}},[a,Ke,j]),Ct=async()=>{var Q;const U=((Q=Ke.current)==null?void 0:Q.name)||null;if(Ke.current&&await os.disconnect(),U)try{const V=encodeURIComponent(U),K=await fetch(`${je.backend.baseUrl}/api/livekit/room/${V}`,{method:"DELETE",headers:{"Content-Type":"application/json",...Re.getAuthHeader()}});if(K.ok){const q=await K.json();console.log("Room deleted:",q),j("Room closed ")}else console.warn("Failed to delete room (non-critical):",K.status)}catch(V){console.error("Error deleting room (non-critical):",V)}typeof ve=="function"&&ve(),r()},nn=async()=>{y(!1),p(null),await Ct()},ft=async()=>{var U;try{if(j("Ending interview..."),d.length>0&&!k){T(!0),j("Calculating interview score...");try{const Q=await fetch(`${je.backend.baseUrl}/api/interviews/score`,{method:"POST",headers:{"Content-Type":"application/json",...Re.getAuthHeader()},body:JSON.stringify({agent_id:t.id,agent_name:t.name,agent_role:t.role,messages:d.map(V=>({text:V.text,sender:V.sender,timestamp:V.timestamp,timestamp_ms:V.timestampMs}))})});if(Q.ok){const V=await Q.json();p(V),y(!0),j("Score calculated ");try{const K=await fetch(`${je.backend.baseUrl}/api/conversations`,{method:"POST",headers:{"Content-Type":"application/json",...Re.getAuthHeader()},body:JSON.stringify({conversation:{agent_id:t.id,agent_name:t.name,agent_role:t.role,room_name:((U=Ke.current)==null?void 0:U.name)||null,started_at:x.toISOString(),messages:d.map(q=>({text:q.text,sender:q.sender,timestamp_ms:q.timestampMs,participant_id:q.participantId}))},score_data:{final_score:V.final_score,tier:V.tier,pre_deduction_total:V.pre_deduction_total,raw_scores:{opening_rapport:V.raw_scores.opening_rapport,discovery_qualification:V.raw_scores.discovery_qualification,value_messaging:V.raw_scores.value_messaging,objection_handling:V.raw_scores.objection_handling,trial_advancement:V.raw_scores.trial_advancement,listening_adaptability:V.raw_scores.listening_adaptability,professionalism:V.raw_scores.professionalism},weighted_points:{opening_rapport:V.weighted_points.opening_rapport,discovery_qualification:V.weighted_points.discovery_qualification,value_messaging:V.weighted_points.value_messaging,objection_handling:V.weighted_points.objection_handling,trial_advancement:V.weighted_points.trial_advancement,listening_adaptability:V.weighted_points.listening_adaptability,professionalism:V.weighted_points.professionalism},deductions:V.deductions,strengths:V.strengths,coaching_items:V.coaching_items,detailed_feedback:V.detailed_feedback}})});K.ok?console.log(" Conversation saved to database"):console.error("Failed to save conversation:",await K.text())}catch(K){console.error("Error saving conversation:",K)}T(!1);return}else{const V=await Q.json().catch(()=>({}));console.error("Failed to calculate score:",V),j("Score calculation failed - continuing with exit")}}catch(Q){console.error("Error calculating score:",Q),j("Score calculation error - continuing with exit")}finally{T(!1)}}await Ct()}catch(Q){console.error("Error during exit:",Q),await Ct()}},mi=E.useCallback((U,Q,V=!1)=>{if(!U||!U.trim())return;const K=U.trim();if(h(q=>{const J=q.length-1;if(J>=0&&q[J].sender==="agent"){const we=q[J],Vt=we.text.trim();if(K.startsWith(Vt)||Vt.length>0&&K.length>Vt.length&&K.substring(0,Vt.length)===Vt||V){const to=[...q];return to[J]={...we,text:K,timestamp:new Date().toLocaleTimeString(),timestampMs:Date.now()},to}}if(q.some(we=>we.text===K&&we.sender==="agent"))return q;const Ge=Date.now(),Bt=(Q==null?void 0:Q.identity)||"agent";let rn=N(Bt,K,Ge),Ve=0;for(;q.some(we=>we.id===rn);)rn=`${rn}-${Ve}`,Ve++;const zi={id:rn,text:K,sender:"agent",timestamp:new Date(Ge).toLocaleTimeString(),timestampMs:Ge,participantId:Bt};return[...q,zi]}),i&&K!==P.current&&I.current){let q=K;if(P.current&&K.startsWith(P.current)&&(q=K.substring(P.current.length).trim(),!q))return;P.current=K,wi.sendTask(i,q).then(()=>{j(` Avatar speaking: "${q.substring(0,30)}..."`),console.log(` Sent to HeyGen (new portion): "${q}"`)}).catch(J=>{console.error(` Failed to send to HeyGen: "${q}"`,J),j(` HeyGen speak failed: ${J.message}`),P.current=""})}else I.current||console.log(" LiveKit audio not active - skipping HeyGen send");V||j(`Agent: ${U.substring(0,50)}${U.length>50?"...":""}`)},[j,N,i]);E.useEffect(()=>{if(!n)return;const U=async(q,J)=>{var Te,Ge,Bt,rn,Ve,zi,ae;try{const we=await q.readAll(),Vt=((Ge=(Te=q.info)==null?void 0:Te.attributes)==null?void 0:Ge["lk.transcribed_track_id"])!=null,Wi=((rn=(Bt=q.info)==null?void 0:Bt.attributes)==null?void 0:rn["lk.transcription_final"])==="true",to=(zi=(Ve=q.info)==null?void 0:Ve.attributes)==null?void 0:zi["lk.segment_id"],uc=((ae=n==null?void 0:n.localParticipant)==null?void 0:ae.identity)===(J==null?void 0:J.identity),N0=!uc&&G(J==null?void 0:J.identity);console.log(" Text stream received",{participant:J==null?void 0:J.identity,message:we.substring(0,50),isTranscription:Vt,isFinal:Wi,segmentId:to,isLocalParticipant:uc,isAgent:N0}),Vt&&uc&&we.trim()&&Wi&&(ce(we),console.log(" Added user transcription to chat:",we))}catch(we){console.error("Error in text stream handler:",we)}};n.registerTextStreamHandler("lk.transcription",U);const Q=q=>{G(q==null?void 0:q.identity)?(j(` Agent ${q.identity} connected!`),a||setTimeout(()=>{It()},1500)):j(`Participant ${q.identity} connected (not an agent)`)},V=q=>{j(`Agent ${q.identity} disconnected`)};n.on(O.ParticipantConnected,Q),n.on(O.ParticipantDisconnected,V),n.remoteParticipants.size===0?j(" Agent not connected - check agent settings in LiveKit Cloud"):(j("Agent connected - starting conversation..."),a||setTimeout(()=>{It()},1e3)),u(!0);const K=setInterval(()=>{if(n.remoteParticipants.size===0){const J=Date.now();(!window.lastParticipantWarning||J-window.lastParticipantWarning>6e4)&&(j(" No remote participants in room. Waiting for agent to join..."),window.lastParticipantWarning=J)}else{const J=Date.now();(!window.lastParticipantLog||J-window.lastParticipantLog>6e4)&&(window.lastParticipantLog=J)}},5e3);return()=>{clearInterval(K),n&&n.unregisterTextStreamHandler("lk.transcription",U),n.off(O.ParticipantConnected,Q),n.off(O.ParticipantDisconnected,V)}},[n,j,mi,ce,It,a,G,i]),E.useEffect(()=>{const U=document.getElementById("chat-messages");U&&(U.scrollTop=U.scrollHeight)},[d]);const I0=()=>n?f.jsx(_0.Provider,{value:n,children:f.jsx(o_,{addAgentMessageToChat:mi})}):null,O0=()=>{if(!g||!S)return null;const{raw_scores:U,weighted_points:Q,pre_deduction_total:V,deductions:K,final_score:q,tier:J,strengths:Te,coaching_items:Ge,detailed_feedback:Bt}=S,Ve=J==="Excellent"?"#4ade80":J==="Strong"?"#60a5fa":J==="Developing"?"#fbbf24":"#f87171",zi=[{key:"opening_rapport",label:"Opening & Rapport",weight:"10%",max:10,color:"#3b82f6"},{key:"discovery_qualification",label:"Discovery & Qualification",weight:"20%",max:20,color:"#8b5cf6"},{key:"value_messaging",label:"Value Messaging & Positioning",weight:"20%",max:20,color:"#ec4899"},{key:"objection_handling",label:"Objection Handling",weight:"20%",max:20,color:"#f59e0b"},{key:"trial_advancement",label:"Trial Advancement & Closing",weight:"15%",max:15,color:"#10b981"},{key:"listening_adaptability",label:"Listening, Adaptability & Flow",weight:"10%",max:10,color:"#06b6d4"},{key:"professionalism",label:"Professionalism & Brand",weight:"5%",max:5,color:"#6366f1"}];return f.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e4,padding:"20px",overflow:"auto"},onClick:nn,children:f.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"20px",padding:"40px",maxWidth:"900px",width:"100%",maxHeight:"95vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.75)",border:`3px solid ${Ve}`},onClick:ae=>ae.stopPropagation(),children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"32px",borderBottom:"2px solid #334155",paddingBottom:"20px"},children:[f.jsxs("div",{children:[f.jsx("h2",{style:{margin:0,color:"#f1f5f9",fontSize:"28px",fontWeight:"700",marginBottom:"8px"},children:" Interview Performance Score"}),f.jsx("p",{style:{margin:0,color:"#94a3b8",fontSize:"14px"},children:"Sales Performance Evaluation"})]}),f.jsx("button",{onClick:nn,style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"32px",cursor:"pointer",padding:"8px 16px",borderRadius:"8px",lineHeight:"1",transition:"all 0.2s"},onMouseOver:ae=>{ae.target.style.backgroundColor="#334155",ae.target.style.color="#f1f5f9"},onMouseOut:ae=>{ae.target.style.backgroundColor="transparent",ae.target.style.color="#94a3b8"},title:"Close",children:""})]}),f.jsxs("div",{style:{textAlign:"center",marginBottom:"40px",padding:"32px",backgroundColor:"#0f172a",borderRadius:"16px",border:`4px solid ${Ve}`},children:[f.jsx("div",{style:{fontSize:"16px",color:"#94a3b8",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"1px"},children:"Final Score"}),f.jsx("div",{style:{fontSize:"96px",fontWeight:"800",color:Ve,lineHeight:"1",marginBottom:"8px"},children:Math.round(q)}),f.jsx("div",{style:{fontSize:"36px",color:"#64748b",marginBottom:"16px"},children:"/ 100"}),f.jsx("div",{style:{fontSize:"24px",fontWeight:"600",color:Ve,padding:"12px 24px",backgroundColor:`${Ve}20`,borderRadius:"8px",display:"inline-block"},children:J}),J==="Excellent"&&f.jsx("div",{style:{color:"#4ade80",marginTop:"12px",fontSize:"14px"},children:" Ready for live selling"}),J==="Strong"&&f.jsx("div",{style:{color:"#60a5fa",marginTop:"12px",fontSize:"14px"},children:" Continue refinement"}),J==="Developing"&&f.jsx("div",{style:{color:"#fbbf24",marginTop:"12px",fontSize:"14px"},children:" Coaching recommended"}),J==="Not ready"&&f.jsx("div",{style:{color:"#f87171",marginTop:"12px",fontSize:"14px"},children:" Repeat simulator sessions"})]}),f.jsxs("div",{style:{marginBottom:"32px"},children:[f.jsx("h3",{style:{color:"#f1f5f9",marginBottom:"24px",fontSize:"20px",fontWeight:"600",borderBottom:"2px solid #334155",paddingBottom:"12px"},children:" Detailed Score Breakdown"}),zi.map(ae=>{const we=U[ae.key],Vt=Q[ae.key],Wi=(Vt/ae.max*100).toFixed(1);return f.jsxs("div",{style:{marginBottom:"24px",padding:"20px",backgroundColor:"#0f172a",borderRadius:"12px",border:"1px solid #334155"},children:[f.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:f.jsxs("div",{style:{flex:1},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px"},children:[f.jsx("span",{style:{color:"#f1f5f9",fontSize:"16px",fontWeight:"600"},children:ae.label}),f.jsx("span",{style:{color:"#64748b",fontSize:"12px",backgroundColor:"#1e293b",padding:"2px 8px",borderRadius:"4px"},children:ae.weight})]}),f.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"center",marginTop:"8px"},children:[f.jsxs("div",{children:[f.jsx("span",{style:{color:"#94a3b8",fontSize:"12px"},children:"Raw Score: "}),f.jsxs("span",{style:{color:ae.color,fontWeight:"700",fontSize:"18px"},children:[we,"/5"]})]}),f.jsxs("div",{children:[f.jsx("span",{style:{color:"#94a3b8",fontSize:"12px"},children:"Weighted: "}),f.jsxs("span",{style:{color:"#f1f5f9",fontWeight:"700",fontSize:"18px"},children:[Vt,"/",ae.max," points"]})]}),f.jsxs("div",{children:[f.jsx("span",{style:{color:"#94a3b8",fontSize:"12px"},children:"Percentage: "}),f.jsxs("span",{style:{color:"#cbd5e1",fontWeight:"600"},children:[Wi,"%"]})]})]})]})}),f.jsx("div",{style:{height:"12px",backgroundColor:"#334155",borderRadius:"6px",overflow:"hidden",marginTop:"12px"},children:f.jsx("div",{style:{height:"100%",width:`${Wi}%`,backgroundColor:ae.color,transition:"width 0.5s ease",borderRadius:"6px"}})})]},ae.key)})]}),f.jsxs("div",{style:{marginBottom:"24px",padding:"16px 20px",backgroundColor:"#0f172a",borderRadius:"12px",border:"1px solid #334155",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsx("span",{style:{color:"#cbd5e1",fontSize:"16px",fontWeight:"600"},children:"Pre-Deduction Total:"}),f.jsxs("span",{style:{color:"#f1f5f9",fontSize:"20px",fontWeight:"700"},children:[V.toFixed(1)," / 100"]})]}),K&&K.length>0&&f.jsxs("div",{style:{marginBottom:"32px"},children:[f.jsx("h3",{style:{color:"#f87171",marginBottom:"16px",fontSize:"20px",fontWeight:"600",borderBottom:"2px solid #334155",paddingBottom:"12px"},children:" Deductions Applied"}),K.map((ae,we)=>f.jsxs("div",{style:{padding:"16px",backgroundColor:"#7f1d1d20",borderRadius:"8px",marginBottom:"12px",borderLeft:"4px solid #f87171",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsx("span",{style:{color:"#fca5a5",fontSize:"14px",flex:1},children:ae.reason}),f.jsxs("span",{style:{color:"#f87171",fontSize:"18px",fontWeight:"700",marginLeft:"16px"},children:[ae.points," points"]})]},we))]}),Bt&&f.jsxs("div",{style:{marginBottom:"32px"},children:[f.jsx("h3",{style:{color:"#f1f5f9",marginBottom:"16px",fontSize:"20px",fontWeight:"600",borderBottom:"2px solid #334155",paddingBottom:"12px"},children:" Detailed Feedback"}),f.jsx("div",{style:{padding:"20px",backgroundColor:"#0f172a",borderRadius:"12px",border:"1px solid #334155"},children:f.jsx("p",{style:{color:"#cbd5e1",lineHeight:"1.8",fontSize:"15px",margin:0},children:Bt})})]}),Te&&Te.length>0&&f.jsxs("div",{style:{marginBottom:"32px"},children:[f.jsxs("h3",{style:{color:"#4ade80",marginBottom:"16px",fontSize:"20px",fontWeight:"600",borderBottom:"2px solid #334155",paddingBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[f.jsx("span",{children:""}),f.jsx("span",{children:"Strengths"})]}),f.jsx("div",{style:{padding:"20px",backgroundColor:"#064e3b20",borderRadius:"12px",border:"1px solid #4ade80"},children:f.jsx("ul",{style:{margin:0,paddingLeft:"24px",color:"#cbd5e1",listStyle:"none"},children:Te.map((ae,we)=>f.jsxs("li",{style:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.6",paddingLeft:"8px",position:"relative"},children:[f.jsx("span",{style:{position:"absolute",left:"-20px",color:"#4ade80",fontWeight:"700"},children:""}),ae]},we))})})]}),Ge&&Ge.length>0&&f.jsxs("div",{style:{marginBottom:"32px"},children:[f.jsxs("h3",{style:{color:"#fbbf24",marginBottom:"16px",fontSize:"20px",fontWeight:"600",borderBottom:"2px solid #334155",paddingBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[f.jsx("span",{children:""}),f.jsx("span",{children:"Areas for Improvement"})]}),f.jsx("div",{style:{padding:"20px",backgroundColor:"#78350f20",borderRadius:"12px",border:"1px solid #fbbf24"},children:f.jsx("ul",{style:{margin:0,paddingLeft:"24px",color:"#cbd5e1",listStyle:"none"},children:Ge.map((ae,we)=>f.jsxs("li",{style:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.6",paddingLeft:"8px",position:"relative"},children:[f.jsx("span",{style:{position:"absolute",left:"-20px",color:"#fbbf24",fontWeight:"700"},children:""}),ae]},we))})})]}),f.jsx("div",{style:{display:"flex",gap:"12px",marginTop:"32px",paddingTop:"24px",borderTop:"2px solid #334155"},children:f.jsx("button",{onClick:nn,style:{flex:1,padding:"16px 32px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:ae=>{ae.target.style.backgroundColor="#2563eb"},onMouseOut:ae=>{ae.target.style.backgroundColor="#3b82f6"},children:"Close & Exit Interview"})})]})})};return f.jsxs("div",{className:"interview-container",children:[f.jsx(I0,{}),f.jsx(O0,{}),v&&f.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",width:"400px",maxHeight:"500px",backgroundColor:"#1e293b",borderRadius:"12px",padding:"20px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2)",border:"2px solid #3b82f6",zIndex:1e4,display:"flex",flexDirection:"column",overflow:"hidden"},children:f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",flexShrink:0},children:[f.jsxs("h3",{style:{margin:0,color:"#3b82f6",fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[f.jsx("span",{children:""}),f.jsx("span",{children:"Complete Message"})]}),f.jsx("button",{onClick:()=>w(!1),style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"20px",cursor:"pointer",padding:"4px 8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",lineHeight:"1"},onMouseOver:U=>{U.target.style.backgroundColor="#334155",U.target.style.color="#f1f5f9"},onMouseOut:U=>{U.target.style.backgroundColor="transparent",U.target.style.color="#94a3b8"},title:"Close",children:""})]})}),f.jsxs("div",{className:"interview-main-content",children:[f.jsxs("div",{className:"webcam-container-top",children:[L?f.jsx("video",{ref:$,autoPlay:!0,playsInline:!0,muted:!0,className:"webcam-video"}):f.jsxs("div",{className:"webcam-placeholder",children:[f.jsx("div",{className:"placeholder-icon",children:""}),f.jsx("div",{className:"placeholder-text",children:"Camera Not Available"})]}),f.jsx("div",{className:"video-label",children:"You (Interviewer)"})]}),f.jsxs("div",{className:"avatar-container-center",children:[f.jsx("video",{ref:ht,autoPlay:!0,playsInline:!0,className:"avatar-video"}),f.jsxs("div",{className:"avatar-info",children:[f.jsx("div",{className:"avatar-badge",style:{backgroundColor:t.backgroundColor},children:t.initials}),f.jsxs("div",{className:"avatar-details",children:[f.jsx("h2",{children:t.fullName}),f.jsx("p",{children:t.role})]})]})]}),f.jsx("div",{className:"interview-controls",children:a?f.jsxs("div",{className:"conversation-controls",children:[f.jsxs("div",{className:"livekit-status",children:[f.jsx("p",{children:" LiveKit agent is listening - speak naturally!"}),f.jsx("p",{className:"status-hint",children:"Your voice is automatically sent to the agent"})]}),f.jsx("button",{className:"btn-close",onClick:ft,children:"End Interview"})]}):f.jsxs("div",{className:"initial-controls",children:[f.jsxs("div",{className:"waiting-status",children:[f.jsx("p",{children:" Waiting for agent to connect and start conversation..."}),(n==null?void 0:n.remoteParticipants.size)===0&&f.jsx("p",{className:"status-hint",children:"Make sure LIVEKIT_AGENT_NAME is set in your .env file"})]}),f.jsx("button",{className:"btn-primary btn-large",onClick:ft,children:"Close Interview"})]})}),f.jsx("div",{className:"status-log",children:f.jsxs("details",{children:[f.jsxs("summary",{children:["Status Log (",s.length,")"]}),f.jsx("div",{className:"status-messages",children:s.map((U,Q)=>f.jsx("div",{className:"status-message",children:U},Q))})]})})]}),f.jsxs("div",{className:"chat-window",children:[f.jsxs("div",{className:"chat-header",children:[f.jsx("h3",{children:" Chat"}),f.jsx("span",{className:"chat-status",children:l?f.jsxs(f.Fragment,{children:[" Connected",(n==null?void 0:n.remoteParticipants.size)>0&&f.jsxs("span",{style:{marginLeft:"8px",fontSize:"11px"},children:["(",n.remoteParticipants.size," agent",n.remoteParticipants.size>1?"s":"",")"]})]}):" Disconnected"})]}),f.jsx("div",{className:"chat-messages",id:"chat-messages",children:d.length===0?f.jsxs("div",{className:"chat-empty",children:[f.jsx("p",{children:"No messages yet."}),f.jsx("p",{className:"chat-hint",children:"Type a message or speak to the agent!"})]}):d.map((U,Q)=>f.jsxs("div",{className:`chat-message ${U.sender==="user"?"chat-message-user":"chat-message-agent"}`,children:[f.jsxs("div",{className:"chat-message-header",children:[f.jsx("span",{className:"chat-message-sender",children:U.sender==="user"?"You":(t==null?void 0:t.fullName)||"Agent"}),f.jsx("span",{className:"chat-message-time",children:U.timestamp||"Now"})]}),f.jsx("div",{className:"chat-message-text",children:U.text||"(empty message)"})]},U.id||`msg-${Q}`))}),f.jsxs("div",{className:"chat-input-container",children:[f.jsx("input",{type:"text",className:"chat-input",placeholder:l?"Type your message...":"Connecting...",value:m,onChange:U=>b(U.target.value),onKeyDown:U=>{U.key==="Enter"&&m.trim()&&l&&fe(m)},disabled:!l}),f.jsx("button",{className:"chat-send-button",onClick:()=>fe(m),disabled:!m.trim()||!l,title:l?"Send message":"Waiting for LiveKit connection...",children:"Send"})]}),l&&f.jsxs("div",{className:"chat-debug-info",children:[f.jsx("small",{style:{color:"rgba(255,255,255,0.5)",fontSize:"10px",padding:"4px 16px",display:"block"},children:" Tip: Check browser console (F12) for data channel logs."}),(n==null?void 0:n.remoteParticipants.size)===0?f.jsx("small",{style:{color:"#ffa500",fontSize:"10px",padding:"4px 16px",display:"block"},children:" Waiting for agent to join the room... (Check your LiveKit agent process)"}):f.jsxs("small",{style:{color:"#4ade80",fontSize:"10px",padding:"4px 16px",display:"block"},children:[" ",n.remoteParticipants.size," participant(s) in room",Array.from(n.remoteParticipants.values()).map(U=>{var V,K,q,J;const Q=((V=U.identity)==null?void 0:V.includes("agent"))||((K=U.identity)==null?void 0:K.includes("bot"))||((q=U.identity)==null?void 0:q.includes("Dakota"))||((J=U.identity)==null?void 0:J.toLowerCase().includes("dakota"));return f.jsxs("span",{style:{marginLeft:"8px",color:Q?"#4ade80":"#93c5fd"},children:[U.identity," ",Q?"(agent)":"(user)"]},U.sid)}),n.remoteParticipants.size>0&&!Array.from(n.remoteParticipants.values()).some(U=>{var Q,V,K,q;return((Q=U.identity)==null?void 0:Q.includes("agent"))||((V=U.identity)==null?void 0:V.includes("bot"))||((K=U.identity)==null?void 0:K.includes("Dakota"))||((q=U.identity)==null?void 0:q.toLowerCase().includes("dakota"))})&&f.jsx("span",{style:{marginLeft:"8px",color:"#fbbf24",fontSize:"9px"},children:"(No agent detected - may be voice-only)"})]})]})]})]})}class c_{constructor(){this.baseUrl=je.backend.baseUrl}getHeaders(){return{"Content-Type":"application/json",...Re.getAuthHeader()}}async checkHealth(){try{const e=await fetch(`${this.baseUrl}/health`,{method:"GET",headers:this.getHeaders()});if(!e.ok)throw new Error(`Backend health check failed: ${e.status}`);return await e.json()}catch{throw new Error(`Cannot connect to backend at ${this.baseUrl}`)}}}const zp=new c_;function l_({onStatusChange:t,isAuthenticated:e}){const[n,i]=E.useState("idle"),[r,s]=E.useState(null),o=E.useCallback(async()=>{try{i("checking"),s(null),await zp.checkHealth(),i("connected"),t==null||t({connected:!0,agentsReady:!0})}catch(a){s(a.message),i("error"),t==null||t({connected:!1,agentsReady:!1})}},[t]);return E.useEffect(()=>{e?o():(i("idle"),s(null),t==null||t({connected:!1,agentsReady:!1}))},[e,o,t]),!e||n==="connected"?null:f.jsx("div",{className:"backend-status-overlay",children:f.jsxs("div",{className:"backend-status-modal",children:[f.jsx("h2",{children:"Backend Connection"}),n==="checking"&&f.jsxs("div",{className:"status-content",children:[f.jsx("div",{className:"spinner-large"}),f.jsx("p",{children:"Checking backend connection..."})]}),n==="error"&&f.jsxs("div",{className:"status-content status-error",children:[f.jsx("div",{className:"error-icon",children:""}),f.jsx("p",{className:"error-message",children:"Cannot connect to backend"}),f.jsx("p",{className:"error-detail",children:r}),f.jsx("div",{className:"error-actions",children:f.jsx("button",{className:"btn-retry",onClick:o,children:"Retry Connection"})}),f.jsxs("div",{className:"error-help",children:[f.jsx("strong",{children:"Troubleshooting:"}),f.jsxs("ul",{children:[f.jsxs("li",{children:["Ensure backend is running: ",f.jsx("code",{children:"python run.py"})]}),f.jsxs("li",{children:["Check backend URL in config: ",f.jsx("code",{children:zp.baseUrl})]}),f.jsx("li",{children:"Verify LiveKit credentials are configured in backend .env"})]})]})]})]})})}function u_(){const[t,e]=E.useState("users"),[n,i]=E.useState([]),[r,s]=E.useState([]),[o,a]=E.useState(!0),[c,l]=E.useState(null),[u,d]=E.useState(!1),[h,m]=E.useState(null),[b,v]=E.useState({email:"",username:"",password:"",role:"user"}),[w,g]=E.useState(null),[y,S]=E.useState(!1),p=async()=>{try{const L=await fetch(`${je.backend.baseUrl}/api/admin/users`,{headers:Re.getAuthHeader()});if(!L.ok){if(L.status===403){l("Admin access required");return}throw new Error("Failed to fetch users")}const Y=await L.json();i(Y)}catch(L){l(L.message)}},k=async()=>{try{const L=await fetch(`${je.backend.baseUrl}/api/admin/conversations`,{headers:Re.getAuthHeader()});if(!L.ok){if(L.status===403){l("Admin access required");return}throw new Error("Failed to fetch conversations")}const Y=await L.json();s(Y)}catch(L){l(L.message)}};E.useEffect(()=>{(async()=>{a(!0),l(null),await p(),await k(),a(!1)})()},[]);const T=async L=>{L.preventDefault();try{const Y=await fetch(`${je.backend.baseUrl}/api/admin/users`,{method:"POST",headers:{"Content-Type":"application/json",...Re.getAuthHeader()},body:JSON.stringify(b)});if(!Y.ok){const ve=await Y.json().catch(()=>({}));throw new Error(ve.detail||"Failed to create user")}await p(),d(!1),v({email:"",username:"",password:"",role:"user"}),l(null)}catch(Y){l(Y.message)}},x=async L=>{L.preventDefault();try{const Y=await fetch(`${je.backend.baseUrl}/api/admin/users/${h.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...Re.getAuthHeader()},body:JSON.stringify(b)});if(!Y.ok){const ve=await Y.json().catch(()=>({}));throw new Error(ve.detail||"Failed to update user")}await p(),d(!1),m(null),v({email:"",username:"",password:"",role:"user"}),l(null)}catch(Y){l(Y.message)}},P=async L=>{if(confirm("Are you sure you want to delete this user? This will also delete all their conversations."))try{const Y=await fetch(`${je.backend.baseUrl}/api/admin/users/${L}`,{method:"DELETE",headers:Re.getAuthHeader()});if(!Y.ok){const ve=await Y.json().catch(()=>({}));throw new Error(ve.detail||"Failed to delete user")}await p(),await k(),l(null)}catch(Y){l(Y.message)}},I=L=>{m(L),v({email:L.email,username:L.username,password:"",role:L.role}),d(!0)},R=()=>{m(null),v({email:"",username:"",password:"",role:"user"}),d(!0)},N=async L=>{try{const Y=await fetch(`${je.backend.baseUrl}/api/admin/conversations/${L}`,{headers:Re.getAuthHeader()});if(!Y.ok)throw new Error("Failed to fetch conversation");const ve=await Y.json();g(ve),S(!0)}catch(Y){l(Y.message)}},$=async L=>{if(confirm("Are you sure you want to delete this conversation?"))try{const Y=await fetch(`${je.backend.baseUrl}/api/admin/conversations/${L}`,{method:"DELETE",headers:Re.getAuthHeader()});if(!Y.ok){const ve=await Y.json().catch(()=>({}));throw new Error(ve.detail||"Failed to delete conversation")}await k(),l(null)}catch(Y){l(Y.message)}};return o?f.jsx("div",{className:"admin-loading",children:"Loading admin panel..."}):c&&c==="Admin access required"?f.jsx("div",{className:"admin-error",children:"Access Denied: Admin privileges required"}):f.jsxs("div",{className:"admin-panel",children:[f.jsxs("div",{className:"admin-header",children:[f.jsx("h1",{children:"Admin Panel"}),f.jsxs("div",{className:"admin-tabs",children:[f.jsxs("button",{className:t==="users"?"active":"",onClick:()=>e("users"),children:["Users (",n.length,")"]}),f.jsxs("button",{className:t==="conversations"?"active":"",onClick:()=>e("conversations"),children:["Conversations (",r.length,")"]})]})]}),c&&f.jsx("div",{className:"admin-error-banner",children:c}),t==="users"&&f.jsxs("div",{className:"admin-content",children:[f.jsx("div",{className:"admin-actions",children:f.jsx("button",{className:"btn-primary",onClick:R,children:"+ Create User"})}),f.jsxs("table",{className:"admin-table",children:[f.jsx("thead",{children:f.jsxs("tr",{children:[f.jsx("th",{children:"ID"}),f.jsx("th",{children:"Email"}),f.jsx("th",{children:"Username"}),f.jsx("th",{children:"Role"}),f.jsx("th",{children:"Conversations"}),f.jsx("th",{children:"Created"}),f.jsx("th",{children:"Actions"})]})}),f.jsx("tbody",{children:n.map(L=>f.jsxs("tr",{children:[f.jsx("td",{children:L.id}),f.jsx("td",{children:L.email}),f.jsx("td",{children:L.username}),f.jsx("td",{children:f.jsx("span",{className:`role-badge role-${L.role}`,children:L.role})}),f.jsx("td",{children:L.conversation_count}),f.jsx("td",{children:new Date(L.created_at).toLocaleDateString()}),f.jsxs("td",{children:[f.jsx("button",{className:"btn-edit",onClick:()=>I(L),children:"Edit"}),f.jsx("button",{className:"btn-delete",onClick:()=>P(L.id),children:"Delete"})]})]},L.id))})]})]}),t==="conversations"&&f.jsx("div",{className:"admin-content",children:f.jsxs("table",{className:"admin-table",children:[f.jsx("thead",{children:f.jsxs("tr",{children:[f.jsx("th",{children:"ID"}),f.jsx("th",{children:"User"}),f.jsx("th",{children:"Agent"}),f.jsx("th",{children:"Score"}),f.jsx("th",{children:"Tier"}),f.jsx("th",{children:"Messages"}),f.jsx("th",{children:"Date"}),f.jsx("th",{children:"Actions"})]})}),f.jsx("tbody",{children:r.map(L=>{var Y;return f.jsxs("tr",{children:[f.jsx("td",{children:L.id}),f.jsx("td",{children:f.jsxs("div",{children:[f.jsx("div",{children:L.user_username}),f.jsx("small",{children:L.user_email})]})}),f.jsx("td",{children:f.jsxs("div",{children:[f.jsx("div",{children:L.agent_name}),f.jsx("small",{children:L.agent_role})]})}),f.jsx("td",{children:L.final_score!==null?f.jsx("span",{className:`score-badge score-${((Y=L.tier)==null?void 0:Y.toLowerCase())||"none"}`,children:Math.round(L.final_score)}):f.jsx("span",{className:"score-badge",children:"-"})}),f.jsx("td",{children:L.tier||"-"}),f.jsx("td",{children:L.message_count}),f.jsx("td",{children:new Date(L.created_at).toLocaleDateString()}),f.jsxs("td",{children:[f.jsx("button",{className:"btn-view",onClick:()=>N(L.id),children:"View"}),f.jsx("button",{className:"btn-delete",onClick:()=>$(L.id),children:"Delete"})]})]},L.id)})})]})}),u&&f.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:f.jsxs("div",{className:"modal-content",onClick:L=>L.stopPropagation(),children:[f.jsx("h2",{children:h?"Edit User":"Create User"}),f.jsxs("form",{onSubmit:h?x:T,children:[f.jsxs("div",{className:"form-group",children:[f.jsx("label",{children:"Email"}),f.jsx("input",{type:"email",value:b.email,onChange:L=>v({...b,email:L.target.value}),required:!0})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{children:"Username"}),f.jsx("input",{type:"text",value:b.username,onChange:L=>v({...b,username:L.target.value}),required:!0})]}),f.jsxs("div",{className:"form-group",children:[f.jsxs("label",{children:["Password ",h&&"(leave blank to keep current)"]}),f.jsx("input",{type:"password",value:b.password,onChange:L=>v({...b,password:L.target.value}),required:!h})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{children:"Role"}),f.jsxs("select",{value:b.role,onChange:L=>v({...b,role:L.target.value}),children:[f.jsx("option",{value:"user",children:"User"}),f.jsx("option",{value:"admin",children:"Admin"})]})]}),f.jsxs("div",{className:"modal-actions",children:[f.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>d(!1),children:"Cancel"}),f.jsx("button",{type:"submit",className:"btn-primary",children:h?"Update":"Create"})]})]})]})}),y&&w&&f.jsx("div",{className:"modal-overlay",onClick:()=>S(!1),children:f.jsxs("div",{className:"modal-content modal-large",onClick:L=>L.stopPropagation(),children:[f.jsx("h2",{children:"Conversation Details"}),f.jsxs("div",{className:"conversation-detail",children:[f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{children:"User Info"}),f.jsxs("p",{children:[f.jsx("strong",{children:"Email:"})," ",w.user_email]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Username:"})," ",w.user_username]})]}),f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{children:"Agent Info"}),f.jsxs("p",{children:[f.jsx("strong",{children:"Agent:"})," ",w.agent_name]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Role:"})," ",w.agent_role]})]}),w.final_score!==null&&f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{children:"Score"}),f.jsxs("p",{children:[f.jsx("strong",{children:"Final Score:"})," ",Math.round(w.final_score),"/100"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Tier:"})," ",w.tier]}),w.detailed_feedback&&f.jsxs("div",{children:[f.jsx("strong",{children:"Feedback:"}),f.jsx("p",{children:w.detailed_feedback})]})]}),f.jsxs("div",{className:"detail-section",children:[f.jsxs("h3",{children:["Messages (",w.messages.length,")"]}),f.jsx("div",{className:"messages-list",children:w.messages.map(L=>f.jsxs("div",{className:`message-item message-${L.sender}`,children:[f.jsxs("strong",{children:[L.sender==="user"?"User":"Agent",":"]}),f.jsx("p",{children:L.text}),f.jsx("small",{children:new Date(L.timestamp_ms).toLocaleString()})]},L.id))})]})]}),f.jsx("div",{className:"modal-actions",children:f.jsx("button",{className:"btn-secondary",onClick:()=>S(!1),children:"Close"})})]})})]})}class d_{constructor(e,n={}){this.iceServers=this._enhanceIceServers(e),this.options={iceCandidatePoolSize:10,...n},this.peerConnection=null,this.iceGatheringTimeout=null}createPeerConnection(){return this.peerConnection=new RTCPeerConnection({iceServers:this.iceServers,iceCandidatePoolSize:this.options.iceCandidatePoolSize}),this.peerConnection}async setRemoteDescription(e){if(!this.peerConnection)throw new Error("Peer connection not initialized");const n=new RTCSessionDescription(e);await this.peerConnection.setRemoteDescription(n)}async createAnswer(){if(!this.peerConnection)throw new Error("Peer connection not initialized");const e=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(e),e}setupIceCandidateHandler(e){if(!this.peerConnection)throw new Error("Peer connection not initialized");this.peerConnection.onicecandidate=({candidate:n})=>{n&&e(n)}}configureJitterBuffer(e=500){if(!this.peerConnection)return;this.peerConnection.getReceivers().forEach(i=>{i.jitterBufferTarget!==void 0&&(i.jitterBufferTarget=e)})}close(){this.iceGatheringTimeout&&(clearTimeout(this.iceGatheringTimeout),this.iceGatheringTimeout=null),this.peerConnection&&(this.peerConnection.onicecandidate=null,this.peerConnection.close(),this.peerConnection=null)}getPeerConnection(){return this.peerConnection}_enhanceIceServers(e){return[...e,{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}class h_{constructor(){this.sessionInfo=null,this.webRTCManager=null,this.isConnected=!1}async createSession(e,n,i="low"){const r=await wi.createSession(i,e,n),{sdp:s,ice_servers2:o}=r;this.webRTCManager=new d_(o);const a=this.webRTCManager.createPeerConnection();return await this.webRTCManager.setRemoteDescription(s),this.sessionInfo=r,this.isConnected=!1,{session:r,peerConnection:a}}async startSession(e,n,i){if(!this.sessionInfo||!this.webRTCManager)throw new Error("Please create a connection first");const r=this.webRTCManager.getPeerConnection();e&&(r.ontrack=e),n&&(r.ondatachannel=n),i&&this.webRTCManager.setupIceCandidateHandler(o=>{i(this.sessionInfo.session_id,o.toJSON())});const s=await this.webRTCManager.createAnswer();await wi.startSession(this.sessionInfo.session_id,s),this.webRTCManager.configureJitterBuffer(500),this.isConnected=!0}async sendTask(e){if(!this.sessionInfo)throw new Error("Please create a connection first");return await wi.sendTask(this.sessionInfo.session_id,e)}async closeSession(){!this.sessionInfo||!this.webRTCManager||(this.webRTCManager.close(),await wi.stopSession(this.sessionInfo.session_id),this.sessionInfo=null,this.webRTCManager=null,this.isConnected=!1)}getPeerConnection(){var e;return((e=this.webRTCManager)==null?void 0:e.getPeerConnection())||null}}function f_(){const[t,e]=E.useState(null),[n,i]=E.useState(null),[r,s]=E.useState(!1),o=E.useRef(new h_),a=E.useCallback(async(d,h,m="low")=>{const b=await o.current.createSession(d,h,m),{session:v,peerConnection:w}=b;return i(w),e(v),s(!1),{session:v,peerConnection:w}},[]),c=E.useCallback(async(d,h)=>{const m=(b,v)=>{wi.submitIceCandidate(b,v)};await o.current.startSession(d,h,m),s(!0)},[]),l=E.useCallback(async d=>await o.current.sendTask(d),[]),u=E.useCallback(async()=>{await o.current.closeSession(),i(null),e(null),s(!1)},[]);return{sessionInfo:t,peerConnection:n,isConnected:r,createNewSession:a,startSession:c,sendTask:l,closeSession:u}}function p_(){const[t,e]=E.useState(!1),[n,i]=E.useState(null),[r,s]=E.useState("dashboard"),[o,a]=E.useState("Initializing..."),[c,l]=E.useState(!1),[u,d]=E.useState(null);E.useEffect(()=>{if((r==="loading"||r==="interview")&&!u){const R=setTimeout(()=>{console.warn(" View stuck in",r,"- resetting to dashboard"),s("dashboard"),i(null),a("Initializing...")},3e4);return()=>clearTimeout(R)}},[r,n,u]);const{sessionInfo:h,peerConnection:m,isConnected:b,createNewSession:v,startSession:w,closeSession:g}=f_();E.useEffect(()=>{(async()=>{Re.isAuthenticated()&&await Re.verifyToken()&&e(!0)})()},[]);const y=Ys(),S=E.useCallback(()=>{e(!0),s("dashboard"),y("/dashboard")},[y]),p=E.useCallback(()=>{Re.signOut(),e(!1),i(null),s("dashboard"),y("/")},[y]),k=E.useCallback(R=>{l(R.connected)},[]);E.useEffect(()=>{const R=()=>{h&&h.session_id&&wi.stopSessionSync(h.session_id),u&&os.disconnect()};return window.addEventListener("beforeunload",R),()=>{window.removeEventListener("beforeunload",R)}},[h,u]);const T=E.useCallback(async R=>{if(!c){alert("Backend is not ready. Please wait for backend initialization to complete.");return}i(R),s("loading"),a("Creating HeyGen session...");try{a("Connecting to HeyGen avatar..."),await v(R.heygenAvatarId,R.heygenVoiceId,"low"),a("Starting HeyGen video stream..."),await w(null,G=>{const j=G.channel;j.onmessage=()=>{}}),a("HeyGen video connected "),a("Connecting to LiveKit agent...");const $=`room-avatar-${R.id}`,L=`user-${Date.now()}`,Y=(h==null?void 0:h.session_id)||null,ve=await os.connectToRoom($,L,R.id,Y,()=>{},()=>{a("LiveKit agent connected ")},()=>{d(null)});d(ve),a("Waiting for agent to join...");let ht=0;const Ke=10,z=setInterval(()=>{ht++,ve.remoteParticipants.size>0?(clearInterval(z),a("Agent connected "),setTimeout(()=>{s("interview")},500)):ht>=Ke?(clearInterval(z),a(" Agent did not join - check LIVEKIT_AGENT_NAME in .env"),setTimeout(()=>{s("interview")},2e3)):a(`Waiting for agent to join... (${ht}/${Ke})`)},1e3)}catch(N){let $="Unknown error";N instanceof Error?$=N.message||String(N):typeof N=="string"?$=N:N&&typeof N=="object"?$=N.message||N.detail||N.error||JSON.stringify(N):$=String(N),alert(`Failed to create interview session: ${$}`),s("dashboard"),i(null),d(null),a("Initializing...")}},[v,w,c,h]),x=E.useCallback(async()=>{try{await os.disconnect(),await g()}catch{}d(null),i(null),s("dashboard")},[g]),P=E.useCallback(async()=>{try{u&&await os.disconnect(),h&&await g()}catch{}d(null),i(null),s("dashboard")},[u,h,g]),I=r!=="interview"&&r!=="loading";return f.jsxs("div",{className:"app",children:[I&&f.jsx(iC,{isAuthenticated:t,onAuthenticated:S,onLogout:p}),f.jsx(l_,{onStatusChange:k,isAuthenticated:t}),f.jsxs(XS,{children:[f.jsx(yi,{path:"/",element:f.jsx(sC,{})}),f.jsx(yi,{path:"/signin",element:t?f.jsx(Kr,{to:"/dashboard",replace:!0}):f.jsx(cC,{onSuccess:S})}),f.jsx(yi,{path:"/signup",element:t?f.jsx(Kr,{to:"/dashboard",replace:!0}):f.jsx(lC,{onSuccess:S})}),f.jsx(yi,{path:"/settings",element:t?f.jsx(uC,{onLogout:p}):f.jsx(Kr,{to:"/",replace:!0})}),f.jsx(yi,{path:"/dashboard",element:t?f.jsx(aC,{onAvatarSelect:T,backendReady:c}):f.jsx(Kr,{to:"/",replace:!0})}),f.jsx(yi,{path:"/admin",element:t?f.jsx(u_,{}):f.jsx(Kr,{to:"/",replace:!0})})]}),t&&f.jsxs(f.Fragment,{children:[r==="loading"&&n&&f.jsx(rC,{avatar:n,status:o,onCancel:P}),r==="interview"&&n&&u&&f.jsx(a_,{avatar:n,peerConnection:m||null,isConnected:b,livekitRoom:u,heygenSessionId:(h==null?void 0:h.session_id)||null,onExit:x})]})]})}ol.createRoot(document.getElementById("root")).render(f.jsx(Zp.StrictMode,{children:f.jsx(tC,{children:f.jsx(p_,{})})}));
