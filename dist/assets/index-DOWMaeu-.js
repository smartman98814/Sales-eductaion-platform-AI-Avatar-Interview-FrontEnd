function C0(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function w0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ap={exports:{}},_a={},Lp={exports:{}},te={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ns=Symbol.for("react.element"),E0=Symbol.for("react.portal"),P0=Symbol.for("react.fragment"),_0=Symbol.for("react.strict_mode"),x0=Symbol.for("react.profiler"),R0=Symbol.for("react.provider"),I0=Symbol.for("react.context"),O0=Symbol.for("react.forward_ref"),N0=Symbol.for("react.suspense"),D0=Symbol.for("react.memo"),M0=Symbol.for("react.lazy"),Gd=Symbol.iterator;function A0(t){return t===null||typeof t!="object"?null:(t=Gd&&t[Gd]||t["@@iterator"],typeof t=="function"?t:null)}var Up={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jp=Object.assign,Fp={};function Tr(t,e,n){this.props=t,this.context=e,this.refs=Fp,this.updater=n||Up}Tr.prototype.isReactComponent={};Tr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Tr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Bp(){}Bp.prototype=Tr.prototype;function Tu(t,e,n){this.props=t,this.context=e,this.refs=Fp,this.updater=n||Up}var Cu=Tu.prototype=new Bp;Cu.constructor=Tu;jp(Cu,Tr.prototype);Cu.isPureReactComponent=!0;var Jd=Array.isArray,Vp=Object.prototype.hasOwnProperty,wu={current:null},zp={key:!0,ref:!0,__self:!0,__source:!0};function Wp(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Vp.call(e,i)&&!zp.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Ns,type:t,key:s,ref:o,props:r,_owner:wu.current}}function L0(t,e){return{$$typeof:Ns,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Eu(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ns}function U0(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Qd=/\/+/g;function ic(t,e){return typeof t=="object"&&t!==null&&t.key!=null?U0(""+t.key):e.toString(36)}function po(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ns:case E0:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+ic(o,0):i,Jd(r)?(n="",t!=null&&(n=t.replace(Qd,"$&/")+"/"),po(r,e,n,"",function(l){return l})):r!=null&&(Eu(r)&&(r=L0(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Qd,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Jd(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+ic(s,a);o+=po(s,e,n,c,r)}else if(c=A0(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+ic(s,a++),o+=po(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function $s(t,e,n){if(t==null)return t;var i=[],r=0;return po(t,i,"","",function(s){return e.call(n,s,r++)}),i}function j0(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ze={current:null},mo={transition:null},F0={ReactCurrentDispatcher:Ze,ReactCurrentBatchConfig:mo,ReactCurrentOwner:wu};function qp(){throw Error("act(...) is not supported in production builds of React.")}te.Children={map:$s,forEach:function(t,e,n){$s(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return $s(t,function(){e++}),e},toArray:function(t){return $s(t,function(e){return e})||[]},only:function(t){if(!Eu(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};te.Component=Tr;te.Fragment=P0;te.Profiler=x0;te.PureComponent=Tu;te.StrictMode=_0;te.Suspense=N0;te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F0;te.act=qp;te.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=jp({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=wu.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Vp.call(e,c)&&!zp.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:Ns,type:t.type,key:r,ref:s,props:i,_owner:o}};te.createContext=function(t){return t={$$typeof:I0,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:R0,_context:t},t.Consumer=t};te.createElement=Wp;te.createFactory=function(t){var e=Wp.bind(null,t);return e.type=t,e};te.createRef=function(){return{current:null}};te.forwardRef=function(t){return{$$typeof:O0,render:t}};te.isValidElement=Eu;te.lazy=function(t){return{$$typeof:M0,_payload:{_status:-1,_result:t},_init:j0}};te.memo=function(t,e){return{$$typeof:D0,type:t,compare:e===void 0?null:e}};te.startTransition=function(t){var e=mo.transition;mo.transition={};try{t()}finally{mo.transition=e}};te.unstable_act=qp;te.useCallback=function(t,e){return Ze.current.useCallback(t,e)};te.useContext=function(t){return Ze.current.useContext(t)};te.useDebugValue=function(){};te.useDeferredValue=function(t){return Ze.current.useDeferredValue(t)};te.useEffect=function(t,e){return Ze.current.useEffect(t,e)};te.useId=function(){return Ze.current.useId()};te.useImperativeHandle=function(t,e,n){return Ze.current.useImperativeHandle(t,e,n)};te.useInsertionEffect=function(t,e){return Ze.current.useInsertionEffect(t,e)};te.useLayoutEffect=function(t,e){return Ze.current.useLayoutEffect(t,e)};te.useMemo=function(t,e){return Ze.current.useMemo(t,e)};te.useReducer=function(t,e,n){return Ze.current.useReducer(t,e,n)};te.useRef=function(t){return Ze.current.useRef(t)};te.useState=function(t){return Ze.current.useState(t)};te.useSyncExternalStore=function(t,e,n){return Ze.current.useSyncExternalStore(t,e,n)};te.useTransition=function(){return Ze.current.useTransition()};te.version="18.3.1";Lp.exports=te;var E=Lp.exports;const $p=w0(E),B0=C0({__proto__:null,default:$p},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V0=E,z0=Symbol.for("react.element"),W0=Symbol.for("react.fragment"),q0=Object.prototype.hasOwnProperty,$0=V0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,K0={key:!0,ref:!0,__self:!0,__source:!0};function Kp(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)q0.call(e,i)&&!K0.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:z0,type:t,key:s,ref:o,props:r,_owner:$0.current}}_a.Fragment=W0;_a.jsx=Kp;_a.jsxs=Kp;Ap.exports=_a;var k=Ap.exports,Xc={},Hp={exports:{}},bt={},Gp={exports:{}},Jp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,J){var I=W.length;W.push(J);e:for(;0<I;){var K=I-1>>>1,q=W[K];if(0<r(q,J))W[K]=J,W[I]=q,I=K;else break e}}function n(W){return W.length===0?null:W[0]}function i(W){if(W.length===0)return null;var J=W[0],I=W.pop();if(I!==J){W[0]=I;e:for(var K=0,q=W.length,H=q>>>1;K<H;){var B=2*(K+1)-1,G=W[B],ve=B+1,Ee=W[ve];if(0>r(G,I))ve<q&&0>r(Ee,G)?(W[K]=Ee,W[ve]=I,K=ve):(W[K]=G,W[B]=I,K=B);else if(ve<q&&0>r(Ee,I))W[K]=Ee,W[ve]=I,K=ve;else break e}}return J}function r(W,J){var I=W.sortIndex-J.sortIndex;return I!==0?I:W.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,m=!1,b=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(W){for(var J=n(l);J!==null;){if(J.callback===null)i(l);else if(J.startTime<=W)i(l),J.sortIndex=J.expirationTime,e(c,J);else break;J=n(l)}}function f(W){if(v=!1,S(W),!b)if(n(c)!==null)b=!0,nt(y);else{var J=n(l);J!==null&&Tt(f,J.startTime-W)}}function y(W,J){b=!1,v&&(v=!1,p(x),x=-1),m=!0;var I=h;try{for(S(J),d=n(c);d!==null&&(!(d.expirationTime>J)||W&&!O());){var K=d.callback;if(typeof K=="function"){d.callback=null,h=d.priorityLevel;var q=K(d.expirationTime<=J);J=t.unstable_now(),typeof q=="function"?d.callback=q:d===n(c)&&i(c),S(J)}else i(c);d=n(c)}if(d!==null)var H=!0;else{var B=n(l);B!==null&&Tt(f,B.startTime-J),H=!1}return H}finally{d=null,h=I,m=!1}}var C=!1,P=null,x=-1,N=5,R=-1;function O(){return!(t.unstable_now()-R<N)}function z(){if(P!==null){var W=t.unstable_now();R=W;var J=!0;try{J=P(!0,W)}finally{J?V():(C=!1,P=null)}}else C=!1}var V;if(typeof g=="function")V=function(){g(z)};else if(typeof MessageChannel<"u"){var Te=new MessageChannel,ft=Te.port2;Te.port1.onmessage=z,V=function(){ft.postMessage(null)}}else V=function(){w(z,0)};function nt(W){P=W,C||(C=!0,V())}function Tt(W,J){x=w(function(){W(t.unstable_now())},J)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){b||m||(b=!0,nt(y))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(W){switch(h){case 1:case 2:case 3:var J=3;break;default:J=h}var I=h;h=J;try{return W()}finally{h=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,J){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var I=h;h=W;try{return J()}finally{h=I}},t.unstable_scheduleCallback=function(W,J,I){var K=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?K+I:K):I=K,W){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=I+q,W={id:u++,callback:J,priorityLevel:W,startTime:I,expirationTime:q,sortIndex:-1},I>K?(W.sortIndex=I,e(l,W),n(c)===null&&W===n(l)&&(v?(p(x),x=-1):v=!0,Tt(f,I-K))):(W.sortIndex=q,e(c,W),b||m||(b=!0,nt(y))),W},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(W){var J=h;return function(){var I=h;h=J;try{return W.apply(this,arguments)}finally{h=I}}}})(Jp);Gp.exports=Jp;var H0=Gp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0=E,kt=H0;function U(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Qp=new Set,cs={};function xi(t,e){dr(t,e),dr(t+"Capture",e)}function dr(t,e){for(cs[t]=e,t=0;t<e.length;t++)Qp.add(e[t])}var bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zc=Object.prototype.hasOwnProperty,J0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Yd={},Xd={};function Q0(t){return Zc.call(Xd,t)?!0:Zc.call(Yd,t)?!1:J0.test(t)?Xd[t]=!0:(Yd[t]=!0,!1)}function Y0(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function X0(t,e,n,i){if(e===null||typeof e>"u"||Y0(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var We={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){We[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];We[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){We[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){We[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){We[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){We[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){We[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){We[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){We[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var Pu=/[\-:]([a-z])/g;function _u(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Pu,_u);We[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Pu,_u);We[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Pu,_u);We[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){We[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});We.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){We[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function xu(t,e,n,i){var r=We.hasOwnProperty(e)?We[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(X0(e,n,r,i)&&(n=null),i||r===null?Q0(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var En=G0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ks=Symbol.for("react.element"),Li=Symbol.for("react.portal"),Ui=Symbol.for("react.fragment"),Ru=Symbol.for("react.strict_mode"),el=Symbol.for("react.profiler"),Yp=Symbol.for("react.provider"),Xp=Symbol.for("react.context"),Iu=Symbol.for("react.forward_ref"),tl=Symbol.for("react.suspense"),nl=Symbol.for("react.suspense_list"),Ou=Symbol.for("react.memo"),Nn=Symbol.for("react.lazy"),Zp=Symbol.for("react.offscreen"),Zd=Symbol.iterator;function xr(t){return t===null||typeof t!="object"?null:(t=Zd&&t[Zd]||t["@@iterator"],typeof t=="function"?t:null)}var ge=Object.assign,rc;function zr(t){if(rc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);rc=e&&e[1]||""}return`
`+rc+t}var sc=!1;function oc(t,e){if(!t||sc)return"";sc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{sc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?zr(t):""}function Z0(t){switch(t.tag){case 5:return zr(t.type);case 16:return zr("Lazy");case 13:return zr("Suspense");case 19:return zr("SuspenseList");case 0:case 2:case 15:return t=oc(t.type,!1),t;case 11:return t=oc(t.type.render,!1),t;case 1:return t=oc(t.type,!0),t;default:return""}}function il(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ui:return"Fragment";case Li:return"Portal";case el:return"Profiler";case Ru:return"StrictMode";case tl:return"Suspense";case nl:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Xp:return(t.displayName||"Context")+".Consumer";case Yp:return(t._context.displayName||"Context")+".Provider";case Iu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ou:return e=t.displayName||null,e!==null?e:il(t.type)||"Memo";case Nn:e=t._payload,t=t._init;try{return il(t(e))}catch{}}return null}function ek(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return il(e);case 8:return e===Ru?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function em(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tk(t){var e=em(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Hs(t){t._valueTracker||(t._valueTracker=tk(t))}function tm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=em(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Vo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function rl(t,e){var n=e.checked;return ge({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function eh(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Xn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function nm(t,e){e=e.checked,e!=null&&xu(t,"checked",e,!1)}function sl(t,e){nm(t,e);var n=Xn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ol(t,e.type,n):e.hasOwnProperty("defaultValue")&&ol(t,e.type,Xn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function th(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ol(t,e,n){(e!=="number"||Vo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Wr=Array.isArray;function Yi(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Xn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function al(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return ge({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nh(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(U(92));if(Wr(n)){if(1<n.length)throw Error(U(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Xn(n)}}function im(t,e){var n=Xn(e.value),i=Xn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function ih(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function rm(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cl(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?rm(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Gs,sm=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Gs=Gs||document.createElement("div"),Gs.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Gs.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ls(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Jr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nk=["Webkit","ms","Moz","O"];Object.keys(Jr).forEach(function(t){nk.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Jr[e]=Jr[t]})});function om(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Jr.hasOwnProperty(t)&&Jr[t]?(""+e).trim():e+"px"}function am(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=om(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var ik=ge({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ll(t,e){if(e){if(ik[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function ul(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dl=null;function Nu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var hl=null,Xi=null,Zi=null;function rh(t){if(t=As(t)){if(typeof hl!="function")throw Error(U(280));var e=t.stateNode;e&&(e=Na(e),hl(t.stateNode,t.type,e))}}function cm(t){Xi?Zi?Zi.push(t):Zi=[t]:Xi=t}function lm(){if(Xi){var t=Xi,e=Zi;if(Zi=Xi=null,rh(t),e)for(t=0;t<e.length;t++)rh(e[t])}}function um(t,e){return t(e)}function dm(){}var ac=!1;function hm(t,e,n){if(ac)return t(e,n);ac=!0;try{return um(t,e,n)}finally{ac=!1,(Xi!==null||Zi!==null)&&(dm(),lm())}}function us(t,e){var n=t.stateNode;if(n===null)return null;var i=Na(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(U(231,e,typeof n));return n}var fl=!1;if(bn)try{var Rr={};Object.defineProperty(Rr,"passive",{get:function(){fl=!0}}),window.addEventListener("test",Rr,Rr),window.removeEventListener("test",Rr,Rr)}catch{fl=!1}function rk(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Qr=!1,zo=null,Wo=!1,pl=null,sk={onError:function(t){Qr=!0,zo=t}};function ok(t,e,n,i,r,s,o,a,c){Qr=!1,zo=null,rk.apply(sk,arguments)}function ak(t,e,n,i,r,s,o,a,c){if(ok.apply(this,arguments),Qr){if(Qr){var l=zo;Qr=!1,zo=null}else throw Error(U(198));Wo||(Wo=!0,pl=l)}}function Ri(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function fm(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sh(t){if(Ri(t)!==t)throw Error(U(188))}function ck(t){var e=t.alternate;if(!e){if(e=Ri(t),e===null)throw Error(U(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return sh(r),t;if(s===i)return sh(r),e;s=s.sibling}throw Error(U(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(U(189))}}if(n.alternate!==i)throw Error(U(190))}if(n.tag!==3)throw Error(U(188));return n.stateNode.current===n?t:e}function pm(t){return t=ck(t),t!==null?mm(t):null}function mm(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=mm(t);if(e!==null)return e;t=t.sibling}return null}var gm=kt.unstable_scheduleCallback,oh=kt.unstable_cancelCallback,lk=kt.unstable_shouldYield,uk=kt.unstable_requestPaint,Ce=kt.unstable_now,dk=kt.unstable_getCurrentPriorityLevel,Du=kt.unstable_ImmediatePriority,vm=kt.unstable_UserBlockingPriority,qo=kt.unstable_NormalPriority,hk=kt.unstable_LowPriority,ym=kt.unstable_IdlePriority,xa=null,en=null;function fk(t){if(en&&typeof en.onCommitFiberRoot=="function")try{en.onCommitFiberRoot(xa,t,void 0,(t.current.flags&128)===128)}catch{}}var Wt=Math.clz32?Math.clz32:gk,pk=Math.log,mk=Math.LN2;function gk(t){return t>>>=0,t===0?32:31-(pk(t)/mk|0)|0}var Js=64,Qs=4194304;function qr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function $o(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=qr(a):(s&=o,s!==0&&(i=qr(s)))}else o=n&~r,o!==0?i=qr(o):s!==0&&(i=qr(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Wt(e),r=1<<n,i|=t[n],e&=~r;return i}function vk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yk(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Wt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=vk(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function ml(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function km(){var t=Js;return Js<<=1,!(Js&4194240)&&(Js=64),t}function cc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ds(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Wt(e),t[e]=n}function kk(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Wt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Mu(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Wt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var se=0;function bm(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Sm,Au,Tm,Cm,wm,gl=!1,Ys=[],Vn=null,zn=null,Wn=null,ds=new Map,hs=new Map,Mn=[],bk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ah(t,e){switch(t){case"focusin":case"focusout":Vn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":ds.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hs.delete(e.pointerId)}}function Ir(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=As(e),e!==null&&Au(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Sk(t,e,n,i,r){switch(e){case"focusin":return Vn=Ir(Vn,t,e,n,i,r),!0;case"dragenter":return zn=Ir(zn,t,e,n,i,r),!0;case"mouseover":return Wn=Ir(Wn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return ds.set(s,Ir(ds.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,hs.set(s,Ir(hs.get(s)||null,t,e,n,i,r)),!0}return!1}function Em(t){var e=di(t.target);if(e!==null){var n=Ri(e);if(n!==null){if(e=n.tag,e===13){if(e=fm(n),e!==null){t.blockedOn=e,wm(t.priority,function(){Tm(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function go(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=vl(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);dl=i,n.target.dispatchEvent(i),dl=null}else return e=As(n),e!==null&&Au(e),t.blockedOn=n,!1;e.shift()}return!0}function ch(t,e,n){go(t)&&n.delete(e)}function Tk(){gl=!1,Vn!==null&&go(Vn)&&(Vn=null),zn!==null&&go(zn)&&(zn=null),Wn!==null&&go(Wn)&&(Wn=null),ds.forEach(ch),hs.forEach(ch)}function Or(t,e){t.blockedOn===e&&(t.blockedOn=null,gl||(gl=!0,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,Tk)))}function fs(t){function e(r){return Or(r,t)}if(0<Ys.length){Or(Ys[0],t);for(var n=1;n<Ys.length;n++){var i=Ys[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Vn!==null&&Or(Vn,t),zn!==null&&Or(zn,t),Wn!==null&&Or(Wn,t),ds.forEach(e),hs.forEach(e),n=0;n<Mn.length;n++)i=Mn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Mn.length&&(n=Mn[0],n.blockedOn===null);)Em(n),n.blockedOn===null&&Mn.shift()}var er=En.ReactCurrentBatchConfig,Ko=!0;function Ck(t,e,n,i){var r=se,s=er.transition;er.transition=null;try{se=1,Lu(t,e,n,i)}finally{se=r,er.transition=s}}function wk(t,e,n,i){var r=se,s=er.transition;er.transition=null;try{se=4,Lu(t,e,n,i)}finally{se=r,er.transition=s}}function Lu(t,e,n,i){if(Ko){var r=vl(t,e,n,i);if(r===null)yc(t,e,i,Ho,n),ah(t,i);else if(Sk(r,t,e,n,i))i.stopPropagation();else if(ah(t,i),e&4&&-1<bk.indexOf(t)){for(;r!==null;){var s=As(r);if(s!==null&&Sm(s),s=vl(t,e,n,i),s===null&&yc(t,e,i,Ho,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else yc(t,e,i,null,n)}}var Ho=null;function vl(t,e,n,i){if(Ho=null,t=Nu(i),t=di(t),t!==null)if(e=Ri(t),e===null)t=null;else if(n=e.tag,n===13){if(t=fm(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ho=t,null}function Pm(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dk()){case Du:return 1;case vm:return 4;case qo:case hk:return 16;case ym:return 536870912;default:return 16}default:return 16}}var Un=null,Uu=null,vo=null;function _m(){if(vo)return vo;var t,e=Uu,n=e.length,i,r="value"in Un?Un.value:Un.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return vo=r.slice(t,1<i?1-i:void 0)}function yo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Xs(){return!0}function lh(){return!1}function St(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Xs:lh,this.isPropagationStopped=lh,this}return ge(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Xs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Xs)},persist:function(){},isPersistent:Xs}),e}var Cr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ju=St(Cr),Ms=ge({},Cr,{view:0,detail:0}),Ek=St(Ms),lc,uc,Nr,Ra=ge({},Ms,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fu,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Nr&&(Nr&&t.type==="mousemove"?(lc=t.screenX-Nr.screenX,uc=t.screenY-Nr.screenY):uc=lc=0,Nr=t),lc)},movementY:function(t){return"movementY"in t?t.movementY:uc}}),uh=St(Ra),Pk=ge({},Ra,{dataTransfer:0}),_k=St(Pk),xk=ge({},Ms,{relatedTarget:0}),dc=St(xk),Rk=ge({},Cr,{animationName:0,elapsedTime:0,pseudoElement:0}),Ik=St(Rk),Ok=ge({},Cr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Nk=St(Ok),Dk=ge({},Cr,{data:0}),dh=St(Dk),Mk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ak={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uk(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Lk[t])?!!e[t]:!1}function Fu(){return Uk}var jk=ge({},Ms,{key:function(t){if(t.key){var e=Mk[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=yo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ak[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fu,charCode:function(t){return t.type==="keypress"?yo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?yo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Fk=St(jk),Bk=ge({},Ra,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hh=St(Bk),Vk=ge({},Ms,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fu}),zk=St(Vk),Wk=ge({},Cr,{propertyName:0,elapsedTime:0,pseudoElement:0}),qk=St(Wk),$k=ge({},Ra,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Kk=St($k),Hk=[9,13,27,32],Bu=bn&&"CompositionEvent"in window,Yr=null;bn&&"documentMode"in document&&(Yr=document.documentMode);var Gk=bn&&"TextEvent"in window&&!Yr,xm=bn&&(!Bu||Yr&&8<Yr&&11>=Yr),fh=" ",ph=!1;function Rm(t,e){switch(t){case"keyup":return Hk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Im(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ji=!1;function Jk(t,e){switch(t){case"compositionend":return Im(e);case"keypress":return e.which!==32?null:(ph=!0,fh);case"textInput":return t=e.data,t===fh&&ph?null:t;default:return null}}function Qk(t,e){if(ji)return t==="compositionend"||!Bu&&Rm(t,e)?(t=_m(),vo=Uu=Un=null,ji=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xm&&e.locale!=="ko"?null:e.data;default:return null}}var Yk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Yk[t.type]:e==="textarea"}function Om(t,e,n,i){cm(i),e=Go(e,"onChange"),0<e.length&&(n=new ju("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Xr=null,ps=null;function Xk(t){zm(t,0)}function Ia(t){var e=Vi(t);if(tm(e))return t}function Zk(t,e){if(t==="change")return e}var Nm=!1;if(bn){var hc;if(bn){var fc="oninput"in document;if(!fc){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),fc=typeof gh.oninput=="function"}hc=fc}else hc=!1;Nm=hc&&(!document.documentMode||9<document.documentMode)}function vh(){Xr&&(Xr.detachEvent("onpropertychange",Dm),ps=Xr=null)}function Dm(t){if(t.propertyName==="value"&&Ia(ps)){var e=[];Om(e,ps,t,Nu(t)),hm(Xk,e)}}function eb(t,e,n){t==="focusin"?(vh(),Xr=e,ps=n,Xr.attachEvent("onpropertychange",Dm)):t==="focusout"&&vh()}function tb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ia(ps)}function nb(t,e){if(t==="click")return Ia(e)}function ib(t,e){if(t==="input"||t==="change")return Ia(e)}function rb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Kt=typeof Object.is=="function"?Object.is:rb;function ms(t,e){if(Kt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Zc.call(e,r)||!Kt(t[r],e[r]))return!1}return!0}function yh(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function kh(t,e){var n=yh(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yh(n)}}function Mm(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Mm(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Am(){for(var t=window,e=Vo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Vo(t.document)}return e}function Vu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function sb(t){var e=Am(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Mm(n.ownerDocument.documentElement,n)){if(i!==null&&Vu(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=kh(n,s);var o=kh(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ob=bn&&"documentMode"in document&&11>=document.documentMode,Fi=null,yl=null,Zr=null,kl=!1;function bh(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;kl||Fi==null||Fi!==Vo(i)||(i=Fi,"selectionStart"in i&&Vu(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Zr&&ms(Zr,i)||(Zr=i,i=Go(yl,"onSelect"),0<i.length&&(e=new ju("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Fi)))}function Zs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bi={animationend:Zs("Animation","AnimationEnd"),animationiteration:Zs("Animation","AnimationIteration"),animationstart:Zs("Animation","AnimationStart"),transitionend:Zs("Transition","TransitionEnd")},pc={},Lm={};bn&&(Lm=document.createElement("div").style,"AnimationEvent"in window||(delete Bi.animationend.animation,delete Bi.animationiteration.animation,delete Bi.animationstart.animation),"TransitionEvent"in window||delete Bi.transitionend.transition);function Oa(t){if(pc[t])return pc[t];if(!Bi[t])return t;var e=Bi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Lm)return pc[t]=e[n];return t}var Um=Oa("animationend"),jm=Oa("animationiteration"),Fm=Oa("animationstart"),Bm=Oa("transitionend"),Vm=new Map,Sh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ni(t,e){Vm.set(t,e),xi(e,[t])}for(var mc=0;mc<Sh.length;mc++){var gc=Sh[mc],ab=gc.toLowerCase(),cb=gc[0].toUpperCase()+gc.slice(1);ni(ab,"on"+cb)}ni(Um,"onAnimationEnd");ni(jm,"onAnimationIteration");ni(Fm,"onAnimationStart");ni("dblclick","onDoubleClick");ni("focusin","onFocus");ni("focusout","onBlur");ni(Bm,"onTransitionEnd");dr("onMouseEnter",["mouseout","mouseover"]);dr("onMouseLeave",["mouseout","mouseover"]);dr("onPointerEnter",["pointerout","pointerover"]);dr("onPointerLeave",["pointerout","pointerover"]);xi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xi("onBeforeInput",["compositionend","keypress","textInput","paste"]);xi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $r="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lb=new Set("cancel close invalid load scroll toggle".split(" ").concat($r));function Th(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,ak(i,e,void 0,t),t.currentTarget=null}function zm(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Th(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Th(r,a,l),s=c}}}if(Wo)throw t=pl,Wo=!1,pl=null,t}function le(t,e){var n=e[wl];n===void 0&&(n=e[wl]=new Set);var i=t+"__bubble";n.has(i)||(Wm(e,t,2,!1),n.add(i))}function vc(t,e,n){var i=0;e&&(i|=4),Wm(n,t,i,e)}var eo="_reactListening"+Math.random().toString(36).slice(2);function gs(t){if(!t[eo]){t[eo]=!0,Qp.forEach(function(n){n!=="selectionchange"&&(lb.has(n)||vc(n,!1,t),vc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[eo]||(e[eo]=!0,vc("selectionchange",!1,e))}}function Wm(t,e,n,i){switch(Pm(e)){case 1:var r=Ck;break;case 4:r=wk;break;default:r=Lu}n=r.bind(null,e,n,t),r=void 0,!fl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function yc(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=di(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}hm(function(){var l=s,u=Nu(n),d=[];e:{var h=Vm.get(t);if(h!==void 0){var m=ju,b=t;switch(t){case"keypress":if(yo(n)===0)break e;case"keydown":case"keyup":m=Fk;break;case"focusin":b="focus",m=dc;break;case"focusout":b="blur",m=dc;break;case"beforeblur":case"afterblur":m=dc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=uh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=_k;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=zk;break;case Um:case jm:case Fm:m=Ik;break;case Bm:m=qk;break;case"scroll":m=Ek;break;case"wheel":m=Kk;break;case"copy":case"cut":case"paste":m=Nk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=hh}var v=(e&4)!==0,w=!v&&t==="scroll",p=v?h!==null?h+"Capture":null:h;v=[];for(var g=l,S;g!==null;){S=g;var f=S.stateNode;if(S.tag===5&&f!==null&&(S=f,p!==null&&(f=us(g,p),f!=null&&v.push(vs(g,f,S)))),w)break;g=g.return}0<v.length&&(h=new m(h,b,null,n,u),d.push({event:h,listeners:v}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",h&&n!==dl&&(b=n.relatedTarget||n.fromElement)&&(di(b)||b[Sn]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(b=n.relatedTarget||n.toElement,m=l,b=b?di(b):null,b!==null&&(w=Ri(b),b!==w||b.tag!==5&&b.tag!==6)&&(b=null)):(m=null,b=l),m!==b)){if(v=uh,f="onMouseLeave",p="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(v=hh,f="onPointerLeave",p="onPointerEnter",g="pointer"),w=m==null?h:Vi(m),S=b==null?h:Vi(b),h=new v(f,g+"leave",m,n,u),h.target=w,h.relatedTarget=S,f=null,di(u)===l&&(v=new v(p,g+"enter",b,n,u),v.target=S,v.relatedTarget=w,f=v),w=f,m&&b)t:{for(v=m,p=b,g=0,S=v;S;S=Ni(S))g++;for(S=0,f=p;f;f=Ni(f))S++;for(;0<g-S;)v=Ni(v),g--;for(;0<S-g;)p=Ni(p),S--;for(;g--;){if(v===p||p!==null&&v===p.alternate)break t;v=Ni(v),p=Ni(p)}v=null}else v=null;m!==null&&Ch(d,h,m,v,!1),b!==null&&w!==null&&Ch(d,w,b,v,!0)}}e:{if(h=l?Vi(l):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var y=Zk;else if(mh(h))if(Nm)y=ib;else{y=tb;var C=eb}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(y=nb);if(y&&(y=y(t,l))){Om(d,y,n,u);break e}C&&C(t,h,l),t==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&ol(h,"number",h.value)}switch(C=l?Vi(l):window,t){case"focusin":(mh(C)||C.contentEditable==="true")&&(Fi=C,yl=l,Zr=null);break;case"focusout":Zr=yl=Fi=null;break;case"mousedown":kl=!0;break;case"contextmenu":case"mouseup":case"dragend":kl=!1,bh(d,n,u);break;case"selectionchange":if(ob)break;case"keydown":case"keyup":bh(d,n,u)}var P;if(Bu)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ji?Rm(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(xm&&n.locale!=="ko"&&(ji||x!=="onCompositionStart"?x==="onCompositionEnd"&&ji&&(P=_m()):(Un=u,Uu="value"in Un?Un.value:Un.textContent,ji=!0)),C=Go(l,x),0<C.length&&(x=new dh(x,t,null,n,u),d.push({event:x,listeners:C}),P?x.data=P:(P=Im(n),P!==null&&(x.data=P)))),(P=Gk?Jk(t,n):Qk(t,n))&&(l=Go(l,"onBeforeInput"),0<l.length&&(u=new dh("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=P))}zm(d,e)})}function vs(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Go(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=us(t,n),s!=null&&i.unshift(vs(t,s,r)),s=us(t,e),s!=null&&i.push(vs(t,s,r))),t=t.return}return i}function Ni(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ch(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=us(n,s),c!=null&&o.unshift(vs(n,c,a))):r||(c=us(n,s),c!=null&&o.push(vs(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var ub=/\r\n?/g,db=/\u0000|\uFFFD/g;function wh(t){return(typeof t=="string"?t:""+t).replace(ub,`
`).replace(db,"")}function to(t,e,n){if(e=wh(e),wh(t)!==e&&n)throw Error(U(425))}function Jo(){}var bl=null,Sl=null;function Tl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cl=typeof setTimeout=="function"?setTimeout:void 0,hb=typeof clearTimeout=="function"?clearTimeout:void 0,Eh=typeof Promise=="function"?Promise:void 0,fb=typeof queueMicrotask=="function"?queueMicrotask:typeof Eh<"u"?function(t){return Eh.resolve(null).then(t).catch(pb)}:Cl;function pb(t){setTimeout(function(){throw t})}function kc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),fs(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);fs(e)}function qn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ph(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var wr=Math.random().toString(36).slice(2),Zt="__reactFiber$"+wr,ys="__reactProps$"+wr,Sn="__reactContainer$"+wr,wl="__reactEvents$"+wr,mb="__reactListeners$"+wr,gb="__reactHandles$"+wr;function di(t){var e=t[Zt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Sn]||n[Zt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ph(t);t!==null;){if(n=t[Zt])return n;t=Ph(t)}return e}t=n,n=t.parentNode}return null}function As(t){return t=t[Zt]||t[Sn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Vi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(U(33))}function Na(t){return t[ys]||null}var El=[],zi=-1;function ii(t){return{current:t}}function de(t){0>zi||(t.current=El[zi],El[zi]=null,zi--)}function ce(t,e){zi++,El[zi]=t.current,t.current=e}var Zn={},He=ii(Zn),lt=ii(!1),ki=Zn;function hr(t,e){var n=t.type.contextTypes;if(!n)return Zn;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function ut(t){return t=t.childContextTypes,t!=null}function Qo(){de(lt),de(He)}function _h(t,e,n){if(He.current!==Zn)throw Error(U(168));ce(He,e),ce(lt,n)}function qm(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(U(108,ek(t)||"Unknown",r));return ge({},n,i)}function Yo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zn,ki=He.current,ce(He,t),ce(lt,lt.current),!0}function xh(t,e,n){var i=t.stateNode;if(!i)throw Error(U(169));n?(t=qm(t,e,ki),i.__reactInternalMemoizedMergedChildContext=t,de(lt),de(He),ce(He,t)):de(lt),ce(lt,n)}var un=null,Da=!1,bc=!1;function $m(t){un===null?un=[t]:un.push(t)}function vb(t){Da=!0,$m(t)}function ri(){if(!bc&&un!==null){bc=!0;var t=0,e=se;try{var n=un;for(se=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}un=null,Da=!1}catch(r){throw un!==null&&(un=un.slice(t+1)),gm(Du,ri),r}finally{se=e,bc=!1}}return null}var Wi=[],qi=0,Xo=null,Zo=0,Pt=[],_t=0,bi=null,vn=1,yn="";function ai(t,e){Wi[qi++]=Zo,Wi[qi++]=Xo,Xo=t,Zo=e}function Km(t,e,n){Pt[_t++]=vn,Pt[_t++]=yn,Pt[_t++]=bi,bi=t;var i=vn;t=yn;var r=32-Wt(i)-1;i&=~(1<<r),n+=1;var s=32-Wt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,vn=1<<32-Wt(e)+r|n<<r|i,yn=s+t}else vn=1<<s|n<<r|i,yn=t}function zu(t){t.return!==null&&(ai(t,1),Km(t,1,0))}function Wu(t){for(;t===Xo;)Xo=Wi[--qi],Wi[qi]=null,Zo=Wi[--qi],Wi[qi]=null;for(;t===bi;)bi=Pt[--_t],Pt[_t]=null,yn=Pt[--_t],Pt[_t]=null,vn=Pt[--_t],Pt[_t]=null}var yt=null,gt=null,he=!1,jt=null;function Hm(t,e){var n=xt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Rh(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,yt=t,gt=qn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,yt=t,gt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=bi!==null?{id:vn,overflow:yn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,yt=t,gt=null,!0):!1;default:return!1}}function Pl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function _l(t){if(he){var e=gt;if(e){var n=e;if(!Rh(t,e)){if(Pl(t))throw Error(U(418));e=qn(n.nextSibling);var i=yt;e&&Rh(t,e)?Hm(i,n):(t.flags=t.flags&-4097|2,he=!1,yt=t)}}else{if(Pl(t))throw Error(U(418));t.flags=t.flags&-4097|2,he=!1,yt=t}}}function Ih(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;yt=t}function no(t){if(t!==yt)return!1;if(!he)return Ih(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Tl(t.type,t.memoizedProps)),e&&(e=gt)){if(Pl(t))throw Gm(),Error(U(418));for(;e;)Hm(t,e),e=qn(e.nextSibling)}if(Ih(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(U(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){gt=qn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}gt=null}}else gt=yt?qn(t.stateNode.nextSibling):null;return!0}function Gm(){for(var t=gt;t;)t=qn(t.nextSibling)}function fr(){gt=yt=null,he=!1}function qu(t){jt===null?jt=[t]:jt.push(t)}var yb=En.ReactCurrentBatchConfig;function Dr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(U(309));var i=n.stateNode}if(!i)throw Error(U(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(U(284));if(!n._owner)throw Error(U(290,t))}return t}function io(t,e){throw t=Object.prototype.toString.call(e),Error(U(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Oh(t){var e=t._init;return e(t._payload)}function Jm(t){function e(p,g){if(t){var S=p.deletions;S===null?(p.deletions=[g],p.flags|=16):S.push(g)}}function n(p,g){if(!t)return null;for(;g!==null;)e(p,g),g=g.sibling;return null}function i(p,g){for(p=new Map;g!==null;)g.key!==null?p.set(g.key,g):p.set(g.index,g),g=g.sibling;return p}function r(p,g){return p=Gn(p,g),p.index=0,p.sibling=null,p}function s(p,g,S){return p.index=S,t?(S=p.alternate,S!==null?(S=S.index,S<g?(p.flags|=2,g):S):(p.flags|=2,g)):(p.flags|=1048576,g)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,g,S,f){return g===null||g.tag!==6?(g=_c(S,p.mode,f),g.return=p,g):(g=r(g,S),g.return=p,g)}function c(p,g,S,f){var y=S.type;return y===Ui?u(p,g,S.props.children,f,S.key):g!==null&&(g.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===Nn&&Oh(y)===g.type)?(f=r(g,S.props),f.ref=Dr(p,g,S),f.return=p,f):(f=Eo(S.type,S.key,S.props,null,p.mode,f),f.ref=Dr(p,g,S),f.return=p,f)}function l(p,g,S,f){return g===null||g.tag!==4||g.stateNode.containerInfo!==S.containerInfo||g.stateNode.implementation!==S.implementation?(g=xc(S,p.mode,f),g.return=p,g):(g=r(g,S.children||[]),g.return=p,g)}function u(p,g,S,f,y){return g===null||g.tag!==7?(g=gi(S,p.mode,f,y),g.return=p,g):(g=r(g,S),g.return=p,g)}function d(p,g,S){if(typeof g=="string"&&g!==""||typeof g=="number")return g=_c(""+g,p.mode,S),g.return=p,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ks:return S=Eo(g.type,g.key,g.props,null,p.mode,S),S.ref=Dr(p,null,g),S.return=p,S;case Li:return g=xc(g,p.mode,S),g.return=p,g;case Nn:var f=g._init;return d(p,f(g._payload),S)}if(Wr(g)||xr(g))return g=gi(g,p.mode,S,null),g.return=p,g;io(p,g)}return null}function h(p,g,S,f){var y=g!==null?g.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return y!==null?null:a(p,g,""+S,f);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ks:return S.key===y?c(p,g,S,f):null;case Li:return S.key===y?l(p,g,S,f):null;case Nn:return y=S._init,h(p,g,y(S._payload),f)}if(Wr(S)||xr(S))return y!==null?null:u(p,g,S,f,null);io(p,S)}return null}function m(p,g,S,f,y){if(typeof f=="string"&&f!==""||typeof f=="number")return p=p.get(S)||null,a(g,p,""+f,y);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Ks:return p=p.get(f.key===null?S:f.key)||null,c(g,p,f,y);case Li:return p=p.get(f.key===null?S:f.key)||null,l(g,p,f,y);case Nn:var C=f._init;return m(p,g,S,C(f._payload),y)}if(Wr(f)||xr(f))return p=p.get(S)||null,u(g,p,f,y,null);io(g,f)}return null}function b(p,g,S,f){for(var y=null,C=null,P=g,x=g=0,N=null;P!==null&&x<S.length;x++){P.index>x?(N=P,P=null):N=P.sibling;var R=h(p,P,S[x],f);if(R===null){P===null&&(P=N);break}t&&P&&R.alternate===null&&e(p,P),g=s(R,g,x),C===null?y=R:C.sibling=R,C=R,P=N}if(x===S.length)return n(p,P),he&&ai(p,x),y;if(P===null){for(;x<S.length;x++)P=d(p,S[x],f),P!==null&&(g=s(P,g,x),C===null?y=P:C.sibling=P,C=P);return he&&ai(p,x),y}for(P=i(p,P);x<S.length;x++)N=m(P,p,x,S[x],f),N!==null&&(t&&N.alternate!==null&&P.delete(N.key===null?x:N.key),g=s(N,g,x),C===null?y=N:C.sibling=N,C=N);return t&&P.forEach(function(O){return e(p,O)}),he&&ai(p,x),y}function v(p,g,S,f){var y=xr(S);if(typeof y!="function")throw Error(U(150));if(S=y.call(S),S==null)throw Error(U(151));for(var C=y=null,P=g,x=g=0,N=null,R=S.next();P!==null&&!R.done;x++,R=S.next()){P.index>x?(N=P,P=null):N=P.sibling;var O=h(p,P,R.value,f);if(O===null){P===null&&(P=N);break}t&&P&&O.alternate===null&&e(p,P),g=s(O,g,x),C===null?y=O:C.sibling=O,C=O,P=N}if(R.done)return n(p,P),he&&ai(p,x),y;if(P===null){for(;!R.done;x++,R=S.next())R=d(p,R.value,f),R!==null&&(g=s(R,g,x),C===null?y=R:C.sibling=R,C=R);return he&&ai(p,x),y}for(P=i(p,P);!R.done;x++,R=S.next())R=m(P,p,x,R.value,f),R!==null&&(t&&R.alternate!==null&&P.delete(R.key===null?x:R.key),g=s(R,g,x),C===null?y=R:C.sibling=R,C=R);return t&&P.forEach(function(z){return e(p,z)}),he&&ai(p,x),y}function w(p,g,S,f){if(typeof S=="object"&&S!==null&&S.type===Ui&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Ks:e:{for(var y=S.key,C=g;C!==null;){if(C.key===y){if(y=S.type,y===Ui){if(C.tag===7){n(p,C.sibling),g=r(C,S.props.children),g.return=p,p=g;break e}}else if(C.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===Nn&&Oh(y)===C.type){n(p,C.sibling),g=r(C,S.props),g.ref=Dr(p,C,S),g.return=p,p=g;break e}n(p,C);break}else e(p,C);C=C.sibling}S.type===Ui?(g=gi(S.props.children,p.mode,f,S.key),g.return=p,p=g):(f=Eo(S.type,S.key,S.props,null,p.mode,f),f.ref=Dr(p,g,S),f.return=p,p=f)}return o(p);case Li:e:{for(C=S.key;g!==null;){if(g.key===C)if(g.tag===4&&g.stateNode.containerInfo===S.containerInfo&&g.stateNode.implementation===S.implementation){n(p,g.sibling),g=r(g,S.children||[]),g.return=p,p=g;break e}else{n(p,g);break}else e(p,g);g=g.sibling}g=xc(S,p.mode,f),g.return=p,p=g}return o(p);case Nn:return C=S._init,w(p,g,C(S._payload),f)}if(Wr(S))return b(p,g,S,f);if(xr(S))return v(p,g,S,f);io(p,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,g!==null&&g.tag===6?(n(p,g.sibling),g=r(g,S),g.return=p,p=g):(n(p,g),g=_c(S,p.mode,f),g.return=p,p=g),o(p)):n(p,g)}return w}var pr=Jm(!0),Qm=Jm(!1),ea=ii(null),ta=null,$i=null,$u=null;function Ku(){$u=$i=ta=null}function Hu(t){var e=ea.current;de(ea),t._currentValue=e}function xl(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function tr(t,e){ta=t,$u=$i=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(at=!0),t.firstContext=null)}function Ot(t){var e=t._currentValue;if($u!==t)if(t={context:t,memoizedValue:e,next:null},$i===null){if(ta===null)throw Error(U(308));$i=t,ta.dependencies={lanes:0,firstContext:t}}else $i=$i.next=t;return e}var hi=null;function Gu(t){hi===null?hi=[t]:hi.push(t)}function Ym(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Gu(e)):(n.next=r.next,r.next=n),e.interleaved=n,Tn(t,i)}function Tn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Dn=!1;function Ju(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Xm(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function kn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function $n(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,re&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Tn(t,n)}return r=i.interleaved,r===null?(e.next=e,Gu(i)):(e.next=r.next,r.next=e),i.interleaved=e,Tn(t,n)}function ko(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Mu(t,n)}}function Nh(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function na(t,e,n,i){var r=t.updateQueue;Dn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,m=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var b=t,v=a;switch(h=e,m=n,v.tag){case 1:if(b=v.payload,typeof b=="function"){d=b.call(m,d,h);break e}d=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=v.payload,h=typeof b=="function"?b.call(m,d,h):b,h==null)break e;d=ge({},d,h);break e;case 2:Dn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else m={eventTime:m,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=m,c=d):u=u.next=m,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Ti|=o,t.lanes=o,t.memoizedState=d}}function Dh(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(U(191,r));r.call(i)}}}var Ls={},tn=ii(Ls),ks=ii(Ls),bs=ii(Ls);function fi(t){if(t===Ls)throw Error(U(174));return t}function Qu(t,e){switch(ce(bs,e),ce(ks,t),ce(tn,Ls),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cl(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=cl(e,t)}de(tn),ce(tn,e)}function mr(){de(tn),de(ks),de(bs)}function Zm(t){fi(bs.current);var e=fi(tn.current),n=cl(e,t.type);e!==n&&(ce(ks,t),ce(tn,n))}function Yu(t){ks.current===t&&(de(tn),de(ks))}var pe=ii(0);function ia(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Sc=[];function Xu(){for(var t=0;t<Sc.length;t++)Sc[t]._workInProgressVersionPrimary=null;Sc.length=0}var bo=En.ReactCurrentDispatcher,Tc=En.ReactCurrentBatchConfig,Si=0,me=null,Ie=null,Me=null,ra=!1,es=!1,Ss=0,kb=0;function qe(){throw Error(U(321))}function Zu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Kt(t[n],e[n]))return!1;return!0}function ed(t,e,n,i,r,s){if(Si=s,me=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,bo.current=t===null||t.memoizedState===null?Cb:wb,t=n(i,r),es){s=0;do{if(es=!1,Ss=0,25<=s)throw Error(U(301));s+=1,Me=Ie=null,e.updateQueue=null,bo.current=Eb,t=n(i,r)}while(es)}if(bo.current=sa,e=Ie!==null&&Ie.next!==null,Si=0,Me=Ie=me=null,ra=!1,e)throw Error(U(300));return t}function td(){var t=Ss!==0;return Ss=0,t}function Yt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?me.memoizedState=Me=t:Me=Me.next=t,Me}function Nt(){if(Ie===null){var t=me.alternate;t=t!==null?t.memoizedState:null}else t=Ie.next;var e=Me===null?me.memoizedState:Me.next;if(e!==null)Me=e,Ie=t;else{if(t===null)throw Error(U(310));Ie=t,t={memoizedState:Ie.memoizedState,baseState:Ie.baseState,baseQueue:Ie.baseQueue,queue:Ie.queue,next:null},Me===null?me.memoizedState=Me=t:Me=Me.next=t}return Me}function Ts(t,e){return typeof e=="function"?e(t):e}function Cc(t){var e=Nt(),n=e.queue;if(n===null)throw Error(U(311));n.lastRenderedReducer=t;var i=Ie,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Si&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,me.lanes|=u,Ti|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Kt(i,e.memoizedState)||(at=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,me.lanes|=s,Ti|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function wc(t){var e=Nt(),n=e.queue;if(n===null)throw Error(U(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Kt(s,e.memoizedState)||(at=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function eg(){}function tg(t,e){var n=me,i=Nt(),r=e(),s=!Kt(i.memoizedState,r);if(s&&(i.memoizedState=r,at=!0),i=i.queue,nd(rg.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,Cs(9,ig.bind(null,n,i,r,e),void 0,null),Ue===null)throw Error(U(349));Si&30||ng(n,e,r)}return r}function ng(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function ig(t,e,n,i){e.value=n,e.getSnapshot=i,sg(e)&&og(t)}function rg(t,e,n){return n(function(){sg(e)&&og(t)})}function sg(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kt(t,n)}catch{return!0}}function og(t){var e=Tn(t,1);e!==null&&qt(e,t,1,-1)}function Mh(t){var e=Yt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ts,lastRenderedState:t},e.queue=t,t=t.dispatch=Tb.bind(null,me,t),[e.memoizedState,t]}function Cs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function ag(){return Nt().memoizedState}function So(t,e,n,i){var r=Yt();me.flags|=t,r.memoizedState=Cs(1|e,n,void 0,i===void 0?null:i)}function Ma(t,e,n,i){var r=Nt();i=i===void 0?null:i;var s=void 0;if(Ie!==null){var o=Ie.memoizedState;if(s=o.destroy,i!==null&&Zu(i,o.deps)){r.memoizedState=Cs(e,n,s,i);return}}me.flags|=t,r.memoizedState=Cs(1|e,n,s,i)}function Ah(t,e){return So(8390656,8,t,e)}function nd(t,e){return Ma(2048,8,t,e)}function cg(t,e){return Ma(4,2,t,e)}function lg(t,e){return Ma(4,4,t,e)}function ug(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function dg(t,e,n){return n=n!=null?n.concat([t]):null,Ma(4,4,ug.bind(null,e,t),n)}function id(){}function hg(t,e){var n=Nt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Zu(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function fg(t,e){var n=Nt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Zu(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function pg(t,e,n){return Si&21?(Kt(n,e)||(n=km(),me.lanes|=n,Ti|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,at=!0),t.memoizedState=n)}function bb(t,e){var n=se;se=n!==0&&4>n?n:4,t(!0);var i=Tc.transition;Tc.transition={};try{t(!1),e()}finally{se=n,Tc.transition=i}}function mg(){return Nt().memoizedState}function Sb(t,e,n){var i=Hn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},gg(t))vg(e,n);else if(n=Ym(t,e,n,i),n!==null){var r=Ye();qt(n,t,i,r),yg(n,e,i)}}function Tb(t,e,n){var i=Hn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(gg(t))vg(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Kt(a,o)){var c=e.interleaved;c===null?(r.next=r,Gu(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Ym(t,e,r,i),n!==null&&(r=Ye(),qt(n,t,i,r),yg(n,e,i))}}function gg(t){var e=t.alternate;return t===me||e!==null&&e===me}function vg(t,e){es=ra=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function yg(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Mu(t,n)}}var sa={readContext:Ot,useCallback:qe,useContext:qe,useEffect:qe,useImperativeHandle:qe,useInsertionEffect:qe,useLayoutEffect:qe,useMemo:qe,useReducer:qe,useRef:qe,useState:qe,useDebugValue:qe,useDeferredValue:qe,useTransition:qe,useMutableSource:qe,useSyncExternalStore:qe,useId:qe,unstable_isNewReconciler:!1},Cb={readContext:Ot,useCallback:function(t,e){return Yt().memoizedState=[t,e===void 0?null:e],t},useContext:Ot,useEffect:Ah,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,So(4194308,4,ug.bind(null,e,t),n)},useLayoutEffect:function(t,e){return So(4194308,4,t,e)},useInsertionEffect:function(t,e){return So(4,2,t,e)},useMemo:function(t,e){var n=Yt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Yt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Sb.bind(null,me,t),[i.memoizedState,t]},useRef:function(t){var e=Yt();return t={current:t},e.memoizedState=t},useState:Mh,useDebugValue:id,useDeferredValue:function(t){return Yt().memoizedState=t},useTransition:function(){var t=Mh(!1),e=t[0];return t=bb.bind(null,t[1]),Yt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=me,r=Yt();if(he){if(n===void 0)throw Error(U(407));n=n()}else{if(n=e(),Ue===null)throw Error(U(349));Si&30||ng(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Ah(rg.bind(null,i,s,t),[t]),i.flags|=2048,Cs(9,ig.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Yt(),e=Ue.identifierPrefix;if(he){var n=yn,i=vn;n=(i&~(1<<32-Wt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ss++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},wb={readContext:Ot,useCallback:hg,useContext:Ot,useEffect:nd,useImperativeHandle:dg,useInsertionEffect:cg,useLayoutEffect:lg,useMemo:fg,useReducer:Cc,useRef:ag,useState:function(){return Cc(Ts)},useDebugValue:id,useDeferredValue:function(t){var e=Nt();return pg(e,Ie.memoizedState,t)},useTransition:function(){var t=Cc(Ts)[0],e=Nt().memoizedState;return[t,e]},useMutableSource:eg,useSyncExternalStore:tg,useId:mg,unstable_isNewReconciler:!1},Eb={readContext:Ot,useCallback:hg,useContext:Ot,useEffect:nd,useImperativeHandle:dg,useInsertionEffect:cg,useLayoutEffect:lg,useMemo:fg,useReducer:wc,useRef:ag,useState:function(){return wc(Ts)},useDebugValue:id,useDeferredValue:function(t){var e=Nt();return Ie===null?e.memoizedState=t:pg(e,Ie.memoizedState,t)},useTransition:function(){var t=wc(Ts)[0],e=Nt().memoizedState;return[t,e]},useMutableSource:eg,useSyncExternalStore:tg,useId:mg,unstable_isNewReconciler:!1};function At(t,e){if(t&&t.defaultProps){e=ge({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Rl(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ge({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Aa={isMounted:function(t){return(t=t._reactInternals)?Ri(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ye(),r=Hn(t),s=kn(i,r);s.payload=e,n!=null&&(s.callback=n),e=$n(t,s,r),e!==null&&(qt(e,t,r,i),ko(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ye(),r=Hn(t),s=kn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=$n(t,s,r),e!==null&&(qt(e,t,r,i),ko(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ye(),i=Hn(t),r=kn(n,i);r.tag=2,e!=null&&(r.callback=e),e=$n(t,r,i),e!==null&&(qt(e,t,i,n),ko(e,t,i))}};function Lh(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!ms(n,i)||!ms(r,s):!0}function kg(t,e,n){var i=!1,r=Zn,s=e.contextType;return typeof s=="object"&&s!==null?s=Ot(s):(r=ut(e)?ki:He.current,i=e.contextTypes,s=(i=i!=null)?hr(t,r):Zn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Aa,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Uh(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Aa.enqueueReplaceState(e,e.state,null)}function Il(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Ju(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ot(s):(s=ut(e)?ki:He.current,r.context=hr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Rl(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Aa.enqueueReplaceState(r,r.state,null),na(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function gr(t,e){try{var n="",i=e;do n+=Z0(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Ec(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ol(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Pb=typeof WeakMap=="function"?WeakMap:Map;function bg(t,e,n){n=kn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){aa||(aa=!0,Vl=i),Ol(t,e)},n}function Sg(t,e,n){n=kn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Ol(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Ol(t,e),typeof i!="function"&&(Kn===null?Kn=new Set([this]):Kn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function jh(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Pb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Bb.bind(null,t,e,n),e.then(t,t))}function Fh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Bh(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=kn(-1,1),e.tag=2,$n(n,e,1))),n.lanes|=1),t)}var _b=En.ReactCurrentOwner,at=!1;function Ge(t,e,n,i){e.child=t===null?Qm(e,null,n,i):pr(e,t.child,n,i)}function Vh(t,e,n,i,r){n=n.render;var s=e.ref;return tr(e,r),i=ed(t,e,n,i,s,r),n=td(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Cn(t,e,r)):(he&&n&&zu(e),e.flags|=1,Ge(t,e,i,r),e.child)}function zh(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!dd(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Tg(t,e,s,i,r)):(t=Eo(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:ms,n(o,i)&&t.ref===e.ref)return Cn(t,e,r)}return e.flags|=1,t=Gn(s,i),t.ref=e.ref,t.return=e,e.child=t}function Tg(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(ms(s,i)&&t.ref===e.ref)if(at=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(at=!0);else return e.lanes=t.lanes,Cn(t,e,r)}return Nl(t,e,n,i,r)}function Cg(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ce(Hi,mt),mt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ce(Hi,mt),mt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,ce(Hi,mt),mt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ce(Hi,mt),mt|=i;return Ge(t,e,r,n),e.child}function wg(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Nl(t,e,n,i,r){var s=ut(n)?ki:He.current;return s=hr(e,s),tr(e,r),n=ed(t,e,n,i,s,r),i=td(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Cn(t,e,r)):(he&&i&&zu(e),e.flags|=1,Ge(t,e,n,r),e.child)}function Wh(t,e,n,i,r){if(ut(n)){var s=!0;Yo(e)}else s=!1;if(tr(e,r),e.stateNode===null)To(t,e),kg(e,n,i),Il(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Ot(l):(l=ut(n)?ki:He.current,l=hr(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&Uh(e,o,i,l),Dn=!1;var h=e.memoizedState;o.state=h,na(e,i,o,r),c=e.memoizedState,a!==i||h!==c||lt.current||Dn?(typeof u=="function"&&(Rl(e,n,u,i),c=e.memoizedState),(a=Dn||Lh(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Xm(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:At(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ot(c):(c=ut(n)?ki:He.current,c=hr(e,c));var m=n.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&Uh(e,o,i,c),Dn=!1,h=e.memoizedState,o.state=h,na(e,i,o,r);var b=e.memoizedState;a!==d||h!==b||lt.current||Dn?(typeof m=="function"&&(Rl(e,n,m,i),b=e.memoizedState),(l=Dn||Lh(e,n,l,i,h,b,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,b,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,b,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=b),o.props=i,o.state=b,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Dl(t,e,n,i,s,r)}function Dl(t,e,n,i,r,s){wg(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&xh(e,n,!1),Cn(t,e,s);i=e.stateNode,_b.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=pr(e,t.child,null,s),e.child=pr(e,null,a,s)):Ge(t,e,a,s),e.memoizedState=i.state,r&&xh(e,n,!0),e.child}function Eg(t){var e=t.stateNode;e.pendingContext?_h(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_h(t,e.context,!1),Qu(t,e.containerInfo)}function qh(t,e,n,i,r){return fr(),qu(r),e.flags|=256,Ge(t,e,n,i),e.child}var Ml={dehydrated:null,treeContext:null,retryLane:0};function Al(t){return{baseLanes:t,cachePool:null,transitions:null}}function Pg(t,e,n){var i=e.pendingProps,r=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ce(pe,r&1),t===null)return _l(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=ja(o,i,0,null),t=gi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Al(n),e.memoizedState=Ml,t):rd(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return xb(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=Gn(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Gn(a,s):(s=gi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Al(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Ml,i}return s=t.child,t=s.sibling,i=Gn(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function rd(t,e){return e=ja({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ro(t,e,n,i){return i!==null&&qu(i),pr(e,t.child,null,n),t=rd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function xb(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Ec(Error(U(422))),ro(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=ja({mode:"visible",children:i.children},r,0,null),s=gi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&pr(e,t.child,null,o),e.child.memoizedState=Al(o),e.memoizedState=Ml,s);if(!(e.mode&1))return ro(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(U(419)),i=Ec(s,i,void 0),ro(t,e,o,i)}if(a=(o&t.childLanes)!==0,at||a){if(i=Ue,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Tn(t,r),qt(i,t,r,-1))}return ud(),i=Ec(Error(U(421))),ro(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Vb.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,gt=qn(r.nextSibling),yt=e,he=!0,jt=null,t!==null&&(Pt[_t++]=vn,Pt[_t++]=yn,Pt[_t++]=bi,vn=t.id,yn=t.overflow,bi=e),e=rd(e,i.children),e.flags|=4096,e)}function $h(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),xl(t.return,e,n)}function Pc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function _g(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ge(t,e,i.children,n),i=pe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$h(t,n,e);else if(t.tag===19)$h(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ce(pe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&ia(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Pc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&ia(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Pc(e,!0,n,null,s);break;case"together":Pc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function To(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Cn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ti|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(U(153));if(e.child!==null){for(t=e.child,n=Gn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Gn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Rb(t,e,n){switch(e.tag){case 3:Eg(e),fr();break;case 5:Zm(e);break;case 1:ut(e.type)&&Yo(e);break;case 4:Qu(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ce(ea,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ce(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?Pg(t,e,n):(ce(pe,pe.current&1),t=Cn(t,e,n),t!==null?t.sibling:null);ce(pe,pe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return _g(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ce(pe,pe.current),i)break;return null;case 22:case 23:return e.lanes=0,Cg(t,e,n)}return Cn(t,e,n)}var xg,Ll,Rg,Ig;xg=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ll=function(){};Rg=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,fi(tn.current);var s=null;switch(n){case"input":r=rl(t,r),i=rl(t,i),s=[];break;case"select":r=ge({},r,{value:void 0}),i=ge({},i,{value:void 0}),s=[];break;case"textarea":r=al(t,r),i=al(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Jo)}ll(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(cs.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(cs.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&le("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Ig=function(t,e,n,i){n!==i&&(e.flags|=4)};function Mr(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function $e(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Ib(t,e,n){var i=e.pendingProps;switch(Wu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $e(e),null;case 1:return ut(e.type)&&Qo(),$e(e),null;case 3:return i=e.stateNode,mr(),de(lt),de(He),Xu(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(no(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,jt!==null&&(ql(jt),jt=null))),Ll(t,e),$e(e),null;case 5:Yu(e);var r=fi(bs.current);if(n=e.type,t!==null&&e.stateNode!=null)Rg(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(U(166));return $e(e),null}if(t=fi(tn.current),no(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Zt]=e,i[ys]=s,t=(e.mode&1)!==0,n){case"dialog":le("cancel",i),le("close",i);break;case"iframe":case"object":case"embed":le("load",i);break;case"video":case"audio":for(r=0;r<$r.length;r++)le($r[r],i);break;case"source":le("error",i);break;case"img":case"image":case"link":le("error",i),le("load",i);break;case"details":le("toggle",i);break;case"input":eh(i,s),le("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},le("invalid",i);break;case"textarea":nh(i,s),le("invalid",i)}ll(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&to(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&to(i.textContent,a,t),r=["children",""+a]):cs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&le("scroll",i)}switch(n){case"input":Hs(i),th(i,s,!0);break;case"textarea":Hs(i),ih(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Jo)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rm(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Zt]=e,t[ys]=i,xg(t,e,!1,!1),e.stateNode=t;e:{switch(o=ul(n,i),n){case"dialog":le("cancel",t),le("close",t),r=i;break;case"iframe":case"object":case"embed":le("load",t),r=i;break;case"video":case"audio":for(r=0;r<$r.length;r++)le($r[r],t);r=i;break;case"source":le("error",t),r=i;break;case"img":case"image":case"link":le("error",t),le("load",t),r=i;break;case"details":le("toggle",t),r=i;break;case"input":eh(t,i),r=rl(t,i),le("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ge({},i,{value:void 0}),le("invalid",t);break;case"textarea":nh(t,i),r=al(t,i),le("invalid",t);break;default:r=i}ll(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?am(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&sm(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ls(t,c):typeof c=="number"&&ls(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(cs.hasOwnProperty(s)?c!=null&&s==="onScroll"&&le("scroll",t):c!=null&&xu(t,s,c,o))}switch(n){case"input":Hs(t),th(t,i,!1);break;case"textarea":Hs(t),ih(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Xn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Yi(t,!!i.multiple,s,!1):i.defaultValue!=null&&Yi(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Jo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $e(e),null;case 6:if(t&&e.stateNode!=null)Ig(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(U(166));if(n=fi(bs.current),fi(tn.current),no(e)){if(i=e.stateNode,n=e.memoizedProps,i[Zt]=e,(s=i.nodeValue!==n)&&(t=yt,t!==null))switch(t.tag){case 3:to(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&to(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Zt]=e,e.stateNode=i}return $e(e),null;case 13:if(de(pe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&gt!==null&&e.mode&1&&!(e.flags&128))Gm(),fr(),e.flags|=98560,s=!1;else if(s=no(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(U(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(U(317));s[Zt]=e}else fr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$e(e),s=!1}else jt!==null&&(ql(jt),jt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Ne===0&&(Ne=3):ud())),e.updateQueue!==null&&(e.flags|=4),$e(e),null);case 4:return mr(),Ll(t,e),t===null&&gs(e.stateNode.containerInfo),$e(e),null;case 10:return Hu(e.type._context),$e(e),null;case 17:return ut(e.type)&&Qo(),$e(e),null;case 19:if(de(pe),s=e.memoizedState,s===null)return $e(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Mr(s,!1);else{if(Ne!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ia(t),o!==null){for(e.flags|=128,Mr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ce(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ce()>vr&&(e.flags|=128,i=!0,Mr(s,!1),e.lanes=4194304)}else{if(!i)if(t=ia(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Mr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return $e(e),null}else 2*Ce()-s.renderingStartTime>vr&&n!==1073741824&&(e.flags|=128,i=!0,Mr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ce(),e.sibling=null,n=pe.current,ce(pe,i?n&1|2:n&1),e):($e(e),null);case 22:case 23:return ld(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?mt&1073741824&&($e(e),e.subtreeFlags&6&&(e.flags|=8192)):$e(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function Ob(t,e){switch(Wu(e),e.tag){case 1:return ut(e.type)&&Qo(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mr(),de(lt),de(He),Xu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Yu(e),null;case 13:if(de(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(U(340));fr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return de(pe),null;case 4:return mr(),null;case 10:return Hu(e.type._context),null;case 22:case 23:return ld(),null;case 24:return null;default:return null}}var so=!1,Ke=!1,Nb=typeof WeakSet=="function"?WeakSet:Set,$=null;function Ki(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ke(t,e,i)}else n.current=null}function Ul(t,e,n){try{n()}catch(i){ke(t,e,i)}}var Kh=!1;function Db(t,e){if(bl=Ko,t=Am(),Vu(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var m;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)h=d,d=m;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(m=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=m}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Sl={focusedElem:t,selectionRange:n},Ko=!1,$=e;$!==null;)if(e=$,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,$=t;else for(;$!==null;){e=$;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var v=b.memoizedProps,w=b.memoizedState,p=e.stateNode,g=p.getSnapshotBeforeUpdate(e.elementType===e.type?v:At(e.type,v),w);p.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(f){ke(e,e.return,f)}if(t=e.sibling,t!==null){t.return=e.return,$=t;break}$=e.return}return b=Kh,Kh=!1,b}function ts(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Ul(e,n,s)}r=r.next}while(r!==i)}}function La(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function jl(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Og(t){var e=t.alternate;e!==null&&(t.alternate=null,Og(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Zt],delete e[ys],delete e[wl],delete e[mb],delete e[gb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Ng(t){return t.tag===5||t.tag===3||t.tag===4}function Hh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ng(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Fl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Jo));else if(i!==4&&(t=t.child,t!==null))for(Fl(t,e,n),t=t.sibling;t!==null;)Fl(t,e,n),t=t.sibling}function Bl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Bl(t,e,n),t=t.sibling;t!==null;)Bl(t,e,n),t=t.sibling}var Fe=null,Lt=!1;function xn(t,e,n){for(n=n.child;n!==null;)Dg(t,e,n),n=n.sibling}function Dg(t,e,n){if(en&&typeof en.onCommitFiberUnmount=="function")try{en.onCommitFiberUnmount(xa,n)}catch{}switch(n.tag){case 5:Ke||Ki(n,e);case 6:var i=Fe,r=Lt;Fe=null,xn(t,e,n),Fe=i,Lt=r,Fe!==null&&(Lt?(t=Fe,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Fe.removeChild(n.stateNode));break;case 18:Fe!==null&&(Lt?(t=Fe,n=n.stateNode,t.nodeType===8?kc(t.parentNode,n):t.nodeType===1&&kc(t,n),fs(t)):kc(Fe,n.stateNode));break;case 4:i=Fe,r=Lt,Fe=n.stateNode.containerInfo,Lt=!0,xn(t,e,n),Fe=i,Lt=r;break;case 0:case 11:case 14:case 15:if(!Ke&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Ul(n,e,o),r=r.next}while(r!==i)}xn(t,e,n);break;case 1:if(!Ke&&(Ki(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ke(n,e,a)}xn(t,e,n);break;case 21:xn(t,e,n);break;case 22:n.mode&1?(Ke=(i=Ke)||n.memoizedState!==null,xn(t,e,n),Ke=i):xn(t,e,n);break;default:xn(t,e,n)}}function Gh(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Nb),e.forEach(function(i){var r=zb.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Dt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Fe=a.stateNode,Lt=!1;break e;case 3:Fe=a.stateNode.containerInfo,Lt=!0;break e;case 4:Fe=a.stateNode.containerInfo,Lt=!0;break e}a=a.return}if(Fe===null)throw Error(U(160));Dg(s,o,r),Fe=null,Lt=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){ke(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Mg(e,t),e=e.sibling}function Mg(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Dt(e,t),Gt(t),i&4){try{ts(3,t,t.return),La(3,t)}catch(v){ke(t,t.return,v)}try{ts(5,t,t.return)}catch(v){ke(t,t.return,v)}}break;case 1:Dt(e,t),Gt(t),i&512&&n!==null&&Ki(n,n.return);break;case 5:if(Dt(e,t),Gt(t),i&512&&n!==null&&Ki(n,n.return),t.flags&32){var r=t.stateNode;try{ls(r,"")}catch(v){ke(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&nm(r,s),ul(a,o);var l=ul(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?am(r,d):u==="dangerouslySetInnerHTML"?sm(r,d):u==="children"?ls(r,d):xu(r,u,d,l)}switch(a){case"input":sl(r,s);break;case"textarea":im(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?Yi(r,!!s.multiple,m,!1):h!==!!s.multiple&&(s.defaultValue!=null?Yi(r,!!s.multiple,s.defaultValue,!0):Yi(r,!!s.multiple,s.multiple?[]:"",!1))}r[ys]=s}catch(v){ke(t,t.return,v)}}break;case 6:if(Dt(e,t),Gt(t),i&4){if(t.stateNode===null)throw Error(U(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){ke(t,t.return,v)}}break;case 3:if(Dt(e,t),Gt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{fs(e.containerInfo)}catch(v){ke(t,t.return,v)}break;case 4:Dt(e,t),Gt(t);break;case 13:Dt(e,t),Gt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(ad=Ce())),i&4&&Gh(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ke=(l=Ke)||u,Dt(e,t),Ke=l):Dt(e,t),Gt(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for($=t,u=t.child;u!==null;){for(d=$=u;$!==null;){switch(h=$,m=h.child,h.tag){case 0:case 11:case 14:case 15:ts(4,h,h.return);break;case 1:Ki(h,h.return);var b=h.stateNode;if(typeof b.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(v){ke(i,n,v)}}break;case 5:Ki(h,h.return);break;case 22:if(h.memoizedState!==null){Qh(d);continue}}m!==null?(m.return=h,$=m):Qh(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=om("display",o))}catch(v){ke(t,t.return,v)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){ke(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Dt(e,t),Gt(t),i&4&&Gh(t);break;case 21:break;default:Dt(e,t),Gt(t)}}function Gt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Ng(n)){var i=n;break e}n=n.return}throw Error(U(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(ls(r,""),i.flags&=-33);var s=Hh(t);Bl(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Hh(t);Fl(t,a,o);break;default:throw Error(U(161))}}catch(c){ke(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Mb(t,e,n){$=t,Ag(t)}function Ag(t,e,n){for(var i=(t.mode&1)!==0;$!==null;){var r=$,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||so;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ke;a=so;var l=Ke;if(so=o,(Ke=c)&&!l)for($=r;$!==null;)o=$,c=o.child,o.tag===22&&o.memoizedState!==null?Yh(r):c!==null?(c.return=o,$=c):Yh(r);for(;s!==null;)$=s,Ag(s),s=s.sibling;$=r,so=a,Ke=l}Jh(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,$=s):Jh(t)}}function Jh(t){for(;$!==null;){var e=$;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||La(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ke)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:At(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Dh(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Dh(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&fs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}Ke||e.flags&512&&jl(e)}catch(h){ke(e,e.return,h)}}if(e===t){$=null;break}if(n=e.sibling,n!==null){n.return=e.return,$=n;break}$=e.return}}function Qh(t){for(;$!==null;){var e=$;if(e===t){$=null;break}var n=e.sibling;if(n!==null){n.return=e.return,$=n;break}$=e.return}}function Yh(t){for(;$!==null;){var e=$;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{La(4,e)}catch(c){ke(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){ke(e,r,c)}}var s=e.return;try{jl(e)}catch(c){ke(e,s,c)}break;case 5:var o=e.return;try{jl(e)}catch(c){ke(e,o,c)}}}catch(c){ke(e,e.return,c)}if(e===t){$=null;break}var a=e.sibling;if(a!==null){a.return=e.return,$=a;break}$=e.return}}var Ab=Math.ceil,oa=En.ReactCurrentDispatcher,sd=En.ReactCurrentOwner,It=En.ReactCurrentBatchConfig,re=0,Ue=null,_e=null,ze=0,mt=0,Hi=ii(0),Ne=0,ws=null,Ti=0,Ua=0,od=0,ns=null,st=null,ad=0,vr=1/0,ln=null,aa=!1,Vl=null,Kn=null,oo=!1,jn=null,ca=0,is=0,zl=null,Co=-1,wo=0;function Ye(){return re&6?Ce():Co!==-1?Co:Co=Ce()}function Hn(t){return t.mode&1?re&2&&ze!==0?ze&-ze:yb.transition!==null?(wo===0&&(wo=km()),wo):(t=se,t!==0||(t=window.event,t=t===void 0?16:Pm(t.type)),t):1}function qt(t,e,n,i){if(50<is)throw is=0,zl=null,Error(U(185));Ds(t,n,i),(!(re&2)||t!==Ue)&&(t===Ue&&(!(re&2)&&(Ua|=n),Ne===4&&An(t,ze)),dt(t,i),n===1&&re===0&&!(e.mode&1)&&(vr=Ce()+500,Da&&ri()))}function dt(t,e){var n=t.callbackNode;yk(t,e);var i=$o(t,t===Ue?ze:0);if(i===0)n!==null&&oh(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&oh(n),e===1)t.tag===0?vb(Xh.bind(null,t)):$m(Xh.bind(null,t)),fb(function(){!(re&6)&&ri()}),n=null;else{switch(bm(i)){case 1:n=Du;break;case 4:n=vm;break;case 16:n=qo;break;case 536870912:n=ym;break;default:n=qo}n=Wg(n,Lg.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Lg(t,e){if(Co=-1,wo=0,re&6)throw Error(U(327));var n=t.callbackNode;if(nr()&&t.callbackNode!==n)return null;var i=$o(t,t===Ue?ze:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=la(t,i);else{e=i;var r=re;re|=2;var s=jg();(Ue!==t||ze!==e)&&(ln=null,vr=Ce()+500,mi(t,e));do try{jb();break}catch(a){Ug(t,a)}while(!0);Ku(),oa.current=s,re=r,_e!==null?e=0:(Ue=null,ze=0,e=Ne)}if(e!==0){if(e===2&&(r=ml(t),r!==0&&(i=r,e=Wl(t,r))),e===1)throw n=ws,mi(t,0),An(t,i),dt(t,Ce()),n;if(e===6)An(t,i);else{if(r=t.current.alternate,!(i&30)&&!Lb(r)&&(e=la(t,i),e===2&&(s=ml(t),s!==0&&(i=s,e=Wl(t,s))),e===1))throw n=ws,mi(t,0),An(t,i),dt(t,Ce()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(U(345));case 2:ci(t,st,ln);break;case 3:if(An(t,i),(i&130023424)===i&&(e=ad+500-Ce(),10<e)){if($o(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ye(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Cl(ci.bind(null,t,st,ln),e);break}ci(t,st,ln);break;case 4:if(An(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Wt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Ce()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ab(i/1960))-i,10<i){t.timeoutHandle=Cl(ci.bind(null,t,st,ln),i);break}ci(t,st,ln);break;case 5:ci(t,st,ln);break;default:throw Error(U(329))}}}return dt(t,Ce()),t.callbackNode===n?Lg.bind(null,t):null}function Wl(t,e){var n=ns;return t.current.memoizedState.isDehydrated&&(mi(t,e).flags|=256),t=la(t,e),t!==2&&(e=st,st=n,e!==null&&ql(e)),t}function ql(t){st===null?st=t:st.push.apply(st,t)}function Lb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Kt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function An(t,e){for(e&=~od,e&=~Ua,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Wt(e),i=1<<n;t[n]=-1,e&=~i}}function Xh(t){if(re&6)throw Error(U(327));nr();var e=$o(t,0);if(!(e&1))return dt(t,Ce()),null;var n=la(t,e);if(t.tag!==0&&n===2){var i=ml(t);i!==0&&(e=i,n=Wl(t,i))}if(n===1)throw n=ws,mi(t,0),An(t,e),dt(t,Ce()),n;if(n===6)throw Error(U(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ci(t,st,ln),dt(t,Ce()),null}function cd(t,e){var n=re;re|=1;try{return t(e)}finally{re=n,re===0&&(vr=Ce()+500,Da&&ri())}}function Ci(t){jn!==null&&jn.tag===0&&!(re&6)&&nr();var e=re;re|=1;var n=It.transition,i=se;try{if(It.transition=null,se=1,t)return t()}finally{se=i,It.transition=n,re=e,!(re&6)&&ri()}}function ld(){mt=Hi.current,de(Hi)}function mi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hb(n)),_e!==null)for(n=_e.return;n!==null;){var i=n;switch(Wu(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Qo();break;case 3:mr(),de(lt),de(He),Xu();break;case 5:Yu(i);break;case 4:mr();break;case 13:de(pe);break;case 19:de(pe);break;case 10:Hu(i.type._context);break;case 22:case 23:ld()}n=n.return}if(Ue=t,_e=t=Gn(t.current,null),ze=mt=e,Ne=0,ws=null,od=Ua=Ti=0,st=ns=null,hi!==null){for(e=0;e<hi.length;e++)if(n=hi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}hi=null}return t}function Ug(t,e){do{var n=_e;try{if(Ku(),bo.current=sa,ra){for(var i=me.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}ra=!1}if(Si=0,Me=Ie=me=null,es=!1,Ss=0,sd.current=null,n===null||n.return===null){Ne=1,ws=e,_e=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=ze,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Fh(o);if(m!==null){m.flags&=-257,Bh(m,o,a,s,e),m.mode&1&&jh(s,l,e),e=m,c=l;var b=e.updateQueue;if(b===null){var v=new Set;v.add(c),e.updateQueue=v}else b.add(c);break e}else{if(!(e&1)){jh(s,l,e),ud();break e}c=Error(U(426))}}else if(he&&a.mode&1){var w=Fh(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Bh(w,o,a,s,e),qu(gr(c,a));break e}}s=c=gr(c,a),Ne!==4&&(Ne=2),ns===null?ns=[s]:ns.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=bg(s,c,e);Nh(s,p);break e;case 1:a=c;var g=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Kn===null||!Kn.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var f=Sg(s,a,e);Nh(s,f);break e}}s=s.return}while(s!==null)}Bg(n)}catch(y){e=y,_e===n&&n!==null&&(_e=n=n.return);continue}break}while(!0)}function jg(){var t=oa.current;return oa.current=sa,t===null?sa:t}function ud(){(Ne===0||Ne===3||Ne===2)&&(Ne=4),Ue===null||!(Ti&268435455)&&!(Ua&268435455)||An(Ue,ze)}function la(t,e){var n=re;re|=2;var i=jg();(Ue!==t||ze!==e)&&(ln=null,mi(t,e));do try{Ub();break}catch(r){Ug(t,r)}while(!0);if(Ku(),re=n,oa.current=i,_e!==null)throw Error(U(261));return Ue=null,ze=0,Ne}function Ub(){for(;_e!==null;)Fg(_e)}function jb(){for(;_e!==null&&!lk();)Fg(_e)}function Fg(t){var e=zg(t.alternate,t,mt);t.memoizedProps=t.pendingProps,e===null?Bg(t):_e=e,sd.current=null}function Bg(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Ob(n,e),n!==null){n.flags&=32767,_e=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ne=6,_e=null;return}}else if(n=Ib(n,e,mt),n!==null){_e=n;return}if(e=e.sibling,e!==null){_e=e;return}_e=e=t}while(e!==null);Ne===0&&(Ne=5)}function ci(t,e,n){var i=se,r=It.transition;try{It.transition=null,se=1,Fb(t,e,n,i)}finally{It.transition=r,se=i}return null}function Fb(t,e,n,i){do nr();while(jn!==null);if(re&6)throw Error(U(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(U(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(kk(t,s),t===Ue&&(_e=Ue=null,ze=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||oo||(oo=!0,Wg(qo,function(){return nr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=It.transition,It.transition=null;var o=se;se=1;var a=re;re|=4,sd.current=null,Db(t,n),Mg(n,t),sb(Sl),Ko=!!bl,Sl=bl=null,t.current=n,Mb(n),uk(),re=a,se=o,It.transition=s}else t.current=n;if(oo&&(oo=!1,jn=t,ca=r),s=t.pendingLanes,s===0&&(Kn=null),fk(n.stateNode),dt(t,Ce()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(aa)throw aa=!1,t=Vl,Vl=null,t;return ca&1&&t.tag!==0&&nr(),s=t.pendingLanes,s&1?t===zl?is++:(is=0,zl=t):is=0,ri(),null}function nr(){if(jn!==null){var t=bm(ca),e=It.transition,n=se;try{if(It.transition=null,se=16>t?16:t,jn===null)var i=!1;else{if(t=jn,jn=null,ca=0,re&6)throw Error(U(331));var r=re;for(re|=4,$=t.current;$!==null;){var s=$,o=s.child;if($.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for($=l;$!==null;){var u=$;switch(u.tag){case 0:case 11:case 15:ts(8,u,s)}var d=u.child;if(d!==null)d.return=u,$=d;else for(;$!==null;){u=$;var h=u.sibling,m=u.return;if(Og(u),u===l){$=null;break}if(h!==null){h.return=m,$=h;break}$=m}}}var b=s.alternate;if(b!==null){var v=b.child;if(v!==null){b.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}$=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,$=o;else e:for(;$!==null;){if(s=$,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ts(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,$=p;break e}$=s.return}}var g=t.current;for($=g;$!==null;){o=$;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,$=S;else e:for(o=g;$!==null;){if(a=$,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:La(9,a)}}catch(y){ke(a,a.return,y)}if(a===o){$=null;break e}var f=a.sibling;if(f!==null){f.return=a.return,$=f;break e}$=a.return}}if(re=r,ri(),en&&typeof en.onPostCommitFiberRoot=="function")try{en.onPostCommitFiberRoot(xa,t)}catch{}i=!0}return i}finally{se=n,It.transition=e}}return!1}function Zh(t,e,n){e=gr(n,e),e=bg(t,e,1),t=$n(t,e,1),e=Ye(),t!==null&&(Ds(t,1,e),dt(t,e))}function ke(t,e,n){if(t.tag===3)Zh(t,t,n);else for(;e!==null;){if(e.tag===3){Zh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Kn===null||!Kn.has(i))){t=gr(n,t),t=Sg(e,t,1),e=$n(e,t,1),t=Ye(),e!==null&&(Ds(e,1,t),dt(e,t));break}}e=e.return}}function Bb(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ye(),t.pingedLanes|=t.suspendedLanes&n,Ue===t&&(ze&n)===n&&(Ne===4||Ne===3&&(ze&130023424)===ze&&500>Ce()-ad?mi(t,0):od|=n),dt(t,e)}function Vg(t,e){e===0&&(t.mode&1?(e=Qs,Qs<<=1,!(Qs&130023424)&&(Qs=4194304)):e=1);var n=Ye();t=Tn(t,e),t!==null&&(Ds(t,e,n),dt(t,n))}function Vb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Vg(t,n)}function zb(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(U(314))}i!==null&&i.delete(e),Vg(t,n)}var zg;zg=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||lt.current)at=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return at=!1,Rb(t,e,n);at=!!(t.flags&131072)}else at=!1,he&&e.flags&1048576&&Km(e,Zo,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;To(t,e),t=e.pendingProps;var r=hr(e,He.current);tr(e,n),r=ed(null,e,i,t,r,n);var s=td();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ut(i)?(s=!0,Yo(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ju(e),r.updater=Aa,e.stateNode=r,r._reactInternals=e,Il(e,i,t,n),e=Dl(null,e,i,!0,s,n)):(e.tag=0,he&&s&&zu(e),Ge(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(To(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=qb(i),t=At(i,t),r){case 0:e=Nl(null,e,i,t,n);break e;case 1:e=Wh(null,e,i,t,n);break e;case 11:e=Vh(null,e,i,t,n);break e;case 14:e=zh(null,e,i,At(i.type,t),n);break e}throw Error(U(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:At(i,r),Nl(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:At(i,r),Wh(t,e,i,r,n);case 3:e:{if(Eg(e),t===null)throw Error(U(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Xm(t,e),na(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=gr(Error(U(423)),e),e=qh(t,e,i,n,r);break e}else if(i!==r){r=gr(Error(U(424)),e),e=qh(t,e,i,n,r);break e}else for(gt=qn(e.stateNode.containerInfo.firstChild),yt=e,he=!0,jt=null,n=Qm(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fr(),i===r){e=Cn(t,e,n);break e}Ge(t,e,i,n)}e=e.child}return e;case 5:return Zm(e),t===null&&_l(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Tl(i,r)?o=null:s!==null&&Tl(i,s)&&(e.flags|=32),wg(t,e),Ge(t,e,o,n),e.child;case 6:return t===null&&_l(e),null;case 13:return Pg(t,e,n);case 4:return Qu(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=pr(e,null,i,n):Ge(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:At(i,r),Vh(t,e,i,r,n);case 7:return Ge(t,e,e.pendingProps,n),e.child;case 8:return Ge(t,e,e.pendingProps.children,n),e.child;case 12:return Ge(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ce(ea,i._currentValue),i._currentValue=o,s!==null)if(Kt(s.value,o)){if(s.children===r.children&&!lt.current){e=Cn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=kn(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),xl(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(U(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),xl(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ge(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,tr(e,n),r=Ot(r),i=i(r),e.flags|=1,Ge(t,e,i,n),e.child;case 14:return i=e.type,r=At(i,e.pendingProps),r=At(i.type,r),zh(t,e,i,r,n);case 15:return Tg(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:At(i,r),To(t,e),e.tag=1,ut(i)?(t=!0,Yo(e)):t=!1,tr(e,n),kg(e,i,r),Il(e,i,r,n),Dl(null,e,i,!0,t,n);case 19:return _g(t,e,n);case 22:return Cg(t,e,n)}throw Error(U(156,e.tag))};function Wg(t,e){return gm(t,e)}function Wb(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(t,e,n,i){return new Wb(t,e,n,i)}function dd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function qb(t){if(typeof t=="function")return dd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Iu)return 11;if(t===Ou)return 14}return 2}function Gn(t,e){var n=t.alternate;return n===null?(n=xt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Eo(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")dd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ui:return gi(n.children,r,s,e);case Ru:o=8,r|=8;break;case el:return t=xt(12,n,e,r|2),t.elementType=el,t.lanes=s,t;case tl:return t=xt(13,n,e,r),t.elementType=tl,t.lanes=s,t;case nl:return t=xt(19,n,e,r),t.elementType=nl,t.lanes=s,t;case Zp:return ja(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Yp:o=10;break e;case Xp:o=9;break e;case Iu:o=11;break e;case Ou:o=14;break e;case Nn:o=16,i=null;break e}throw Error(U(130,t==null?t:typeof t,""))}return e=xt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function gi(t,e,n,i){return t=xt(7,t,i,e),t.lanes=n,t}function ja(t,e,n,i){return t=xt(22,t,i,e),t.elementType=Zp,t.lanes=n,t.stateNode={isHidden:!1},t}function _c(t,e,n){return t=xt(6,t,null,e),t.lanes=n,t}function xc(t,e,n){return e=xt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $b(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cc(0),this.expirationTimes=cc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cc(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function hd(t,e,n,i,r,s,o,a,c){return t=new $b(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=xt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ju(s),t}function Kb(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Li,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function qg(t){if(!t)return Zn;t=t._reactInternals;e:{if(Ri(t)!==t||t.tag!==1)throw Error(U(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ut(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(t.tag===1){var n=t.type;if(ut(n))return qm(t,n,e)}return e}function $g(t,e,n,i,r,s,o,a,c){return t=hd(n,i,!0,t,r,s,o,a,c),t.context=qg(null),n=t.current,i=Ye(),r=Hn(n),s=kn(i,r),s.callback=e??null,$n(n,s,r),t.current.lanes=r,Ds(t,r,i),dt(t,i),t}function Fa(t,e,n,i){var r=e.current,s=Ye(),o=Hn(r);return n=qg(n),e.context===null?e.context=n:e.pendingContext=n,e=kn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=$n(r,e,o),t!==null&&(qt(t,r,o,s),ko(t,r,o)),o}function ua(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ef(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function fd(t,e){ef(t,e),(t=t.alternate)&&ef(t,e)}function Hb(){return null}var Kg=typeof reportError=="function"?reportError:function(t){console.error(t)};function pd(t){this._internalRoot=t}Ba.prototype.render=pd.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(U(409));Fa(t,e,null,null)};Ba.prototype.unmount=pd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ci(function(){Fa(null,t,null,null)}),e[Sn]=null}};function Ba(t){this._internalRoot=t}Ba.prototype.unstable_scheduleHydration=function(t){if(t){var e=Cm();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Mn.length&&e!==0&&e<Mn[n].priority;n++);Mn.splice(n,0,t),n===0&&Em(t)}};function md(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Va(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tf(){}function Gb(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=ua(o);s.call(l)}}var o=$g(e,i,t,0,null,!1,!1,"",tf);return t._reactRootContainer=o,t[Sn]=o.current,gs(t.nodeType===8?t.parentNode:t),Ci(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=ua(c);a.call(l)}}var c=hd(t,0,!1,null,null,!1,!1,"",tf);return t._reactRootContainer=c,t[Sn]=c.current,gs(t.nodeType===8?t.parentNode:t),Ci(function(){Fa(e,c,n,i)}),c}function za(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=ua(o);a.call(c)}}Fa(e,o,t,r)}else o=Gb(n,e,t,r,i);return ua(o)}Sm=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=qr(e.pendingLanes);n!==0&&(Mu(e,n|1),dt(e,Ce()),!(re&6)&&(vr=Ce()+500,ri()))}break;case 13:Ci(function(){var i=Tn(t,1);if(i!==null){var r=Ye();qt(i,t,1,r)}}),fd(t,1)}};Au=function(t){if(t.tag===13){var e=Tn(t,134217728);if(e!==null){var n=Ye();qt(e,t,134217728,n)}fd(t,134217728)}};Tm=function(t){if(t.tag===13){var e=Hn(t),n=Tn(t,e);if(n!==null){var i=Ye();qt(n,t,e,i)}fd(t,e)}};Cm=function(){return se};wm=function(t,e){var n=se;try{return se=t,e()}finally{se=n}};hl=function(t,e,n){switch(e){case"input":if(sl(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Na(i);if(!r)throw Error(U(90));tm(i),sl(i,r)}}}break;case"textarea":im(t,n);break;case"select":e=n.value,e!=null&&Yi(t,!!n.multiple,e,!1)}};um=cd;dm=Ci;var Jb={usingClientEntryPoint:!1,Events:[As,Vi,Na,cm,lm,cd]},Ar={findFiberByHostInstance:di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Qb={bundleType:Ar.bundleType,version:Ar.version,rendererPackageName:Ar.rendererPackageName,rendererConfig:Ar.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:En.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=pm(t),t===null?null:t.stateNode},findFiberByHostInstance:Ar.findFiberByHostInstance||Hb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ao=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ao.isDisabled&&ao.supportsFiber)try{xa=ao.inject(Qb),en=ao}catch{}}bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jb;bt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!md(e))throw Error(U(200));return Kb(t,e,null,n)};bt.createRoot=function(t,e){if(!md(t))throw Error(U(299));var n=!1,i="",r=Kg;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=hd(t,1,!1,null,null,n,!1,i,r),t[Sn]=e.current,gs(t.nodeType===8?t.parentNode:t),new pd(e)};bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(U(188)):(t=Object.keys(t).join(","),Error(U(268,t)));return t=pm(e),t=t===null?null:t.stateNode,t};bt.flushSync=function(t){return Ci(t)};bt.hydrate=function(t,e,n){if(!Va(e))throw Error(U(200));return za(null,t,e,!0,n)};bt.hydrateRoot=function(t,e,n){if(!md(t))throw Error(U(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Kg;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=$g(e,null,t,1,n??null,r,!1,s,o),t[Sn]=e.current,gs(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Ba(e)};bt.render=function(t,e,n){if(!Va(e))throw Error(U(200));return za(null,t,e,!1,n)};bt.unmountComponentAtNode=function(t){if(!Va(t))throw Error(U(40));return t._reactRootContainer?(Ci(function(){za(null,null,t,!1,function(){t._reactRootContainer=null,t[Sn]=null})}),!0):!1};bt.unstable_batchedUpdates=cd;bt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Va(n))throw Error(U(200));if(t==null||t._reactInternals===void 0)throw Error(U(38));return za(t,e,n,!1,i)};bt.version="18.3.1-next-f1338f8080-20240426";function Hg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Hg)}catch(t){console.error(t)}}Hg(),Hp.exports=bt;var Yb=Hp.exports,nf=Yb;Xc.createRoot=nf.createRoot,Xc.hydrateRoot=nf.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Es(){return Es=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Es.apply(this,arguments)}var Fn;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Fn||(Fn={}));const rf="popstate";function Xb(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return $l("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:Gg(r)}return eS(e,n,null,t)}function xe(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function gd(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Zb(){return Math.random().toString(36).substr(2,8)}function sf(t,e){return{usr:t.state,key:t.key,idx:e}}function $l(t,e,n,i){return n===void 0&&(n=null),Es({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Er(e):e,{state:n,key:e&&e.key||i||Zb()})}function Gg(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Er(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function eS(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Fn.Pop,c=null,l=u();l==null&&(l=0,o.replaceState(Es({},o.state,{idx:l}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Fn.Pop;let w=u(),p=w==null?null:w-l;l=w,c&&c({action:a,location:v.location,delta:p})}function h(w,p){a=Fn.Push;let g=$l(v.location,w,p);l=u()+1;let S=sf(g,l),f=v.createHref(g);try{o.pushState(S,"",f)}catch(y){if(y instanceof DOMException&&y.name==="DataCloneError")throw y;r.location.assign(f)}s&&c&&c({action:a,location:v.location,delta:1})}function m(w,p){a=Fn.Replace;let g=$l(v.location,w,p);l=u();let S=sf(g,l),f=v.createHref(g);o.replaceState(S,"",f),s&&c&&c({action:a,location:v.location,delta:0})}function b(w){let p=r.location.origin!=="null"?r.location.origin:r.location.href,g=typeof w=="string"?w:Gg(w);return g=g.replace(/ $/,"%20"),xe(p,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,p)}let v={get action(){return a},get location(){return t(r,o)},listen(w){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(rf,d),c=w,()=>{r.removeEventListener(rf,d),c=null}},createHref(w){return e(r,w)},createURL:b,encodeLocation(w){let p=b(w);return{pathname:p.pathname,search:p.search,hash:p.hash}},push:h,replace:m,go(w){return o.go(w)}};return v}var of;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(of||(of={}));function tS(t,e,n){return n===void 0&&(n="/"),nS(t,e,n)}function nS(t,e,n,i){let r=typeof e=="string"?Er(e):e,s=Yg(r.pathname||"/",n);if(s==null)return null;let o=Jg(t);iS(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=mS(s);a=hS(o[c],l)}return a}function Jg(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(xe(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let l=vi([i,c.relativePath]),u=n.concat(c);s.children&&s.children.length>0&&(xe(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),Jg(s.children,e,u,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:uS(l,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let c of Qg(s.path))r(s,o,c)}),e}function Qg(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=Qg(i.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),r&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function iS(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:dS(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const rS=/^:[\w-]+$/,sS=3,oS=2,aS=1,cS=10,lS=-2,af=t=>t==="*";function uS(t,e){let n=t.split("/"),i=n.length;return n.some(af)&&(i+=lS),e&&(i+=oS),n.filter(r=>!af(r)).reduce((r,s)=>r+(rS.test(s)?sS:s===""?aS:cS),i)}function dS(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function hS(t,e,n){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let c=i[a],l=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=fS({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),h=c.route;if(!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:vi([s,d.pathname]),pathnameBase:bS(vi([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=vi([s,d.pathnameBase]))}return o}function fS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=pS(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((l,u,d)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let v=a[d]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const b=a[d];return m&&!b?l[h]=void 0:l[h]=(b||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function pS(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),gd(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(i.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function mS(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return gd(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Yg(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const gS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vS=t=>gS.test(t);function yS(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Er(t):t,s;if(n)if(vS(n))s=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),gd(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+n))}n.startsWith("/")?s=cf(n.substring(1),"/"):s=cf(n,e)}else s=e;return{pathname:s,search:SS(i),hash:TS(r)}}function cf(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Rc(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function kS(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Xg(t,e){let n=kS(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function Zg(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=Er(t):(r=Es({},t),xe(!r.pathname||!r.pathname.includes("?"),Rc("?","pathname","search",r)),xe(!r.pathname||!r.pathname.includes("#"),Rc("#","pathname","hash",r)),xe(!r.search||!r.search.includes("#"),Rc("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!i&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}a=d>=0?e[d]:"/"}let c=yS(r,a),l=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}const vi=t=>t.join("/").replace(/\/\/+/g,"/"),bS=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),SS=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,TS=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function CS(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const ev=["post","put","patch","delete"];new Set(ev);const wS=["get",...ev];new Set(wS);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ps(){return Ps=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ps.apply(this,arguments)}const vd=E.createContext(null),ES=E.createContext(null),Us=E.createContext(null),Wa=E.createContext(null),Ii=E.createContext({outlet:null,matches:[],isDataRoute:!1}),tv=E.createContext(null);function js(){return E.useContext(Wa)!=null}function yd(){return js()||xe(!1),E.useContext(Wa).location}function nv(t){E.useContext(Us).static||E.useLayoutEffect(t)}function Fs(){let{isDataRoute:t}=E.useContext(Ii);return t?jS():PS()}function PS(){js()||xe(!1);let t=E.useContext(vd),{basename:e,future:n,navigator:i}=E.useContext(Us),{matches:r}=E.useContext(Ii),{pathname:s}=yd(),o=JSON.stringify(Xg(r,n.v7_relativeSplatPath)),a=E.useRef(!1);return nv(()=>{a.current=!0}),E.useCallback(function(l,u){if(u===void 0&&(u={}),!a.current)return;if(typeof l=="number"){i.go(l);return}let d=Zg(l,JSON.parse(o),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:vi([e,d.pathname])),(u.replace?i.replace:i.push)(d,u.state,u)},[e,i,o,s,t])}function _S(t,e){return xS(t,e)}function xS(t,e,n,i){js()||xe(!1);let{navigator:r}=E.useContext(Us),{matches:s}=E.useContext(Ii),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let l=yd(),u;if(e){var d;let w=typeof e=="string"?Er(e):e;c==="/"||(d=w.pathname)!=null&&d.startsWith(c)||xe(!1),u=w}else u=l;let h=u.pathname||"/",m=h;if(c!=="/"){let w=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(w.length).join("/")}let b=tS(t,{pathname:m}),v=DS(b&&b.map(w=>Object.assign({},w,{params:Object.assign({},a,w.params),pathname:vi([c,r.encodeLocation?r.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?c:vi([c,r.encodeLocation?r.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),s,n,i);return e&&v?E.createElement(Wa.Provider,{value:{location:Ps({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Fn.Pop}},v):v}function RS(){let t=US(),e=CS(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),n?E.createElement("pre",{style:r},n):null,null)}const IS=E.createElement(RS,null);class OS extends E.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?E.createElement(Ii.Provider,{value:this.props.routeContext},E.createElement(tv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function NS(t){let{routeContext:e,match:n,children:i}=t,r=E.useContext(vd);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),E.createElement(Ii.Provider,{value:e},i)}function DS(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||xe(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,l=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:h,errors:m}=n,b=d.route.loader&&h[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||b){c=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let m,b=!1,v=null,w=null;n&&(m=a&&d.route.id?a[d.route.id]:void 0,v=d.route.errorElement||IS,c&&(l<0&&h===0?(FS("route-fallback"),b=!0,w=null):l===h&&(b=!0,w=d.route.hydrateFallbackElement||null)));let p=e.concat(o.slice(0,h+1)),g=()=>{let S;return m?S=v:b?S=w:d.route.Component?S=E.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,E.createElement(NS,{match:d,routeContext:{outlet:u,matches:p,isDataRoute:n!=null},children:S})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?E.createElement(OS,{location:n.location,revalidation:n.revalidation,component:v,error:m,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()},null)}var iv=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(iv||{}),rv=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(rv||{});function MS(t){let e=E.useContext(vd);return e||xe(!1),e}function AS(t){let e=E.useContext(ES);return e||xe(!1),e}function LS(t){let e=E.useContext(Ii);return e||xe(!1),e}function sv(t){let e=LS(),n=e.matches[e.matches.length-1];return n.route.id||xe(!1),n.route.id}function US(){var t;let e=E.useContext(tv),n=AS(),i=sv();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function jS(){let{router:t}=MS(iv.UseNavigateStable),e=sv(rv.UseNavigateStable),n=E.useRef(!1);return nv(()=>{n.current=!0}),E.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,Ps({fromRouteId:e},s)))},[t,e])}const lf={};function FS(t,e,n){lf[t]||(lf[t]=!0)}function BS(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function co(t){let{to:e,replace:n,state:i,relative:r}=t;js()||xe(!1);let{future:s,static:o}=E.useContext(Us),{matches:a}=E.useContext(Ii),{pathname:c}=yd(),l=Fs(),u=Zg(e,Xg(a,s.v7_relativeSplatPath),c,r==="path"),d=JSON.stringify(u);return E.useEffect(()=>l(JSON.parse(d),{replace:n,state:i,relative:r}),[l,d,r,n,i]),null}function Ai(t){xe(!1)}function VS(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Fn.Pop,navigator:s,static:o=!1,future:a}=t;js()&&xe(!1);let c=e.replace(/^\/*/,"/"),l=E.useMemo(()=>({basename:c,navigator:s,static:o,future:Ps({v7_relativeSplatPath:!1},a)}),[c,a,s,o]);typeof i=="string"&&(i=Er(i));let{pathname:u="/",search:d="",hash:h="",state:m=null,key:b="default"}=i,v=E.useMemo(()=>{let w=Yg(u,c);return w==null?null:{location:{pathname:w,search:d,hash:h,state:m,key:b},navigationType:r}},[c,u,d,h,m,b,r]);return v==null?null:E.createElement(Us.Provider,{value:l},E.createElement(Wa.Provider,{children:n,value:v}))}function zS(t){let{children:e,location:n}=t;return _S(Kl(e),n)}new Promise(()=>{});function Kl(t,e){e===void 0&&(e=[]);let n=[];return E.Children.forEach(t,(i,r)=>{if(!E.isValidElement(i))return;let s=[...e,r];if(i.type===E.Fragment){n.push.apply(n,Kl(i.props.children,s));return}i.type!==Ai&&xe(!1),!i.props.index||!i.props.children||xe(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=Kl(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const WS="6";try{window.__reactRouterVersion=WS}catch{}const qS="startTransition",uf=B0[qS];function $S(t){let{basename:e,children:n,future:i,window:r}=t,s=E.useRef();s.current==null&&(s.current=Xb({window:r,v5Compat:!0}));let o=s.current,[a,c]=E.useState({action:o.action,location:o.location}),{v7_startTransition:l}=i||{},u=E.useCallback(d=>{l&&uf?uf(()=>c(d)):c(d)},[c,l]);return E.useLayoutEffect(()=>o.listen(u),[o,u]),E.useEffect(()=>BS(i),[i]),E.createElement(VS,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:i})}var df;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(df||(df={}));var hf;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(hf||(hf={}));const hn={heygen:{apiKey:"sk_V2_hgu_kANdMI493FF_OL6Q6C8xToxmlx0rJyKceAZ7nxGuB68C",serverUrl:"https://api.heygen.com"},backend:{baseUrl:"http://localhost:8000"}},Ic="auth_token",Oc="auth_user";class KS{async parseError(e){try{const n=await e.json();return n!=null&&n.detail?Array.isArray(n.detail)?n.detail.map(i=>{const r=i.loc?i.loc.slice(1).join("."):"unknown";let s=i.msg||i.message||"validation error";if(s.includes("pattern")||s.includes("match pattern"))r==="username"?s="Username can only contain letters, numbers, spaces, hyphens, and underscores":r==="email"?s="Please enter a valid email address":s=`Invalid ${r} format`;else if(s.includes("String should have at least")){const o=s.match(/at least (\d+)/),a=o?o[1]:"minimum";r==="username"?s=`Username must be at least ${a} characters long`:r==="password"&&(s=`Password must be at least ${a} characters long`)}else if(s.includes("String should have at most")){const o=s.match(/at most (\d+)/),a=o?o[1]:"maximum";r==="username"&&(s=`Username must be at most ${a} characters long`)}return`${r==="body"?"":r.charAt(0).toUpperCase()+r.slice(1)+": "}${s}`}).join("; "):typeof n.detail=="string"?n.detail:JSON.stringify(n.detail):n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):`HTTP ${e.status}: ${e.statusText||"Error"}`}catch{return`HTTP ${e.status}: ${e.statusText||"Error"}`}}async signUp(e,n,i){try{const r=await fetch(`${hn.backend.baseUrl}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:n,password:i})});if(!r.ok){const o=await this.parseError(r);throw new Error(o||"Sign up failed")}const s=await r.json();return this.setToken(s.access_token),this.setUser(s.user),s}catch(r){throw console.error("Sign up error:",r),r}}async signIn(e,n){try{const i=await fetch(`${hn.backend.baseUrl}/api/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:n})});if(!i.ok){const s=await this.parseError(i),o=i.status===401?"Incorrect email or password (or account not found).":s||"Sign in failed";throw new Error(o)}const r=await i.json();return this.setToken(r.access_token),this.setUser(r.user),r}catch(i){throw console.error("Sign in error:",i),i}}signOut(){this.removeToken(),this.removeUser()}getUser(){const e=localStorage.getItem(Oc);return e?JSON.parse(e):null}getToken(){return localStorage.getItem(Ic)}isAuthenticated(){return!!this.getToken()}setToken(e){localStorage.setItem(Ic,e)}setUser(e){localStorage.setItem(Oc,JSON.stringify(e))}removeToken(){localStorage.removeItem(Ic)}removeUser(){localStorage.removeItem(Oc)}getAuthHeader(){const e=this.getToken();return e?{Authorization:`Bearer ${e}`}:{}}async updateProfile({username:e,currentPassword:n,newPassword:i}){const r={username:e||void 0,current_password:n||void 0,new_password:i||void 0},s=await fetch(`${hn.backend.baseUrl}/api/auth/profile`,{method:"PATCH",headers:{"Content-Type":"application/json",...this.getAuthHeader()},body:JSON.stringify(r)}),o=await s.json().catch(()=>null);if(!s.ok){const a=(o==null?void 0:o.detail)||await this.parseError(s);throw new Error(a||"Failed to update profile")}return o!=null&&o.access_token&&this.setToken(o.access_token),o!=null&&o.user&&this.setUser(o.user),o}async deleteAccount(e){const n=await fetch(`${hn.backend.baseUrl}/api/auth/profile`,{method:"DELETE",headers:{"Content-Type":"application/json",...this.getAuthHeader()},body:JSON.stringify({current_password:e})}),i=await n.json().catch(()=>null);if(!n.ok){const r=(i==null?void 0:i.detail)||await this.parseError(n);throw new Error(r||"Failed to delete account")}return this.signOut(),i}async verifyToken(){if(!this.getToken())return!1;try{const n=await fetch(`${hn.backend.baseUrl}/api/auth/me`,{headers:{...this.getAuthHeader()}});if(n.ok){const i=await n.json();return this.setUser(i),!0}else return this.signOut(),!1}catch{return this.signOut(),!1}}}const $t=new KS;function HS({isAuthenticated:t,onLogout:e}){var u,d,h,m;const n=Fs(),i=t?$t.getUser():null,[r,s]=E.useState(!1),o=E.useRef(null),a=()=>{e(),s(!1)},c=()=>{s(b=>!b)};E.useEffect(()=>{const b=v=>{o.current&&!o.current.contains(v.target)&&s(!1)};return r&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[r]);const l=((d=(u=i==null?void 0:i.username)==null?void 0:u[0])==null?void 0:d.toUpperCase())||((m=(h=i==null?void 0:i.email)==null?void 0:h[0])==null?void 0:m.toUpperCase())||"U";return k.jsx(k.Fragment,{children:k.jsx("nav",{className:"navbar",children:k.jsxs("div",{className:"navbar-container",children:[k.jsxs("div",{className:"navbar-left",children:[k.jsx("div",{className:"navbar-brand",onClick:()=>n("/"),style:{cursor:"pointer"},children:k.jsx("h1",{children:"Home"})}),t&&k.jsx("button",{className:"navbar-button navbar-button-dashboard",onClick:()=>n("/dashboard"),children:"Dashboard"})]}),k.jsx("div",{className:"navbar-menu",children:t?k.jsxs("div",{className:"navbar-user",ref:o,children:[k.jsx("button",{className:"profile-button",onClick:c,"aria-haspopup":"true","aria-expanded":r,type:"button",children:k.jsx("div",{className:"profile-avatar",children:l})}),r&&k.jsxs("div",{className:"profile-dropdown",children:[k.jsxs("div",{className:"profile-dropdown-header",children:[k.jsx("div",{className:"profile-avatar small",children:l}),k.jsxs("div",{className:"profile-info",children:[k.jsx("span",{className:"profile-name",children:(i==null?void 0:i.username)||(i==null?void 0:i.email)||"User"}),k.jsx("span",{className:"profile-email",children:i==null?void 0:i.email})]})]}),k.jsx("button",{className:"dropdown-item",type:"button",onClick:()=>{n("/settings"),s(!1)},children:"Settings"}),k.jsx("button",{className:"dropdown-item dropdown-logout",type:"button",onClick:a,children:"Logout"})]})]}):k.jsxs("div",{className:"navbar-auth",children:[k.jsx("button",{className:"navbar-button navbar-button-signin",onClick:()=>n("/signin"),children:"Sign In"}),k.jsx("button",{className:"navbar-button navbar-button-signup",onClick:()=>n("/signup"),children:"Sign Up"})]})})]})})})}function GS({avatar:t,status:e,onCancel:n}){return k.jsx("div",{className:"loading-screen",children:k.jsxs("div",{className:"loading-content",children:[k.jsx("div",{className:"loading-avatar-circle",style:{backgroundColor:t.backgroundColor},children:k.jsx("span",{className:"loading-avatar-initials",children:t.initials})}),k.jsxs("h2",{className:"loading-title",children:["Preparing Interview with ",t.name]}),k.jsx("div",{className:"loading-spinner",children:k.jsx("div",{className:"spinner-ring"})}),k.jsx("p",{className:"loading-status",children:e}),k.jsx("button",{className:"btn-cancel",onClick:n,children:"Cancel"})]})})}const Po=[{id:1,name:"Maya",fullName:"Maya - Rushed Salon Owner",role:"Owner of a busy hair and nail salon",description:"Friendly but hurried salon owner focused on Instagram-worthy aesthetics",personality:"Busy, Instagram-obsessed, cost-skeptical at first",backgroundColor:"#FF6B9D",initials:"M",imageUrl:"https://files2.heygen.ai/avatar/v3/d3370d0f86784bde8e2144d16d573dcc_55280/preview_target.webp",heygenAvatarId:"Anastasia_Chair_Sitting_public",heygenVoiceId:"e0cc82c22f414c95b1f25696c732f058"},{id:2,name:"Patricia",fullName:"Patricia - Medical Office Manager",role:"Office manager at a dental practice",description:"Detail-oriented healthcare office manager focused on patient comfort and compliance",personality:"Detail-oriented, cautious, asks about sanitation/allergies/maintenance",backgroundColor:"#4ECDC4",initials:"P",imageUrl:"https://files2.heygen.ai/avatar/v3/699a4c2995914d39b2cb311a930d7720_45570/preview_talk_3.webp",heygenAvatarId:"Ann_Doctor_Standing2_public",heygenVoiceId:"f8c69e517f424cafaecde32dde57096b"},{id:3,name:"Jennifer",fullName:"Jennifer - Corporate Receptionist",role:"Receptionist and gatekeeper at a professional office",description:"Polite but protective gatekeeper who controls access to decision makers",personality:"Tired of salespeople, initially deflects, warms up if treated respectfully",backgroundColor:"#95E1D3",initials:"J",imageUrl:"https://files2.heygen.ai/avatar/v3/89e07b826f1c4cb1a5549201cdd8f4d6_55300/preview_target.webp",heygenAvatarId:"Alessandra_Chair_Sitting_public",heygenVoiceId:"fb8c5c3f02854c57a4da182d4ed59467"},{id:4,name:"Marcus",fullName:"Marcus - Cost-Conscious Caf Owner",role:"Owner of a small caf with tight margins",description:"Pragmatic, budget-focused caf owner who compares all costs carefully",personality:'Pragmatic, immediately asks "How much?", compares everything to Costco',backgroundColor:"#F38181",initials:"M",imageUrl:"https://files2.heygen.ai/avatar/v3/7fbef4dd1d6641bc8777b26a6aaac85e_45580/preview_talk_1.webp",heygenAvatarId:"Bryan_FitnessCoach_public",heygenVoiceId:"3b4aec73277b4a3f8afd462f76da2778"},{id:5,name:"Diane",fullName:"Diane - Corporate Marketing Manager",role:"Marketing manager at a law firm",description:"Strategic, brand-focused manager who needs ROI justification",personality:"Strategic, measured, thinks ROI/client perception, needs data",backgroundColor:"#AA96DA",initials:"D",imageUrl:"https://files2.heygen.ai/avatar/v3/4e5afdfe8bdb44f3ae18b90281ab034c_45610/preview_talk_1.webp",heygenAvatarId:"Elenora_FitnessCoach2_public",heygenVoiceId:"cef3bc4e0a84424cafcde6f2cf466c97"},{id:6,name:"Rick",fullName:"Rick - Auto Dealership GM",role:"General manager of a car dealership",description:"Sales-driven, enthusiastic GM who loves customer wow-factor",personality:"Energetic, obsessed with customer wow-factor and showroom appeal",backgroundColor:"#FCBAD3",initials:"R",imageUrl:"https://files2.heygen.ai/avatar/v3/f83fffc45faa4368b6db9597e6b323ca_45590/preview_talk_3.webp",heygenAvatarId:"Dexter_Doctor_Sitting2_public",heygenVoiceId:"e0cc82c22f414c95b1f25696c732f058"},{id:7,name:"Sofia",fullName:"Sofia - Boutique Retail Owner",role:"Owner of a boutique retail store",description:"Design-focused owner who makes emotional decisions based on aesthetics",personality:"Design-focused, emotional, highly visual decisions, brand-conscious",backgroundColor:"#FFFFD2",initials:"S",imageUrl:"https://files2.heygen.ai/avatar/v3/b1ff5edbf96242e6ac9469227df40924_55360/preview_target.webp",heygenAvatarId:"Katya_Chair_Sitting_public",heygenVoiceId:"0c418eab508d4030879c0c3381433806"},{id:8,name:"Robert",fullName:"Robert - Skeptical CFO",role:"CFO focused on financial justification",description:"Analytical, numbers-focused CFO who demands clear financial value",personality:"Analytical, data-focused, questions financial value, demands ROI",backgroundColor:"#A8DADC",initials:"R",imageUrl:"https://files2.heygen.ai/avatar/v3/db2fb7fd0d044b908395a011166ab22d_45680/preview_target.webp",heygenAvatarId:"Shawn_Therapist_public",heygenVoiceId:"c4a8ceb7a2954500bc047fb092bcff3f"},{id:9,name:"Amanda",fullName:"Amanda - Hotel Manager",role:"Manager of a boutique hotel focused on guest experience",description:"Guest-obsessed hotel manager who thinks at scale and values reviews",personality:"Guest-focused, obsessed with reviews, thinks at scale",backgroundColor:"#FFB4A2",initials:"A",imageUrl:"https://files2.heygen.ai/avatar/v3/2b901b6b72c4444d81a93a2eb8fe1070_55420/preview_target.webp",heygenAvatarId:"Rika_Chair_Sitting_public",heygenVoiceId:"16a09e4706f74997ba4ed05ea11470f6"},{id:10,name:"James",fullName:"James - Multi-Location Franchise Owner",role:"Owner of 8-12 franchise locations seeking turnkey solutions",description:"Strategic multi-location owner who values consistency and hates complexity",personality:"Strategic, thinks scale, hates complexity, wants turnkey solutions",backgroundColor:"#B5EAD7",initials:"J",imageUrl:"https://files2.heygen.ai/avatar/v3/a1ed8c71e4bf4e6cb9071d2b7cd71e4e_45660/preview_talk_1.webp",heygenAvatarId:"Silas_CustomerSupport_public",heygenVoiceId:"d2f4f24783d04e22ab49ee8fdc3715e0"}];function JS(){const t=Po.find(i=>i.name==="Patricia"),e=Po.find(i=>i.name==="Rick"),n=Po.find(i=>i.name==="Sofia");return k.jsxs("div",{className:"landing-page",children:[k.jsx("div",{className:"landing-hero",children:k.jsx("div",{className:"landing-container",children:k.jsxs("div",{className:"landing-content",children:[k.jsx("h1",{className:"landing-title",children:"Floral Image"}),k.jsx("h2",{className:"landing-subtitle",children:"Sustainable, Lifelike Floral Arrangements for Your Business"}),k.jsx("p",{className:"landing-description",children:"Transform your space with our handmade, sustainable flower arrangements. Experience the beauty of fresh flowers without the mess, allergies, or high costs. Join over 45,000 businesses worldwide who trust Floral Image."}),k.jsxs("div",{className:"landing-features",children:[k.jsxs("div",{className:"feature-card",children:[k.jsx("div",{className:"feature-icon",children:t&&k.jsx("img",{src:t.imageUrl,alt:t.fullName,className:"feature-avatar-image"})}),k.jsx("h3",{children:"Sustainable"}),k.jsx("p",{children:"80 times more sustainable than fresh cut flowers over a 5-year period"})]}),k.jsxs("div",{className:"feature-card",children:[k.jsx("div",{className:"feature-icon",children:e&&k.jsx("img",{src:e.imageUrl,alt:e.fullName,className:"feature-avatar-image"})}),k.jsx("h3",{children:"Monthly Refresh"}),k.jsx("p",{children:"New arrangements delivered monthly - always fresh, always beautiful"})]}),k.jsxs("div",{className:"feature-card",children:[k.jsx("div",{className:"feature-icon",children:n&&k.jsx("img",{src:n.imageUrl,alt:n.fullName,className:"feature-avatar-image"})}),k.jsx("h3",{children:"No Contracts"}),k.jsx("p",{children:"Flexible month-to-month service - cancel anytime, no commitments"})]})]}),k.jsxs("div",{className:"landing-benefits",children:[k.jsxs("div",{className:"benefit-item",children:[k.jsx("span",{className:"benefit-icon",children:""}),k.jsx("span",{className:"benefit-text",children:"No allergies, no mess, no water"})]}),k.jsxs("div",{className:"benefit-item",children:[k.jsx("span",{className:"benefit-icon",children:""}),k.jsx("span",{className:"benefit-text",children:"Significant cost savings vs. fresh flowers"})]}),k.jsxs("div",{className:"benefit-item",children:[k.jsx("span",{className:"benefit-icon",children:""}),k.jsx("span",{className:"benefit-text",children:"Creates positive conversations with clients"})]}),k.jsxs("div",{className:"benefit-item",children:[k.jsx("span",{className:"benefit-icon",children:""}),k.jsx("span",{className:"benefit-text",children:"Monthly refresh service included"})]})]})]})})}),k.jsx("div",{className:"landing-footer",children:k.jsxs("div",{className:"landing-container",children:[k.jsx("p",{children:" 2024 Floral Image. All rights reserved."}),k.jsx("p",{className:"footer-tagline",children:"Handmade  Sustainable  Lifelike"})]})})]})}function QS({onAvatarSelect:t,backendReady:e}){const[n,i]=E.useState(null),[r,s]=E.useState({x:0,y:0,showBelow:!1}),o=(c,l)=>{const u=l.currentTarget.getBoundingClientRect(),d=c.id<=5,h=u.top,b=d||h<350;s({x:u.left+u.width/2,y:b?u.bottom:u.top,showBelow:b}),i(c)},a=()=>{i(null)};return k.jsxs("div",{className:"avatar-grid-container",children:[k.jsx("h1",{className:"grid-title",children:"Select Your Interview Customer"}),k.jsx("p",{className:"grid-subtitle",children:"Choose one of 10 AI customer personas to practice your sales pitch"}),!e&&k.jsxs("div",{className:"backend-notice",children:[k.jsx("div",{className:"notice-icon",children:""}),k.jsx("p",{children:"Initializing backend AI agents... Please wait"})]}),k.jsx("div",{className:"avatar-grid",children:Po.map(c=>k.jsxs("div",{className:"avatar-card",onMouseEnter:l=>o(c,l),onMouseLeave:a,onClick:()=>t(c),children:[k.jsx("div",{className:"avatar-image-container",children:k.jsx("img",{src:c.imageUrl,alt:c.name,className:"avatar-image",loading:"lazy"})}),k.jsx("div",{className:"avatar-name",children:c.name}),k.jsx("div",{className:"avatar-role-short",children:c.role.split(" ").slice(0,3).join(" ")})]},c.id))}),n&&k.jsxs("div",{className:`avatar-modal ${r.showBelow?"modal-below":"modal-above"}`,style:{left:`${r.x}px`,top:`${r.y}px`},children:[k.jsxs("div",{className:"modal-header",children:[k.jsx("div",{className:"modal-avatar-image-container",children:k.jsx("img",{src:n.imageUrl,alt:n.name,className:"modal-avatar-image"})}),k.jsxs("div",{children:[k.jsx("h3",{className:"modal-name",children:n.fullName}),k.jsx("p",{className:"modal-role",children:n.role})]})]}),k.jsxs("div",{className:"modal-content",children:[k.jsxs("div",{className:"modal-section",children:[k.jsx("strong",{children:"Description:"}),k.jsx("p",{children:n.description})]}),k.jsxs("div",{className:"modal-section",children:[k.jsx("strong",{children:"Personality:"}),k.jsx("p",{children:n.personality})]})]}),k.jsx("div",{className:"modal-footer",children:k.jsx("p",{children:"Click to start interview"})})]})]})}function YS({onAvatarSelect:t,backendReady:e}){return k.jsx("div",{className:"dashboard",children:k.jsx("div",{className:"dashboard-container",children:k.jsx("div",{className:"dashboard-content",children:k.jsx(QS,{onAvatarSelect:t,backendReady:e})})})})}function XS({onSuccess:t,onSwitchToSignup:e}){const n=Fs(),[i,r]=E.useState(""),[s,o]=E.useState(""),[a,c]=E.useState(""),[l,u]=E.useState(!1),d=async m=>{m.preventDefault(),c(""),u(!0);try{await $t.signIn(i,s),t?t():n("/dashboard")}catch(b){let v="Failed to sign in. Please check your credentials (account may not exist).";b instanceof Error?v=b.message||v:typeof b=="string"?v=b:b&&typeof b=="object"&&(v=b.message||b.detail||JSON.stringify(b)),c(v)}finally{u(!1)}},h=()=>{e?e():n("/signup")};return k.jsx("div",{className:"auth-page",children:k.jsx("div",{className:"auth-container",children:k.jsxs("div",{className:"auth-card",children:[k.jsx("h2",{children:"Sign In"}),k.jsx("p",{className:"auth-subtitle",children:"Welcome back! Please sign in to continue."}),a&&k.jsx("div",{className:"auth-error",children:a}),k.jsxs("form",{onSubmit:d,className:"auth-form",children:[k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"email",children:"Email"}),k.jsx("input",{type:"email",id:"email",value:i,onChange:m=>r(m.target.value),required:!0,placeholder:"your.email@example.com",disabled:l})]}),k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"password",children:"Password"}),k.jsx("input",{type:"password",id:"password",value:s,onChange:m=>o(m.target.value),required:!0,placeholder:"Enter your password",disabled:l})]}),k.jsx("button",{type:"submit",className:"auth-button",disabled:l,children:l?"Signing in...":"Sign In"})]}),k.jsx("div",{className:"auth-switch",children:k.jsxs("p",{children:[" Don't have an account?"," ",k.jsx("button",{type:"button",onClick:h,className:"auth-link-button",children:"Sign Up"})]})})]})})})}function ZS({onSuccess:t,onSwitchToLogin:e}){const n=Fs(),[i,r]=E.useState(""),[s,o]=E.useState(""),[a,c]=E.useState(""),[l,u]=E.useState(""),[d,h]=E.useState(""),[m,b]=E.useState(!1),v=async p=>{if(p.preventDefault(),h(""),s.trim().length<3){h("Username must be at least 3 characters long");return}if(s.trim().length>50){h("Username must be at most 50 characters long");return}if(a!==l){h("Passwords do not match");return}if(a.length<8){h("Password must be at least 8 characters long");return}b(!0);try{await $t.signUp(i,s,a),t?t():n("/dashboard")}catch(g){let S="Failed to sign up. Please try again.";g instanceof Error?S=g.message||S:typeof g=="string"?S=g:g&&typeof g=="object"&&(S=g.message||g.detail||JSON.stringify(g)),h(S)}finally{b(!1)}},w=()=>{e?e():n("/signin")};return k.jsx("div",{className:"auth-page",children:k.jsx("div",{className:"auth-container",children:k.jsxs("div",{className:"auth-card",children:[k.jsx("h2",{children:"Sign Up"}),k.jsx("p",{className:"auth-subtitle",children:"Create an account to get started."}),d&&k.jsx("div",{className:"auth-error",children:d}),k.jsxs("form",{onSubmit:v,className:"auth-form",children:[k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"email",children:"Email"}),k.jsx("input",{type:"email",id:"email",value:i,onChange:p=>r(p.target.value),required:!0,placeholder:"your.email@example.com",disabled:m})]}),k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"username",children:"Username"}),k.jsx("input",{type:"text",id:"username",value:s,onChange:p=>o(p.target.value),required:!0,placeholder:"Choose a username",disabled:m})]}),k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"password",children:"Password"}),k.jsx("input",{type:"password",id:"password",value:a,onChange:p=>c(p.target.value),required:!0,placeholder:"At least 8 characters",disabled:m})]}),k.jsxs("div",{className:"auth-field",children:[k.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),k.jsx("input",{type:"password",id:"confirmPassword",value:l,onChange:p=>u(p.target.value),required:!0,placeholder:"Confirm your password",disabled:m})]}),k.jsx("button",{type:"submit",className:"auth-button",disabled:m,children:m?"Creating account...":"Sign Up"})]}),k.jsx("div",{className:"auth-switch",children:k.jsxs("p",{children:["Already have an account?"," ",k.jsx("button",{type:"button",onClick:w,className:"auth-link-button",children:"Sign In"})]})})]})})})}function eT({onLogout:t}){const e=$t.getUser(),[n,i]=E.useState((e==null?void 0:e.username)||""),[r,s]=E.useState(""),[o,a]=E.useState(""),[c,l]=E.useState(""),[u,d]=E.useState(null),[h,m]=E.useState(null),[b,v]=E.useState(!1),[w,p]=E.useState(!1),g=async f=>{if(f.preventDefault(),d(null),m(null),v(!0),o&&o.length<6){m("Password length must be at least 6 letters."),v(!1);return}try{await $t.updateProfile({username:n.trim(),currentPassword:r||void 0,newPassword:o||void 0}),d("Profile updated successfully."),s(""),a("")}catch(y){m(y.message||"Failed to update profile.")}finally{v(!1)}},S=async f=>{f.preventDefault(),d(null),m(null),p(!0);try{await $t.deleteAccount(c),d("Account deleted. You will be signed out."),t&&t()}catch(y){m(y.message||"Failed to delete account.")}finally{l(""),p(!1)}};return k.jsx("div",{className:"profile-settings",children:k.jsxs("div",{className:"profile-card",children:[k.jsx("h1",{children:"Account Settings"}),k.jsx("p",{className:"profile-subtitle",children:"Update your name or password, or delete your account."}),k.jsxs("form",{className:"profile-form",onSubmit:g,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{htmlFor:"username",children:"Name"}),k.jsx("input",{id:"username",type:"text",value:n,onChange:f=>i(f.target.value),placeholder:"Your display name",required:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{htmlFor:"currentPassword",children:"Current Password (required to change password)"}),k.jsx("input",{id:"currentPassword",type:"password",value:r,onChange:f=>s(f.target.value),placeholder:"Enter current password"})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{htmlFor:"newPassword",children:"New Password (optional)"}),k.jsx("input",{id:"newPassword",type:"password",value:o,onChange:f=>a(f.target.value),placeholder:"Enter new password"})]}),k.jsx("button",{type:"submit",className:"btn-primary",disabled:b,children:b?"Saving...":"Save Changes"})]}),k.jsxs("div",{className:"danger-zone",children:[k.jsx("h2",{children:"Danger Zone"}),k.jsx("p",{children:"Delete your account permanently. This cannot be undone."}),k.jsxs("form",{className:"profile-form",onSubmit:S,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{htmlFor:"deletePassword",children:"Confirm with current password"}),k.jsx("input",{id:"deletePassword",type:"password",value:c,onChange:f=>l(f.target.value),placeholder:"Enter current password",required:!0})]}),k.jsx("button",{type:"submit",className:"btn-danger",disabled:w,children:w?"Deleting...":"Delete Account"})]})]}),u&&k.jsx("div",{className:"status success",children:u}),h&&k.jsx("div",{className:"status error",children:h})]})})}function tT(){const[t,e]=E.useState(null),[n,i]=E.useState(null),[r,s]=E.useState(!1),o=E.useRef(null),a=E.useCallback(async()=>{try{const l=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!1});e(l),s(!0),i(null),o.current&&(o.current.srcObject=l)}catch(l){i(l.message||"Failed to access webcam"),s(!1)}},[]),c=E.useCallback(()=>{t&&(t.getTracks().forEach(l=>l.stop()),e(null),s(!1),o.current&&(o.current.srcObject=null))},[t]);return E.useEffect(()=>{o.current&&t&&(o.current.srcObject=t)},[t]),E.useEffect(()=>()=>{t&&t.getTracks().forEach(l=>l.stop())},[t]),{stream:t,error:n,isActive:r,videoRef:o,startWebcam:a,stopWebcam:c}}var ff={};function nT(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var iT=Object.defineProperty,rT=(t,e,n)=>e in t?iT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pf=(t,e,n)=>rT(t,typeof e!="symbol"?e+"":e,n);class Xe{constructor(){pf(this,"_locking"),pf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function be(t,e){if(!t)throw new Error(e)}const sT=34028234663852886e22,oT=-34028234663852886e22,aT=4294967295,cT=2147483647,lT=-2147483648;function _o(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>cT||t<lT)throw new Error("invalid int 32: "+t)}function Hl(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>aT||t<0)throw new Error("invalid uint 32: "+t)}function ov(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>sT||t<oT))throw new Error("invalid float 32: "+t)}const av=Symbol("@bufbuild/protobuf/enum-type");function uT(t){const e=t[av];return be(e,"missing enum type on enum object"),e}function cv(t,e,n,i){t[av]=lv(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function lv(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=uv(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function dT(t,e,n){const i={};for(const r of e){const s=uv(r);i[s.localName]=s.no,i[s.no]=s.localName}return cv(i,t,e),i}function uv(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class kd{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function hT(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new kd),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function fT(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Nc(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const xo=4294967296;function mf(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=xo&&(r=r+(i/xo|0),i=i%xo)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?hv(i,r):bd(i,r)}function pT(t,e){let n=bd(t,e);const i=n.hi&2147483648;i&&(n=hv(n.lo,n.hi));const r=dv(n.lo,n.hi);return i?"-"+r:r}function dv(t,e){if({lo:t,hi:e}=mT(t,e),e<=2097151)return String(xo*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+gf(o)+gf(s)}function mT(t,e){return{lo:t>>>0,hi:e>>>0}}function bd(t,e){return{lo:t|0,hi:e|0}}function hv(t,e){return e=~e,t?t=~t+1:e+=1,bd(t,e)}const gf=t=>{const e=String(t);return"0000000".slice(e.length)+e};function vf(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function gT(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function vT(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof ff!="object"||ff.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>be(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>be(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),mf(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),mf(r)},dec(r,s){return pT(r,s)},uDec(r,s){return dv(r,s)}}}const fe=vT();var L;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(L||(L={}));var ei;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(ei||(ei={}));function Rn(t,e,n){if(e===n)return!0;if(t==L.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return e==n}return!1}function yr(t,e){switch(t){case L.BOOL:return!1;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return e==0?fe.zero:"0";case L.DOUBLE:case L.FLOAT:return 0;case L.BYTES:return new Uint8Array(0);case L.STRING:return"";default:return 0}}function fv(t,e){switch(t){case L.BOOL:return e===!1;case L.STRING:return e==="";case L.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var we;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(we||(we={}));class yT{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Hl(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return _o(e),vf(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){ov(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Hl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){_o(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return _o(e),e=(e<<1^e>>31)>>>0,vf(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=fe.enc(e);return Nc(n.lo,n.hi,this.buf),this}sint64(e){let n=fe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Nc(r,s,this.buf),this}uint64(e){let n=fe.uEnc(e);return Nc(n.lo,n.hi,this.buf),this}}class kT{constructor(e,n){this.varint64=fT,this.uint32=gT,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case we.Varint:for(;this.buf[this.pos++]&128;);break;case we.Bit64:this.pos+=4;case we.Bit32:this.pos+=4;break;case we.LengthDelimited:let r=this.uint32();this.pos+=r;break;case we.StartGroup:for(;;){const[s,o]=this.tag();if(o===we.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return fe.dec(...this.varint64())}uint64(){return fe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,fe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return fe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return fe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function bT(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function pv(t){const e=t.field.localName,n=Object.create(null);return n[e]=ST(t),[n,()=>n[e]]}function ST(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return yr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function TT(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let fn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),qa=[];for(let t=0;t<fn.length;t++)qa[fn[t].charCodeAt(0)]=t;qa[45]=fn.indexOf("+");qa[95]=fn.indexOf("/");const mv={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=qa[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=fn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=fn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=fn[r|i>>6],e+=fn[i&63],n=0;break}return n&&(e+=fn[r],e+="=",n==1&&(e+="=")),e}};function CT(t,e,n){vv(e,t);const i=e.runtime.bin.makeReadOptions(n),r=TT(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=pv(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function wT(t,e,n,i){vv(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(gv(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function gv(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function vv(t,e){be(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function yv(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!fv(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function yf(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?yr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function pn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(kd.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function kv(t,e){return pn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}L.DOUBLE,L.FLOAT,L.INT64,L.UINT64,L.INT32,L.UINT32,L.BOOL,L.STRING,L.BYTES;const kf={ignoreUnknownFields:!1},bf={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function ET(t){return t?Object.assign(Object.assign({},kf),t):kf}function PT(t){return t?Object.assign(Object.assign({},bf),t):bf}const da=Symbol(),Ro=Symbol();function _T(){return{makeReadOptions:ET,makeWriteOptions:PT,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Xt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}Sf(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=pv(u);Sf(d,a,u.field,n,u),wT(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!yv(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!RT(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Tf(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&gv(t,a)){const c=CT(t,a,e),l=Tf(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return rs(t,e,n??ei.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||fv(t,e)))return Io(t,e)},debug:Xt}}function Xt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Sf(t,e,n,i,r){let s=n.localName;if(n.repeated){if(be(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Dc(n.T,a,i.ignoreUnknownFields,!0);c!==Ro&&o.push(c);break;case"scalar":try{o.push(rs(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=xT(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Dc(n.V.T,c,i.ignoreUnknownFields,!0);u!==Ro&&(o[l]=u);break;case"scalar":try{o[l]=rs(n.V.T,c,ei.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];pn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Dc(n.T,e,i.ignoreUnknownFields,!1);switch(c){case da:yf(n,t);break;case Ro:break;default:t[s]=c;break}break;case"scalar":try{const l=rs(n.T,e,n.L,!1);switch(l){case da:yf(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xt(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function xT(t,e){if(t===L.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return rs(t,e,ei.BIGINT,!0).toString()}function rs(t,e,n,i){if(e===null)return i?yr(t,n):da;switch(t){case L.DOUBLE:case L.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==L.FLOAT&&ov(r),r;case L.INT32:case L.FIXED32:case L.SFIXED32:case L.SINT32:case L.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==L.UINT32||t==L.FIXED32?Hl(s):_o(s),s;case L.INT64:case L.SFIXED64:case L.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=fe.parse(e);return n?o.toString():o;case L.FIXED64:case L.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=fe.uParse(e);return n?a.toString():a;case L.BOOL:if(typeof e!="boolean")break;return e;case L.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case L.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return mv.dec(e)}throw new Error}function Dc(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:da;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Ro;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Xt(e)))}function RT(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Tf(t,e,n){if(t.kind=="map"){be(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Io(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Mc(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){be(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Io(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Mc(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Io(t.T,e);case"enum":return Mc(t.T,e,n.enumAsInteger);case"message":return kv(t.T,e).toJson(n)}}function Mc(t,e,n){var i;if(be(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Io(t,e){switch(t){case L.INT32:case L.SFIXED32:case L.SINT32:case L.FIXED32:case L.UINT32:return be(typeof e=="number"),e;case L.FLOAT:case L.DOUBLE:return be(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case L.STRING:return be(typeof e=="string"),e;case L.BOOL:return be(typeof e=="boolean"),e;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return be(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case L.BYTES:return be(e instanceof Uint8Array),mv.enc(e)}}const Di=Symbol("@bufbuild/protobuf/unknown-fields"),Cf={readUnknownFields:!0,readerFactory:t=>new kT(t)},wf={writeUnknownFields:!0,writerFactory:()=>new yT};function IT(t){return t?Object.assign(Object.assign({},Cf),t):Cf}function OT(t){return t?Object.assign(Object.assign({},wf),t):wf}function NT(){return{makeReadOptions:IT,makeWriteOptions:OT,listUnknownFields(t){var e;return(e=t[Di])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Di]},writeUnknownFields(t,e){const i=t[Di];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Di])||(r[Di]=[]),r[Di].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==we.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Ef(t,e,l,c,i)}if(r&&(c!=we.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Ef,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!yv(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Pf(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Pf(t,e,n,i)}}}function Ef(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?L.INT32:n.T;let c=ha;if(n.kind=="scalar"&&n.L>0&&(c=MT),s){let h=t[o];if(i==we.LengthDelimited&&a!=L.STRING&&a!=L.BYTES){let b=e.uint32()+e.pos;for(;e.pos<b;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(Oo(e,new l,r,n)):pn(t[o])?Oo(e,t[o],r,n):(t[o]=Oo(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=DT(n,e,r);t[o][u]=d;break}}function Oo(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function DT(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=ha(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=ha(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Oo(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=yr(t.K,ei.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=yr(t.V.T,ei.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function MT(t,e){const n=ha(t,e);return typeof n=="bigint"?n.toString():n}function ha(t,e){switch(e){case L.STRING:return t.string();case L.BOOL:return t.bool();case L.DOUBLE:return t.double();case L.FLOAT:return t.float();case L.INT32:return t.int32();case L.INT64:return t.int64();case L.UINT64:return t.uint64();case L.FIXED64:return t.fixed64();case L.BYTES:return t.bytes();case L.FIXED32:return t.fixed32();case L.SFIXED32:return t.sfixed32();case L.SFIXED64:return t.sfixed64();case L.SINT64:return t.sint64();case L.UINT32:return t.uint32();case L.SINT32:return t.sint32()}}function Pf(t,e,n,i){be(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?L.INT32:t.T;if(r)if(be(Array.isArray(e)),t.packed)LT(n,s,t.no,e);else for(const o of e)ss(n,s,t.no,o);else ss(n,s,t.no,e);break;case"message":if(r){be(Array.isArray(e));for(const o of e)_f(n,i,t,o)}else _f(n,i,t,e);break;case"map":be(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))AT(n,i,t,o,a);break}}function AT(t,e,n,i,r){t.tag(n.no,we.LengthDelimited),t.fork();let s=i;switch(n.K){case L.INT32:case L.FIXED32:case L.UINT32:case L.SFIXED32:case L.SINT32:s=Number.parseInt(i);break;case L.BOOL:be(i=="true"||i=="false"),s=i=="true";break}switch(ss(t,n.K,1,s),n.V.kind){case"scalar":ss(t,n.V.T,2,r);break;case"enum":ss(t,L.INT32,2,r);break;case"message":be(r!==void 0),t.tag(2,we.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function _f(t,e,n,i){const r=kv(n.T,i);n.delimited?t.tag(n.no,we.StartGroup).raw(r.toBinary(e)).tag(n.no,we.EndGroup):t.tag(n.no,we.LengthDelimited).bytes(r.toBinary(e))}function ss(t,e,n,i){be(i!==void 0);let[r,s]=bv(e);t.tag(n,r)[s](i)}function LT(t,e,n,i){if(!i.length)return;t.tag(n,we.LengthDelimited).fork();let[,r]=bv(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function bv(t){let e=we.Varint;switch(t){case L.BYTES:case L.STRING:e=we.LengthDelimited;break;case L.DOUBLE:case L.FIXED64:case L.SFIXED64:e=we.Bit64;break;case L.FIXED32:case L.SFIXED32:case L.FLOAT:e=we.Bit32;break}const n=L[t].toLowerCase();return[e,n]}function UT(){return{setEnumType:cv,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!pn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===L.BYTES&&(l=Lr(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===L.BYTES&&(u=i.repeated?u.map(Lr):Lr(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===L.BYTES)for(const[m,b]of Object.entries(o[r]))s[r][m]=Lr(b);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const m of Object.keys(o[r])){let b=o[r][m];h.fieldWrapper||(b=new h(b)),s[r][m]=b}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>pn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=Lr(h):s[r]=h:s[r]=pn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Rn(i.T,o,s[a]));case"enum":return r.every((o,a)=>Rn(L.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!pn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!pn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Rn(L.INT32,r,s);case"scalar":return Rn(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return Rn(L.INT32,r.value,s.value);case"scalar":return Rn(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>Rn(L.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>Rn(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(lo);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=lo(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:lo(s.value)}:{case:void 0}:o=lo(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function lo(t){if(t===void 0)return t;if(pn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Lr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function jT(t,e,n){return{syntax:t,json:_T(),bin:NT(),util:Object.assign(Object.assign({},UT()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return hT(this,i,r,s)},makeEnum:dT,makeEnumType:lv,getEnumType:uT,makeExtension(i,r,s){return bT(this,i,r,s)}}}class FT{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Sv(t,e){const n=Tv(t);return e?n:$T(qT(n))}function BT(t){return Sv(t,!1)}const VT=Tv;function Tv(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const zT=new Set(["constructor","toString","toJSON","valueOf"]),WT=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Cv=t=>"".concat(t,"$"),qT=t=>WT.has(t)?Cv(t):t,$T=t=>zT.has(t)?Cv(t):t;class KT{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=BT(e)}addField(e){be(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function HT(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=Sv(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:VT(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:ei.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=L.BYTES&&u.T!=L.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new KT(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const _=jT("proto3",t=>new FT(t,e=>HT(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=yr(e.T,e.L);break}}});class ot extends kd{constructor(e){super(),this.seconds=fe.zero,this.nanos=0,_.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(_.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=fe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ot.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new ot({seconds:fe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new ot().fromBinary(e,n)}static fromJson(e,n){return new ot().fromJson(e,n)}static fromJsonString(e,n){return new ot().fromJsonString(e,n)}static equals(e,n){return _.util.equals(ot,e,n)}}ot.runtime=_;ot.typeName="google.protobuf.Timestamp";ot.fields=_.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const GT=_.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ot},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:JT,repeated:!0},{no:5,name:"events",kind:"message",T:YT,repeated:!0}]),JT=_.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:QT,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),QT=_.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ot},{no:3,name:"value",kind:"scalar",T:2}]),YT=_.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ot},{no:7,name:"normalized_end_timestamp",kind:"message",T:ot,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),wv=_.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ft=_.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Pe=_.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Sd=_.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Kr=_.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),_s=_.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),zt=_.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),li=_.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),XT=_.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ae=_.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),$a=_.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:fa,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Uv}]),fa=_.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ZT=_.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:_.getEnumType(Pe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),wi=_.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(ir)},{no:4,name:"tracks",kind:"message",T:Gi,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ZT},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:_.getEnumType(Ei)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:_.getEnumType(zt)},{no:18,name:"kind_details",kind:"enum",T:_.getEnumType(eC),repeated:!0}]),ir=_.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ei=_.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),eC=_.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Oe=_.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),tC=_.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Jn,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(Ev)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Gi=_.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:_.getEnumType(Ft)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:_.getEnumType(Pe)},{no:10,name:"layers",kind:"message",T:Jn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:tC,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:_.getEnumType(Oe)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Uv},{no:19,name:"audio_features",kind:"enum",T:_.getEnumType(Ae),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(wv)}]),Jn=_.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(Sd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ev=_.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Qe=_.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:_.getEnumType(X)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Td,oneof:"value"},{no:3,name:"speaker",kind:"message",T:nC,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Rv,oneof:"value"},{no:7,name:"transcription",kind:"message",T:iC,oneof:"value"},{no:8,name:"metrics",kind:"message",T:GT,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:pa,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Cd,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:wd,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ed,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ma,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:ga,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:va,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Pv,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),X=_.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Pv=_.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:_.getEnumType(Oe)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),_v=_.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Td,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:pa,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Cd,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:wd,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Ed,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:ma,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:ga,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:va,oneof:"value"}]),nC=_.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:xv,repeated:!0}]),xv=_.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Td=_.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Rv=_.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),iC=_.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:rC,repeated:!0}]),rC=_.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),pa=_.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Cd=_.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),wd=_.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Ed=_.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Iv,oneof:"value"}]),Iv=_.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Ov=_.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Nv=_.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:_.getEnumType(Dv)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Dv=_.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Mv=_.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:_.getEnumType(Av)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Av=_.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Lv=_.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:xf},{no:2,name:"screen",kind:"message",T:xf},{no:3,name:"resume_connection",kind:"enum",T:_.getEnumType(_s)},{no:4,name:"disabled_codecs",kind:"message",T:sC},{no:5,name:"force_relay",kind:"enum",T:_.getEnumType(_s)}]),xf=_.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:_.getEnumType(_s)}]),sC=_.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:fa,repeated:!0},{no:2,name:"publish",kind:"message",T:fa,repeated:!0}]),Uv=_.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Gl=_.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),jv=_.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:_.getEnumType(Gl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Fv=_.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ma=_.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:_.getEnumType(Oe)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:jv,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Fv,oneof:"content_header"}],{localName:"DataStream_Header"}),ga=_.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),va=_.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),oC=_.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Bt=_.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Jl=_.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),aC=_.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),cC=_.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ti,oneof:"message"},{no:2,name:"answer",kind:"message",T:ti,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Ka,oneof:"message"},{no:4,name:"add_track",kind:"message",T:xs,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ha,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Ga,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Bv,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ja,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:zv,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:$v,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Id,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Jt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:xd,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Gv,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:_d,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Vv,oneof:"message"}]),Rf=_.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:lC,oneof:"message"},{no:2,name:"answer",kind:"message",T:ti,oneof:"message"},{no:3,name:"offer",kind:"message",T:ti,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Ka,oneof:"message"},{no:5,name:"update",kind:"message",T:hC,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Pd,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ja,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ha,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:fC,oneof:"message"},{no:11,name:"room_update",kind:"message",T:pC,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:gC,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:yC,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:bC,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:TC,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:dC,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:uC,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:wC,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:_C,oneof:"message"},{no:22,name:"request_response",kind:"message",T:xC,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:RC,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:CC,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:DC,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:SC,oneof:"message"}]),Ql=_.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Jn,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(Ev)}]),xs=_.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:_.getEnumType(Ft)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:_.getEnumType(Pe)},{no:9,name:"layers",kind:"message",T:Jn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ql,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:_.getEnumType(Oe)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(wv)},{no:17,name:"audio_features",kind:"enum",T:_.getEnumType(Ae),repeated:!0}]),Ka=_.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:_.getEnumType(Bt)},{no:3,name:"final",kind:"scalar",T:8}]),Ha=_.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),lC=_.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:$a},{no:2,name:"participant",kind:"message",T:wi},{no:3,name:"other_participants",kind:"message",T:wi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Wv,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Lv},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Nv},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:fa,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),uC=_.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Wv,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Lv},{no:3,name:"server_info",kind:"message",T:Nv},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Pd=_.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Gi}]),dC=_.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ti=_.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),hC=_.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:wi,repeated:!0}]),Ga=_.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ov,repeated:!0}]),Bv=_.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:_.getEnumType(Sd)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),_d=_.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:_.getEnumType(Ae),repeated:!0}]),Vv=_.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ja=_.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:_.getEnumType(zt)},{no:3,name:"action",kind:"enum",T:_.getEnumType(rr)},{no:4,name:"regions",kind:"message",T:EC}]),rr=_.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),zv=_.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Jn,repeated:!0}]),xd=_.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Wv=_.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),fC=_.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:xv,repeated:!0}]),pC=_.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:$a}]),mC=_.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:_.getEnumType(Kr)},{no:3,name:"score",kind:"scalar",T:2}]),gC=_.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:mC,repeated:!0}]),vC=_.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(Jl)}]),yC=_.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:vC,repeated:!0}]),Rd=_.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(Sd)},{no:2,name:"enabled",kind:"scalar",T:8}]),kC=_.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Rd,repeated:!0}]),bC=_.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Rd,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:kC,repeated:!0}]),SC=_.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:oC,repeated:!0}]),qv=_.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),$v=_.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:qv,repeated:!0}]),TC=_.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),CC=_.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:$a},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:wi},{no:4,name:"other_participants",kind:"message",T:wi,repeated:!0}]),Id=_.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ti},{no:2,name:"subscription",kind:"message",T:Ga},{no:3,name:"publish_tracks",kind:"message",T:Pd,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Hv,repeated:!0},{no:5,name:"offer",kind:"message",T:ti},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Kv,repeated:!0}]),Kv=_.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Hv=_.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:_.getEnumType(Bt)}]),Jt=_.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:_.getEnumType(aC),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Gv=_.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),wC=_.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),EC=_.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:PC,repeated:!0}]),PC=_.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),_C=_.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:_.getEnumType(XT)}]),xC=_.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:_.getEnumType(Od)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Ka,oneof:"request"},{no:5,name:"add_track",kind:"message",T:xs,oneof:"request"},{no:6,name:"mute",kind:"message",T:Ha,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:xd,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:_d,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Vv,oneof:"request"}]),Od=_.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),RC=_.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Jv=_.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),IC=_.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Mv},{no:2,name:"connection_settings",kind:"message",T:Jv},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:xs,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:ti},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:_.getEnumType(li)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Id}]),OC=_.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:_.getEnumType(NC)},{no:2,name:"join_request",kind:"scalar",T:12}]),NC=_.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),DC=_.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function MC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var No={exports:{}},AC=No.exports,If;function LC(){return If||(If=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(AC,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var p=v[w];if(typeof p.bind=="function")return p.bind(v);try{return Function.prototype.bind.call(p,v)}catch{return function(){return Function.prototype.apply.apply(p,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),w=0;w<r.length;w++){var p=r[w];this[p]=w<v?e:this.methodFactory(p,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function h(v,w,p){return l(v)||d.apply(this,arguments)}function m(v,w){var p=this,g,S,f,y="loglevel";typeof v=="string"?y+=":"+v:typeof v=="symbol"&&(y=void 0);function C(O){var z=(r[O]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=z;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+z+";"}catch{}}}function P(){var O;if(!(typeof window===n||!y)){try{O=window.localStorage[y]}catch{}if(typeof O===n)try{var z=window.document.cookie,V=encodeURIComponent(y),Te=z.indexOf(V+"=");Te!==-1&&(O=/^([^;]+)/.exec(z.slice(Te+V.length+1))[1])}catch{}return p.levels[O]===void 0&&(O=void 0),O}}function x(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(O){var z=O;if(typeof z=="string"&&p.levels[z.toUpperCase()]!==void 0&&(z=p.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=p.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+O)}p.name=v,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=w||h,p.getLevel=function(){return f??S??g},p.setLevel=function(O,z){return f=N(O),z!==!1&&C(f),u.call(p)},p.setDefaultLevel=function(O){S=N(O),P()||p.setLevel(O,!1)},p.resetLevel=function(){f=null,x(),u.call(p)},p.enableAll=function(O){p.setLevel(p.levels.TRACE,O)},p.disableAll=function(O){p.setLevel(p.levels.SILENT,O)},p.rebuild=function(){if(o!==p&&(g=N(o.getLevel())),u.call(p),o===p)for(var O in s)s[O].rebuild()},g=N(o?o.getLevel():"WARN");var R=P();R!=null&&(f=N(R)),u.call(p)}o=new m,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var p=s[w];return p||(p=s[w]=new m(w,o.methodFactory)),p};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return s},o.default=o,o})}(No)),No.exports}var Qa=LC(),Yl;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Yl||(Yl={}));var Ht;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Ht||(Ht={}));let Y=Qa.getLogger("livekit");Object.values(Ht).map(t=>Qa.getLogger(t));Y.setDefaultLevel(Yl.info);function wn(t){const e=Qa.getLogger(t);return e.setDefaultLevel(Y.getLevel()),e}const UC=Qa.getLogger("lk-e2ee"),Ur=7e3,jC=[0,300,2*2*300,3*3*300,4*4*300,Ur,Ur,Ur,Ur,Ur];class FC{constructor(e){this._retryDelays=e!==void 0?[...e]:jC}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function BC(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function T(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Of(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function mn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Of=="function"?Of(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var uo={exports:{}},Nf;function VC(){if(Nf)return uo.exports;Nf=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(y,C,P){return Function.prototype.apply.call(y,C,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:n=function(y){return Object.getOwnPropertyNames(y)};function i(f){console&&console.warn&&console.warn(f)}var r=Number.isNaN||function(y){return y!==y};function s(){s.init.call(this)}uo.exports=s,uo.exports.once=p,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(f){if(typeof f!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(f){if(typeof f!="number"||f<0||r(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");o=f}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function c(f){return f._maxListeners===void 0?s.defaultMaxListeners:f._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(y){for(var C=[],P=1;P<arguments.length;P++)C.push(arguments[P]);var x=y==="error",N=this._events;if(N!==void 0)x=x&&N.error===void 0;else if(!x)return!1;if(x){var R;if(C.length>0&&(R=C[0]),R instanceof Error)throw R;var O=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw O.context=R,O}var z=N[y];if(z===void 0)return!1;if(typeof z=="function")e(z,this,C);else for(var V=z.length,Te=b(z,V),P=0;P<V;++P)e(Te[P],this,C);return!0};function l(f,y,C,P){var x,N,R;if(a(C),N=f._events,N===void 0?(N=f._events=Object.create(null),f._eventsCount=0):(N.newListener!==void 0&&(f.emit("newListener",y,C.listener?C.listener:C),N=f._events),R=N[y]),R===void 0)R=N[y]=C,++f._eventsCount;else if(typeof R=="function"?R=N[y]=P?[C,R]:[R,C]:P?R.unshift(C):R.push(C),x=c(f),x>0&&R.length>x&&!R.warned){R.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=f,O.type=y,O.count=R.length,i(O)}return f}s.prototype.addListener=function(y,C){return l(this,y,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(y,C){return l(this,y,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(f,y,C){var P={fired:!1,wrapFn:void 0,target:f,type:y,listener:C},x=u.bind(P);return x.listener=C,P.wrapFn=x,x}s.prototype.once=function(y,C){return a(C),this.on(y,d(this,y,C)),this},s.prototype.prependOnceListener=function(y,C){return a(C),this.prependListener(y,d(this,y,C)),this},s.prototype.removeListener=function(y,C){var P,x,N,R,O;if(a(C),x=this._events,x===void 0)return this;if(P=x[y],P===void 0)return this;if(P===C||P.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete x[y],x.removeListener&&this.emit("removeListener",y,P.listener||C));else if(typeof P!="function"){for(N=-1,R=P.length-1;R>=0;R--)if(P[R]===C||P[R].listener===C){O=P[R].listener,N=R;break}if(N<0)return this;N===0?P.shift():v(P,N),P.length===1&&(x[y]=P[0]),x.removeListener!==void 0&&this.emit("removeListener",y,O||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(y){var C,P,x;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[y]),this;if(arguments.length===0){var N=Object.keys(P),R;for(x=0;x<N.length;++x)R=N[x],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=P[y],typeof C=="function")this.removeListener(y,C);else if(C!==void 0)for(x=C.length-1;x>=0;x--)this.removeListener(y,C[x]);return this};function h(f,y,C){var P=f._events;if(P===void 0)return[];var x=P[y];return x===void 0?[]:typeof x=="function"?C?[x.listener||x]:[x]:C?w(x):b(x,x.length)}s.prototype.listeners=function(y){return h(this,y,!0)},s.prototype.rawListeners=function(y){return h(this,y,!1)},s.listenerCount=function(f,y){return typeof f.listenerCount=="function"?f.listenerCount(y):m.call(f,y)},s.prototype.listenerCount=m;function m(f){var y=this._events;if(y!==void 0){var C=y[f];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(f,y){for(var C=new Array(y),P=0;P<y;++P)C[P]=f[P];return C}function v(f,y){for(;y+1<f.length;y++)f[y]=f[y+1];f.pop()}function w(f){for(var y=new Array(f.length),C=0;C<y.length;++C)y[C]=f[C].listener||f[C];return y}function p(f,y){return new Promise(function(C,P){function x(R){f.removeListener(y,N),P(R)}function N(){typeof f.removeListener=="function"&&f.removeListener("error",x),C([].slice.call(arguments))}S(f,y,N,{once:!0}),y!=="error"&&g(f,x,{once:!0})})}function g(f,y,C){typeof f.on=="function"&&S(f,"error",y,C)}function S(f,y,C,P){if(typeof f.on=="function")P.once?f.once(y,C):f.on(y,C);else if(typeof f.addEventListener=="function")f.addEventListener(y,function x(N){P.once&&f.removeEventListener(y,x),C(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f)}return uo.exports}var on=VC();let Qv=!0,Yv=!0;function Hr(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Oi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function zC(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Qv=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function WC(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Yv=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Xv(){if(typeof window=="object"){if(Qv)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Nd(t,e){Yv&&console.warn(t+" is deprecated, please use "+e+" instead.")}function qC(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Hr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Hr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Hr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Hr(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Df(t){return Object.prototype.toString.call(t)==="[object Object]"}function Zv(t){return Df(t)?Object.keys(t).reduce(function(e,n){const i=Df(t[n]),r=i?Zv(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function Xl(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Xl(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Xl(t,t.get(r),n)})}))}function Mf(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&Xl(t,a,r)})}),r}const Af=Xv;function ey(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,m){return h?h+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(b=>b.kind==="videoinput");let m=h.find(b=>d.some(v=>b.label.toLowerCase().includes(v)));return!m&&h.length&&d.includes("back")&&(m=h[h.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=i(a.video),Af("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Af("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function ty(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function ny(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Oi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function iy(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ry(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Mf(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Oi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Mf(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function sy(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function oy(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return sy(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(m=>m.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[d.id];if(b)b.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const m=l._reverseStreams[h],b=l._streams[m.id];d=d.replace(new RegExp(b.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const m=l._reverseStreams[h],b=l._streams[m.id];d=d.replace(new RegExp(m.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[b=>{const v=s(this,b);h[0].apply(null,[v])},b=>{h[1]&&h[1].apply(null,b)},arguments[2]]):u.apply(this,arguments).then(b=>s(this,b))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(v=>u.track===v)&&(h=this._streams[m])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zl(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function ay(t,e){Oi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Lf=Object.freeze({__proto__:null,fixNegotiationNeeded:ay,shimAddTrackRemoveTrack:oy,shimAddTrackRemoveTrackWithNative:sy,shimGetSendersWithDtmf:iy,shimGetUserMedia:ey,shimMediaStream:ty,shimOnTrack:ny,shimPeerConnection:Zl,shimSenderReceiverGetStats:ry});function cy(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Nd("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function $C(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function ly(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eu(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function uy(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function dy(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Oi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hy(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Nd("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function fy(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function py(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function my(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function gy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function vy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Uf=Object.freeze({__proto__:null,shimAddTransceiver:py,shimCreateAnswer:vy,shimCreateOffer:gy,shimGetDisplayMedia:$C,shimGetParameters:my,shimGetUserMedia:cy,shimOnTrack:ly,shimPeerConnection:eu,shimRTCDataChannel:fy,shimReceiverGetStats:dy,shimRemoveStream:hy,shimSenderGetStats:uy});function yy(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function ky(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function by(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function Sy(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Ty(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function Ty(t){return t&&t.video!==void 0?Object.assign({},t,{video:Zv(t.video)}):t}function Cy(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Nd("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function wy(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ey(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Py(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var jf=Object.freeze({__proto__:null,shimAudioContext:Py,shimCallbacksAPI:by,shimConstraints:Ty,shimCreateOfferLegacy:Ey,shimGetUserMedia:Sy,shimLocalStreamsAPI:yy,shimRTCIceServerUrls:Cy,shimRemoteStreamsAPI:ky,shimTrackEventTransceiver:wy}),Ac={exports:{}},Ff;function KC(){return Ff||(Ff=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(b=>parseInt(b,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(m.rtx={ssrc:l}),i.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(m))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Ac)),Ac.exports}var _y=KC(),sr=MC(_y),HC=nT({__proto__:null,default:sr},[_y]);function Do(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=sr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Oi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function tu(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Oi(t,"icecandidate",e=>{if(e.candidate){const n=sr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Mo(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=sr.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=sr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=sr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function Ao(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Oi(t,"datachannel",i=>(e(i.channel,i.target),i))}function nu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function iu(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Lo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Uo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var GC=Object.freeze({__proto__:null,removeExtmapAllowMixed:iu,shimAddIceCandidateNullOrEmpty:Lo,shimConnectionState:nu,shimMaxMessageSize:Mo,shimParameterlessSetLocalDescription:Uo,shimRTCIceCandidate:Do,shimRTCIceCandidateRelayProtocol:tu,shimSendThrowTypeError:Ao});function JC(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Xv,i=qC(t),r={browserDetails:i,commonShim:GC,extractVersion:Hr,disableLog:zC,disableWarnings:WC,sdp:HC};switch(i.browser){case"chrome":if(!Lf||!Zl||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Lf,Lo(t,i),Uo(t),ey(t,i),ty(t),Zl(t,i),ny(t),oy(t,i),iy(t),ry(t),ay(t,i),Do(t),tu(t),nu(t),Mo(t,i),Ao(t),iu(t,i);break;case"firefox":if(!Uf||!eu||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Uf,Lo(t,i),Uo(t),cy(t,i),eu(t,i),ly(t),hy(t),uy(t),dy(t),fy(t),py(t),my(t),gy(t),vy(t),Do(t),nu(t),Mo(t,i),Ao(t);break;case"safari":if(!jf||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=jf,Lo(t,i),Uo(t),Cy(t),Ey(t),by(t),yy(t),ky(t),wy(t),Sy(t),Py(t),Do(t),tu(t),Mo(t,i),Ao(t),iu(t,i);break;default:n("Unsupported browser!");break}return r}JC({window:typeof window>"u"?void 0:window});const QC=/version\/(\d+(\.?_?\d+)+)/i;let Lc;function ht(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Lc===void 0||e){const i=YC.find(r=>{let{test:s}=r;return s.test(n)});Lc=i==null?void 0:i.describe(n)}return Lc}const YC=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:jo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Uc(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:jo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Uc(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:jo(QC,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Uc(t)}}}];function jo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Uc(t){return t.includes("mac os")?jo(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var XC="2.16.1";const ZC=XC,ew=16;class an extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var ue;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(ue||(ue={}));class Q extends an{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=ue[n]}static notAllowed(e,n,i){return new Q(e,ue.NotAllowed,n,i)}static timeout(e){return new Q(e,ue.Timeout)}static leaveRequest(e,n){return new Q(e,ue.LeaveRequest,void 0,n)}static internal(e,n){return new Q(e,ue.InternalError,void 0,n)}static cancelled(e){return new Q(e,ue.Cancelled)}static serverUnreachable(e,n){return new Q(e,ue.ServerUnreachable,n)}static websocket(e,n,i){return new Q(e,ue.WebSocket,n,i)}}class Dd extends an{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class gn extends an{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class tw extends an{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Re extends an{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ru extends an{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Bf extends an{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Vf extends an{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Od[n]}}var Je;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Je||(Je={}));class Et extends an{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Je[n]}}class Mi extends an{constructor(e){super(18,e),this.name="SignalReconnectError"}}var ya;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(ya||(ya={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(ya||(ya={}));class Be{}Be.setTimeout=function(){return setTimeout(...arguments)};Be.setInterval=function(){return setInterval(...arguments)};Be.clearTimeout=function(){return clearTimeout(...arguments)};Be.clearInterval=function(){return clearInterval(...arguments)};var D;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(D||(D={}));var A;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(A||(A={}));var F;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(F||(F={}));var j;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(j||(j={}));function nw(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class oe{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const iw=["vp8","h264"],rw=["vp8","h264","vp9","av1","h265"];function sw(t){return!!iw.find(e=>e===t)}const ow=sw;var zf;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(zf||(zf={}));var su;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(su||(su={}));const Rs={h90:new oe(160,90,9e4,20),h180:new oe(320,180,16e4,20),h216:new oe(384,216,18e4,20),h360:new oe(640,360,45e4,20),h540:new oe(960,540,8e5,25),h720:new oe(1280,720,17e5,30),h1080:new oe(1920,1080,3e6,30),h1440:new oe(2560,1440,5e6,30),h2160:new oe(3840,2160,8e6,30)},ou={h120:new oe(160,120,7e4,20),h180:new oe(240,180,125e3,20),h240:new oe(320,240,14e4,20),h360:new oe(480,360,33e4,20),h480:new oe(640,480,5e5,20),h540:new oe(720,540,6e5,25),h720:new oe(960,720,13e5,30),h1080:new oe(1440,1080,23e5,30),h1440:new oe(1920,1440,38e5,30)},Md={h360fps3:new oe(640,360,2e5,3,"medium"),h360fps15:new oe(640,360,4e5,15,"medium"),h720fps5:new oe(1280,720,8e5,5,"medium"),h720fps15:new oe(1280,720,15e5,15,"medium"),h720fps30:new oe(1280,720,2e6,30,"medium"),h1080fps15:new oe(1920,1080,25e5,15,"medium"),h1080fps30:new oe(1920,1080,5e6,30,"medium"),original:new oe(0,0,7e6,30,"medium")};function xy(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=Oy(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(au(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(au(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function au(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Ad(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":au(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function Ry(t){return T(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Iy();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ve(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function Iy(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>T(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function aw(t){return t==="audioinput"?M.Source.Microphone:t==="videoinput"?M.Source.Camera:M.Source.Unknown}function cu(t){return t===M.Source.Microphone?"audioinput":t===M.Source.Camera?"videoinput":void 0}function cw(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,_i()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function os(t){return t.split("/")[1].toLowerCase()}function lw(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Pd({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Z(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Z(t.track):{})}}function uw(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function dw(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function Oy(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:nw(e)}}function hw(t){switch(t){case Pe.CAMERA:return M.Source.Camera;case Pe.MICROPHONE:return M.Source.Microphone;case Pe.SCREEN_SHARE:return M.Source.ScreenShare;case Pe.SCREEN_SHARE_AUDIO:return M.Source.ScreenShareAudio;default:return M.Source.Unknown}}function Wf(t,e){return t.width*t.height<e.width*e.height}function fw(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const pw=5e3,jr=[];var vt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(vt||(vt={}));class M extends on.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=M.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Y,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),pw):this.handleAppVisibilityChanged()},this.log=wn((r=i.loggerName)!==null&&r!==void 0?r:Ht.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=M.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Z(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===M.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===M.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(jr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&jr.splice(jr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ji(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?j.AudioPlaybackStarted:j.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?j.AudioPlaybackFailed:j.VideoPlaybackFailed,s):s.name==="AbortError"?Y.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Y.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(j.ElementAttached,e),e}detach(e){try{if(e){or(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(j.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{or(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(j.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=wn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),jr.forEach(i=>{i.parentElement||(n=!1)}),n&&jr.push(e)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===M.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ct()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ct()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ji(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!_i()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(_i()||Pi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function or(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Ft.AUDIO;case e.Video:return Ft.VIDEO;default:return Ft.DATA}}t.kindToProto=r;function s(l){switch(l){case Ft.AUDIO:return e.Audio;case Ft.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return Pe.CAMERA;case n.Microphone:return Pe.MICROPHONE;case n.ScreenShare:return Pe.SCREEN_SHARE;case n.ScreenShareAudio:return Pe.SCREEN_SHARE_AUDIO;default:return Pe.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case Pe.CAMERA:return n.Camera;case Pe.MICROPHONE:return n.Microphone;case Pe.SCREEN_SHARE:return n.ScreenShare;case Pe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case Jl.ACTIVE:return i.Active;case Jl.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(M||(M={}));const mw="|",qf="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function gw(t){const e=t.split(mw);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ve(t){return T(this,void 0,void 0,function*(){return new Promise(e=>Be.setTimeout(e,t))})}function lu(){return"addTransceiver"in RTCPeerConnection.prototype}function uu(){return"addTrack"in RTCPeerConnection.prototype}function vw(){if(!("getCapabilities"in RTCRtpSender)||_i()||Pi())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function yw(){if(!("getCapabilities"in RTCRtpSender)||Pi())return!1;if(_i()){const n=ht();if(n!=null&&n.version&&sn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&sn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Vt(t){return t==="av1"||t==="vp9"}function du(t){return!document||Is()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function kw(){return typeof RTCPeerConnection>"u"?!1:lu()||uu()}function Pi(){var t;return((t=ht())===null||t===void 0?void 0:t.name)==="Firefox"}function $f(){const t=ht();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function _i(){var t;return((t=ht())===null||t===void 0?void 0:t.name)==="Safari"}function Is(){const t=ht();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function bw(){const t=ht();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&sn(t.osVersion,"17")>=0}function Sw(t){return t||(t=ht()),(t==null?void 0:t.name)==="Safari"&&sn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&sn(t.osVersion,"18.3")>0}function Ny(){var t,e;return ct()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Tw(){const t=ht(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&sn(t.osVersion,e)>=0?!0:t.name==="Safari"&&sn(t.version,e)>=0}function ct(){return typeof document<"u"}function rn(){return navigator.product=="ReactNative"}function kr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function jc(t){return kr(t)?t.hostname.split(".")[0]:null}function Dy(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function My(){if(!rn())return;let t=Dy();if(t)return t.platform}function Kf(){if(ct())return window.devicePixelRatio;if(rn()){let t=Dy();if(t)return t.devicePixelRatio}return 1}function sn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function Cw(t){for(const e of t)e.target.handleResize(e)}function ww(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Fc=null;const Hf=()=>(Fc||(Fc=new ResizeObserver(Cw)),Fc);let Bc=null;const Gf=()=>(Bc||(Bc=new IntersectionObserver(ww,{root:null,rootMargin:"0px"})),Bc);function Ew(){var t;const e=new Mv({sdk:Av.JS,protocol:ew,version:ZC});return rn()&&(e.os=(t=My())!==null&&t!==void 0?t:""),e}function Jf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Fr;function Vc(){if(!Fr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Fr]=i.stream.getAudioTracks(),!Fr)throw Error("Could not get empty media stream audio track");Fr.enabled=!1}return Fr.clone()}class Rt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>T(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Pw(t){return rw.includes(t)}function Qn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function _w(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Os(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function xw(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function Rw(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Qf(t){switch(t.reason){case ue.LeaveRequest:return t.context;case ue.Cancelled:return zt.CLIENT_INITIATED;case ue.NotAllowed:return zt.USER_REJECTED;case ue.ServerUnreachable:return zt.JOIN_FAILURE;default:return zt.UNKNOWN_REASON}}function Fo(t){return t!==void 0?Number(t):void 0}function ui(t){return t!==void 0?BigInt(t):void 0}function ar(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function nn(t){return!!t&&t.kind==M.Kind.Audio}function si(t){return!!t&&t.kind==M.Kind.Video}function In(t){return ar(t)&&si(t)}function cn(t){return ar(t)&&nn(t)}function hu(t){return!!t&&!t.isLocal}function Iw(t){return!!t&&!t.isLocal}function zc(t){return hu(t)&&si(t)}function Ow(t){return t.isLocal}function Nw(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function Dw(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function Mw(t,e){const n=new URL(_w(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),Ly(n,"rtc")}function Aw(t){const e=new URL(Os(t));return Ly(e,"validate")}function Ay(t){return t.endsWith("/")?t:"".concat(t,"/")}function Ly(t,e){return t.pathname="".concat(Ay(t.pathname)).concat(e),t.toString()}function Yf(t){if(typeof t=="string")return Rf.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Rf.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function Lw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const Uw=10,Br="lk_e2ee",jw="LKFrameEncryptionKey",Fw={sharedKey:!1,ratchetSalt:jw,ratchetWindowSize:8,failureTolerance:Uw,keyringSize:16};var Yn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Yn||(Yn={}));var Xf;(function(t){t.KeyRatcheted="keyRatcheted"})(Xf||(Xf={}));var Bn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Bn||(Bn={}));var Zf;(function(t){t.Error="cryptorError"})(Zf||(Zf={}));function Bw(){return Vw()||fu()}function fu(){return typeof window.RTCRtpScriptTransform<"u"}function Vw(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function zw(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new _v({value:t.value})}class r1 extends on.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Y.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Fw),e),this.on(Yn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Yn.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Yn.RatchetRequest,e,n)}}var ep;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(ep||(ep={}));class Ww extends on.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(Y.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(Bn.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Bn.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Bn.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Yn.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break}},this.onWorkerError=i=>{Y.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Bn.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!Bw())throw new Dd("tried to setup end-to-end encryption on an unsupported browser");if(Y.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:UC.getLevel()}};this.worker&&(Y.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Y.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Y.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(F.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(D.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Oe.NONE,r.identity)),e.on(D.ConnectionStateChanged,i=>{i===ne.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Oe.NONE,r.identity)})})}).on(D.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(D.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(D.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(A.LocalSenderCreated,(i,r)=>T(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(A.LocalTrackPublished,i=>{if(!si(i.track)||!Is())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:os(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Yn.SetKey,i=>this.postKey(i)).on(Yn.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Rt;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Rt;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?os(i.mimeType):void 0)}}setupE2EESender(e,n){if(!ar(e)||!n){n||Y.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return T(this,void 0,void 0,function*(){if(this.worker){if(fu()&&!$f()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Br in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Br in e}};this.worker.postMessage(a,[o,s])}e[Br]=!0}})}handleSender(e,n,i){var r;if(!(Br in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(fu()&&!$f()){Y.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Y.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Br]=!0}}}const qw=500,$w=15e3;class cr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new cr),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=jc(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,Ve(Math.min(qw*Math.pow(2,s),$w)))}getBackOffPromise(e){const n=new URL(e),i=n&&jc(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&jc(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}cr._instance=null;const Wc="default";class Le{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Le),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Le.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Y.debug("awaiting getUserMedia promise");try{n?yield Le.userMediaPromiseMap.get(n):yield Promise.all(Le.userMediaPromiseMap.values())}catch{Y.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(_i()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return T(this,void 0,void 0,function*(){if(n!==Wc)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Wc);if(!s){Y.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Wc&&a.groupId===(i??s.groupId));if(!o){Y.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Le.userMediaPromiseMap.has(e):Le.userMediaPromiseMap.size>0}}Le.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Le.userMediaPromiseMap=new Map;var as;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(as||(as={}));class Kw{constructor(){this.pendingTasks=new Map,this.taskMutex=new Xe,this.nextTaskIndex=0}run(e){return T(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:as.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=as.RUNNING,yield e()}finally{n.status=as.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class Hw{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(l){s.onmessage=u=>{let{data:d}=u;return l.enqueue(d)},s.onerror=u=>l.error(u)},cancel:o}),writable:new WritableStream({write(l){s.send(l)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const l=()=>T(this,void 0,void 0,function*(){const u=new Promise(h=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",m=>{h(m)},{once:!0})}),d=yield Promise.race([Ve(250),u]);d?a(d):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:h}=u;a({closeCode:d,reason:h}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const Gw=["syncState","trickle","offer","answer","simulate","leave"];function Jw(t){const e=Gw.indexOf(t.case)>=0;return Y.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ae;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ae||(ae={}));const Qw=250;class Ld{get currentState(){return this.state}get isDisconnected(){return this.state===ae.DISCONNECTING||this.state===ae.DISCONNECTED}get isEstablishingConnection(){return this.state===ae.CONNECTING||this.state===ae.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ae.DISCONNECTED,this.log=Y,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=wn((i=n.loggerName)!==null&&i!==void 0?i:Ht.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new Kw,this.queuedRequests=[],this.closingLock=new Xe,this.connectionLock=new Xe,this.state=ae.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return T(this,void 0,void 0,function*(){return this.state=ae.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ae.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return T(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=i;const o=Ew(),a=i.singlePeerConnection?Xw(n,o,i):Yw(n,o,i),c=Mw(e,a),l=Aw(c);return new Promise((u,d)=>T(this,void 0,void 0,function*(){var h,m;try{let b=!1;const v=f=>T(this,void 0,void 0,function*(){if(b)return;b=!0;const y=f instanceof Event?f.currentTarget:f,C=Lw(y,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(C)).catch(P=>{this.log.error(P),this.close()}):this.close(),w(),d(Q.cancelled(C))});r==null||r.addEventListener("abort",v);const w=()=>{clearTimeout(p),r==null||r.removeEventListener("abort",v)},p=setTimeout(()=>{v(Q.timeout("room connection has timed out (signal)"))},i.websocketTimeout),g=(f,y)=>{this.handleSignalConnected(f,p,y)},S=new URL(c);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new Hw(c);try{this.ws.closed.then(R=>{var O;this.isEstablishingConnection&&d(Q.internal("Websocket got closed during a (re)connection attempt: ".concat(R.reason))),R.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:R.reason,code:R.closeCode,wasClean:R.closeCode===1e3,state:this.state})),this.state===ae.CONNECTED&&this.handleOnClose((O=R.reason)!==null&&O!==void 0?O:"Unexpected WS error"))}).catch(R=>{this.isEstablishingConnection&&d(Q.internal("Websocket error during a (re)connection attempt: ".concat(R)))});const f=yield this.ws.opened.catch(R=>T(this,void 0,void 0,function*(){if(this.state!==ae.CONNECTED){this.state=ae.DISCONNECTED,clearTimeout(p);const O=yield this.handleConnectionError(R,l);d(O);return}this.handleWSError(R),d(R)}));if(clearTimeout(p),!f)return;const y=f.readable.getReader();this.streamWriter=f.writable.getWriter();const C=yield y.read();if(y.releaseLock(),!C.value)throw Q.internal("no message received as first message");const P=Yf(C.value),x=this.validateFirstMessage(P,(h=i.reconnect)!==null&&h!==void 0?h:!1);if(!x.isValid){d(x.error);return}((m=P.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=P.message.value.pingTimeout,this.pingIntervalDuration=P.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const N=x.shouldProcessFirstMessage?P:void 0;g(f,N),u(x.response)}catch(f){d(f)}finally{w()}}finally{s()}}))})}startReadingLoop(e,n){return T(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Ve(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=Yf(r);this.handleSignalResponse(s)}})}close(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([ae.DISCONNECTING||ae.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ae.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Ve(Qw)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=ae.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Qi(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Qi(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Ka({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Ha({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new xd({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new zv({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new $v({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:fe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Gv({timestamp:fe.parse(Date.now()),rtt:fe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new _d({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ja({reason:zt.CLIENT_INITIATED,action:rr.DISCONNECT})})}sendRequest(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!Jw(n)&&i.state===ae.RECONNECTING){i.queuedRequests.push(()=>T(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ve(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new cC({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=tp(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=tp(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return T(this,void 0,void 0,function*(){if(this.state===ae.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Be.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Be.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Be.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Be.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=ae.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===ae.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:Q.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:Q.internal("Unexpected first message")}:{isValid:!1,error:Q.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return T(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return Q.notAllowed(r,i.status)}else return e instanceof Q?e:Q.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof Q?i:Q.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function tp(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Qi(t,e){return new ti({sdp:t.sdp,type:t.type,id:e})}function Yw(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",rn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function Xw(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new IC({clientInfo:e,connectionSettings:new Jv({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new OC({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class np{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Zw{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Mt={},qc={},$c={exports:{}},ip;function Ud(){if(ip)return $c.exports;ip=1;var t=$c.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),$c.exports}var rp;function eE(){return rp||(rp=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=Ud(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],m=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var b=0;b<(r[h]||[]).length;b+=1){var v=r[h][b];if(v.reg.test(m))return i(v,u,m)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(qc)),qc}var Kc,sp;function tE(){if(sp)return Kc;sp=1;var t=Ud(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Kc=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(m){u.push(i(d,h,m))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(m){m.name in d&&d[m.name]!=null?u.push(i(h,m,d)):m.push in d&&d[m.push]!=null&&d[m.push].forEach(function(b){u.push(i(h,m,b))})})})}),u.join(`\r
`)+`\r
`},Kc}var op;function nE(){if(op)return Mt;op=1;var t=eE(),e=tE(),n=Ud();return Mt.grammar=n,Mt.write=e,Mt.parse=t.parse,Mt.parseParams=t.parseParams,Mt.parseFmtpConfig=t.parseFmtpConfig,Mt.parsePayloads=t.parsePayloads,Mt.parseRemoteCandidates=t.parseRemoteCandidates,Mt.parseImageAttributes=t.parseImageAttributes,Mt.parseSimulcastStreamList=t.parseSimulcastStreamList,Mt}var On=nE();function jd(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var m=Date.now()-l;if(m+e>=c)return c-m}return e}var h=function(){var m=[].slice.call(arguments),b=this;return new Promise(function(v,w){var p=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var S=t.apply(b,m);a&&a(S),u.forEach(function(f){return(0,f.resolve)(S)}),u=[]}},d()),p){var g=t.apply(b,m);return a&&a(g),v(g)}u.push({resolve:v,reject:w})})};return h.cancel=function(m){s!==void 0&&clearTimeout(s),u.forEach(function(b){return(0,b.reject)(m)}),u=[]},h}const iE=.7,rE=20,lr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class ap extends on.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Y,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=jd(r=>T(this,void 0,void 0,function*(){this.emit(lr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),rE),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=wn((i=n.loggerName)!==null&&i!==void 0?i:Ht.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Xe}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return T(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=sE(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=On.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Fd(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===l){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=On.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(lr.NegotiationComplete),e.sdp&&On.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(lr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return T(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=On.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{lp(a),a.type==="audio"?cp(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(Vt(c.codec)&&!_i()&&this.ensureVideoDDExtensionForSVC(a,o),!Vt(c.codec)))return!0;const u=Math.round(c.maxbr*iE);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,On.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=On.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{lp(r),r.type==="audio"&&cp(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,On.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Re("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Re("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return T(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new ru(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===qf))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:qf})}}}function cp(t,e,n){const i=Fd(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function sE(t){var e;const n=[],i=[],r=On.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const c=Fd(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&i.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function lp(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Fd(t){return typeof t=="number"?t.toFixed(0):t}const pu="vp8",oE={audioPreset:su.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Md.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:pu,backupCodec:!0,preConnectBuffer:!1},Uy={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},jy={deviceId:{ideal:"default"},resolution:Rs.h720.resolution},aE={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new FC,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Bd={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ye;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ye||(ye={}));class cE{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Bd.peerConnectionTimeout,this.log=Y,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=ye.CONNECTED:c.some(l=>l==="failed")?this.state=ye.FAILED:c.some(l=>l==="connecting")?this.state=ye.CONNECTING:c.every(l=>l==="closed")?this.state=ye.CLOSED:c.some(l=>l==="closed")?this.state=ye.CLOSING:c.every(l=>l==="new")&&(this.state=ye.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(ye[a]," to ").concat(ye[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=wn((r=i.loggerName)!==null&&r!==void 0?r:Ht.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new ap(e,i),n!=="publisher-only"&&(this.subscriber=new ap(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Bt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Bt.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ye.NEW,this.connectionLock=new Xe,this.remoteOfferLock=new Xe}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return T(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return T(this,void 0,void 0,function*(){var i;n===Bt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return T(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return T(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return T(this,void 0,void 0,function*(){return new Promise((n,i)=>T(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(lr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(lr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Bt.PUBLISHER?this.publisher.getConnectedAddress():e===Bt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>T(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Be.clearTimeout(d),l(Q.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Be.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(Q.internal("could not establish pc connection"))},o);for(;this.state!==ye.CONNECTED;)if(yield Ve(50),r!=null&&r.signal.aborted){l(Q.cancelled("room connection has been cancelled"));return}Be.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}const Fy=5e3,lE=3e4;class ie{static fetchRegionSettings(e,n,i){return T(this,void 0,void 0,function*(){const r=yield ie.fetchLock.lock();try{const s=yield fetch("".concat(uE(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=Dw(s.headers),a=o?o*1e3:Fy;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?Q.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):Q.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof Q?s:i!=null&&i.aborted?Q.cancelled("Region fetching was aborted"):Q.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return T(this,void 0,void 0,function*(){const r=ie.settingsTimeouts.get(e.hostname);clearTimeout(r),ie.settingsTimeouts.set(e.hostname,setTimeout(()=>T(this,void 0,void 0,function*(){try{const s=yield ie.fetchRegionSettings(e,n);ie.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof Q&&s.reason===ue.NotAllowed){Y.debug("token is not valid, cancelling auto region refresh");return}Y.debug("auto refetching of region settings failed",{error:s}),ie.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){ie.cache.set(e.hostname,i),ie.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=ie.settingsTimeouts.get(e);n&&(clearTimeout(n),ie.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=ie.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=ie.connectionTrackers.get(e);i&&i.connectionCount===0&&(Y.debug("stopping region refetch after disconnect delay",{hostname:e}),ie.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},lE))}static cancelCleanup(e){const n=ie.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=ie.connectionTrackers.get(e);n||(n={connectionCount:0},ie.connectionTrackers.set(e,n)),n.connectionCount++,ie.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=ie.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&ie.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return kr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return T(this,void 0,void 0,function*(){return ie.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=ie.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),ie.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Y.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){ie.updateCachedRegionSettings(this.serverUrl,this.token,e)}}ie.cache=new Map;ie.settingsTimeouts=new Map;ie.connectionTrackers=new Map;ie.fetchLock=new Xe;function uE(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Se extends Error{constructor(e,n,i){super(n),this.code=e,this.message=up(n,Se.MAX_MESSAGE_BYTES),this.data=i?up(i,Se.MAX_DATA_BYTES):void 0}static fromProto(e){return new Se(e.code,e.message,e.data)}toProto(){return new Iv({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Se(Se.ErrorCode[e],Se.ErrorMessage[e],n)}}Se.MAX_MESSAGE_BYTES=256;Se.MAX_DATA_BYTES=15360;Se.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Se.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const By=15360;function Vd(t){return new TextEncoder().encode(t).length}function up(t,e){if(Vd(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const zd=2e3;function Ya(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Wd=typeof MediaRecorder<"u";class dE{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const hE=Wd?MediaRecorder:dE;class fE extends hE{constructor(e,n){if(!Wd)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>T(this,void 0,void 0,function*(){let u;if(l.data.arrayBuffer){const d=yield l.data.arrayBuffer();u=new Uint8Array(d)}else if(l.data.byteArray)u=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function pE(){return Wd}const mE=1e3,gE=1e4;class Vy extends M{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=jd(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(j.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Xe,this.pauseUpstreamLock=new Xe,this.trackChangeLock=new Xe,this.trackChangeLock.lock().then(o=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==M.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return T(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{or(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ji(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Ji(r??e,s)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mE;return function*(){var i;if(e.kind===M.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ht())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ve(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Ve(50)}throw new gn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Qn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Qn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===M.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===M.Kind.Audio?"audioinput":"videoinput";return n?Le.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return T(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new gn("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=BC(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===M.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(l=>{or(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===M.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(j.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?j.Muted:j.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ny()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(j.UpstreamPaused,this);const i=ht();if((i==null?void 0:i.name)==="Safari"&&sn(i.version,"12.0")<0)throw new Dd("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(j.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ji(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(or(i._mediaStreamTrack,l),Ji(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(j.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(j.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!pE()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new fE(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},gE)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class ka extends Vy{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,M.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Ya(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(j.AudioTrackFeatureUpdate,this,Ae.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(j.AudioTrackFeatureUpdate,this,Ae.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===M.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Qn(this._constraints.deviceId);return this.source===M.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return T(this,void 0,void 0,function*(){let n;if(e){const i=Ad({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ct()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},zd)))}setProcessor(e){return T(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!rn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(j.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return T(this,void 0,void 0,function*(){const e=yield Ry(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(j.AudioSilenceDetected)),e})}}function vE(t,e,n){switch(t.kind){case"audio":return new ka(t,e,!1,void 0,n);case"video":return new ba(t,e,!1,n);default:throw new gn("unsupported track type: ".concat(t.kind))}}const yE=Object.values(Rs),kE=Object.values(ou),bE=Object.values(Md),SE=[Rs.h180,Rs.h360],TE=[ou.h180,ou.h360],CE=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new oe(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),mu=["q","h","f"];function gu(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=EE(t,e,n,l),Y.debug("using video encoding",o));const u=o.maxFramerate,d=new oe(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Vt(l)){const b=new zy(c),v=[];if(b.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const w=ht();if(Is()||rn()||(w==null?void 0:w.name)==="Chrome"&&sn(w==null?void 0:w.version,"113")<0){const p=b.suffix=="h"?2:3,g=Sw(w);for(let S=0;S<b.spatial;S+=1)v.push({rid:mu[2-S],maxBitrate:o.maxBitrate/Math.pow(p,S),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:g?Math.pow(2,S):void 0});v[0].scalabilityMode=c}else v.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(v[0].priority=d.encoding.priority,v[0].networkPriority=d.encoding.priority),Y.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let h=[];t?h=(r=hp(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:dp(t,d):h=(s=hp(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:dp(t,d);let m;if(h.length>0){const b=h[0];h.length>1&&([,m]=h);const v=Math.max(e,n);if(v>=960&&m)return Hc(e,n,[b,m,d],u);if(v>=480)return Hc(e,n,[b,d],u)}return Hc(e,n,[d])}function wE(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Y.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===M.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),gu(t.source===M.Source.ScreenShare,c,l,n)}function EE(t,e,n,i){const r=PE(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function PE(t,e,n){if(t)return bE;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?yE:kE}function dp(t,e){if(t)return CE(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?SE:TE}function Hc(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=mu.length)return;const a=Math.min(t,e),l={rid:mu[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=Pi()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),rn()&&My()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Y.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Y.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function hp(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class zy{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function _E(t){return t.source===M.Source.ScreenShare||t.constraints.height&&Qn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const xE=5e3;class ba extends Vy{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,M.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(j.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=Ya(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Xe}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ct())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},zd))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=mn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=mn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===M.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===M.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=vt.LOW;i<=vt.HIGH;i+=1)n.push(new Rd({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Vt(this.codec),n)}restartTrack(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Ad({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=mn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,m=mn(r.simulcastCodecs.values()),b;b=yield m.next(),o=b.done,!o;h=!0)l=b.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(v){a={error:v}}finally{try{!h&&!o&&(c=m.return)&&(yield c.call(m))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return T(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},xE))}setPublishingCodecs(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Vt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=mn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Vt(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield fp(d.sender,d.encodings,u.qualities,this.senderLock,Vt(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield fp(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Vt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ny()&&this.isInBackground&&this.source===M.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function fp(t,e,n,i,r,s,o){return T(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),l.forEach((h,m)=>{var b;let v=(b=h.rid)!==null&&b!==void 0?b:"";v===""&&(v="q");const w=Wy(v),p=n.find(g=>g.quality===w);p&&h.active!==p.enabled&&(u=!0,h.active=p.enabled,s.debug("setting layer ".concat(p.quality," to ").concat(h.active?"enabled":"disabled"),o),Pi()&&(p.enabled?(h.scaleResolutionDownBy=e[m].scaleResolutionDownBy,h.maxBitrate=e[m].maxBitrate,h.maxFrameRate=e[m].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Wy(t){switch(t){case"f":return vt.HIGH;case"h":return vt.MEDIUM;case"q":return vt.LOW;default:return vt.HIGH}}function pp(t,e,n,i){if(!n)return[new Jn({quality:vt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new zy(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Jn({quality:Math.min(vt.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Wy((o=r.rid)!==null&&o!==void 0?o:"");return new Jn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const mp="_lossy",gp="_reliable",RE=2*1e3,Gc="leave-reconnect",IE=3e4,OE=8*1024,NE=256*1024;var wt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(wt||(wt={}));class DE extends on.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Bd.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=wt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Y,this.reliableDataSequence=1,this.reliableMessageBuffer=new np,this.reliableReceivedState=new Zw(IE),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>T(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===gp)s.reliableDCSub=o;else if(o.label===mp)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>T(this,void 0,void 0,function*(){var r,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=Qe.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(F.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),m=_v.fromBinary(h.payload),b=new Qe({value:m.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=b.value)===null||a===void 0?void 0:a.case)==="user"&&vp(b,b.value.value),this.emit(F.DataPacketReceived,b,d.value.value.encryptionType)}else((c=d.value)===null||c===void 0?void 0:c.case)==="user"&&vp(d,d.value.value),this.emit(F.DataPacketReceived,d,Oe.NONE)}finally{l()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?X.LOSSY:X.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(F.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Gc&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Be.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===wt.Connected&&i();const s=()=>{this.off(F.Disconnected,o),i()},o=()=>{this.off(F.Restarted,s),r()};this.once(F.Restarted,s),this.once(F.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===X.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(F.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>T(this,void 0,void 0,function*(){!this.url||!(yield fetch(Os(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===ae.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===ae.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(li.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>T(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Os(this.url),{method:"HEAD"}),Ve(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=wn((n=e.loggerName)!==null&&n!==void 0?n:Ht.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ld(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Xe,this.dataProcessLock=new Xe,this.dcBufferStatus=new Map([[X.LOSSY,!0],[X.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(F.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(F.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(F.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(F.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(F.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(F.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(F.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(F.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return T(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{Y.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(F.SignalConnected,s),s}catch(s){if(s instanceof Q&&s.reason===ue.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return T(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(F.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new np,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new gn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(Q.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return T(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ye.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new cE(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(F.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ye.CONNECTED){const u=this.pcState===wt.New;this.pcState=wt.Connected,u&&this.emit(F.Connected,e)}else s===ye.FAILED&&(this.pcState===wt.Connected||this.pcState===wt.Reconnecting)&&(this.pcState=wt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?li.RR_SUBSCRIBER_FAILED:li.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===ae.RECONNECTING,l=[ye.FAILED,ye.CLOSING,ye.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(F.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(F.MediaTrackAdded,s.track,s.streams[0],s.receiver)},ME((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(F.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(F.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(F.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(F.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(F.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",li.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Fy,regionSettings:e.regions})),e.action){case rr.DISCONNECT:this.emit(F.Disconnected,e==null?void 0:e.reason),this.close();break;case rr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Gc);break;case rr.RESUME:this.handleDisconnect(Gc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===_s.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(mp,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(gp,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(X.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,OE),NE)}},1e3))}createSender(e,n,i){return T(this,void 0,void 0,function*(){if(lu())return yield this.createTransceiverRTCRtpSender(e,n,i);if(uu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Re("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(lu())return this.createSimulcastTransceiverSender(e,n,i,r);if(uu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Re("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Re("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),si(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Re("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Re("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return T(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Y.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===_s.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ye.NEW)===ye.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Re?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Mi||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",li.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(F.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return T(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Re("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Mi;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof Q&&o.reason===ue.NotAllowed?new Re("could not reconnect, token might be expired"):new Mi}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(F.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==ae.CONNECTED)throw new Mi("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(F.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return T(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Re("could not reconnect, url or token not saved");if(!this.pcManager)throw new Re("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof Q&&r.reason===ue.NotAllowed?new Re("could not reconnect, token might be expired"):r instanceof Q&&r.reason===ue.LeaveRequest?r:new Mi(s)}if(this.emit(F.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ae.CONNECTED)throw new Mi("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(F.Resumed)})}waitForPCInitialConnection(e,n){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Re("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=wt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ve(RE),!this.pcManager)throw new Re("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=wt.Connected}catch(e){throw this.pcState=wt.Disconnected,Q.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return T(this,void 0,void 0,function*(){const s=new Qe({destinationIdentities:[e],kind:X.RELIABLE,value:{case:"rpcResponse",value:new Ed({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,X.RELIABLE)})}publishRpcAck(e,n){return T(this,void 0,void 0,function*(){const i=new Qe({destinationIdentities:[e],kind:X.RELIABLE,value:{case:"rpcAck",value:new wd({requestId:n})}});yield this.sendDataPacket(i,X.RELIABLE)})}sendDataPacket(e,n){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=zw(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new Pv({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===X.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===X.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(X.RELIABLE);const n=this.dataChannelForKind(X.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(X.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(F.Closing,r);!this.dcBufferStatus.get(e);)yield Ve(10);this.off(F.Closing,r),n()}}))}ensureDataTransportConnected(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Re("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw Q.internal("".concat(a," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(d=>{Y.error(d,i.logContext)});const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Ve(50)}throw Q.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ye.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Promise((e,n)=>T(this,void 0,void 0,function*(){if(!this.pcManager){n(new ru("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(F.Closing,r),this.pcManager.publisher.once(lr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();Pw(c)&&o.set(a.payload,c)}),this.emit(F.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof ru&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",li.RR_UNKNOWN),n(s)}finally{this.off(F.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===X.LOSSY)return this.lossyDCSub;if(e===X.RELIABLE)return this.reliableDCSub}else{if(e===X.LOSSY)return this.lossyDC;if(e===X.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,m=new Array;e.forEach(b=>{b.isDesired!==d&&h.push(b.trackSid),b.isEnabled||m.push(b.trackSid)}),this.client.sendSyncState(new Id({answer:this.options.singlePeerConnection?c?Qi({sdp:c.sdp,type:c.type}):void 0:u?Qi({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?a?Qi({sdp:a.sdp,type:a.type}):void 0:l?Qi({sdp:l.sdp,type:l.type}):void 0,subscription:new Ga({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:lw(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((b,v)=>new Kv({publisherSid:v,lastSeq:b}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Hv({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(X.LOSSY),Bt.PUBLISHER),n(this.dataChannelForKind(X.RELIABLE),Bt.PUBLISHER),n(this.dataChannelForKind(X.LOSSY,!0),Bt.SUBSCRIBER),n(this.dataChannelForKind(X.RELIABLE,!0),Bt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Be.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ct()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ct()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function ME(t){return t!==void 0&&t>13}function vp(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class qy{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Et("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Je.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Et("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Je.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class AE extends qy{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Rt,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return T(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=mn(c),d;d=yield u.next(),i=d.done,!i;l=!0){o=d.value,l=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class LE extends qy{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Fo(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Rt,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:u}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new Et("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),Je.DecodeFailed)}return{done:!1,value:d}}}catch(l){throw o(),l}}),return(){return T(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=mn(c),d;d=yield u.next(),i=d.done,!i;l=!0)o=d.value,l=!1,a+=o}catch(h){r={error:h}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class UE{constructor(){this.log=Y,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Et('A text stream handler for topic "'.concat(e,'" has already been set.'),Je.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Et('A byte stream handler for topic "'.concat(e,'" has already been set.'),Je.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new Et("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Je.AbnormalEnd);for(const[l,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return T(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return T(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Rt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Fo(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Et("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Je.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new AE(c,l,Fo(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Rt;a.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Et("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Je.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new LE(c,l,Fo(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Et("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Je.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Et("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Je.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Et("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Je.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Et("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Je.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class $y{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return T(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class jE extends $y{}class FE extends $y{}const yp=15e3;class BE{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return T(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var m;c[h]=d;const b=c.reduce((v,w)=>v+w,0);(m=n==null?void 0:n.onProgress)===null||m===void 0||m.call(n,b)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>T(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:m=>{l(m,h+1)}})})))),u.info})}streamText(e){return T(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Oe.GCM:Oe.NONE},a=new ma({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:ui(o.timestamp),totalLength:ui(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new jv({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Gl.UPDATE:Gl.CREATE})}}),c=e==null?void 0:e.destinationIdentities,l=new Qe({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,X.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(v){return T(this,void 0,void 0,function*(){for(const w of Nw(v,yp)){const p=new ga({content:w,streamId:s,chunkIndex:ui(u)}),g=new Qe({destinationIdentities:c,value:{case:"streamChunk",value:p}});yield d.sendDataPacket(g,X.RELIABLE),u+=1}})},close(){return T(this,void 0,void 0,function*(){const v=new va({streamId:s}),w=new Qe({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield d.sendDataPacket(w,X.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let m=()=>T(this,void 0,void 0,function*(){yield b.close()});d.once(F.Closing,m);const b=new jE(h,o,()=>this.engine.off(F.Closing,m));return b})}sendFile(e,n){return T(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return T(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o,a;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e==null?void 0:e.destinationIdentities,u={id:c,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Oe.GCM:Oe.NONE},d=new ma({totalLength:ui((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:ui(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new Fv({name:u.name})}}),h=new Qe({destinationIdentities:l,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,X.RELIABLE);let m=0;const b=new Xe,v=this.engine,w=this.log,p=new WritableStream({write(S){return T(this,void 0,void 0,function*(){const f=yield b.lock();let y=0;try{for(;y<S.byteLength;){const C=S.slice(y,y+yp),P=new Qe({destinationIdentities:l,value:{case:"streamChunk",value:new ga({content:C,streamId:c,chunkIndex:ui(m)})}});yield v.sendDataPacket(P,X.RELIABLE),m+=1,y+=C.byteLength}}finally{f()}})},close(){return T(this,void 0,void 0,function*(){const S=new va({streamId:c}),f=new Qe({destinationIdentities:l,value:{case:"streamTrailer",value:S}});yield v.sendDataPacket(f,X.RELIABLE)})},abort(S){w.error("Sink error:",S)}});return new FE(p,u)})}}class Ky extends M{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?j.Muted:j.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(j.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),zd)),uw()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(j.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class VE extends Ky{constructor(e,n,i,r,s,o){super(e,n,M.Kind.Audio,i,o),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Ya(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;rn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(rn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return T(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(du(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&du(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(j.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(j.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Jc=100;class zE extends Ky{constructor(e,n,i,r,s){super(e,n,M.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Ya(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=jd(()=>{this.updateDimensions()},Jc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===M.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?or(this._mediaStreamTrack,n):Ji(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new WE(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<Jc){Be.setTimeout(()=>{this.updateVisibility()},Jc);return}this.lastVisible=a,this.emit(j.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(j.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Kf():n||(Kf()>2?2:1)}}class WE{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Vr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Vr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Vr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??vu(e),this.isPiP=ct()&&Vr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=vu(this.element),this.isPiP=Vr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Gf().observe(this.element),Hf().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Gf())===null||e===void 0||e.unobserve(this.element),(n=Hf())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Vr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?vu(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function vu(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class dn extends on.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Oe.NONE,this.log=Y,this.handleMuted=()=>{this.emit(j.Muted)},this.handleUnmuted=()=>{this.emit(j.Unmuted)},this.log=wn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Ht.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=M.Source.Unknown}setTrack(e){this.track&&(this.track.off(j.Muted,this.handleMuted),this.track.off(j.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(j.Muted,this.handleMuted),e.on(j.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Z(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Oe.NONE}get audioTrack(){if(nn(this.track))return this.track}get videoTrack(){if(si(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=M.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===M.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(dn||(dn={}));class yu extends dn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(j.Ended)},this.handleCpuConstrained=()=>{this.track&&si(this.track)&&this.emit(j.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(j.Ended,this.handleTrackEnded),this.track.off(j.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(j.Ended,this.handleTrackEnded),e.on(j.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(nn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Ae.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Ae.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Ae.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Ae.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ae.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ae.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Xa(t,e){return T(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=Oy(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=xy(s,Uy,jy),l=Ad(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Le.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Le.userMediaPromiseMap.delete("audioinput"))),s.video&&(Le.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Le.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>T(this,void 0,void 0,function*(){const m=h.kind==="audio";let b=m?c.audio:c.video;(typeof b=="boolean"||!b)&&(b={});let v;const w=m?l.audio:l.video;typeof w!="boolean"&&(v=w);const p=h.getSettings().deviceId;v!=null&&v.deviceId&&Qn(v.deviceId)!==p?v.deviceId=p:v||(v={deviceId:p});const g=vE(h,v,e);return g.kind===M.Kind.Video?g.source=M.Source.Camera:g.kind===M.Kind.Audio&&(g.source=M.Source.Microphone),g.mediaStream=d,nn(g)&&i?yield g.setProcessor(i):si(g)&&r&&(yield g.setProcessor(r)),g})))}catch(d){if(!n)throw d;return Xa(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function qE(t){return T(this,void 0,void 0,function*(){return(yield Xa({audio:!1,video:!0}))[0]})}function $E(t){return T(this,void 0,void 0,function*(){return(yield Xa({audio:!0,video:!1}))[0]})}var Ln;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Ln||(Ln={}));function KE(t){switch(t){case Kr.EXCELLENT:return Ln.Excellent;case Kr.GOOD:return Ln.Good;case Kr.POOR:return Ln.Poor;case Kr.LOST:return Ln.Lost;default:return Ln.Unknown}}class Hy extends on.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ei.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===ir.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ei.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ln.Unknown,this.log=Y,this.log=wn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Ht.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Rt,this.once(A.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(M.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(M.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(M.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ir.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==ir.ACTIVE&&this.emit(A.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(A.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(A.ParticipantNameChanged,e)}_setAttributes(e){const n=dw(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(A.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(A.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(A.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=KE(e),n!==this._connectionQuality&&this.emit(A.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>nn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(j.Muted,()=>{this.emit(A.TrackMuted,e)}),e.on(j.Unmuted,()=>{this.emit(A.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case M.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case M.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function HE(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new qv({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class GE extends Hy{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Oe.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Rt)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(l=this.signalConnectedFuture).reject)===null||u===void 0||u.call(l,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Rt),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:u}=a,d=this.pendingSignalRequests.get(c);d&&(l!==Od.OK&&d.reject(new Vf(u,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,u=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(u=Se.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>HE(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Z(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Z(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Z(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Z(c))),this.emit(A.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>T(this,void 0,void 0,function*(){var c,l,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const m=this.videoTrackPublications.get(a.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!m.videoTrack)return;const b=yield m.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,w=mn(b),p;p=yield w.next(),c=p.done,!c;v=!0){d=p.value,v=!1;const g=d;ow(g)&&(this.log.debug("publish ".concat(g," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Z(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,g,m.options))}}catch(g){l={error:g}}finally{try{!v&&!c&&(u=w.return)&&(yield u.call(w))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>T(this,void 0,void 0,function*(){if(a.source===M.Source.ScreenShare||a.source===M.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Z(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(cn(a)||In(a))try{if(ct())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===M.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),Z(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Z(a))),cn(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Z(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Oe.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(F.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(F.Connected,this.handleReconnected).on(F.SignalConnected,this.handleSignalConnected).on(F.SignalRestarted,this.handleReconnected).on(F.SignalResumed,this.handleReconnected).on(F.Restarting,this.handleReconnecting).on(F.Resuming,this.handleReconnecting).on(F.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(F.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(F.Closing,this.handleClosing).on(F.SignalRequestResponse,this.handleSignalRequestResponse).on(F.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return T(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>T(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),m=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:b=>{c(b),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-m<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(b=>{let[v,w]=b;return this.attributes[v]===w||w===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(h),a();return}yield Ve(50)}c(new Vf("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(M.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(M.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(M.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){this.encryptionType=e?Oe.GCM:Oe.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return T(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case M.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case M.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case M.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new gn(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(A.MediaDevicesError,l,cu(e)),this.pendingPublishing.delete(e),l}for(const l of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===M.Source.Microphone&&nn(l)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Z(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===M.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(M.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(M.Source.Camera)||this.pendingPublishing.has(M.Source.Microphone))){this.pendingPublishing.add(M.Source.Camera),this.pendingPublishing.add(M.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(M.Source.Camera),this.pendingPublishing.delete(M.Source.Microphone)}}})}createTracks(e){return T(this,void 0,void 0,function*(){var n,i;e??(e={});const r=xy(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Xa(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(nn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=M.Source.Microphone,this.emit(A.AudioStreamAcquired)),si(a)&&(this.cameraError=void 0,a.source=M.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return T(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Dd("getDisplayMedia not supported");e.resolution===void 0&&!bw()&&(e.resolution=Md.h1080fps30.resolution);const n=cw(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new gn("no video track found");const s=new ba(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=M.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(A.AudioStreamAcquired);const a=new ka(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=M.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;cn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),ar(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let p;switch(i.source){case M.Source.Microphone:p="audioinput";break;case M.Source.Camera:p="videoinput"}p&&s.activeDeviceMap.has(p)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(p)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new ka(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new ba(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new gn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(p=>{p.track&&p.track===i&&(h=p)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Z(h))),h;const m=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),b="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,v=(c=m.forceStereo)!==null&&c!==void 0?c:b;v&&(m.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Z(i))),m.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=m.dtx)!==null&&l!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!Tw()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const w=new Promise((p,g)=>T(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ae.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Z(i)}));let S=!1;const f=setTimeout(()=>{S=!0,i.stop(),g(new Bf("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(f),S)return;const y=yield this.publish(i,m,v);p(y)}else try{const S=yield this.publish(i,m,v);p(S)}catch(S){g(S)}}catch(S){g(S)}}));s.pendingPublishPromises.set(i,w);try{return yield w}catch(p){throw p}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Rt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Z(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>hw(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Z(e))),!1)}publish(e,n,i){return T(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,m;if(!this.hasPermissionsToPublish(e))throw new Bf("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(N=>ar(e)&&N.source===e.source)&&e.source!==M.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Z(e))),n.stopMicTrackOnMute&&nn(e)&&(e.stopOnMute=!0),e.source===M.Source.ScreenShare&&Pi()&&(n.simulcast=!1),n.videoCodec==="av1"&&!vw()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!yw()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=pu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(N=>n.videoCodec===os(N.mime))||(n.videoCodec=os(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(j.Muted,this.onTrackMuted),e.on(j.Unmuted,this.onTrackUnmuted),e.on(j.Ended,this.handleTrackEnded),e.on(j.UpstreamPaused,this.onTrackUpstreamPaused),e.on(j.UpstreamResumed,this.onTrackUpstreamResumed),e.on(j.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const w=[],p=!(!((r=n.dtx)!==null&&r!==void 0)||r),g=e.getSourceTrackSettings();g.autoGainControl&&w.push(Ae.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&w.push(Ae.TF_ECHO_CANCELLATION),g.noiseSuppression&&w.push(Ae.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&w.push(Ae.TF_STEREO),p&&w.push(Ae.TF_NO_DTX),cn(e)&&e.hasPreConnectBuffer&&w.push(Ae.TF_PRECONNECT_BUFFER);const S=new xs({cid:e.mediaStreamTrack.id,name:n.name,type:M.kindToProto(e.kind),muted:e.isMuted,source:M.sourceToProto(e.source),disableDtx:p,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:w});let f;if(e.kind===M.Kind.Video){let N={width:0,height:0};try{N=yield e.waitForDimensions()}catch{const O=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Rs.h720.resolution;N={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Z(e)),{dims:N}))}S.width=N.width,S.height=N.height,In(e)&&(Vt(v)&&(e.source===M.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Z(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new Ql({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:pu}),n.backupCodec&&v!==n.backupCodec.codec&&S.encryption===Oe.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new Ql({codec:n.backupCodec.codec,cid:""})))),f=gu(e.source===M.Source.ScreenShare,S.width,S.height,n),S.layers=pp(S.width,S.height,f,Vt(n.videoCodec))}else e.kind===M.Kind.Audio&&(f=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(m=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Re("cannot publish track when not connected");const y=()=>T(this,void 0,void 0,function*(){var N,R,O;if(!this.engine.pcManager)throw new Re("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,f),this.emit(A.LocalSenderCreated,e.sender,e),In(e)&&((N=n.degradationPreference)!==null&&N!==void 0||(n.degradationPreference=_E(e)),e.setDegradationPreference(n.degradationPreference)),f)if(Pi()&&e.kind===M.Kind.Audio){let z;for(const V of this.engine.pcManager.publisher.getTransceivers())if(V.sender===e.sender){z=V;break}z&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:z,codec:"opus",maxbr:!((R=f[0])===null||R===void 0)&&R.maxBitrate?f[0].maxBitrate/1e3:0})}else e.codec&&Vt(e.codec)&&(!((O=f[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:f[0].maxBitrate/1e3});yield this.engine.negotiate()});let C;const P=new Promise((N,R)=>T(this,void 0,void 0,function*(){var O;try{C=yield this.engine.addTrack(S),N(C)}catch(z){e.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(V=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Z(e)),{error:V}))})),R(z)}}));if(this.enabledPublishVideoCodecs.length>0)C=(yield Promise.all([P,y()]))[0];else{C=yield P;let N;if(C.codecs.forEach(R=>{N===void 0&&(N=R.mimeType)}),N&&e.kind===M.Kind.Video){const R=os(N);R!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Z(e)),{codec:R})),n.videoCodec=R,f=gu(e.source===M.Source.ScreenShare,S.width,S.height,n))}yield y()}const x=new yu(e.kind,C,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(x.on(j.CpuConstrained,N=>this.onTrackCpuConstrained(N,x)),x.options=n,e.sid=C.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:f,trackInfo:C})),In(e)?e.startMonitor(this.engine.client):cn(e)&&e.startMonitor(),this.addTrackPublication(x),this.emit(A.LocalTrackPublished,x),cn(e)&&C.audioFeatures.includes(Ae.TF_PRECONNECT_BUFFER)){const N=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(A.LocalTrackSubscribed,O=>{if(O.trackSid===C.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Z(e))),e.stopPreConnectBuffer()}}),N&&new Promise((z,V)=>T(this,void 0,void 0,function*(){var Te,ft,nt,Tt,W,J;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Z(e)));const H=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),B=yield this.waitUntilActiveAgentPresent();clearTimeout(H),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Z(e)));const G=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[B.identity],attributes:{trackId:x.trackSid,sampleRate:String((W=g.sampleRate)!==null&&W!==void 0?W:"48000"),channels:String((J=g.channelCount)!==null&&J!==void 0?J:"1")}});try{for(var I=!0,K=mn(N),q;q=yield K.next(),Te=q.done,!Te;I=!0){Tt=q.value,I=!1;const ve=Tt;yield G.write(ve)}}catch(ve){ft={error:ve}}finally{try{!I&&!Te&&(nt=K.return)&&(yield nt.call(K))}finally{if(ft)throw ft.error}}yield G.close(),z()}catch(H){V(H)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Z(e)))}).catch(z=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Z(e)),{error:z}))})}return x})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return T(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Oe.NONE)return;let s;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(s=m)}),!s)throw new gn("track is not published");if(!In(e))throw new gn("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=wE(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Z(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new xs({cid:c.mediaStreamTrack.id,type:M.kindToProto(e.kind),muted:e.isMuted,source:M.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=pp(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Re("cannot publish track when not connected");const u=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return T(this,void 0,void 0,function*(){var i,r;if(ar(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Z(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Z(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(j.Muted,this.onTrackMuted),e.off(j.Unmuted,this.onTrackUnmuted),e.off(j.Ended,this.handleTrackEnded),e.off(j.UpstreamPaused,this.onTrackUpstreamPaused),e.off(j.UpstreamResumed,this.onTrackUpstreamResumed),e.off(j.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ye.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),In(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case M.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case M.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(A.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return T(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>T(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>T(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==M.Source.ScreenShare&&l.source!==M.Source.ScreenShareAudio&&(cn(l)||In(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?X.RELIABLE:X.LOSSY,o=r.destinationIdentities,a=r.topic;let c=new Td({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const l=new Qe({kind:s,value:{case:"user",value:c}});yield i.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return T(this,void 0,void 0,function*(){const i=new Qe({kind:X.RELIABLE,value:{case:"sipDtmf",value:new Rv({code:e,digit:n})}});yield this.engine.sendDataPacket(i,X.RELIABLE)})}sendChatMessage(e,n){return T(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Qe({value:{case:"chatMessage",value:new pa(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,X.RELIABLE),this.emit(A.ChatMessage,i),i})}editChatMessage(e,n){return T(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Qe({value:{case:"chatMessage",value:new pa(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp),editTimestamp:fe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,X.RELIABLE),this.emit(A.ChatMessage,i),i})}sendText(e,n){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return T(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((u,d)=>T(i,void 0,void 0,function*(){var h,m,b,v;if(Vd(o)>By){d(Se.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||m===void 0)&&m.version&&sn((v=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){d(Se.builtIn("UNSUPPORTED_SERVER"));return}const w=Math.max(a,8e3),p=crypto.randomUUID();yield this.publishRpcRequest(r,p,s,o,w);const g=setTimeout(()=>{this.pendingAcks.delete(p),d(Se.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(S)},7e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(g)},participantIdentity:r});const S=setTimeout(()=>{this.pendingResponses.delete(p),d(Se.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(f,y)=>{clearTimeout(S),this.pendingAcks.has(p)&&(this.log.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(g)),y?d(y):u(f??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return T(this,void 0,void 0,function*(){const o=new Qe({destinationIdentities:[e],kind:X.RELIABLE,value:{case:"rpcRequest",value:new Cd({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,X.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Se.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Z(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Rt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(cn(r)||In(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return T(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Ve(20)}})}}class JE extends dn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(j.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Ga({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ov({participantSid:"",trackSids:[this.trackSid]})]});this.emit(j.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?dn.SubscriptionStatus.Unsubscribed:super.isSubscribed?dn.SubscriptionStatus.Subscribed:dn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?dn.PermissionStatus.Allowed:dn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(zc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&zc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:vt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(j.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(j.VisibilityChanged,this.handleVisibilityChange),r.off(j.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(j.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(j.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(j.VisibilityChanged,this.handleVisibilityChange),e.on(j.Ended,this.handleEnded),this.emit(j.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(j.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?j.Muted:j.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(j.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(j.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return zc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Bv({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===M.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Wf(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=fw(this.trackInfo,this.requestedMaxQuality);i&&Wf(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:vt.HIGH})),e.quality=vt.HIGH)}this.emit(j.UpdateSettings,e)}}class Sa extends Hy{static fromParticipantInfo(e,n,i){return new Sa(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ei.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(j.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Z(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(j.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(j.SubscriptionPermissionChanged,n=>{this.emit(A.TrackSubscriptionPermissionChanged,e,n)}),e.on(j.SubscriptionStatusChanged,n=>{this.emit(A.TrackSubscriptionStatusChanged,e,n)}),e.on(j.Subscribed,n=>{this.emit(A.TrackSubscribed,n,e)}),e.on(j.Unsubscribed,n=>{this.emit(A.TrackUnsubscribed,n,e)}),e.on(j.SubscriptionFailed,n=>{this.emit(A.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:M.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(A.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Z(a))),this.emit(A.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new zE(e,n,r,s):l=new VE(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&hu(l)&&nn(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=M.kindFromProto(r.type);if(!c)return;a=new JE(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==M.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Z(l),newTrack:Z(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Z(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(A.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case M.Kind.Audio:this.audioTrackPublications.delete(e);break;case M.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(A.TrackUnpublished,i)}setAudioOutput(e){return T(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;nn(i.track)&&hu(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ne;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ne||(ne={}));const QE=4*1e3;class br extends on.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=ne.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Y,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>T(this,void 0,void 0,function*(){var l;if(!kw())throw rn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===ne.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(ne.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==Ay(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),kr(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new ie(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(m=>{var b;(b=this.regionUrlProvider)===null||b===void 0||b.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const d=(m,b,v)=>T(this,void 0,void 0,function*(){var w,p;this.abortController&&this.abortController.abort();const g=new AbortController;this.abortController=g,u==null||u();try{if(yield cr.getInstance().getBackOffPromise(o),g.signal.aborted)throw Q.cancelled("Connection attempt aborted");yield this.attemptConnection(v??o,a,c,g),this.abortController=void 0,m()}catch(S){if(this.regionUrlProvider&&S instanceof Q&&S.reason!==ue.Cancelled&&S.reason!==ue.NotAllowed){let f=null;try{this.log.debug("Fetching next region"),f=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(y){if(y instanceof Q&&(y.status===401||y.reason===ue.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),b(y);return}}[ue.InternalError,ue.ServerUnreachable,ue.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),cr.getInstance().addFailedConnectionAttempt(o)),f&&!(!((p=this.abortController)===null||p===void 0)&&p.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(f),this.logContext),this.recreateEngine(),yield d(m,b,f)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Qf(S)),b(S))}else{let f=zt.UNKNOWN_REASON;S instanceof Q&&(f=Qf(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,f),b(S)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Rt((m,b)=>{d(m,b,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>T(this,void 0,void 0,function*(){var h,m,b;const v=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout,singlePeerConnection:u.singlePeerConnection},d.signal);let w=v.serverInfo;if(w||(w={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(p=>{let[g,S]=p;return"".concat(g,": ").concat(S)}).join(", ")),{room:(h=v.room)===null||h===void 0?void 0:h.name,roomSid:(m=v.room)===null||m===void 0?void 0:m.sid,identity:(b=v.participant)===null||b===void 0?void 0:b.identity}),!w.version)throw new tw("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),v}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>T(this,void 0,void 0,function*(){var u,d;this.state===ne.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Bd),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(D.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const m=l.signal.aborted?Q.cancelled("Signal connection aborted"):Q.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(m.message="".concat(m.message,": ").concat(h.message)),h instanceof Q&&(m.reason=h.reason,m.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),m}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),Q.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}ct()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ct()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ne.Connected),this.emit(D.Connected),cr.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return T(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,m;const b=yield l.disconnectLock.lock();try{if(l.state===ne.Disconnected){l.log.debug("already disconnected",l.logContext);return}if(l.log.info("disconnect from room",Object.assign({},l.logContext)),l.state===ne.Connecting||l.state===ne.Reconnecting||l.isResuming){const v="Abort connection attempt due to user initiated disconnect";l.log.warn(v,l.logContext),(d=l.abortController)===null||d===void 0||d.abort(v),(m=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||m===void 0||m.call(h,Q.cancelled("Client initiated disconnect")),l.connectFuture=void 0}l.engine&&(l.engine.client.isDisconnected||(yield l.engine.client.sendLeave()),yield l.engine.close()),l.handleDisconnect(u,zt.CLIENT_INITIATED),l.engine=void 0}finally{b()}}()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const o=[],a=ht();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=Vc();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(D.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(ne.Reconnecting)&&this.emit(D.Reconnecting)},this.handleSignalRestarted=o=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(ne.Connected),this.emit(D.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===ir.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(D.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(D.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=M.streamStateFromProto(a.state);l.track.setStreamState(u),u!==l.track.streamState&&(c.emit(A.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(D.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,c,l)=>{this.emit(D.DataReceived,a.payload,o,c,a.topic,l),o==null||o.emit(A.DataReceived,a.payload,c,l)},this.handleSipDtmf=(o,a)=>{this.emit(D.SipDTMFReceived,a,o),o==null||o.emit(A.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=xw(a,this.transcriptionReceivedTimes);l==null||l.emit(j.TranscriptionReceived,u),c==null||c.emit(A.TranscriptionReceived,u,l),this.emit(D.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=Rw(a);this.emit(D.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(D.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(D.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(D.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(D.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(D.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var o;((o=ht())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(D.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(D.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(D.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(D.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(D.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(D.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(D.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(D.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>T(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(j.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(j.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(D.LocalTrackPublished,o,this.localParticipant),cn(o.track)&&(yield o.track.checkForSilence())&&this.emit(D.LocalAudioSilenceDetected,o);const m=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),b=cu(o.source);b&&m&&m!==this.localParticipant.activeDeviceMap.get(b)&&(this.localParticipant.activeDeviceMap.set(b,m),this.emit(D.ActiveDeviceChanged,b,m))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(j.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(j.Restarted,this.onLocalTrackRestarted),this.emit(D.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>T(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=cu(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(D.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(D.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(D.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(D.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(D.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},aE),e),this.log=wn((i=this.options.loggerName)!==null&&i!==void 0?i:Ht.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Uy),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},jy),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},oE),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new UE,this.outgoingDataStreamManager=new BE(this.engine,this.log),this.disconnectLock=new Xe,this.localParticipant=new GE("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Qn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Qn(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Qn(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),ct()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),br.cleanupRegistry&&br.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new Ww(i,n),this.e2eeManager.on(Bn.ParticipantEncryptionStatusChanged,(r,s)=>{Ow(s)&&(this.isE2EEEnabled=r),this.emit(D.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(Bn.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(D.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return T(this,void 0,void 0,function*(){return this.state===ne.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(F.RoomUpdate,i),e(r.sid))};this.engine.on(F.RoomUpdate,i),this.once(D.Disconnected,()=>{this.engine.off(F.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new DE(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(F.ParticipantUpdate,this.handleParticipantUpdates).on(F.RoomUpdate,this.handleRoomUpdate).on(F.SpeakersChanged,this.handleSpeakersChanged).on(F.StreamStateChanged,this.handleStreamStateUpdate).on(F.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(F.SubscriptionError,this.handleSubscriptionError).on(F.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(F.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(F.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(F.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(F.DataPacketReceived,this.handleDataPacket).on(F.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ne.SignalReconnecting)&&this.emit(D.SignalReconnecting)}).on(F.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ne.Connected)&&this.emit(D.Reconnected)}).on(F.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ne.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(F.Restarting,this.handleRestarting).on(F.SignalRestarted,this.handleSignalRestarted).on(F.Offline,()=>{this.setAndEmitConnectionState(ne.Reconnecting)&&this.emit(D.Reconnecting)}).on(F.DCBufferStatusChanged,(e,n)=>{this.emit(D.DCBufferStatusChanged,e,n)}).on(F.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(A.LocalTrackSubscribed,n),this.emitWhenConnected(D.LocalTrackSubscribed,n,this.localParticipant)}).on(F.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(D.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Le.getInstance().getDevices(e,n)}prepareConnection(e,n){return T(this,void 0,void 0,function*(){if(this.state===ne.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(kr(new URL(e))&&n){this.regionUrlProvider=new ie(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ne.Disconnected&&(this.regionUrl=i,yield fetch(Os(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Os(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return T(this,void 0,void 0,function*(){let i=()=>T(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Jt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Jt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Jt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Jt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Jt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Jt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Jt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>T(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Ja({reason:zt.CLIENT_INITIATED,action:rr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Jt({scenario:{case:"subscriberBandwidth",value:ui(n)}});break;case"leave-full-reconnect":r=new Jt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,m;let b=!0,v=!1;const w=o?{exact:r}:r;if(i==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const p=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=w;const g=Array.from(s.localParticipant.audioTrackPublications.values()).filter(f=>f.source===M.Source.Microphone);try{b=(yield Promise.all(g.map(f=>{var y;return(y=f.audioTrack)===null||y===void 0?void 0:y.setDeviceId(w)}))).every(f=>f===!0)}catch(f){throw s.options.audioCaptureDefaults.deviceId=p,f}const S=g.some(f=>{var y,C;return(C=(y=f.track)===null||y===void 0?void 0:y.isMuted)!==null&&C!==void 0?C:!1});b&&S&&(v=!0)}else if(i==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const p=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=w;const g=Array.from(s.localParticipant.videoTrackPublications.values()).filter(f=>f.source===M.Source.Camera);try{b=(yield Promise.all(g.map(f=>{var y;return(y=f.videoTrack)===null||y===void 0?void 0:y.setDeviceId(w)}))).every(f=>f===!0)}catch(f){throw s.options.videoCaptureDefaults.deviceId=p,f}const S=g.some(f=>{var y,C;return(C=(y=f.track)===null||y===void 0?void 0:y.isMuted)!==null&&C!==void 0?C:!1});b&&S&&(v=!0)}else if(i==="audiooutput"){if(v=!0,!du()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield Le.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(m=s.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const p=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(g=>g.setAudioOutput({deviceId:r})))}catch(g){throw s.options.audioOutput.deviceId=p,g}}return v&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(D.ActiveDeviceChanged,i,r)),b}()})}setupLocalParticipantEvents(){this.localParticipant.on(A.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(A.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(A.AttributesChanged,this.onLocalAttributesChanged).on(A.TrackMuted,this.onLocalTrackMuted).on(A.TrackUnmuted,this.onLocalTrackUnmuted).on(A.LocalTrackPublished,this.onLocalTrackPublished).on(A.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(A.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(A.MediaDevicesError,this.onMediaDevicesError).on(A.AudioStreamAcquired,this.startAudio).on(A.ChatMessage,this.onLocalChatMessageSent).on(A.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ne.Connecting||this.state===ne.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(D.Reconnected,d),this.off(D.Connected,d),this.off(D.Disconnected,h)};this.once(D.Reconnected,d),this.once(D.Connected,d),this.once(D.Disconnected,h);return}if(this.state===ne.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=gw(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const u=c.addSubscribedMediaTrack(e,a,n,i,l);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(D.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==ne.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(A.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(A.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(A.AttributesChanged,this.onLocalAttributesChanged).off(A.TrackMuted,this.onLocalTrackMuted).off(A.TrackUnmuted,this.onLocalTrackUnmuted).off(A.LocalTrackPublished,this.onLocalTrackPublished).off(A.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(A.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(A.MediaDevicesError,this.onMediaDevicesError).off(A.AudioStreamAcquired,this.startAudio).off(A.ChatMessage,this.onLocalChatMessageSent).off(A.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ct()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ne.Disconnected),this.emit(D.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(D.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Se.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Se.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Vd(u)>By?(c=Se.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof Se?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=Se.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var e,n,i;const r=Le.getInstance().previousDevices,s=yield Le.getInstance().getDevices(void 0,!1),o=ht();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(D.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=aw(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(m=>m.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!Is()||c==="videoinput"||d.length>0&&!d.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Is())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Iy())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ve(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(D.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Sa.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Sa(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(D.ParticipantConnected,i),i.on(A.TrackPublished,r=>{this.emitWhenConnected(D.TrackPublished,r,i)}).on(A.TrackSubscribed,(r,s)=>{r.kind===M.Kind.Audio?(r.on(j.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(j.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===M.Kind.Video&&(r.on(j.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(j.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(D.TrackSubscribed,r,s,i)}).on(A.TrackUnpublished,r=>{this.emit(D.TrackUnpublished,r,i)}).on(A.TrackUnsubscribed,(r,s)=>{this.emit(D.TrackUnsubscribed,r,s,i)}).on(A.TrackMuted,r=>{this.emitWhenConnected(D.TrackMuted,r,i)}).on(A.TrackUnmuted,r=>{this.emitWhenConnected(D.TrackUnmuted,r,i)}).on(A.ParticipantMetadataChanged,r=>{this.emitWhenConnected(D.ParticipantMetadataChanged,r,i)}).on(A.ParticipantNameChanged,r=>{this.emitWhenConnected(D.ParticipantNameChanged,r,i)}).on(A.AttributesChanged,r=>{this.emitWhenConnected(D.ParticipantAttributesChanged,r,i)}).on(A.ConnectionQualityChanged,r=>{this.emitWhenConnected(D.ConnectionQualityChanged,r,i)}).on(A.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(D.ParticipantPermissionsChanged,r,i)}).on(A.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(D.TrackSubscriptionStatusChanged,r,s,i)}).on(A.TrackSubscriptionFailed,(r,s)=>{this.emit(D.TrackSubscriptionFailed,r,i,s)}).on(A.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(D.TrackSubscriptionPermissionChanged,r,s,i)}).on(A.Active,()=>{this.emitWhenConnected(D.ParticipantActive,i),i.kind===Ei.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Iw(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Be.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,zt.STATE_MISMATCH))):e=0},QE)}clearConnectionReconcile(){this.connectionReconcileInterval&&Be.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(D.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ne.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ne.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return T(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new $a({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:fe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new wi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(D.SignalConnected),this.emit(D.Connected),this.setAndEmitConnectionState(ne.Connected),r.video){const o=new yu(M.Kind.Video,new Gi({source:Pe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ft.AUDIO,name:"video-dummy"}),new ba(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Jf(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(A.LocalTrackPublished,o)}if(r.audio){const o=new yu(M.Kind.Audio,new Gi({source:Pe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ft.AUDIO}),new ka(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Vc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(A.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new wi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:ir.ACTIVE,tracks:[],joinedAt:fe.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=Jf(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Gi({source:Pe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ft.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=Vc(),u=new Gi({source:Pe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ft.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==D.ActiveSpeakersChanged&&e!==D.TranscriptionReceived){const s=Gy(i).filter(o=>o!==void 0);(e===D.TrackSubscribed||e===D.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}br.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Gy(t){return t.map(e=>{if(e)return Array.isArray(e)?Gy(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ut;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ut||(Ut={}));class oi extends on.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ut.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new br(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return T(this,void 0,void 0,function*(){if(this.status!==Ut.IDLE)throw Error("check is running already");this.setStatus(Ut.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ut.SKIPPED&&this.setStatus(this.isSuccess()?Ut.SUCCESS:Ut.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return T(this,void 0,void 0,function*(){return this.room.state===ne.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==ne.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ut.SKIPPED)}switchProtocol(e){return T(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(D.Reconnecting,()=>{n=!0}),this.room.once(D.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ve(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class YE extends oi{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const e=new ie(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return T(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let b=0;b<c;b++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),m={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(b=>{b.type==="candidate-pair"&&b.nominated&&(m.rtt=b.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const Qc=1e4;class XE extends oi{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Qc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Qc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return T(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>T(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,Qc)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class ZE extends oi{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield $E();if(yield Ry(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class eP extends oi{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield qE();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return T(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const m=l.getContext("2d");m.drawImage(i,0,0);const v=m.getImageData(0,0,l.width,l.height).data;let w=!0;for(let p=0;p<v.length;p+=4)if(v[p]!==0||v[p+1]!==0||v[p+2]!==0){w=!1;break}w?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class tP extends oi{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(D.SignalReconnecting,a).on(D.Reconnecting,a).on(D.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==ne.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class nP extends oi{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var e,n,i;kr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new ie(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new Ld,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let o=!1,a=!1,c=!1;for(let l of s.iceServers)for(let u of l.urls)u.startsWith("turn:")?(a=!0,c=!0):u.startsWith("turns:")&&(a=!0,c=!0,o=!0),u.startsWith("stun:")&&(c=!0);c?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class iP extends oi{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(D.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(rP(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Y.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function rP(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class sP extends oi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Ld,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(o){if(kr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const c=yield new ie(this.url,this.token).getNextBestRegionUrl();c&&(s=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===Dv.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class s1 extends on.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ut.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ut.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return T(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(sP)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(iP)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(nP)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(tP)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(ZE)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(eP)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(XE);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(YE)})}}function ee(t,e,n){return(e=aP(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function oP(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function aP(t){var e=oP(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class tt extends Error{constructor(e,n){var i;super(e,n),ee(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ee(tt,"code","ERR_JOSE_GENERIC");class cP extends tt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ee(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ee(this,"claim",void 0),ee(this,"reason",void 0),ee(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ee(cP,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class lP extends tt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ee(this,"code","ERR_JWT_EXPIRED"),ee(this,"claim",void 0),ee(this,"reason",void 0),ee(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ee(lP,"code","ERR_JWT_EXPIRED");class uP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ee(uP,"code","ERR_JOSE_ALG_NOT_ALLOWED");class dP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ee(dP,"code","ERR_JOSE_NOT_SUPPORTED");class hP extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ee(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ee(hP,"code","ERR_JWE_DECRYPTION_FAILED");class fP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JWE_INVALID")}}ee(fP,"code","ERR_JWE_INVALID");class pP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JWS_INVALID")}}ee(pP,"code","ERR_JWS_INVALID");class mP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JWT_INVALID")}}ee(mP,"code","ERR_JWT_INVALID");class gP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JWK_INVALID")}}ee(gP,"code","ERR_JWK_INVALID");class vP extends tt{constructor(){super(...arguments),ee(this,"code","ERR_JWKS_INVALID")}}ee(vP,"code","ERR_JWKS_INVALID");class yP extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ee(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ee(yP,"code","ERR_JWKS_NO_MATCHING_KEY");class kP extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ee(this,Symbol.asyncIterator,void 0),ee(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ee(kP,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class bP extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ee(this,"code","ERR_JWKS_TIMEOUT")}}ee(bP,"code","ERR_JWKS_TIMEOUT");class SP extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ee(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ee(SP,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");class TP{constructor(){this.baseUrl=hn.backend.baseUrl,this.currentRoom=null}getHeaders(){return{"Content-Type":"application/json",...$t.getAuthHeader()}}async createRoomToken(e,n,i,r=null){const s={room_name:e,participant_name:n};i!=null&&i!==void 0&&(s.agent_id=i),r!=null&&r!==void 0&&r!==""&&(s.heygen_session_id=r);const o=await fetch(`${this.baseUrl}/api/livekit/token`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(s)});if(!o.ok){let a=`HTTP ${o.status}`;try{const c=await o.json();c.detail?Array.isArray(c.detail)?a=c.detail.map(l=>`${l.loc?l.loc.slice(1).join("."):"unknown"}: ${l.msg||l.message||"validation error"}`).join("; "):typeof c.detail=="string"?a=c.detail:a=JSON.stringify(c.detail):c.message?a=typeof c.message=="string"?c.message:JSON.stringify(c.message):c.error?a=typeof c.error=="string"?c.error:JSON.stringify(c.error):a=JSON.stringify(c)}catch{try{a=await o.text()||`HTTP ${o.status}: ${o.statusText}`}catch{a=`HTTP ${o.status}: ${o.statusText}`}}throw new Error(`Failed to create room token: ${a}`)}return await o.json()}async connectToRoom(e,n,i,r=null,s,o,a){const c=await this.createRoomToken(e,n,i,r),l=new br({adaptiveStream:!0,dynacast:!0});l.on(D.TrackSubscribed,(u,d,h)=>{s&&s(u,d,h)}),l.on(D.ParticipantConnected,u=>{o&&o(u)}),l.on(D.Disconnected,()=>{a&&a()}),await l.connect(c.url,c.token);try{await l.localParticipant.setMicrophoneEnabled(!0)}catch{}return this.currentRoom=l,l}async disconnect(){this.currentRoom&&(await this.currentRoom.disconnect(),this.currentRoom=null)}getCurrentRoom(){return this.currentRoom}async publishTracks(e){if(!this.currentRoom)throw new Error("Not connected to a room");const n=e.getVideoTracks()[0];n&&await this.currentRoom.localParticipant.publishTrack(n,{source:M.Source.Camera});const i=e.getAudioTracks()[0];i&&await this.currentRoom.localParticipant.publishTrack(i,{source:M.Source.Microphone})}}const Gr=new TP;async function Qt(t,e={},n=3,i=3e4){const r=new AbortController,s=setTimeout(()=>r.abort(),i);try{const o=await fetch(t,{...e,signal:r.signal});return clearTimeout(s),o}catch(o){if(clearTimeout(s),n>0&&(o.name==="AbortError"||o.name==="TypeError"||o.message.includes("network")))return await new Promise(a=>setTimeout(a,1e3)),Qt(t,e,n-1,i);throw o}}class CP{constructor(){this.apiKey=hn.heygen.apiKey,this.serverUrl=hn.heygen.serverUrl}async fetchVoices(){let e=await Qt(`${this.serverUrl}/v2/voices`,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4);if(e.ok||(e=await Qt(`${this.serverUrl}/v1/voices.list`,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4)),e.ok){const n=await e.json();return this._parseVoicesResponse(n)}return[]}async fetchAvatars(){const e=`${this.serverUrl}/v1/streaming/avatar.list`,n=await Qt(e,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},3,3e4);if(n.ok){const i=await n.json();return this._parseAvatarsResponse(i)}return[]}async createSession(e,n,i){const r={quality:e,avatar_name:n,voice:{voice_id:i}},s=await Qt(`${this.serverUrl}/v1/streaming.new`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify(r)},3,6e4),o=await s.json();if(!s.ok){const a=o.message||o.error||`Server error (${s.status})`;throw new Error(a)}if(s.status===500)throw new Error("Server error");return o.data}async startSession(e,n){const i=await Qt(`${this.serverUrl}/v1/streaming.start`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,sdp:n})},3,6e4);if(i.status===500)throw new Error("Server error");return(await i.json()).data}async submitIceCandidate(e,n){fetch(`${this.serverUrl}/v1/streaming.ice`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,candidate:n})}).catch(()=>{})}async sendTask(e,n){const i=await Qt(`${this.serverUrl}/v1/streaming.task`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e,text:n})},3,3e4);if(i.status===500)throw new Error("Server error");return(await i.json()).data}async stopSession(e){const n=await Qt(`${this.serverUrl}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e})},2,2e4);if(n.status===500)throw new Error("Server error");return(await n.json()).data}stopSessionSync(e){if(e)try{const n=`${this.serverUrl}/v1/streaming.stop`,i=JSON.stringify({session_id:e}),r=new Blob([i],{type:"application/json"}),s=`${n}?x-api-key=${encodeURIComponent(this.apiKey)}`;navigator.sendBeacon(s,r)||fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:i,keepalive:!0}).catch(()=>{})}catch{}}async listSessions(){const e=[`${this.serverUrl}/v1/sessions.list`,`${this.serverUrl}/v1/streaming.list`,`${this.serverUrl}/v1/sessions`];for(const n of e)try{const i=await Qt(n,{method:"GET",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey}},2,2e4);if(i.ok){const r=await i.json();return this._parseSessionsResponse(r)}}catch{}return[]}async closeSessionById(e){try{const n=await Qt(`${this.serverUrl}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({session_id:e})},2,2e4);return n.ok?{success:!0,data:await n.json()}:{success:!1,error:(await n.json()).message||"Failed to close session"}}catch(n){return{success:!1,error:n.message}}}_parseVoicesResponse(e){let n=[];return e.data&&Array.isArray(e.data)?n=e.data:e.data&&e.data.voices&&Array.isArray(e.data.voices)?n=e.data.voices:e.voices&&Array.isArray(e.voices)?n=e.voices:Array.isArray(e)&&(n=e),n.length>0?n.map(i=>({id:i.voice_id||i.id||i.voiceId,name:i.name||i.display_name||i.displayName||`${i.voice_id||i.id||i.voiceId} (${i.language||i.lang||"Unknown"})`})):[]}_parseAvatarsResponse(e){let n=[];if(e.data&&Array.isArray(e.data)?n=e.data:e.data&&e.data.avatars&&Array.isArray(e.data.avatars)?n=e.data.avatars:e.avatars&&Array.isArray(e.avatars)?n=e.avatars:Array.isArray(e)&&(n=e),n.length>0){const i=n.filter(s=>{var a,c;return s.is_streaming===!0||s.is_streaming_avatar===!0||s.streaming_enabled===!0||s.type==="streaming"||s.type==="interactive"||s.avatar_type==="streaming"||s.avatar_type==="interactive"||((a=s.capabilities)==null?void 0:a.includes("streaming"))||((c=s.capabilities)==null?void 0:c.includes("interactive"))||s.is_streaming===void 0&&s.is_streaming_avatar===void 0&&s.streaming_enabled===void 0&&s.type===void 0&&s.avatar_type===void 0});return(i.length>0?i:n).map(s=>({id:s.avatar_id||s.id||s.avatarId,name:s.name||s.display_name||s.displayName||s.avatar_name||`${s.avatar_id||s.id||s.avatarId}`,isStreaming:s.is_streaming||s.is_streaming_avatar||s.streaming_enabled||!0}))}return[]}_parseSessionsResponse(e){return e.data&&Array.isArray(e.data)?e.data:e.sessions&&Array.isArray(e.sessions)?e.sessions:Array.isArray(e)?e:[]}}const pi=new CP;function wP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ku={exports:{}},EP=ku.exports,kp;function PP(){return kp||(kp=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(EP,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var p=v[w];if(typeof p.bind=="function")return p.bind(v);try{return Function.prototype.bind.call(p,v)}catch{return function(){return Function.prototype.apply.apply(p,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),w=0;w<r.length;w++){var p=r[w];this[p]=w<v?e:this.methodFactory(p,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function h(v,w,p){return l(v)||d.apply(this,arguments)}function m(v,w){var p=this,g,S,f,y="loglevel";typeof v=="string"?y+=":"+v:typeof v=="symbol"&&(y=void 0);function C(O){var z=(r[O]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=z;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+z+";"}catch{}}}function P(){var O;if(!(typeof window===n||!y)){try{O=window.localStorage[y]}catch{}if(typeof O===n)try{var z=window.document.cookie,V=encodeURIComponent(y),Te=z.indexOf(V+"=");Te!==-1&&(O=/^([^;]+)/.exec(z.slice(Te+V.length+1))[1])}catch{}return p.levels[O]===void 0&&(O=void 0),O}}function x(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(O){var z=O;if(typeof z=="string"&&p.levels[z.toUpperCase()]!==void 0&&(z=p.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=p.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+O)}p.name=v,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=w||h,p.getLevel=function(){return f??S??g},p.setLevel=function(O,z){return f=N(O),z!==!1&&C(f),u.call(p)},p.setDefaultLevel=function(O){S=N(O),P()||p.setLevel(O,!1)},p.resetLevel=function(){f=null,x(),u.call(p)},p.enableAll=function(O){p.setLevel(p.levels.TRACE,O)},p.disableAll=function(O){p.setLevel(p.levels.SILENT,O)},p.rebuild=function(){if(o!==p&&(g=N(o.getLevel())),u.call(p),o===p)for(var O in s)s[O].rebuild()},g=N(o?o.getLevel():"WARN");var R=P();R!=null&&(f=N(R)),u.call(p)}o=new m,o.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[v];return w||(w=s[v]=new m(v,o.methodFactory)),w};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return s},o.default=o,o})}(ku)),ku.exports}var _P=PP();const xP=wP(_P);var bu=function(t,e){return bu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},bu(t,e)};function Pn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");bu(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function RP(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,[])).next())})}function Jy(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Sr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ta(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Ca(t,e,n){if(arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function ur(t){return this instanceof ur?(this.v=t,this):new ur(t)}function IP(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(m){return function(b){return Promise.resolve(b).then(m,d)}}function a(m,b){i[m]&&(r[m]=function(v){return new Promise(function(w,p){s.push([m,v,w,p])>1||c(m,v)})},b&&(r[m]=b(r[m])))}function c(m,b){try{l(i[m](b))}catch(v){h(s[0][3],v)}}function l(m){m.value instanceof ur?Promise.resolve(m.value.v).then(u,d):h(s[0][2],m)}function u(m){c("next",m)}function d(m){c("throw",m)}function h(m,b){m(b),s.shift(),s.length&&c(s[0][0],s[0][1])}}function OP(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Sr=="function"?Sr(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function De(t){return typeof t=="function"}function qd(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Yc=qd(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function wa(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Bs=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Sr(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(De(u))try{u()}catch(v){s=v instanceof Yc?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Sr(d),m=h.next();!m.done;m=h.next()){var b=m.value;try{bp(b)}catch(v){s=s??[],v instanceof Yc?s=Ca(Ca([],Ta(s)),Ta(v.errors)):s.push(v)}}}catch(v){i={error:v}}finally{try{m&&!m.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(s)throw new Yc(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)bp(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&wa(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&wa(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Qy=Bs.EMPTY;function Yy(t){return t instanceof Bs||t&&"closed"in t&&De(t.remove)&&De(t.add)&&De(t.unsubscribe)}function bp(t){De(t)?t():t.unsubscribe()}var NP={Promise:void 0},DP={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Ca([t,e],Ta(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Xy(t){DP.setTimeout(function(){throw t})}function Sp(){}function Bo(t){t()}var $d=function(t){Pn(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,Yy(n)&&n.add(i)):i.destination=LP,i}return e.create=function(n,i,r){return new Su(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Bs),MP=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){ho(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){ho(i)}else ho(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){ho(n)}},t}(),Su=function(t){Pn(e,t);function e(n,i,r){var s=t.call(this)||this,o;return De(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new MP(o),s}return e}($d);function ho(t){Xy(t)}function AP(t){throw t}var LP={closed:!0,next:Sp,error:AP,complete:Sp},Kd=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Zy(t){return t}function UP(t){return t.length===0?Zy:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var je=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=FP(e)?e:new Su(e,n,i);return Bo(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=Tp(n),new n(function(r,s){var o=new Su({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Kd]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return UP(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Tp(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function Tp(t){var e;return(e=t??NP.Promise)!==null&&e!==void 0?e:Promise}function jP(t){return t&&De(t.next)&&De(t.error)&&De(t.complete)}function FP(t){return t&&t instanceof $d||jP(t)&&Yy(t)}function BP(t){return De(t==null?void 0:t.lift)}function Vs(t){return function(e){if(BP(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ea(t,e,n,i,r){return new VP(t,e,n,i,r)}var VP=function(t){Pn(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}($d),zP=qd(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),e0=function(t){Pn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new Cp(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new zP},e.prototype.next=function(n){var i=this;Bo(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Sr(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;Bo(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;Bo(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?Qy:(this.currentObservers=null,a.push(n),new Bs(function(){i.currentObservers=null,wa(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new je;return n.source=this,n},e.create=function(n,i){return new Cp(n,i)},e}(je),Cp=function(t){Pn(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:Qy},e}(e0);(function(t){Pn(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(e0);var WP={now:function(){return Date.now()}},qP=function(t){Pn(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Bs),wp={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Ca([t,e],Ta(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},$P=function(t){Pn(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),wp.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&wp.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,wa(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(qP),Ep=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=WP.now,t}(),KP=function(t){Pn(e,t);function e(n,i){i===void 0&&(i=Ep.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(Ep);new KP($P);function HP(t){return t&&De(t.schedule)}function GP(t){return t[t.length-1]}function t0(t){return HP(GP(t))?t.pop():void 0}var n0=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function i0(t){return De(t==null?void 0:t.then)}function r0(t){return De(t[Kd])}function s0(t){return Symbol.asyncIterator&&De(t==null?void 0:t[Symbol.asyncIterator])}function o0(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function JP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var a0=JP();function c0(t){return De(t==null?void 0:t[a0])}function l0(t){return IP(this,arguments,function(){var e,n,i,r;return Jy(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ur(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,ur(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ur(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function u0(t){return De(t==null?void 0:t.getReader)}function zs(t){if(t instanceof je)return t;if(t!=null){if(r0(t))return QP(t);if(n0(t))return YP(t);if(i0(t))return XP(t);if(s0(t))return d0(t);if(c0(t))return ZP(t);if(u0(t))return e_(t)}throw o0(t)}function QP(t){return new je(function(e){var n=t[Kd]();if(De(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function YP(t){return new je(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function XP(t){return new je(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Xy)})}function ZP(t){return new je(function(e){var n,i;try{for(var r=Sr(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function d0(t){return new je(function(e){t_(t,e).catch(function(n){return e.error(n)})})}function e_(t){return d0(l0(t))}function t_(t,e){var n,i,r,s;return RP(this,void 0,void 0,function(){var o,a;return Jy(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=OP(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function yi(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function h0(t,e){return e===void 0&&(e=0),Vs(function(n,i){n.subscribe(Ea(i,function(r){return yi(i,t,function(){return i.next(r)},e)},function(){return yi(i,t,function(){return i.complete()},e)},function(r){return yi(i,t,function(){return i.error(r)},e)}))})}function f0(t,e){return e===void 0&&(e=0),Vs(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function n_(t,e){return zs(t).pipe(f0(e),h0(e))}function i_(t,e){return zs(t).pipe(f0(e),h0(e))}function r_(t,e){return new je(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function s_(t,e){return new je(function(n){var i;return yi(n,e,function(){i=t[a0](),yi(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return De(i==null?void 0:i.return)&&i.return()}})}function p0(t,e){if(!t)throw new Error("Iterable cannot be null");return new je(function(n){yi(n,e,function(){var i=t[Symbol.asyncIterator]();yi(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function o_(t,e){return p0(l0(t),e)}function a_(t,e){if(t!=null){if(r0(t))return n_(t,e);if(n0(t))return r_(t,e);if(i0(t))return i_(t,e);if(s0(t))return p0(t,e);if(c0(t))return s_(t,e);if(u0(t))return o_(t,e)}throw o0(t)}function c_(t,e){return e?a_(t,e):zs(t)}qd(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Pr(t,e){return Vs(function(n,i){var r=0;n.subscribe(Ea(i,function(s){i.next(t.call(e,s,r++))}))})}function l_(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){d&&!c.length&&!l&&e.complete()},m=function(v){return l<i?b(v):c.push(v)},b=function(v){l++;var w=!1;zs(n(v,u++)).subscribe(Ea(e,function(p){e.next(p)},function(){w=!0},void 0,function(){if(w)try{l--;for(var p=function(){var g=c.shift();o||b(g)};c.length&&l<i;)p();h()}catch(g){e.error(g)}}))};return t.subscribe(Ea(e,m,function(){d=!0,h()})),function(){}}function m0(t,e,n){return n===void 0&&(n=1/0),De(e)?m0(function(i,r){return Pr(function(s,o){return e(i,s,r,o)})(zs(t(i,r)))},n):(typeof e=="number"&&(n=e),Vs(function(i,r){return l_(i,r,t,n)}))}function u_(t){return m0(Zy,t)}function d_(){return u_(1)}function Pp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d_()(c_(t,t0(t)))}function _r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t0(t);return Vs(function(i,r){(n?Pp(t,i,n):Pp(t,i)).subscribe(r)})}var h_=Object.defineProperty,f_=Object.defineProperties,p_=Object.getOwnPropertyDescriptors,_p=Object.getOwnPropertySymbols,m_=Object.prototype.hasOwnProperty,g_=Object.prototype.propertyIsEnumerable,xp=(t,e,n)=>e in t?h_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,v_=(t,e)=>{for(var n in e||(e={}))m_.call(e,n)&&xp(t,n,e[n]);if(_p)for(var n of _p(e))g_.call(e,n)&&xp(t,n,e[n]);return t},y_=(t,e)=>f_(t,p_(e));function k_(t){return typeof t>"u"?!1:b_(t)||S_(t)}function b_(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function S_(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function T_(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function C_(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(T_(t))return`${t.participant.identity}_${t.source}_placeholder`;if(k_(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var w_=[D.ConnectionStateChanged,D.RoomMetadataChanged,D.ActiveSpeakersChanged,D.ConnectionQualityChanged,D.ParticipantConnected,D.ParticipantDisconnected,D.ParticipantPermissionsChanged,D.ParticipantMetadataChanged,D.ParticipantNameChanged,D.ParticipantAttributesChanged,D.TrackMuted,D.TrackUnmuted,D.TrackPublished,D.TrackUnpublished,D.TrackStreamStateChanged,D.TrackSubscriptionFailed,D.TrackSubscriptionPermissionChanged,D.TrackSubscriptionStatusChanged],E_=[...w_,D.LocalTrackPublished,D.LocalTrackUnpublished],P_=[A.TrackPublished,A.TrackUnpublished,A.TrackMuted,A.TrackUnmuted,A.TrackStreamStateChanged,A.TrackSubscribed,A.TrackUnsubscribed,A.TrackSubscriptionPermissionChanged,A.TrackSubscriptionFailed,A.LocalTrackPublished,A.LocalTrackUnpublished],__=[A.ConnectionQualityChanged,A.IsSpeakingChanged,A.ParticipantMetadataChanged,A.ParticipantPermissionsChanged,A.TrackMuted,A.TrackUnmuted,A.TrackPublished,A.TrackUnpublished,A.TrackStreamStateChanged,A.TrackSubscriptionFailed,A.TrackSubscriptionPermissionChanged,A.TrackSubscriptionStatusChanged];[...__,A.LocalTrackPublished,A.LocalTrackUnpublished];var g0=xP.getLogger("lk-components-js");g0.setDefaultLevel("WARN");function x_(t,e){var n;return y_(v_({},t),{receivedAtMediaTimestamp:(n=e.rtpTimestamp)!=null?n:0,receivedAt:e.timestamp})}function R_(t,e,n){return[...t,...e].reduceRight((i,r)=>(i.find(s=>s.id===r.id)||i.unshift(r),i),[]).slice(0-n)}var Pa=(t=>(t.AgentState="lk.agent.state",t.PublishOnBehalf="lk.publish_on_behalf",t.TranscriptionFinal="lk.transcription_final",t.TranscriptionSegmentId="lk.segment_id",t.TranscribedTrackId="lk.transcribed_track_id",t))(Pa||{});function I_(t,...e){return new je(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(_r(t))}function O_(t,e){return new je(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function N_(t){return O_(t,D.ConnectionStateChanged).pipe(Pr(([e])=>e),_r(t.state))}function v0(t,...e){return new je(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(_r(t))}function D_(t){return v0(t,A.TrackMuted,A.TrackUnmuted,A.ParticipantPermissionsChanged,A.TrackPublished,A.TrackUnpublished,A.LocalTrackPublished,A.LocalTrackUnpublished,A.MediaDevicesError,A.TrackSubscriptionStatusChanged).pipe(Pr(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(M.Source.Microphone),o=e.getTrackPublication(M.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function M_(t,e){return new je(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function A_(t,e={}){var n;let i;const r=new je(c=>(i=c,()=>a.unsubscribe())).pipe(_r(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:E_,o=Array.from(new Set([D.ParticipantConnected,D.ParticipantDisconnected,D.ConnectionStateChanged,...s])),a=I_(t,...o).subscribe(c=>i==null?void 0:i.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&(i==null||i.next(Array.from(t.remoteParticipants.values()))),r}function Rp(t){return typeof t>"u"?new je:M_(t,A.AttributesChanged).pipe(Pr(([e])=>({changed:e,attributes:t.attributes})),_r({changed:t.attributes,attributes:t.attributes}))}function Ip(t,e,n=!1){const{sources:i,kind:r,name:s}=e;return Array.from(t.trackPublications.values()).filter(o=>(!i||i.includes(o.source))&&(!r||o.kind===r)&&(!s||o.trackName===s)&&(!n||o.track)).map(o=>({participant:t,publication:o,source:o.source}))}function L_(t,e){return v0(t,...P_).pipe(Pr(n=>{const i=Ip(n,e);return g0.debug(`TrackReference[] was updated. (length ${i.length})`,i),i}),_r(Ip(t,e)))}function y0(t,e){return new je(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function U_(t){return y0(t,j.TranscriptionReceived)}function j_(t){return y0(t,j.TimeSyncUpdate).pipe(Pr(([e])=>e))}E.createContext(void 0);E.createContext(void 0);const F_=E.createContext(void 0);function k0(){return E.useContext(F_)}const b0=E.createContext(void 0);function B_(){return E.useContext(b0)}function Hd(t){const e=B_(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}E.createContext(void 0);E.createContext(void 0);function Za(t,e,n=!0){const[i,r]=E.useState(e);return E.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function V_(t){const e=Hd(t),n=E.useMemo(()=>N_(e),[e]);return Za(n,e.state)}function z_(t={}){const e=Hd(t.room),[n,i]=E.useState(e.localParticipant),[r,s]=E.useState(n.isMicrophoneEnabled),[o,a]=E.useState(n.isCameraEnabled),[c,l]=E.useState(n.isScreenShareEnabled),[u,d]=E.useState(n.lastMicrophoneError),[h,m]=E.useState(n.lastCameraError),[b,v]=E.useState(void 0),[w,p]=E.useState(void 0),g=S=>{a(S.isCameraEnabled),s(S.isMicrophoneEnabled),l(S.isScreenShareEnabled),p(S.cameraTrack),v(S.microphoneTrack),d(S.participant.lastMicrophoneError),m(S.participant.lastCameraError),i(S.participant)};return E.useEffect(()=>{const S=D_(e.localParticipant).subscribe(g);return()=>S.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:c,isCameraEnabled:o,microphoneTrack:b,cameraTrack:w,lastMicrophoneError:u,lastCameraError:h,localParticipant:n}}function S0(t={}){const e=Hd(t.room),[n,i]=E.useState([]);return E.useEffect(()=>{const r=A_(e,{additionalRoomEvents:t.updateOnlyOn}).subscribe(i);return()=>r.unsubscribe()},[e,JSON.stringify(t.updateOnlyOn)]),n}function W_(t={}){const e=S0(t),{localParticipant:n}=z_(t);return E.useMemo(()=>[n,...e],[n,e])}function Op(t,e={}){let n,i;typeof e=="string"?n=e:(n=e==null?void 0:e.participantIdentity,i=e==null?void 0:e.room);const r=k0(),s=W_({room:i,updateOnlyOn:[]}),o=E.useMemo(()=>n?s.find(c=>c.identity===n):r,[n,s,r]),a=E.useMemo(()=>{if(o)return L_(o,{sources:t})},[o,JSON.stringify(t)]);return Za(a,[])}function q_(t){var e,n,i;const r=E.useMemo(()=>{var s;return(s=t==null?void 0:t.publication)!=null&&s.track?j_(t==null?void 0:t.publication.track):void 0},[(e=t==null?void 0:t.publication)==null?void 0:e.track]);return Za(r,{timestamp:Date.now(),rtpTimestamp:(i=(n=t==null?void 0:t.publication)==null?void 0:n.track)==null?void 0:i.rtpTimestamp})}const $_={bufferSize:100};function K_(t,e){const n={...$_,...e},[i,r]=E.useState([]),s=q_(t),o=a=>{var c;(c=n.onTranscription)==null||c.call(n,a),r(l=>R_(l,a.map(u=>x_(u,s)),n.bufferSize))};return E.useEffect(()=>{if(!(t!=null&&t.publication))return;const a=U_(t.publication).subscribe(c=>{o(...c)});return()=>{a.unsubscribe()}},[t&&C_(t),o]),{segments:i}}function H_(t={}){const e=k0(),n=t.participant??e,i=E.useMemo(()=>Rp(n),[n]);return Za(i,{attributes:n==null?void 0:n.attributes})}const Np=Pa.AgentState;function G_(){const t=S0(),e=t.find(d=>d.kind===Ei.AGENT&&!(Pa.PublishOnBehalf in d.attributes)),n=t.find(d=>d.kind===Ei.AGENT&&d.attributes[Pa.PublishOnBehalf]===(e==null?void 0:e.identity)),i=Op([M.Source.Microphone,M.Source.Camera],e==null?void 0:e.identity),r=Op([M.Source.Microphone,M.Source.Camera],n==null?void 0:n.identity),s=i.find(d=>d.source===M.Source.Microphone)??r.find(d=>d.source===M.Source.Microphone),o=i.find(d=>d.source===M.Source.Camera)??r.find(d=>d.source===M.Source.Camera),{segments:a}=K_(s),c=V_(),{attributes:l}=H_({participant:e}),u=E.useMemo(()=>c===ne.Disconnected?"disconnected":c===ne.Connecting||!e||!(l!=null&&l[Np])?"connecting":l[Np],[l,e,c]);return{agent:e,state:u,audioTrack:s,videoTrack:o,agentTranscriptions:a,agentAttributes:l}}var fo={exports:{}},Dp;function J_(){if(Dp)return fo.exports;Dp=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(f,y,C){return Function.prototype.apply.call(f,y,C)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:n=function(f){return Object.getOwnPropertyNames(f)};function i(f){console&&console.warn&&console.warn(f)}var r=Number.isNaN||function(f){return f!==f};function s(){s.init.call(this)}fo.exports=s,fo.exports.once=p,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(f){if(typeof f!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(f){if(typeof f!="number"||f<0||r(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");o=f}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(f){if(typeof f!="number"||f<0||r(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this};function c(f){return f._maxListeners===void 0?s.defaultMaxListeners:f._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(f){for(var y=[],C=1;C<arguments.length;C++)y.push(arguments[C]);var P=f==="error",x=this._events;if(x!==void 0)P=P&&x.error===void 0;else if(!P)return!1;if(P){var N;if(y.length>0&&(N=y[0]),N instanceof Error)throw N;var R=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw R.context=N,R}var O=x[f];if(O===void 0)return!1;if(typeof O=="function")e(O,this,y);else for(var z=O.length,V=b(O,z),C=0;C<z;++C)e(V[C],this,y);return!0};function l(f,y,C,P){var x,N,R;if(a(C),N=f._events,N===void 0?(N=f._events=Object.create(null),f._eventsCount=0):(N.newListener!==void 0&&(f.emit("newListener",y,C.listener?C.listener:C),N=f._events),R=N[y]),R===void 0)R=N[y]=C,++f._eventsCount;else if(typeof R=="function"?R=N[y]=P?[C,R]:[R,C]:P?R.unshift(C):R.push(C),x=c(f),x>0&&R.length>x&&!R.warned){R.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=f,O.type=y,O.count=R.length,i(O)}return f}s.prototype.addListener=function(f,y){return l(this,f,y,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(f,y){return l(this,f,y,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(f,y,C){var P={fired:!1,wrapFn:void 0,target:f,type:y,listener:C},x=u.bind(P);return x.listener=C,P.wrapFn=x,x}s.prototype.once=function(f,y){return a(y),this.on(f,d(this,f,y)),this},s.prototype.prependOnceListener=function(f,y){return a(y),this.prependListener(f,d(this,f,y)),this},s.prototype.removeListener=function(f,y){var C,P,x,N,R;if(a(y),P=this._events,P===void 0)return this;if(C=P[f],C===void 0)return this;if(C===y||C.listener===y)--this._eventsCount===0?this._events=Object.create(null):(delete P[f],P.removeListener&&this.emit("removeListener",f,C.listener||y));else if(typeof C!="function"){for(x=-1,N=C.length-1;N>=0;N--)if(C[N]===y||C[N].listener===y){R=C[N].listener,x=N;break}if(x<0)return this;x===0?C.shift():v(C,x),C.length===1&&(P[f]=C[0]),P.removeListener!==void 0&&this.emit("removeListener",f,R||y)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(f){var y,C,P;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[f]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[f]),this;if(arguments.length===0){var x=Object.keys(C),N;for(P=0;P<x.length;++P)N=x[P],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(y=C[f],typeof y=="function")this.removeListener(f,y);else if(y!==void 0)for(P=y.length-1;P>=0;P--)this.removeListener(f,y[P]);return this};function h(f,y,C){var P=f._events;if(P===void 0)return[];var x=P[y];return x===void 0?[]:typeof x=="function"?C?[x.listener||x]:[x]:C?w(x):b(x,x.length)}s.prototype.listeners=function(f){return h(this,f,!0)},s.prototype.rawListeners=function(f){return h(this,f,!1)},s.listenerCount=function(f,y){return typeof f.listenerCount=="function"?f.listenerCount(y):m.call(f,y)},s.prototype.listenerCount=m;function m(f){var y=this._events;if(y!==void 0){var C=y[f];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(f,y){for(var C=new Array(y),P=0;P<y;++P)C[P]=f[P];return C}function v(f,y){for(;y+1<f.length;y++)f[y]=f[y+1];f.pop()}function w(f){for(var y=new Array(f.length),C=0;C<y.length;++C)y[C]=f[C].listener||f[C];return y}function p(f,y){return new Promise(function(C,P){function x(R){f.removeListener(y,N),P(R)}function N(){typeof f.removeListener=="function"&&f.removeListener("error",x),C([].slice.call(arguments))}S(f,y,N,{once:!0}),y!=="error"&&g(f,x,{once:!0})})}function g(f,y,C){typeof f.on=="function"&&S(f,"error",y,C)}function S(f,y,C,P){if(typeof f.on=="function")P.once?f.once(y,C):f.on(y,C);else if(typeof f.addEventListener=="function")f.addEventListener(y,function x(N){P.once&&f.removeEventListener(y,x),C(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f)}return fo.exports}J_();function Q_({addAgentMessageToChat:t}){const{agentTranscriptions:e}=G_(),n=E.useRef(-1);return E.useEffect(()=>{if(e&&e.length>0&&e.slice(n.current+1).length>0){const r=e[e.length-1];if(r&&r.text&&r.text.trim()){const s=r.text.trim();t(s,{identity:"agent"},!0)}n.current=e.length-1}},[e,t]),null}function Y_({avatar:t,peerConnection:e,livekitRoom:n,heygenSessionId:i,onExit:r}){const[s,o]=E.useState([]),[a,c]=E.useState(!1),[l,u]=E.useState(!1),[d,h]=E.useState([]),[m,b]=E.useState(""),[v,w]=E.useState(!1),p=E.useRef(""),g=E.useRef(!1),S=E.useCallback(I=>{try{return btoa(encodeURIComponent(I).replace(/%([0-9A-F]{2})/g,(K,q)=>String.fromCharCode(parseInt(q,16))))}catch{let q=0;for(let H=0;H<I.length;H++){const B=I.charCodeAt(H);q=(q<<5)-q+B,q=q&q}return Math.abs(q).toString(36)}},[]),f=E.useCallback((I,K,q)=>{const H=`${I||"user"}-${K.substring(0,50)}-${q}-${Math.random().toString(36).substring(2,9)}`;return S(H).substring(0,16).replace(/[^a-zA-Z0-9]/g,"")},[S]),{videoRef:y,isActive:C,startWebcam:P,stopWebcam:x}=tT(),N=E.useRef(null),R=E.useRef(null),O=E.useRef(null),z=E.useCallback(I=>{const K=(I||"").toLowerCase();return["agent","bot","dakota","sage-1986"].some(q=>K.includes(q))},[]),V=E.useCallback(I=>{o(K=>[...K,I])},[]);E.useEffect(()=>{n&&(R.current=n)},[n]),E.useEffect(()=>{if(!O.current){const I=document.createElement("audio");I.autoplay=!0,I.playsInline=!0,I.id="livekit-audio",document.body.appendChild(I),O.current=I,console.log(" LiveKit audio element created")}return()=>{O.current&&O.current.parentNode&&(document.body.removeChild(O.current),O.current=null)}},[]),E.useEffect(()=>{if(!n)return;const I=(q,H,B)=>{const G=z(B==null?void 0:B.identity);if(q.kind==="audio"&&G&&O.current){const ve=O.current;g.current=!0,console.log(" LiveKit audio track subscribed - enabling HeyGen sends");const Ee=new MediaStream([q.mediaStreamTrack]);ve.srcObject=Ee;const Ct=()=>{g.current=!1,console.log(" LiveKit audio track ended - stopping HeyGen sends"),V(" Audio ended")};q.on("ended",Ct);const pt=()=>{g.current=!1,console.log(" LiveKit audio element ended - stopping HeyGen sends"),V(" Audio ended")};ve.addEventListener("ended",pt),ve.play().catch(it=>{console.error("Failed to play LiveKit audio:",it),V(" LiveKit audio playback failed - may need user interaction")}),V("LiveKit audio connected "),console.log(" LiveKit audio track attached from",B==null?void 0:B.identity)}},K=(q,H,B)=>{const G=z(B==null?void 0:B.identity);q.kind==="audio"&&G&&(g.current=!1,console.log(" LiveKit audio track unsubscribed - stopping HeyGen sends"),V(" Audio track unsubscribed"))};return n.on(D.TrackSubscribed,I),n.on(D.TrackUnsubscribed,K),n.remoteParticipants.forEach(q=>{z(q==null?void 0:q.identity)&&q.audioTrackPublications.forEach(B=>{if(B.track&&B.isSubscribed&&O.current){const G=O.current,ve=new MediaStream([B.track.mediaStreamTrack]);G.srcObject=ve,g.current=!0;const Ee=()=>{g.current=!1,console.log(" LiveKit audio track ended - stopping HeyGen sends"),V(" Audio ended")};B.track.on("ended",Ee);const Ct=()=>{g.current=!1,console.log(" LiveKit audio element ended - stopping HeyGen sends"),V(" Audio ended")};G.addEventListener("ended",Ct),G.play().catch(pt=>{console.error("Failed to play existing LiveKit audio:",pt)}),V("LiveKit audio connected "),console.log(" Existing LiveKit audio track attached from",q==null?void 0:q.identity)}})}),()=>{n.off(D.TrackSubscribed,I),n.off(D.TrackUnsubscribed,K)}},[n,V,z]),E.useEffect(()=>((async()=>{try{V("Starting your camera..."),await P(),V("Camera ready ")}catch(K){V(`Camera not available (${K.message}) - continuing without webcam`)}})(),()=>{x()}),[]),E.useEffect(()=>{if(!e){V("Waiting for HeyGen peer connection...");return}if(!N.current)return;const I=N.current;I.muted=!0,I.volume=0;const q=(()=>{try{const H=e.getReceivers(),B=[];for(const G of H)G.track&&G.track.kind==="video"&&B.push(G.track);if(B.length>0){const G=new MediaStream(B);return I.srcObject=G,V("HeyGen video connected "),I.play().catch(()=>{}),!0}}catch(H){V(`Error checking existing tracks: ${(H==null?void 0:H.message)||H||"unknown error"}`)}return!1})();e.ontrack=H=>{if(H.track&&H.track.kind==="video"){let B=I.srcObject;B||(B=new MediaStream,I.srcObject=B),B.getVideoTracks().forEach(G=>B.removeTrack(G)),B.addTrack(H.track),V("HeyGen video track connected "),I.play().catch(()=>{})}},q||V("Waiting for HeyGen video stream...")},[e,V]);const Te=E.useCallback(I=>{var H;if(!I||!I.trim())return;const K=Date.now(),q=((H=n==null?void 0:n.localParticipant)==null?void 0:H.identity)||"user";h(B=>{const G=I.trim();if(B.some(it=>it.text===G&&it.sender==="user"&&it.participantId===q&&Math.abs(K-(it.timestampMs||0))<2e3))return B;let Ee=f(q,G,K),Ct=0;for(;B.some(it=>it.id===Ee);)Ee=`${Ee}-${Ct}`,Ct++;const pt={id:Ee,text:G,sender:"user",timestamp:new Date(K).toLocaleTimeString(),timestampMs:K,participantId:q};return[...B,pt]}),V(`You: ${I.substring(0,50)}${I.length>50?"...":""}`)},[n,V,f]),ft=E.useCallback(async I=>{if(!(!I.trim()||!n))try{if(Te(I),b(""),n.localParticipant)try{await n.localParticipant.sendText(I,{topic:"lk.chat"}),V(`Sent: ${I}`),n.remoteParticipants.size===0?V(" Message sent, but no agent connected to room"):V("Message sent to agent")}catch{try{const H=new TextEncoder().encode(JSON.stringify({type:"text_message",text:I,timestamp:Date.now()}));await n.localParticipant.publishData(H,{reliable:!0}),V(`Sent: ${I}`)}catch(q){V(`Error sending message: ${q.message}`)}}else V("Error: Not connected to LiveKit room")}catch(K){V(`Error sending message: ${K.message}`)}},[n,Te,V]),nt=E.useCallback(async()=>{if(!a)try{if(c(!0),V("Starting conversation with LiveKit agent..."),R.current)try{await R.current.localParticipant.setMicrophoneEnabled(!0),V("Microphone connected - speak naturally!")}catch{V("Microphone not available - agent can still hear you if enabled")}V("Conversation started! Speak naturally to the agent.")}catch(I){V(`Error: ${I.message}`)}},[a,R,V]),Tt=async()=>{try{V("Ending interview..."),R.current&&await Gr.disconnect(),typeof x=="function"&&x(),r()}catch(I){console.error("Error during exit:",I),r()}},W=E.useCallback((I,K,q=!1)=>{if(!I||!I.trim())return;const H=I.trim();if(h(B=>{const G=B.length-1;if(G>=0&&B[G].sender==="agent"){const rt=B[G],_n=rt.text.trim();if(H.startsWith(_n)||_n.length>0&&H.length>_n.length&&H.substring(0,_n.length)===_n||q){const qs=[...B];return qs[G]={...rt,text:H,timestamp:new Date().toLocaleTimeString(),timestampMs:Date.now()},qs}}if(B.some(rt=>rt.text===H&&rt.sender==="agent"))return B;const Ee=Date.now(),Ct=(K==null?void 0:K.identity)||"agent";let pt=f(Ct,H,Ee),it=0;for(;B.some(rt=>rt.id===pt);)pt=`${pt}-${it}`,it++;const Ws={id:pt,text:H,sender:"agent",timestamp:new Date(Ee).toLocaleTimeString(),timestampMs:Ee,participantId:Ct};return[...B,Ws]}),i&&H!==p.current&&g.current){let B=H;if(p.current&&H.startsWith(p.current)&&(B=H.substring(p.current.length).trim(),!B))return;p.current=H,pi.sendTask(i,B).then(()=>{V(` Avatar speaking: "${B.substring(0,30)}..."`),console.log(` Sent to HeyGen (new portion): "${B}"`)}).catch(G=>{console.error(` Failed to send to HeyGen: "${B}"`,G),V(` HeyGen speak failed: ${G.message}`),p.current=""})}else g.current||console.log(" LiveKit audio not active - skipping HeyGen send");q||V(`Agent: ${I.substring(0,50)}${I.length>50?"...":""}`)},[V,f,i]);E.useEffect(()=>{if(!n)return;const I=async(B,G)=>{var ve,Ee,Ct,pt,it,Ws,ec;try{const rt=await B.readAll(),_n=((Ee=(ve=B.info)==null?void 0:ve.attributes)==null?void 0:Ee["lk.transcribed_track_id"])!=null,tc=((pt=(Ct=B.info)==null?void 0:Ct.attributes)==null?void 0:pt["lk.transcription_final"])==="true",qs=(Ws=(it=B.info)==null?void 0:it.attributes)==null?void 0:Ws["lk.segment_id"],nc=((ec=n==null?void 0:n.localParticipant)==null?void 0:ec.identity)===(G==null?void 0:G.identity),T0=!nc&&z(G==null?void 0:G.identity);console.log(" Text stream received",{participant:G==null?void 0:G.identity,message:rt.substring(0,50),isTranscription:_n,isFinal:tc,segmentId:qs,isLocalParticipant:nc,isAgent:T0}),_n&&nc&&rt.trim()&&tc&&(Te(rt),console.log(" Added user transcription to chat:",rt))}catch(rt){console.error("Error in text stream handler:",rt)}};n.registerTextStreamHandler("lk.transcription",I);const K=B=>{z(B==null?void 0:B.identity)?(V(` Agent ${B.identity} connected!`),a||setTimeout(()=>{nt()},1500)):V(`Participant ${B.identity} connected (not an agent)`)},q=B=>{V(`Agent ${B.identity} disconnected`)};n.on(D.ParticipantConnected,K),n.on(D.ParticipantDisconnected,q),n.remoteParticipants.size===0?V(" Agent not connected - check agent settings in LiveKit Cloud"):(V("Agent connected - starting conversation..."),a||setTimeout(()=>{nt()},1e3)),u(!0);const H=setInterval(()=>{if(n.remoteParticipants.size===0){const G=Date.now();(!window.lastParticipantWarning||G-window.lastParticipantWarning>6e4)&&(V(" No remote participants in room. Waiting for agent to join..."),window.lastParticipantWarning=G)}else{const G=Date.now();(!window.lastParticipantLog||G-window.lastParticipantLog>6e4)&&(window.lastParticipantLog=G)}},5e3);return()=>{clearInterval(H),n&&n.unregisterTextStreamHandler("lk.transcription",I),n.off(D.ParticipantConnected,K),n.off(D.ParticipantDisconnected,q)}},[n,V,W,Te,nt,a,z,i]),E.useEffect(()=>{const I=document.getElementById("chat-messages");I&&(I.scrollTop=I.scrollHeight)},[d]);const J=()=>n?k.jsx(b0.Provider,{value:n,children:k.jsx(Q_,{addAgentMessageToChat:W})}):null;return k.jsxs("div",{className:"interview-container",children:[k.jsx(J,{}),v&&k.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",width:"400px",maxHeight:"500px",backgroundColor:"#1e293b",borderRadius:"12px",padding:"20px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2)",border:"2px solid #3b82f6",zIndex:1e4,display:"flex",flexDirection:"column",overflow:"hidden"},children:k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",flexShrink:0},children:[k.jsxs("h3",{style:{margin:0,color:"#3b82f6",fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""}),k.jsx("span",{children:"Complete Message"})]}),k.jsx("button",{onClick:()=>w(!1),style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"20px",cursor:"pointer",padding:"4px 8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",lineHeight:"1"},onMouseOver:I=>{I.target.style.backgroundColor="#334155",I.target.style.color="#f1f5f9"},onMouseOut:I=>{I.target.style.backgroundColor="transparent",I.target.style.color="#94a3b8"},title:"Close",children:""})]})}),k.jsxs("div",{className:"interview-main-content",children:[k.jsxs("div",{className:"webcam-container-top",children:[C?k.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,className:"webcam-video"}):k.jsxs("div",{className:"webcam-placeholder",children:[k.jsx("div",{className:"placeholder-icon",children:""}),k.jsx("div",{className:"placeholder-text",children:"Camera Not Available"})]}),k.jsx("div",{className:"video-label",children:"You (Interviewer)"})]}),k.jsxs("div",{className:"avatar-container-center",children:[k.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,className:"avatar-video"}),k.jsxs("div",{className:"avatar-info",children:[k.jsx("div",{className:"avatar-badge",style:{backgroundColor:t.backgroundColor},children:t.initials}),k.jsxs("div",{className:"avatar-details",children:[k.jsx("h2",{children:t.fullName}),k.jsx("p",{children:t.role})]})]})]}),k.jsx("div",{className:"interview-controls",children:a?k.jsxs("div",{className:"conversation-controls",children:[k.jsxs("div",{className:"livekit-status",children:[k.jsx("p",{children:" LiveKit agent is listening - speak naturally!"}),k.jsx("p",{className:"status-hint",children:"Your voice is automatically sent to the agent"})]}),k.jsx("button",{className:"btn-close",onClick:Tt,children:"End Interview"})]}):k.jsxs("div",{className:"initial-controls",children:[k.jsxs("div",{className:"waiting-status",children:[k.jsx("p",{children:" Waiting for agent to connect and start conversation..."}),(n==null?void 0:n.remoteParticipants.size)===0&&k.jsx("p",{className:"status-hint",children:"Make sure LIVEKIT_AGENT_NAME is set in your .env file"})]}),k.jsx("button",{className:"btn-primary btn-large",onClick:Tt,children:"Close Interview"})]})}),k.jsx("div",{className:"status-log",children:k.jsxs("details",{children:[k.jsxs("summary",{children:["Status Log (",s.length,")"]}),k.jsx("div",{className:"status-messages",children:s.map((I,K)=>k.jsx("div",{className:"status-message",children:I},K))})]})})]}),k.jsxs("div",{className:"chat-window",children:[k.jsxs("div",{className:"chat-header",children:[k.jsx("h3",{children:" Chat"}),k.jsx("span",{className:"chat-status",children:l?k.jsxs(k.Fragment,{children:[" Connected",(n==null?void 0:n.remoteParticipants.size)>0&&k.jsxs("span",{style:{marginLeft:"8px",fontSize:"11px"},children:["(",n.remoteParticipants.size," agent",n.remoteParticipants.size>1?"s":"",")"]})]}):" Disconnected"})]}),k.jsx("div",{className:"chat-messages",id:"chat-messages",children:d.length===0?k.jsxs("div",{className:"chat-empty",children:[k.jsx("p",{children:"No messages yet."}),k.jsx("p",{className:"chat-hint",children:"Type a message or speak to the agent!"})]}):d.map((I,K)=>k.jsxs("div",{className:`chat-message ${I.sender==="user"?"chat-message-user":"chat-message-agent"}`,children:[k.jsxs("div",{className:"chat-message-header",children:[k.jsx("span",{className:"chat-message-sender",children:I.sender==="user"?"You":(t==null?void 0:t.fullName)||"Agent"}),k.jsx("span",{className:"chat-message-time",children:I.timestamp||"Now"})]}),k.jsx("div",{className:"chat-message-text",children:I.text||"(empty message)"})]},I.id||`msg-${K}`))}),k.jsxs("div",{className:"chat-input-container",children:[k.jsx("input",{type:"text",className:"chat-input",placeholder:l?"Type your message...":"Connecting...",value:m,onChange:I=>b(I.target.value),onKeyDown:I=>{I.key==="Enter"&&m.trim()&&l&&ft(m)},disabled:!l}),k.jsx("button",{className:"chat-send-button",onClick:()=>ft(m),disabled:!m.trim()||!l,title:l?"Send message":"Waiting for LiveKit connection...",children:"Send"})]}),l&&k.jsxs("div",{className:"chat-debug-info",children:[k.jsx("small",{style:{color:"rgba(255,255,255,0.5)",fontSize:"10px",padding:"4px 16px",display:"block"},children:" Tip: Check browser console (F12) for data channel logs."}),(n==null?void 0:n.remoteParticipants.size)===0?k.jsx("small",{style:{color:"#ffa500",fontSize:"10px",padding:"4px 16px",display:"block"},children:" Waiting for agent to join the room... (Check your LiveKit agent process)"}):k.jsxs("small",{style:{color:"#4ade80",fontSize:"10px",padding:"4px 16px",display:"block"},children:[" ",n.remoteParticipants.size," participant(s) in room",Array.from(n.remoteParticipants.values()).map(I=>{var q,H,B,G;const K=((q=I.identity)==null?void 0:q.includes("agent"))||((H=I.identity)==null?void 0:H.includes("bot"))||((B=I.identity)==null?void 0:B.includes("Dakota"))||((G=I.identity)==null?void 0:G.toLowerCase().includes("dakota"));return k.jsxs("span",{style:{marginLeft:"8px",color:K?"#4ade80":"#93c5fd"},children:[I.identity," ",K?"(agent)":"(user)"]},I.sid)}),n.remoteParticipants.size>0&&!Array.from(n.remoteParticipants.values()).some(I=>{var K,q,H,B;return((K=I.identity)==null?void 0:K.includes("agent"))||((q=I.identity)==null?void 0:q.includes("bot"))||((H=I.identity)==null?void 0:H.includes("Dakota"))||((B=I.identity)==null?void 0:B.toLowerCase().includes("dakota"))})&&k.jsx("span",{style:{marginLeft:"8px",color:"#fbbf24",fontSize:"9px"},children:"(No agent detected - may be voice-only)"})]})]})]})]})}class X_{constructor(){this.baseUrl=hn.backend.baseUrl}getHeaders(){return{"Content-Type":"application/json",...$t.getAuthHeader()}}async checkHealth(){try{const e=await fetch(`${this.baseUrl}/health`,{method:"GET",headers:this.getHeaders()});if(!e.ok)throw new Error(`Backend health check failed: ${e.status}`);return await e.json()}catch{throw new Error(`Cannot connect to backend at ${this.baseUrl}`)}}}const Mp=new X_;function Z_({onStatusChange:t,isAuthenticated:e}){const[n,i]=E.useState("idle"),[r,s]=E.useState(null),o=E.useCallback(async()=>{try{i("checking"),s(null),await Mp.checkHealth(),i("connected"),t==null||t({connected:!0,agentsReady:!0})}catch(a){s(a.message),i("error"),t==null||t({connected:!1,agentsReady:!1})}},[t]);return E.useEffect(()=>{e?o():(i("idle"),s(null),t==null||t({connected:!1,agentsReady:!1}))},[e,o,t]),!e||n==="connected"?null:k.jsx("div",{className:"backend-status-overlay",children:k.jsxs("div",{className:"backend-status-modal",children:[k.jsx("h2",{children:"Backend Connection"}),n==="checking"&&k.jsxs("div",{className:"status-content",children:[k.jsx("div",{className:"spinner-large"}),k.jsx("p",{children:"Checking backend connection..."})]}),n==="error"&&k.jsxs("div",{className:"status-content status-error",children:[k.jsx("div",{className:"error-icon",children:""}),k.jsx("p",{className:"error-message",children:"Cannot connect to backend"}),k.jsx("p",{className:"error-detail",children:r}),k.jsx("div",{className:"error-actions",children:k.jsx("button",{className:"btn-retry",onClick:o,children:"Retry Connection"})}),k.jsxs("div",{className:"error-help",children:[k.jsx("strong",{children:"Troubleshooting:"}),k.jsxs("ul",{children:[k.jsxs("li",{children:["Ensure backend is running: ",k.jsx("code",{children:"python run.py"})]}),k.jsxs("li",{children:["Check backend URL in config: ",k.jsx("code",{children:Mp.baseUrl})]}),k.jsx("li",{children:"Verify LiveKit credentials are configured in backend .env"})]})]})]})]})})}class e1{constructor(e,n={}){this.iceServers=this._enhanceIceServers(e),this.options={iceCandidatePoolSize:10,...n},this.peerConnection=null,this.iceGatheringTimeout=null}createPeerConnection(){return this.peerConnection=new RTCPeerConnection({iceServers:this.iceServers,iceCandidatePoolSize:this.options.iceCandidatePoolSize}),this.peerConnection}async setRemoteDescription(e){if(!this.peerConnection)throw new Error("Peer connection not initialized");const n=new RTCSessionDescription(e);await this.peerConnection.setRemoteDescription(n)}async createAnswer(){if(!this.peerConnection)throw new Error("Peer connection not initialized");const e=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(e),e}setupIceCandidateHandler(e){if(!this.peerConnection)throw new Error("Peer connection not initialized");this.peerConnection.onicecandidate=({candidate:n})=>{n&&e(n)}}configureJitterBuffer(e=500){if(!this.peerConnection)return;this.peerConnection.getReceivers().forEach(i=>{i.jitterBufferTarget!==void 0&&(i.jitterBufferTarget=e)})}close(){this.iceGatheringTimeout&&(clearTimeout(this.iceGatheringTimeout),this.iceGatheringTimeout=null),this.peerConnection&&(this.peerConnection.onicecandidate=null,this.peerConnection.close(),this.peerConnection=null)}getPeerConnection(){return this.peerConnection}_enhanceIceServers(e){return[...e,{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}class t1{constructor(){this.sessionInfo=null,this.webRTCManager=null,this.isConnected=!1}async createSession(e,n,i="low"){const r=await pi.createSession(i,e,n),{sdp:s,ice_servers2:o}=r;this.webRTCManager=new e1(o);const a=this.webRTCManager.createPeerConnection();return await this.webRTCManager.setRemoteDescription(s),this.sessionInfo=r,this.isConnected=!1,{session:r,peerConnection:a}}async startSession(e,n,i){if(!this.sessionInfo||!this.webRTCManager)throw new Error("Please create a connection first");const r=this.webRTCManager.getPeerConnection();e&&(r.ontrack=e),n&&(r.ondatachannel=n),i&&this.webRTCManager.setupIceCandidateHandler(o=>{i(this.sessionInfo.session_id,o.toJSON())});const s=await this.webRTCManager.createAnswer();await pi.startSession(this.sessionInfo.session_id,s),this.webRTCManager.configureJitterBuffer(500),this.isConnected=!0}async sendTask(e){if(!this.sessionInfo)throw new Error("Please create a connection first");return await pi.sendTask(this.sessionInfo.session_id,e)}async closeSession(){!this.sessionInfo||!this.webRTCManager||(this.webRTCManager.close(),await pi.stopSession(this.sessionInfo.session_id),this.sessionInfo=null,this.webRTCManager=null,this.isConnected=!1)}getPeerConnection(){var e;return((e=this.webRTCManager)==null?void 0:e.getPeerConnection())||null}}function n1(){const[t,e]=E.useState(null),[n,i]=E.useState(null),[r,s]=E.useState(!1),o=E.useRef(new t1),a=E.useCallback(async(d,h,m="low")=>{const b=await o.current.createSession(d,h,m),{session:v,peerConnection:w}=b;return i(w),e(v),s(!1),{session:v,peerConnection:w}},[]),c=E.useCallback(async(d,h)=>{const m=(b,v)=>{pi.submitIceCandidate(b,v)};await o.current.startSession(d,h,m),s(!0)},[]),l=E.useCallback(async d=>await o.current.sendTask(d),[]),u=E.useCallback(async()=>{await o.current.closeSession(),i(null),e(null),s(!1)},[]);return{sessionInfo:t,peerConnection:n,isConnected:r,createNewSession:a,startSession:c,sendTask:l,closeSession:u}}function i1(){const[t,e]=E.useState(!1),[n,i]=E.useState(null),[r,s]=E.useState("dashboard"),[o,a]=E.useState("Initializing..."),[c,l]=E.useState(!1),[u,d]=E.useState(null);E.useEffect(()=>{if((r==="loading"||r==="interview")&&!u){const R=setTimeout(()=>{console.warn(" View stuck in",r,"- resetting to dashboard"),s("dashboard"),i(null),a("Initializing...")},3e4);return()=>clearTimeout(R)}},[r,n,u]);const{sessionInfo:h,peerConnection:m,isConnected:b,createNewSession:v,startSession:w,closeSession:p}=n1();E.useEffect(()=>{(async()=>{$t.isAuthenticated()&&await $t.verifyToken()&&e(!0)})()},[]);const g=Fs(),S=E.useCallback(()=>{e(!0),s("dashboard"),g("/dashboard")},[g]),f=E.useCallback(()=>{$t.signOut(),e(!1),i(null),s("dashboard"),g("/")},[g]),y=E.useCallback(R=>{l(R.connected)},[]);E.useEffect(()=>{const R=()=>{h&&h.session_id&&pi.stopSessionSync(h.session_id),u&&Gr.disconnect()};return window.addEventListener("beforeunload",R),()=>{window.removeEventListener("beforeunload",R)}},[h,u]);const C=E.useCallback(async R=>{if(!c){alert("Backend is not ready. Please wait for backend initialization to complete.");return}i(R),s("loading"),a("Creating HeyGen session...");try{a("Connecting to HeyGen avatar..."),await v(R.heygenAvatarId,R.heygenVoiceId,"low"),a("Starting HeyGen video stream..."),await w(null,J=>{const I=J.channel;I.onmessage=()=>{}}),a("HeyGen video connected "),a("Connecting to LiveKit agent...");const z=`room-avatar-${R.id}`,V=`user-${Date.now()}`,Te=(h==null?void 0:h.session_id)||null,ft=await Gr.connectToRoom(z,V,R.id,Te,()=>{},()=>{a("LiveKit agent connected ")},()=>{d(null)});d(ft),a("Waiting for agent to join...");let nt=0;const Tt=10,W=setInterval(()=>{nt++,ft.remoteParticipants.size>0?(clearInterval(W),a("Agent connected "),setTimeout(()=>{s("interview")},500)):nt>=Tt?(clearInterval(W),a(" Agent did not join - check LIVEKIT_AGENT_NAME in .env"),setTimeout(()=>{s("interview")},2e3)):a(`Waiting for agent to join... (${nt}/${Tt})`)},1e3)}catch(O){let z="Unknown error";O instanceof Error?z=O.message||String(O):typeof O=="string"?z=O:O&&typeof O=="object"?z=O.message||O.detail||O.error||JSON.stringify(O):z=String(O),alert(`Failed to create interview session: ${z}`),s("dashboard"),i(null),d(null),a("Initializing...")}},[v,w,c,h]),P=E.useCallback(async()=>{try{await Gr.disconnect(),await p()}catch{}d(null),i(null),s("dashboard")},[p]),x=E.useCallback(async()=>{try{u&&await Gr.disconnect(),h&&await p()}catch{}d(null),i(null),s("dashboard")},[u,h,p]),N=r!=="interview"&&r!=="loading";return k.jsxs("div",{className:"app",children:[N&&k.jsx(HS,{isAuthenticated:t,onAuthenticated:S,onLogout:f}),k.jsx(Z_,{onStatusChange:y,isAuthenticated:t}),k.jsxs(zS,{children:[k.jsx(Ai,{path:"/",element:k.jsx(JS,{})}),k.jsx(Ai,{path:"/signin",element:t?k.jsx(co,{to:"/dashboard",replace:!0}):k.jsx(XS,{onSuccess:S})}),k.jsx(Ai,{path:"/signup",element:t?k.jsx(co,{to:"/dashboard",replace:!0}):k.jsx(ZS,{onSuccess:S})}),k.jsx(Ai,{path:"/settings",element:t?k.jsx(eT,{onLogout:f}):k.jsx(co,{to:"/",replace:!0})}),k.jsx(Ai,{path:"/dashboard",element:t?k.jsx(YS,{onAvatarSelect:C,backendReady:c}):k.jsx(co,{to:"/",replace:!0})})]}),t&&k.jsxs(k.Fragment,{children:[r==="loading"&&n&&k.jsx(GS,{avatar:n,status:o,onCancel:x}),r==="interview"&&n&&u&&k.jsx(Y_,{avatar:n,peerConnection:m||null,isConnected:b,livekitRoom:u,heygenSessionId:(h==null?void 0:h.session_id)||null,onExit:P})]})]})}Xc.createRoot(document.getElementById("root")).render(k.jsx($p.StrictMode,{children:k.jsx($S,{children:k.jsx(i1,{})})}));
